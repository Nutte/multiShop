This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
app/
  Console/
    Commands/
      TenantsLinkCommand.php
      TenantsMigrateCommand.php
      TenantsStorageLinkCommand.php
  Http/
    Controllers/
      Admin/
        AttributeController.php
        AuthController.php
        CategoryController.php
        ClothingLineController.php
        ContactMessageController.php
        DashboardController.php
        InventoryController.php
        ManagerController.php
        OrderController.php
        ProductController.php
        PromoCodeController.php
        ReportController.php
        SettingsController.php
        TelegramSettingsController.php
        UserController.php
      Api/
        ProductController.php
      Client/
        AuthController.php
        ContactController.php
        ProfileController.php
      CartController.php
      Controller.php
      ShopController.php
    Middleware/
      AdminTenantMiddleware.php
      SuperAdminMiddleware.php
      TenantMiddleware.php
  Models/
    AttributeOption.php
    Category.php
    ClothingLine.php
    ContactMessage.php
    Order.php
    OrderItem.php
    Product.php
    ProductImage.php
    ProductVariant.php
    PromoCode.php
    TelegramConfig.php
    TenantSetting.php
    User.php
  Providers/
    AppServiceProvider.php
  Services/
    CartService.php
    ProductService.php
    SearchService.php
    TelegramService.php
    TenantService.php
bootstrap/
  cache/
    .gitignore
  app.php
  providers.php
config/
  app.php
  auth.php
  cache.php
  database.php
  filesystems.php
  logging.php
  mail.php
  queue.php
  services.php
  session.php
  tenants.php
database/
  factories/
    UserFactory.php
  migrations/
    0001_01_01_000000_create_users_table.php
    0001_01_01_000001_create_cache_table.php
    0001_01_01_000002_create_jobs_table.php
    2024_01_01_000001_create_products_table.php
    2024_01_01_000002_create_orders_table.php
    2024_01_01_000003_create_tenant_settings_table.php
    2024_01_01_000004_add_tenant_id_to_users_table.php
    2024_01_01_000005_add_image_to_products_table.php
    2024_01_01_000006_create_categories_table.php
    2024_01_01_000007_refactor_categories_and_attributes.php
    2024_01_01_000009_clean_products_table_columns.php
    2024_01_01_000010_create_product_images_table.php
    2024_01_01_000011_create_product_variants_table.php
    2024_01_01_000012_create_telegram_configs_table.php
    2024_01_01_000013_create_clothing_lines_table.php
    2024_01_01_000014_add_discounts_and_promocodes.php
    2024_01_01_000015_update_promo_codes_structure.php
    2024_01_01_000016_create_orders_system.php
    2024_01_01_000020_recreate_orders_tables.php
    2024_01_01_000021_update_users_and_orders_for_clients.php
    2024_01_01_000022_link_orphaned_orders.php
    2024_01_01_000023_add_access_key_to_users.php
    2024_01_01_000030_create_contact_messages_table.php
  seeders/
    DatabaseSeeder.php
  .gitignore
docker/
  nginx/
    conf.d/
      app.conf
  php/
    Dockerfile
    local.ini
public/
  .htaccess
  favicon.ico
  index.php
  robots.txt
resources/
  css/
    app.css
  js/
    app.js
    bootstrap.js
  views/
    admin/
      attributes/
        index.blade.php
      auth/
        login.blade.php
      categories/
        index.blade.php
      clothing_lines/
        index.blade.php
      inventory/
        index.blade.php
      managers/
        form.blade.php
        index.blade.php
      messages/
        index.blade.php
        show.blade.php
      orders/
        index.blade.php
        show.blade.php
      products/
        form.blade.php
        index.blade.php
        select_tenant.blade.php
      promocodes/
        create.blade.php
        index.blade.php
      reports/
        index.blade.php
      settings/
        index.blade.php
      users/
        create.blade.php
        edit.blade.php
        index.blade.php
        show.blade.php
      dashboard.blade.php
    cart/
      index.blade.php
    client/
      auth/
        login.blade.php
      profile/
        index.blade.php
        order.blade.php
    layouts/
      admin.blade.php
      app.blade.php
    shop/
      contact.blade.php
      home.blade.php
      product.blade.php
    welcome.blade.php
routes/
  api.php
  console.php
  web.php
storage/
  tenants/
    designer_hub/
      cache/
        .gitignore
      logs/
        .gitignore
      media/
        .gitignore
    military_gear/
      cache/
        .gitignore
      logs/
        .gitignore
      media/
        .gitignore
    street_style/
      cache/
        .gitignore
      logs/
        .gitignore
      media/
        .gitignore
tests/
  Feature/
    ExampleTest.php
  Unit/
    ExampleTest.php
  TestCase.php
.editorconfig
.env.example
.gitattributes
.gitignore
artisan
composer.json
docker-compose.yml
full_reset.sh
package.json
phpunit.xml
README.md
refresh.sh
setup_structure.sh
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/Http/Controllers/Admin/ContactMessageController.php">
<?php

// FILE: app/Http/Controllers/Admin/ContactMessageController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\ContactMessage;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Pagination\LengthAwarePaginator;

class ContactMessageController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    public function index(Request $request)
    {
        $user = auth()->user();
        $isSuperAdmin = $user->role === 'super_admin';
        
        // ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚
        $currentTenantId = null;
        if ($isSuperAdmin) {
            $currentTenantId = $request->get('tenant_id');
        } else {
            $currentTenantId = $this->tenantService->getCurrentTenantId();
        }

        $messages = collect();
        $paginatedMessages = null;

        if ($currentTenantId) {
            // 1. ÐšÐžÐÐšÐ Ð•Ð¢ÐÐ«Ð™ ÐœÐÐ“ÐÐ—Ð˜Ð
            $this->tenantService->switchTenant($currentTenantId);
            $paginatedMessages = ContactMessage::latest()->paginate(20);
            // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¸Ð½Ñ„Ñƒ Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ
            $paginatedMessages->getCollection()->transform(function ($msg) use ($currentTenantId) {
                $msg->tenant_id = $currentTenantId;
                $msg->tenant_name = config("tenants.tenants.{$currentTenantId}.name");
                return $msg;
            });
        } else {
            // 2. Ð’Ð¡Ð• ÐœÐÐ“ÐÐ—Ð˜ÐÐ« (Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð¡ÑƒÐ¿ÐµÑ€-ÐÐ´Ð¼Ð¸Ð½)
            // ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· Ð²ÑÐµÑ… ÑÑ…ÐµÐ¼
            $allMessages = collect();
            
            foreach (config('tenants.tenants') as $id => $config) {
                try {
                    $this->tenantService->switchTenant($id);
                    // Ð‘ÐµÑ€ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 20 Ð¸Ð· ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ³Ñ€ÑƒÐ¶Ð°Ñ‚ÑŒ Ð¿Ð°Ð¼ÑÑ‚ÑŒ
                    $tenantMessages = ContactMessage::latest()->limit(20)->get();
                    
                    foreach ($tenantMessages as $msg) {
                        $msg->tenant_id = $id;
                        $msg->tenant_name = $config['name'];
                        $allMessages->push($msg);
                    }
                } catch (\Exception $e) {
                    continue;
                }
            }

            // Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð²ÑÐµ ÑÐ¾Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ
            $sorted = $allMessages->sortByDesc('created_at')->values();
            
            // Ð ÑƒÑ‡Ð½Ð°Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸
            $perPage = 20;
            $page = $request->get('page', 1);
            $paginatedMessages = new LengthAwarePaginator(
                $sorted->forPage($page, $perPage),
                $sorted->count(),
                $perPage,
                $page,
                ['path' => $request->url(), 'query' => $request->query()]
            );
        }

        return view('admin.messages.index', [
            'messages' => $paginatedMessages,
            'currentTenantId' => $currentTenantId
        ]);
    }

    // ÐŸÐ¾Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ ÐºÐ°Ðº Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ð¾Ðµ / ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ
    public function show(Request $request, $id)
    {
        // Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð½ÑƒÐ¶Ð½Ð¾ Ð·Ð½Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
        $tenantId = $request->get('tenant_id');
        if (!$tenantId) {
            // Ð•ÑÐ»Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½, Ð¿Ñ‹Ñ‚Ð°ÐµÐ¼ÑÑ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð´Ð»Ñ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°
            if (auth()->user()->role !== 'super_admin') {
                $tenantId = $this->tenantService->getCurrentTenantId();
            } else {
                return back()->with('error', 'Tenant ID required to view message.');
            }
        }

        $this->tenantService->switchTenant($tenantId);
        $message = ContactMessage::findOrFail($id);
        
        // ÐŸÐ¾Ð¼ÐµÑ‡Ð°ÐµÐ¼ ÐºÐ°Ðº Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ð¾Ðµ
        if (!$message->is_read) {
            $message->update(['is_read' => true]);
        }

        return view('admin.messages.show', compact('message', 'tenantId'));
    }

    public function destroy(Request $request, $id)
    {
        $tenantId = $request->get('tenant_id');
        if (auth()->user()->role !== 'super_admin' && !$tenantId) {
             $tenantId = $this->tenantService->getCurrentTenantId();
        }

        $this->tenantService->switchTenant($tenantId);
        ContactMessage::destroy($id);

        return redirect()->route('admin.messages.index', ['tenant_id' => $tenantId])
            ->with('success', 'Message deleted.');
    }
}
</file>

<file path="app/Http/Controllers/Client/ContactController.php">
<?php

// FILE: app/Http/Controllers/Client/ContactController.php

namespace App\Http\Controllers\Client;

use App\Http\Controllers\Controller;
use App\Models\ContactMessage;
use App\Services\TenantService;
use Illuminate\Http\Request;

class ContactController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function resolveTenant()
    {
        $host = request()->getHost();
        $map = $this->tenantService->getDomainMap();
        $tenantId = $map[$host] ?? 'default';
        $this->tenantService->switchTenant($tenantId);
        return $tenantId;
    }

    // ÐŸÐ¾ÐºÐ°Ð· Ñ„Ð¾Ñ€Ð¼Ñ‹
    public function index()
    {
        $tenantId = $this->resolveTenant();
        
        // ÐŸÑ‹Ñ‚Ð°ÐµÐ¼ÑÑ Ð½Ð°Ð¹Ñ‚Ð¸ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½, ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ - Ð¾Ð±Ñ‰Ð¸Ð¹
        $view = "tenants.{$tenantId}.contact";
        if (!view()->exists($view)) {
            $view = 'shop.contact';
        }

        return view($view);
    }

    // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸
    public function store(Request $request)
    {
        $this->resolveTenant();

        $validated = $request->validate([
            'email' => 'required|email',
            'phone' => 'nullable|string|max:20',
            'message' => 'required|string|min:10|max:2000',
        ]);

        ContactMessage::create($validated);

        return back()->with('success', 'Thank you! Your message has been sent. We will contact you shortly.');
    }
}
</file>

<file path="app/Models/ContactMessage.php">
<?php

// FILE: app/Models/ContactMessage.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class ContactMessage extends Model
{
    use HasFactory;

    protected $fillable = [
        'email',
        'phone',
        'message',
        'is_read',
    ];

    protected $casts = [
        'is_read' => 'boolean',
    ];
}
</file>

<file path="database/migrations/2024_01_01_000030_create_contact_messages_table.php">
<?php

// File - database/migrations/2024_01_01_000030_create_contact_messages_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('contact_messages', function (Blueprint $table) {
            $table->id();
            $table->string('email');
            $table->string('phone')->nullable();
            $table->text('message');
            $table->boolean('is_read')->default(false); // Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¿Ñ€Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ñ
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('contact_messages');
    }
};
</file>

<file path="resources/views/admin/messages/index.blade.php">
<!-- FILE: resources/views/admin/messages/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Inbox')

@section('content')
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold flex items-center gap-2">
            <span>ðŸ“¬ Inbox</span>
            @if(auth()->user()->role === 'super_admin' && !$currentTenantId)
                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">All Stores</span>
            @endif
        </h1>
    </div>

    <!-- Toolbar -->
    <div class="bg-white p-4 rounded shadow mb-6 border border-gray-200">
        <form method="GET" action="{{ route('admin.messages.index') }}" class="flex items-end gap-4">
            <!-- Store Selector (Super Admin Only) -->
            @if(auth()->user()->role === 'super_admin')
                <div class="flex-1 max-w-xs">
                    <label class="block text-xs font-bold text-gray-500 mb-1">Store Context</label>
                    <select name="tenant_id" class="w-full border p-2 rounded bg-yellow-50 border-yellow-200" onchange="this.form.submit()">
                        <option value="">ALL STORES (Overview)</option>
                        @foreach(config('tenants.tenants') as $id => $data)
                            <option value="{{ $id }}" {{ $currentTenantId === $id ? 'selected' : '' }}>
                                {{ $data['name'] }}
                            </option>
                        @endforeach
                    </select>
                </div>
            @endif
            
            <div class="text-xs text-gray-500 pb-2">
                Showing latest messages sorted by date.
            </div>
        </form>
    </div>

    <!-- Messages List -->
    <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="p-4 text-sm font-bold text-gray-600">Store</th>
                    <th class="p-4 text-sm font-bold text-gray-600">From</th>
                    <th class="p-4 text-sm font-bold text-gray-600">Message Preview</th>
                    <th class="p-4 text-sm font-bold text-gray-600">Date</th>
                    <th class="p-4 text-sm font-bold text-gray-600 text-right">Action</th>
                </tr>
            </thead>
            <tbody>
                @forelse($messages as $msg)
                    <tr class="border-b hover:bg-gray-50 {{ !$msg->is_read ? 'bg-blue-50' : '' }}">
                        <td class="p-4">
                            <span class="text-[10px] uppercase font-bold bg-gray-200 px-2 py-1 rounded text-gray-600">
                                {{ $msg->tenant_name ?? $msg->tenant_id }}
                            </span>
                        </td>
                        <td class="p-4">
                            <div class="font-bold {{ !$msg->is_read ? 'text-blue-700' : 'text-gray-800' }}">
                                {{ $msg->email }}
                            </div>
                            @if($msg->phone)
                                <div class="text-xs text-gray-500">{{ $msg->phone }}</div>
                            @endif
                        </td>
                        <td class="p-4 max-w-md">
                            <div class="truncate text-gray-600 italic">"{{ Str::limit($msg->message, 50) }}"</div>
                        </td>
                        <td class="p-4 text-xs text-gray-500 whitespace-nowrap">
                            {{ $msg->created_at->format('d M Y, H:i') }}
                            @if(!$msg->is_read)
                                <span class="ml-2 w-2 h-2 bg-blue-500 rounded-full inline-block" title="Unread"></span>
                            @endif
                        </td>
                        <td class="p-4 text-right">
                            <a href="{{ route('admin.messages.show', [$msg->id, 'tenant_id' => $msg->tenant_id]) }}" 
                               class="text-blue-600 hover:text-blue-800 font-bold text-sm">
                                Read
                            </a>
                        </td>
                    </tr>
                @empty
                    <tr>
                        <td colspan="5" class="p-8 text-center text-gray-400 italic">No messages found.</td>
                    </tr>
                @endforelse
            </tbody>
        </table>
        
        <div class="p-4 border-t">
            {{ $messages->appends(request()->query())->links() }}
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/messages/show.blade.php">
<!-- FILE: resources/views/admin/messages/show.blade.php -->
@extends('layouts.admin')
@section('title', 'Read Message')

@section('content')
    <div class="max-w-3xl mx-auto">
        <div class="mb-6 flex justify-between items-center">
            <a href="{{ route('admin.messages.index', ['tenant_id' => $tenantId]) }}" class="text-blue-600 hover:underline font-bold">&larr; Back to Inbox</a>
            
            <form action="{{ route('admin.messages.destroy', [$message->id, 'tenant_id' => $tenantId]) }}" method="POST" onsubmit="return confirm('Delete this message?');">
                @csrf
                @method('DELETE')
                <button class="text-red-500 hover:text-red-700 font-bold text-sm bg-red-50 px-3 py-1 rounded border border-red-200">
                    Delete Message
                </button>
            </form>
        </div>

        <div class="bg-white rounded shadow-lg overflow-hidden border-t-4 border-blue-600">
            <div class="p-6 border-b bg-gray-50 flex justify-between items-start">
                <div>
                    <h1 class="text-xl font-bold mb-1">Message from {{ $message->email }}</h1>
                    <div class="flex items-center gap-4 text-sm text-gray-500">
                        <span>{{ $message->created_at->format('d F Y, H:i') }}</span>
                        @if($message->phone)
                            <span class="bg-gray-200 px-2 py-0.5 rounded text-xs font-bold text-gray-700">Phone: {{ $message->phone }}</span>
                        @endif
                    </div>
                </div>
                <div class="text-right">
                    <span class="block text-xs font-bold text-gray-400 uppercase">Received in Store</span>
                    <span class="font-bold text-gray-800">{{ config("tenants.tenants.{$tenantId}.name") }}</span>
                </div>
            </div>

            <div class="p-8 text-gray-800 leading-relaxed text-lg whitespace-pre-wrap">
{{ $message->message }}
            </div>

            <div class="p-6 bg-gray-50 border-t flex gap-4">
                <a href="mailto:{{ $message->email }}" class="bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-500">
                    Reply via Email
                </a>
                @if($message->phone)
                    <a href="tel:{{ $message->phone }}" class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded font-bold hover:bg-gray-100">
                        Call {{ $message->phone }}
                    </a>
                @endif
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/shop/contact.blade.php">
<!-- FILE: resources/views/shop/contact.blade.php -->
@extends('layouts.app')
@section('title', 'Contact Us')

@section('content')
<div class="max-w-4xl mx-auto py-12 px-4">
    
    <div class="text-center mb-12">
        <h1 class="text-4xl font-black uppercase tracking-tighter theme-skew theme-text mb-4">
            Get In Touch
        </h1>
        <p class="theme-muted uppercase tracking-widest text-sm">
            We are here to help you
        </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
        
        <!-- Info Block -->
        <div class="space-y-8">
            <div class="theme-card p-8 h-full">
                <h2 class="text-xl font-bold uppercase mb-6 theme-text border-b theme-border pb-2">Customer Service</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold uppercase theme-muted mb-1">Email</label>
                        <a href="mailto:support@trishop.local" class="theme-link font-mono text-lg">support@trishop.local</a>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold uppercase theme-muted mb-1">Phone</label>
                        <p class="font-mono text-lg theme-text">+38 (044) 123-45-67</p>
                        <p class="text-xs theme-muted">Mon-Fri: 10:00 - 19:00</p>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase theme-muted mb-1">Headquarters</label>
                        <p class="theme-text">Kyiv, Khreshchatyk St, 1</p>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t theme-border text-xs theme-muted leading-relaxed">
                    If you have questions about your order, please include your Order # in the message for faster assistance.
                </div>
            </div>
        </div>

        <!-- Form Block -->
        <div>
            <form action="{{ route('contact.store') }}" method="POST" class="theme-card p-8 shadow-xl">
                @csrf
                
                <h2 class="text-xl font-bold uppercase mb-6 theme-text">Send Message</h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold uppercase mb-1 theme-muted">Email Address <span class="text-red-500">*</span></label>
                        <input type="email" name="email" value="{{ old('email') }}" class="theme-input w-full p-3 font-bold text-sm" placeholder="your@email.com" required>
                        @error('email') <span class="text-xs text-red-500">{{ $message }}</span> @enderror
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase mb-1 theme-muted">Phone Number (Optional)</label>
                        <input type="text" name="phone" value="{{ old('phone') }}" class="theme-input w-full p-3 font-bold text-sm" placeholder="+380...">
                        @error('phone') <span class="text-xs text-red-500">{{ $message }}</span> @enderror
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase mb-1 theme-muted">Message <span class="text-red-500">*</span></label>
                        <textarea name="message" rows="5" class="theme-input w-full p-3 font-bold text-sm" placeholder="How can we help?" required>{{ old('message') }}</textarea>
                        @error('message') <span class="text-xs text-red-500">{{ $message }}</span> @enderror
                    </div>
                </div>

                <div class="mt-6">
                    <button class="theme-btn w-full py-4 text-lg shadow-lg hover:shadow-2xl transition">
                        SEND MESSAGE
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
@endsection
</file>

<file path="app/Console/Commands/TenantsLinkCommand.php">
<?php
// FILE: app/Console/Commands/TenantsLinkCommand.php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\File;

class TenantsLinkCommand extends Command
{
    // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¾Ð¿Ñ†Ð¸ÑŽ --force
    protected $signature = 'tenants:link {--force : Overwrite existing links}';
    protected $description = 'Create symbolic links for tenants storage';

    public function handle()
    {
        $tenants = config('tenants.tenants');
        $force = $this->option('force');
        
        // Ð£Ð±ÐµÐ´Ð¸Ð¼ÑÑ, Ñ‡Ñ‚Ð¾ Ð¿Ð°Ð¿ÐºÐ° public/tenants ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
        if (!File::exists(public_path('tenants'))) {
            File::makeDirectory(public_path('tenants'));
        }

        foreach ($tenants as $id => $config) {
            $target = storage_path("tenants/{$id}");
            $link = public_path("tenants/{$id}");

            // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ð¿Ð°Ð¿ÐºÑƒ Ð² storage, ÐµÑÐ»Ð¸ Ð½ÐµÑ‚
            if (!File::exists($target)) {
                File::makeDirectory($target, 0755, true);
                File::makeDirectory($target . '/media', 0755, true);
            }

            if (File::exists($link)) {
                if ($force) {
                    // Ð•ÑÐ»Ð¸ force, ÑƒÐ´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ (Ð¸Ð»Ð¸ Ð¿Ð°Ð¿ÐºÑƒ, ÐµÑÐ»Ð¸ ÑÑ‚Ð¾ Ð¿Ð°Ð¿ÐºÐ°)
                    // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ unlink Ð´Ð»Ñ ÑÐ¸Ð¼Ð»Ð¸Ð½ÐºÐ¾Ð²
                    if (is_link($link)) {
                        unlink($link);
                    } else {
                        // Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ð²Ð´Ñ€ÑƒÐ³ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð°Ñ Ð¿Ð°Ð¿ÐºÐ° (Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹), ÑƒÐ´Ð°Ð»ÑÐµÐ¼ Ñ€ÐµÐºÑƒÑ€ÑÐ¸Ð²Ð½Ð¾
                        File::deleteDirectory($link);
                    }
                    $this->warn("Removed existing link: {$link}");
                } else {
                    $this->error("Link exists: {$link} (use --force to overwrite)");
                    continue;
                }
            }

            // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐ¸Ð¼Ð»Ð¸Ð½Ðº
            $this->laravel->make('files')->link($target, $link);
            
            $this->info("Linked: public/tenants/{$id} -> storage/tenants/{$id}");
        }
        
        // Ð¢Ð°ÐºÐ¶Ðµ Ð»Ð¸Ð½ÐºÑƒÐµÐ¼ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ storage Ñ Ñ„Ð»Ð°Ð³Ð¾Ð¼ force, ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾
        $this->call('storage:link', $force ? ['--force' => true] : []);

        $this->info('All tenants linked.');
    }
}
</file>

<file path="app/Console/Commands/TenantsMigrateCommand.php">
<?php
// FILE: app/Console/Commands/TenantsMigrateCommand.php

namespace App\Console\Commands;

use App\Services\TenantService;
use Illuminate\Console\Command;
use Illuminate\Support\Facades\DB;

class TenantsMigrateCommand extends Command
{
    protected $signature = 'tenants:migrate {--fresh : Wipe databases first} {--seed : Run seeders}';
    protected $description = 'Run migrations for Public and ALL tenants';

    public function handle(TenantService $tenantService)
    {
        $tenants = config('tenants.tenants');
        
        $this->info("1. PROCESSING PUBLIC SCHEMA...");
        
        // Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð½Ð° Public
        DB::statement("SET search_path TO public");
        
        // 1. ÐÐ°ÐºÐ°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Public
        if ($this->option('fresh')) {
            $this->call('migrate:fresh', [
                '--force' => true,
                '--path' => 'database/migrations',
            ]);
        } else {
            $this->call('migrate', [
                '--force' => true,
                '--path' => 'database/migrations',
            ]);
        }

        // 2. Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: Ð¡ÐµÐµÐ¼ Public ÑÑ…ÐµÐ¼Ñƒ (ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ ÐÐ´Ð¼Ð¸Ð½Ð°) Ð¡Ð ÐÐ—Ð£
        if ($this->option('seed')) {
            $this->info("Seeding PUBLIC schema...");
            $this->call('db:seed', ['--force' => true]); 
            // DatabaseSeeder ÑƒÐ²Ð¸Ð´Ð¸Ñ‚, Ñ‡Ñ‚Ð¾ tenant Ð½Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½, Ð¸ ÑÐ¾Ð·Ð´Ð°ÑÑ‚ ÐÐ´Ð¼Ð¸Ð½Ð°.
        }

        // 3. ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¢ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð²
        foreach ($tenants as $tenantId => $config) {
            $this->info("---------------------------------------");
            $this->info("2. PROCESSING TENANT: {$config['name']} ($tenantId)");

            DB::statement("CREATE SCHEMA IF NOT EXISTS \"{$tenantId}\"");

            $tenantService->switchTenant($tenantId);

            $this->call('migrate', [
                '--force' => true,
                '--path' => 'database/migrations',
            ]);

            if ($this->option('seed')) {
                $this->info("Seeding tenant {$tenantId}...");
                $this->call('db:seed', ['--force' => true]);
            }
        }

        $this->info("---------------------------------------");
        $this->info("âœ… All operations completed successfully.");
    }
}
</file>

<file path="app/Console/Commands/TenantsStorageLinkCommand.php">
<?php
// FILE: app/Console/Commands/TenantsStorageLinkCommand.php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\File;

class TenantsStorageLinkCommand extends Command
{
    protected $signature = 'tenants:link';
    protected $description = 'Create symbolic links for tenants (public/tenants/{id} -> storage/tenants/{id})';

    public function handle()
    {
        $tenants = config('tenants.tenants');
        
        // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð°Ð¿ÐºÑƒ-ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð² public, ÐµÑÐ»Ð¸ Ð½ÐµÑ‚
        if (!File::exists(public_path('tenants'))) {
            File::makeDirectory(public_path('tenants'), 0755, true);
        }

        foreach ($tenants as $id => $config) {
            // Ð¦ÐµÐ»ÑŒ: storage/tenants/{id}/media
            // ÐœÑ‹ Ð»Ð¸Ð½ÐºÑƒÐµÐ¼ ÐºÐ¾Ñ€ÐµÐ½ÑŒ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° Ð¸Ð»Ð¸ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾ media. 
            // Ð”Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð° ÑÐ»Ð¸Ð½ÐºÑƒÐµÐ¼ ÐºÐ¾Ñ€ÐµÐ½ÑŒ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð¼ÐµÑ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð¸ Ðº Ð´Ñ€ÑƒÐ³Ð¸Ð¼ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼ Ð¿Ð°Ð¿ÐºÐ°Ð¼ ÐµÑÐ»Ð¸ Ð¿Ð¾Ð½Ð°Ð´Ð¾Ð±ÑÑ‚ÑÑ.
            
            $target = storage_path("tenants/{$id}"); 
            $link = public_path("tenants/{$id}");

            // 1. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ†ÐµÐ»ÐµÐ²ÑƒÑŽ Ð¿Ð°Ð¿ÐºÑƒ Ð² storage, ÐµÑÐ»Ð¸ ÐµÑ‘ Ð½ÐµÑ‚
            if (!File::exists($target)) {
                 $this->warn("Target directory [{$target}] does not exist. Creating...");
                 // force creation
                 File::makeDirectory($target, 0777, true);
                 // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ media Ð´Ð»Ñ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ°
                 File::makeDirectory($target . '/media', 0777, true); 
            }

            // 2. Ð•ÑÐ»Ð¸ ÑÑÑ‹Ð»ÐºÐ° ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ â€” Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÐ¼
            if (File::exists($link)) {
                $this->info("The [{$link}] link already exists.");
                continue;
            }

            // 3. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐ¸Ð¼Ð»Ð¸Ð½Ðº
            try {
                $this->laravel->make('files')->link($target, $link);
                $this->info("Connected: [public/tenants/{$id}] -> [storage/tenants/{id}]");
            } catch (\Exception $e) {
                $this->error("Failed to link {$id}: " . $e->getMessage());
            }
        }

        $this->info('All tenant links processed.');
    }
}
</file>

<file path="app/Http/Controllers/Admin/AuthController.php">
<?php
// FILE: app/Http/Controllers/Admin/AuthController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class AuthController extends Controller
{
    public function showLoginForm()
    {
        if (Auth::check()) {
            return redirect()->route('admin.dashboard');
        }
        return view('admin.auth.login');
    }

    public function login(Request $request)
    {
        $credentials = $request->validate([
            'email' => ['required', 'email'],
            'password' => ['required'],
        ]);

        // ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð²Ñ…Ð¾Ð´Ð° Ð² Ð¢Ð•ÐšÐ£Ð©Ð•Ð™ ÑÑ…ÐµÐ¼Ðµ
        // Ð¢Ð°Ðº ÐºÐ°Ðº ÐÐ´Ð¼Ð¸Ð½ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ ÐµÑÑ‚ÑŒ Ð²ÐµÐ·Ð´Ðµ, ÑÑ‚Ð¾ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¸ Ð´Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½Ð°, Ð¸ Ð´Ð»Ñ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°
        if (Auth::attempt($credentials)) {
            $request->session()->regenerate();

            $user = Auth::user();
            
            // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ„Ð»Ð°Ð³ ÑÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½Ð° Ð² ÑÐµÑÑÐ¸ÑŽ Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð° Ð² Blade
            if ($user->role === 'super_admin') {
                $request->session()->put('is_super_admin', true);
            } else {
                $request->session()->put('is_super_admin', false);
            }

            return redirect()->route('admin.dashboard');
        }

        return back()->withErrors([
            'email' => 'The provided credentials do not match our records.',
        ]);
    }

    public function logout(Request $request)
    {
        Auth::logout();
        $request->session()->invalidate();
        $request->session()->regenerateToken();
        return redirect()->route('admin.login');
    }
}
</file>

<file path="app/Http/Controllers/Admin/ClothingLineController.php">
<?php
// FILE: app/Http/Controllers/Admin/ClothingLineController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\ClothingLine;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Str;

class ClothingLineController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    // Ð¥ÐµÐ»Ð¿ÐµÑ€ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° (Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ð°Ð¼)
    private function resolveContext(Request $request)
    {
        if (auth()->user()->role !== 'super_admin') {
            return $this->tenantService->getCurrentTenantId();
        }

        // Ð”ÐµÑ„Ð¾Ð»Ñ‚ Ð¸Ð»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½
        $tenantId = $request->tenant_id ?? array_key_first(config('tenants.tenants'));
        
        if ($tenantId) {
            $this->tenantService->switchTenant($tenantId);
        }
        
        return $tenantId;
    }

    public function index(Request $request)
    {
        $currentTenantId = $this->resolveContext($request);
        
        $query = ClothingLine::withCount('products');
        
        if ($request->filled('search')) {
            $query->where('name', 'ilike', "%{$request->search}%");
        }

        $lines = $query->orderBy('name')->get();

        return view('admin.clothing_lines.index', compact('lines', 'currentTenantId'));
    }

    public function store(Request $request)
    {
        $this->resolveContext($request);
        
        $validated = $request->validate(['name' => 'required|string|max:255']);
        $slug = Str::slug($validated['name']);

        ClothingLine::firstOrCreate(
            ['slug' => $slug],
            ['name' => $validated['name']]
        );

        return back()->with('success', 'Collection created/found.');
    }

    public function update(Request $request, $id)
    {
        $this->resolveContext($request);
        $line = ClothingLine::findOrFail($id);
        
        $validated = $request->validate(['name' => 'required|string|max:255']);
        
        try {
            $line->update([
                'name' => $validated['name'],
                'slug' => Str::slug($validated['name'])
            ]);
        } catch (\Exception $e) {
            return back()->with('error', 'Collection with this name already exists.');
        }
        
        return back()->with('success', 'Collection updated.');
    }

    public function destroy(Request $request, $id)
    {
        $this->resolveContext($request);
        ClothingLine::destroy($id);
        return back()->with('success', 'Collection deleted.');
    }
}
</file>

<file path="app/Http/Controllers/Admin/InventoryController.php">
<?php
// FILE: app/Http/Controllers/Admin/InventoryController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\ClothingLine;
use App\Models\TelegramConfig; // Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Telegram
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Collection;
use Illuminate\Support\Facades\Http;
use Illuminate\Pagination\LengthAwarePaginator;
use Symfony\Component\HttpFoundation\StreamedResponse;

class InventoryController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function resolveContext(Request $request)
    {
        $user = auth()->user();
        if ($user->role !== 'super_admin') {
            return $this->tenantService->getCurrentTenantId();
        }
        $tenantId = $request->get('tenant_id');
        if ($tenantId) {
            $this->tenantService->switchTenant($tenantId);
            return $tenantId;
        }
        
        // Ð•ÑÐ»Ð¸ Ð¡ÑƒÐ¿ÐµÑ€-ÐÐ´Ð¼Ð¸Ð½ Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð» ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ null (Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ "Ð’ÑÐµ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñ‹")
        // Ð•ÑÐ»Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ ÑƒÐ¶Ðµ Ð±Ñ‹Ð» ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ middleware, ÑÐ±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ ÐµÐ³Ð¾ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸ÐºÐ¸ "Ð’ÑÐµÑ…"
        if ($request->has('tenant_id') && empty($request->tenant_id)) {
            return null;
        }

        return $this->tenantService->getCurrentTenantId();
    }

    public function index(Request $request)
    {
        $currentTenantId = $this->resolveContext($request);
        $isSuperAdmin = auth()->user()->role === 'super_admin';
        
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð±Ð¾Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð²Ñ‹Ð¿Ð°Ð´Ð°ÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¿Ð¸ÑÐºÐ°
        $telegramBots = $isSuperAdmin 
            ? TelegramConfig::where('is_active', true)->get() 
            : TelegramConfig::where('tenant_id', $currentTenantId)->orWhereNull('tenant_id')->where('is_active', true)->get();

        // Ð›Ð¾Ð³Ð¸ÐºÐ° ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
        $products = new Collection();
        $isGlobalView = $isSuperAdmin && empty($currentTenantId);

        if ($isGlobalView) {
            // Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ¾ Ð²ÑÐµÑ… Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð¾Ð²
            foreach (config('tenants.tenants') as $id => $config) {
                try {
                    $this->tenantService->switchTenant($id);
                    $storeProducts = $this->getFilteredQuery($request)->latest()->take(50)->get();
                    
                    // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¼ÐµÑ‚ÐºÑƒ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
                    $storeProducts->each(function($p) use ($config) {
                        $p->tenant_name = $config['name'];
                    });
                    
                    $products = $products->merge($storeProducts);
                } catch (\Exception $e) { continue; }
            }
            // Ð ÑƒÑ‡Ð½Ð°Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ð½Ð¾Ð¹ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸ (Ð´Ð»Ñ ÐºÑ€Ð°ÑÐ¾Ñ‚Ñ‹)
            $page = $request->get('page', 1);
            $perPage = 50;
            $products = new LengthAwarePaginator(
                $products->forPage($page, $perPage), 
                $products->count(), 
                $perPage, 
                $page, 
                ['path' => $request->url(), 'query' => $request->query()]
            );
        } else {
            // ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
            $products = $this->getFilteredQuery($request)->latest()->paginate(50)->withQueryString();
        }

        // --- EXPORT LOGIC ---
        if ($request->get('action') === 'export_csv') {
            // Ð”Ð»Ñ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð° Ð±ÐµÑ€ÐµÐ¼ Ð¿Ð¾Ð»Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð±ÐµÐ· Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ð¸
            $exportData = $isGlobalView ? $this->getAllTenantsData($request) : $this->getFilteredQuery($request)->get();
            return $this->exportCsv($exportData, $currentTenantId ?? 'All_Stores');
        }

        // Load filters (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½, Ð¸Ð½Ð°Ñ‡Ðµ ÑÐ¿Ð¸ÑÐºÐ¸ Ð¿ÑƒÑÑ‚Ñ‹Ðµ)
        $categories = $currentTenantId ? Category::orderBy('name')->get() : collect();
        $lines = $currentTenantId ? ClothingLine::orderBy('name')->get() : collect();

        return view('admin.inventory.index', compact('products', 'categories', 'lines', 'currentTenantId', 'telegramBots'));
    }

    /**
     * ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð¾Ñ‚Ñ‡ÐµÑ‚Ð° Ð² Telegram
     */
    public function sendToTelegram(Request $request)
    {
        $request->validate([
            'telegram_config_id' => 'required|exists:public.telegram_configs,id',
        ]);

        $config = TelegramConfig::findOrFail($request->telegram_config_id);
        $currentTenantId = $this->resolveContext($request);
        $isGlobalView = auth()->user()->role === 'super_admin' && empty($currentTenantId);

        // 1. Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
        $data = $isGlobalView ? $this->getAllTenantsData($request) : $this->getFilteredQuery($request)->get();
        
        // 2. Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÐ¼ CSV ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ (ÑÑ‚Ñ€Ð¾ÐºÐ°)
        $csvContent = $this->generateCsvString($data);
        $fileName = 'inventory_report_' . date('Y-m-d_H-i') . '.csv';

        // 3. Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
        $totalItems = $data->sum('stock_quantity');
        $totalValue = $data->sum(fn($p) => $p->stock_quantity * ($p->sale_price ?? $p->price));
        
        $message = "ðŸ“Š *Inventory Report*\n" .
                   "Store: " . ($currentTenantId ?? 'ALL STORES') . "\n" .
                   "Date: " . date('Y-m-d H:i') . "\n" .
                   "Total Items: *{$totalItems}*\n" .
                   "Total Value: *$" . number_format($totalValue, 2) . "*";

        // 4. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ñ‡ÐµÑ€ÐµÐ· Telegram API (multipart/form-data)
        try {
            // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ‚ÐµÐºÑÑ‚
            Http::post("https://api.telegram.org/bot{$config->bot_token}/sendMessage", [
                'chat_id' => $config->chat_id,
                'text' => $message,
                'parse_mode' => 'Markdown',
            ]);

            // ÐŸÐ¾Ñ‚Ð¾Ð¼ Ñ„Ð°Ð¹Ð»
            $response = Http::attach(
                'document', $csvContent, $fileName
            )->post("https://api.telegram.org/bot{$config->bot_token}/sendDocument", [
                'chat_id' => $config->chat_id,
                'caption' => 'ðŸ“‚ Full report attached (Excel compatible)',
            ]);

            if ($response->successful()) {
                return back()->with('success', 'Report sent to Telegram successfully.');
            } else {
                return back()->with('error', 'Telegram Error: ' . $response->body());
            }

        } catch (\Exception $e) {
            return back()->with('error', 'Failed to send: ' . $e->getMessage());
        }
    }

    // --- HELPERS ---

    private function getFilteredQuery(Request $request)
    {
        $query = Product::with(['categories', 'variants', 'clothingLine']);

        if ($request->filled('search')) {
            $query->where(fn($q) => $q->where('name', 'ilike', "%{$request->search}%")
                                      ->orWhere('sku', 'ilike', "%{$request->search}%"));
        }
        if ($request->filled('category_id')) {
            $query->whereHas('categories', fn($q) => $q->where('categories.id', $request->category_id));
        }
        if ($request->filled('clothing_line_id')) {
            $query->where('clothing_line_id', $request->clothing_line_id);
        }
        if ($request->filled('stock_status')) {
            if ($request->stock_status === 'out_of_stock') {
                $query->where('stock_quantity', '<=', 0);
            } elseif ($request->stock_status === 'low_stock') {
                $query->where('stock_quantity', '>', 0)->where('stock_quantity', '<', 5);
            } elseif ($request->stock_status === 'in_stock') {
                $query->where('stock_quantity', '>=', 5);
            }
        }
        return $query;
    }

    private function getAllTenantsData(Request $request)
    {
        $allData = new Collection();
        foreach (config('tenants.tenants') as $id => $config) {
            try {
                $this->tenantService->switchTenant($id);
                $products = $this->getFilteredQuery($request)->get();
                $products->each(function($p) use ($config) {
                    $p->tenant_name = $config['name'];
                });
                $allData = $allData->merge($products);
            } catch (\Exception $e) { continue; }
        }
        return $allData;
    }

    private function generateCsvString(Collection $products)
    {
        $output = fopen('php://temp', 'r+');
        fputs($output, "\xEF\xBB\xBF"); // BOM
        fputcsv($output, ['Store', 'SKU', 'Product Name', 'Category', 'Collection', 'Size Variants', 'Price', 'Stock', 'Value']);

        foreach ($products as $product) {
            $variantsStr = $product->variants->map(fn($v) => "{$v->size}: {$v->stock}")->join(' | ');
            $categoriesStr = $product->categories->pluck('name')->join(', ');
            $totalValue = $product->stock_quantity * ($product->sale_price ?? $product->price);
            
            fputcsv($output, [
                $product->tenant_name ?? 'Current',
                $product->sku,
                $product->name,
                $categoriesStr,
                $product->clothingLine->name ?? '-',
                $variantsStr ?: 'One Size',
                $product->price,
                $product->stock_quantity,
                number_format($totalValue, 2, '.', '')
            ]);
        }
        rewind($output);
        $content = stream_get_contents($output);
        fclose($output);
        return $content;
    }

    private function exportCsv(Collection $products, string $name)
    {
        $content = $this->generateCsvString($products);
        return response($content)
            ->header('Content-Type', 'text/csv')
            ->header('Content-Disposition', 'attachment; filename="inventory_' . $name . '.csv"');
    }
}
</file>

<file path="app/Http/Controllers/Admin/ManagerController.php">
<?php

//  File (app/Http/Controllers/Admin/ManagerController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rule;

class ManagerController extends Controller
{
    public function index()
    {
        $managers = User::where('role', 'manager')->latest()->get();
        return view('admin.managers.index', compact('managers'));
    }

    public function create()
    {
        $tenants = config('tenants.tenants');
        // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐµÐ´Ð¸Ð½ÑƒÑŽ Ñ„Ð¾Ñ€Ð¼Ñƒ. ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ $manager Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°ÐµÑ‚ÑÑ, ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð¿Ð¾Ð¹Ð¼ÐµÑ‚, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ.
        return view('admin.managers.form', compact('tenants'));
    }

    public function store(Request $request)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255',
            'email' => 'required|email|unique:users,email',
            'phone' => 'required|string|max:20',
            'password' => 'required|string|min:8',
            'tenant_id' => 'required|string',
        ]);

        User::create([
            'name' => $validated['name'],
            'email' => $validated['email'],
            'phone' => $validated['phone'],
            'password' => Hash::make($validated['password']),
            'role' => 'manager',
            'tenant_id' => $validated['tenant_id'],
        ]);

        return redirect()->route('admin.managers.index')->with('success', 'Manager created successfully.');
    }

    public function edit($id)
    {
        $manager = User::where('role', 'manager')->findOrFail($id);
        $tenants = config('tenants.tenants');
        // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ñ‚Ñƒ Ð¶Ðµ Ñ„Ð¾Ñ€Ð¼Ñƒ, Ð½Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°ÐµÐ¼ $manager Ð´Ð»Ñ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
        return view('admin.managers.form', compact('manager', 'tenants'));
    }

    public function update(Request $request, $id)
    {
        $manager = User::where('role', 'manager')->findOrFail($id);

        $validated = $request->validate([
            'name' => 'required|string|max:255',
            'email' => ['required', 'email', Rule::unique('users')->ignore($manager->id)],
            'phone' => 'required|string|max:20',
            'password' => 'nullable|string|min:8',
            'tenant_id' => 'required|string',
        ]);

        $data = [
            'name' => $validated['name'],
            'email' => $validated['email'],
            'phone' => $validated['phone'],
            'tenant_id' => $validated['tenant_id'],
        ];

        if ($request->filled('password')) {
            $data['password'] = Hash::make($validated['password']);
        }

        $manager->update($data);

        return redirect()->route('admin.managers.index')->with('success', 'Manager updated successfully.');
    }

    public function destroy($id)
    {
        $manager = User::where('role', 'manager')->findOrFail($id);
        $manager->delete();

        return back()->with('success', 'Manager deleted.');
    }
}
</file>

<file path="app/Http/Controllers/Admin/PromoCodeController.php">
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\PromoCode;
use App\Models\Product;
use App\Models\Category;
use App\Models\ClothingLine;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Str; // Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ÑÐ¾ ÑÑ‚Ñ€Ð¾ÐºÐ°Ð¼Ð¸
use Illuminate\Validation\Rule;

class PromoCodeController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function checkSuperAdmin()
    {
        if (auth()->user()->role !== 'super_admin') {
            abort(403, 'Access denied. Only Super Admin can manage promo codes.');
        }
    }

    public function index()
    {
        $this->checkSuperAdmin();
        $promocodes = PromoCode::latest()->get();
        return view('admin.promocodes.index', compact('promocodes'));
    }

    public function create()
    {
        $this->checkSuperAdmin();

        $catalogData = [];
        $tenants = config('tenants.tenants');

        foreach ($tenants as $id => $config) {
            try {
                $this->tenantService->switchTenant($id);
                
                $catalogData[$id] = [
                    'name' => $config['name'],
                    'products' => Product::select('id', 'name', 'sku')->orderBy('name')->get()->toArray(),
                    'categories' => Category::select('id', 'name', 'slug')->orderBy('name')->get()->toArray(),
                    'lines' => ClothingLine::select('id', 'name', 'slug')->orderBy('name')->get()->toArray(),
                ];
            } catch (\Exception $e) {
                continue;
            }
        }

        return view('admin.promocodes.create', compact('catalogData'));
    }

    /**
     * Store a newly created promo code.
     */
    public function store(Request $request)
    {
        $this->checkSuperAdmin();

        // ÐÐžÐ ÐœÐÐ›Ð˜Ð—ÐÐ¦Ð˜Ð¯: ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ð¼ ÐºÐ¾Ð´ Ð² Ð²ÐµÑ€Ñ…Ð½Ð¸Ð¹ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€ Ð´Ð¾ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸.
        // Ð­Ñ‚Ð¾ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Rule::unique ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ 
        // Ð¸ Ð² Ð±Ð°Ð·Ñƒ Ð¿Ð¾Ð¿Ð°Ð´ÑƒÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ð½ÑƒÐ¶Ð½Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ.
        if ($request->has('code')) {
            $request->merge([
                'code' => Str::upper($request->code)
            ]);
        }

        $validated = $request->validate([
            'code' => [
                'required', 
                'string', 
                'alpha_dash', 
                Rule::unique(PromoCode::class, 'code')
            ],
            'type' => 'required|in:percent,fixed',
            'value' => 'required|numeric|min:0',
            'starts_at' => 'nullable|date',
            'expires_at' => 'nullable|date|after_or_equal:starts_at',
            'scope_type' => 'required|in:global,specific,category,line',
            'scope_data' => 'nullable|array',
        ]);

        $validated['is_active'] = $request->has('is_active');

        // ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð¿ÑƒÑÑ‚Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°Ð¼
        if (!empty($validated['scope_data'])) {
            $cleanedData = [];
            foreach ($validated['scope_data'] as $tenant => $ids) {
                if (!empty($ids)) {
                    $cleanedData[$tenant] = $ids;
                }
            }
            $validated['scope_data'] = $cleanedData;
        }

        PromoCode::create($validated);

        return redirect()->route('admin.promocodes.index')->with('success', 'Promo Code created successfully.');
    }

    public function destroy($id)
    {
        $this->checkSuperAdmin();
        PromoCode::destroy($id);
        return back()->with('success', 'Promo Code deleted.');
    }
}
</file>

<file path="app/Http/Controllers/Admin/ReportController.php">
<?php
// FILE: app/Http/Controllers/Admin/ReportController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Order;
use App\Services\TenantService;
use Illuminate\Support\Facades\DB;

class ReportController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    public function index()
    {
        $user = auth()->user();
        $reportData = [];
        $grandTotal = 0;

        // Ð›ÐžÐ“Ð˜ÐšÐ Ð¡Ð£ÐŸÐ•Ð -ÐÐ”ÐœÐ˜ÐÐ: ÐŸÑ€Ð¾Ð±ÐµÐ³Ð°ÐµÐ¼ Ð¿Ð¾ Ð²ÑÐµÐ¼ ÑÑ…ÐµÐ¼Ð°Ð¼
        if ($user->role === 'super_admin') {
            $tenants = config('tenants.tenants');
            
            foreach ($tenants as $id => $config) {
                // ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð‘Ð”
                // Ð’Ð°Ð¶Ð½Ð¾: try-catch, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð² Ð¾Ð´Ð½Ð¾Ð¹ ÑÑ…ÐµÐ¼Ðµ Ð½Ðµ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ð»Ð° Ð²ÐµÑÑŒ Ð¾Ñ‚Ñ‡ÐµÑ‚
                try {
                    $this->tenantService->switchTenant($id);
                    
                    $total = Order::sum('total_amount');
                    $count = Order::count();
                    $avg = $count > 0 ? $total / $count : 0;

                    $reportData[] = [
                        'tenant' => $config['name'],
                        'orders_count' => $count,
                        'total_revenue' => $total,
                        'average_check' => $avg,
                    ];
                    $grandTotal += $total;

                } catch (\Exception $e) {
                    $reportData[] = [
                        'tenant' => $config['name'] . ' (Error)',
                        'orders_count' => 0,
                        'total_revenue' => 0,
                        'average_check' => 0,
                    ];
                }
            }
            
            // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ÑÑ Ð² Public (Ð¸Ð»Ð¸ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð°Ð´Ð¼Ð¸Ð½ÐºÐ¸ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ)
            DB::statement("SET search_path TO public");

        } else {
            // Ð›ÐžÐ“Ð˜ÐšÐ ÐœÐ•ÐÐ•Ð”Ð–Ð•Ð Ð: Ð”Ð°Ð½Ð½Ñ‹Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑÑ…ÐµÐ¼Ñ‹
            // Middleware ÑƒÐ¶Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ð» Ð½Ð°Ñ Ð² Ð½ÑƒÐ¶Ð½ÑƒÑŽ ÑÑ…ÐµÐ¼Ñƒ Ð¿Ñ€Ð¸ Ð²Ñ…Ð¾Ð´Ðµ (ÐµÑÐ»Ð¸ Ð¼Ñ‹ Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°)
            // ÐÐ¾ Ñ‚Ð°Ðº ÐºÐ°Ðº Ð¼Ñ‹ Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð°Ð´Ð¼Ð¸Ð½ÐºÐµ, Ð½Ð°Ð¼ Ð½ÑƒÐ¶Ð½Ð¾ ÑƒÐ±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð²ÐµÑ€ÐµÐ½.
            
            if ($user->tenant_id) {
                $this->tenantService->switchTenant($user->tenant_id);
                
                $total = Order::sum('total_amount');
                $count = Order::count();
                $avg = $count > 0 ? $total / $count : 0;

                $reportData[] = [
                    'tenant' => ucfirst($user->tenant_id),
                    'orders_count' => $count,
                    'total_revenue' => $total,
                    'average_check' => $avg,
                ];
                $grandTotal = $total;
            }
        }

        return view('admin.reports.index', compact('reportData', 'grandTotal'));
    }
}
</file>

<file path="app/Http/Controllers/Admin/TelegramSettingsController.php">
<?php
    // FILE: app/Http/Controllers/Admin/TelegramSettingsController.php

    namespace App\Http\Controllers\Admin;

    use App\Http\Controllers\Controller;
    use App\Models\TelegramConfig;
    use Illuminate\Http\Request;
    use Illuminate\Validation\Rule;
    use Illuminate\Support\Facades\Http;

    class TelegramSettingsController extends Controller
    {
        private function checkSuperAdmin()
        {
            if (auth()->user()->role !== 'super_admin') {
                abort(403, 'Access denied.');
            }
        }

        // Index Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð¼Ñ‹ Ð¸Ð´ÐµÐ¼ Ð½Ð° Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ (Ð½Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ Ñƒ Ð½Ð°Ñ Ð¾Ð±Ñ‰Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸)
        // ÐžÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð° Ð²ÑÑÐºÐ¸Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹ Ð¸Ð»Ð¸ Ð´Ð»Ñ API Ð²Ñ‹Ð·Ð¾Ð²Ð¾Ð²
        public function index()
        {
            $this->checkSuperAdmin();
            $configs = TelegramConfig::all();
            $tenants = config('tenants.tenants');
            return view('admin.settings.telegram', compact('configs', 'tenants'));
        }

        public function store(Request $request)
        {
            $this->checkSuperAdmin();

            $validated = $request->validate([
                'name' => 'required|string|max:255',
                'bot_token' => 'required|string',
                'chat_id' => 'required|string',
                'tenant_id' => 'nullable|string|unique:public.telegram_configs,tenant_id',
            ]);

            $validated['is_active'] = $request->has('is_active');

            TelegramConfig::create($validated);

            return back()->with('success', 'Telegram Bot configuration added.');
        }

        public function update(Request $request, $id)
        {
            $this->checkSuperAdmin();
            $config = TelegramConfig::findOrFail($id);

            $validated = $request->validate([
                'name' => 'required|string|max:255',
                'bot_token' => 'required|string',
                'chat_id' => 'required|string',
                'tenant_id' => ['nullable', 'string', Rule::unique('public.telegram_configs', 'tenant_id')->ignore($config->id)],
            ]);

            $validated['is_active'] = $request->has('is_active');
            $config->update($validated);

            return back()->with('success', 'Configuration updated.');
        }

        public function destroy($id)
        {
            $this->checkSuperAdmin();
            TelegramConfig::destroy($id);
            return back()->with('success', 'Configuration deleted.');
        }

        public function test($id)
        {
            $this->checkSuperAdmin();
            $config = TelegramConfig::findOrFail($id);

            return $this->performSend($config, "âš¡ *TEST*\nConnection successful for bot: _{$config->name}_");
        }

        // ÐÐžÐ’Ð«Ð™ ÐœÐ•Ð¢ÐžÐ”: Ð ÑƒÑ‡Ð½Ð°Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
        public function sendMessage(Request $request)
        {
            $this->checkSuperAdmin();
            
            $validated = $request->validate([
                'config_id' => 'required|exists:public.telegram_configs,id',
                'message' => 'required|string|min:2',
            ]);

            $config = TelegramConfig::findOrFail($validated['config_id']);
            
            return $this->performSend($config, $validated['message']);
        }

        // ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ…ÐµÐ»Ð¿ÐµÑ€ Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð´
        private function performSend($config, $text)
        {
            try {
                $response = Http::post("https://api.telegram.org/bot{$config->bot_token}/sendMessage", [
                    'chat_id' => $config->chat_id,
                    'text' => $text,
                    'parse_mode' => 'Markdown',
                ]);

                if ($response->successful()) {
                    return back()->with('success', 'Message sent successfully via Telegram!');
                } else {
                    return back()->with('error', 'Telegram API Error: ' . $response->body());
                }
            } catch (\Exception $e) {
                return back()->with('error', 'Connection failed: ' . $e->getMessage());
            }
        }
    }
</file>

<file path="app/Http/Controllers/Api/ProductController.php">
<?php
// FILE: app/Http/Controllers/Api/ProductController.php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Services\ProductService;
use Illuminate\Http\Request;

class ProductController extends Controller
{
    protected ProductService $productService;

    public function __construct(ProductService $productService)
    {
        $this->productService = $productService;
    }

    // GET /api/products
    public function index()
    {
        return response()->json(Product::latest()->paginate(12));
    }

    // GET /api/products/{id}
    public function show($id)
    {
        $product = Product::findOrFail($id);
        return response()->json($product);
    }

    // GET /api/products/search?q=hoodie
    public function search(Request $request)
    {
        $query = $request->get('q');
        
        if (!$query) {
            return $this->index();
        }

        $products = $this->productService->search($query);
        return response()->json($products);
    }
}
</file>

<file path="app/Http/Controllers/Client/ProfileController.php">
<?php
// FILE: app/Http/Controllers/Client/ProfileController.php

namespace App\Http\Controllers\Client;

use App\Http\Controllers\Controller;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use App\Models\Order;

class ProfileController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function resolveTenant()
    {
        $host = request()->getHost();
        $map = $this->tenantService->getDomainMap();
        $tenantId = $map[$host] ?? 'default';
        $this->tenantService->switchTenant($tenantId);
        return $tenantId;
    }

    public function index()
    {
        $tenantId = $this->resolveTenant();
        $user = Auth::user();
        
        $orders = $user->orders()->with('items')->get();

        $view = "tenants.{$tenantId}.profile.index";
        if (!view()->exists($view)) $view = 'client.profile.index';

        return view($view, compact('orders', 'user'));
    }

    public function showOrder($id)
    {
        $tenantId = $this->resolveTenant();
        
        $order = Order::with('items')->where('user_id', Auth::id())->findOrFail($id);
        
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð¸Ð· ÑÐµÑÑÐ¸Ð¸ (ÐµÑÐ»Ð¸ ÑÑ‚Ð¾ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ð¹ Ð·Ð°ÐºÐ°Ð·)
        $generatedPassword = session('generated_password');

        $view = "tenants.{$tenantId}.profile.order";
        if (!view()->exists($view)) $view = 'client.profile.order';

        return view($view, compact('order', 'generatedPassword'));
    }
}
</file>

<file path="app/Http/Controllers/Controller.php">
<?php

namespace App\Http\Controllers;

abstract class Controller
{
    //
}
</file>

<file path="app/Http/Middleware/AdminTenantMiddleware.php">
<?php
// FILE: app/Http/Middleware/AdminTenantMiddleware.php

namespace App\Http\Middleware;

use App\Services\TenantService;
use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class AdminTenantMiddleware
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    public function handle(Request $request, Closure $next): Response
    {
        $user = auth()->user();

        // Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½
        if ($user) {
            
            // Ð¡Ð¦Ð•ÐÐÐ Ð˜Ð™ 1: ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€
            // Ð£ Ð½ÐµÐ³Ð¾ Ð¶ÐµÑÑ‚ÐºÐ°Ñ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ° Ðº Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñƒ. ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾.
            if ($user->role === 'manager' && $user->tenant_id) {
                try {
                    $this->tenantService->switchTenant($user->tenant_id);
                } catch (\Exception $e) {
                    abort(500, "Manager assigned to invalid tenant: " . $user->tenant_id);
                }
            }
            
            // Ð¡Ð¦Ð•ÐÐÐ Ð˜Ð™ 2: Ð¡ÑƒÐ¿ÐµÑ€-ÐÐ´Ð¼Ð¸Ð½
            // ÐžÐ½ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒÑÑ Ñ‡ÐµÑ€ÐµÐ· ÑÐµÑÑÐ¸ÑŽ.
            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐµÑÑÐ¸ÑŽ Ð¸ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼, ÐµÑÐ»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð¾.
            elseif ($user->role === 'super_admin') {
                if (session()->has('admin_current_tenant_id')) {
                    try {
                        $this->tenantService->switchTenant(session('admin_current_tenant_id'));
                    } catch (\Exception $e) {
                        session()->forget('admin_current_tenant_id');
                    }
                }
            }
        }

        return $next($request);
    }
}
</file>

<file path="app/Http/Middleware/SuperAdminMiddleware.php">
<?php

//FILE - app/Http/Middleware/SuperAdminMiddleware.php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class SuperAdminMiddleware
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½ Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¸ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð»Ð¸ Ð¾Ð½ ÑÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½Ð¾Ð¼
        if (auth()->check() && auth()->user()->role !== 'super_admin') {
            abort(403, 'Access denied. Super Admin rights required.');
        }

        return $next($request);
    }
}
</file>

<file path="app/Http/Middleware/TenantMiddleware.php">
<?php
// FILE: app/Http/Middleware/TenantMiddleware.php

declare(strict_types=1);

namespace App\Http\Middleware;

use App\Services\TenantService;
use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB; // Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾
use Symfony\Component\HttpFoundation\Response;

class TenantMiddleware
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    public function handle(Request $request, Closure $next): Response
    {
        $host = $request->getHost();
        $adminDomain = config('tenants.admin_domain');

        // Ð Ð•Ð–Ð˜Ðœ 1: ÐÐ”ÐœÐ˜ÐÐšÐ
        if ($host === $adminDomain) {
            // Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÑ‚Ð°Ð²Ð¸Ð¼ public Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
            // Ð­Ñ‚Ð¾ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚, Ñ‡Ñ‚Ð¾ Auth Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐºÐ°Ñ‚ÑŒ ÑŽÐ·ÐµÑ€Ð° Ð² public.users
            DB::statement("SET search_path TO public");

            // Ð•ÑÐ»Ð¸ Ð¡ÑƒÐ¿ÐµÑ€-ÐÐ´Ð¼Ð¸Ð½ Ð²Ñ‹Ð±Ñ€Ð°Ð» Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½ "Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ", Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð¢ÐžÐ›Ð¬ÐšÐž Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…
            // ÐÐ¾ ÑÑ‚Ð¾ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð°ÐºÐºÑƒÑ€Ð°Ñ‚Ð½Ð¾ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾ Ð² ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ð°Ñ…. 
            // Ð”Ð»Ñ Ð²Ñ…Ð¾Ð´Ð° (Login) ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ð°Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð² public.
            
            if (session()->has('admin_current_tenant_id')) {
                try {
                    $targetTenant = session('admin_current_tenant_id');
                    // Ð’Ð°Ð¶Ð½Ð¾: switchTenant Ð¼ÐµÐ½ÑÐµÑ‚ search_path.
                    // Ð”Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð°Ð´Ð¼Ð¸Ð½ÐºÐ¸ Ð½Ð°Ð¼ Ð½ÑƒÐ¶Ð½Ð¾:
                    // 1. Auth -> Public schema
                    // 2. Orders -> Tenant schema
                    // Ð­Ñ‚Ð¾ ÑÐ»Ð¾Ð¶Ð½Ð¾. Ð£Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ð¼: ÐµÑÐ»Ð¸ Ð¼Ñ‹ Ð»Ð¾Ð³Ð¸Ð½Ð¸Ð¼ÑÑ (Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚ login), Ð¼Ñ‹ Ñ„Ð¾Ñ€ÑÐ¸Ñ€ÑƒÐµÐ¼ public.
                    
                    if (!$request->routeIs('admin.login')) {
                         $this->tenantService->switchTenant($targetTenant);
                    }
                } catch (\Exception $e) {
                    session()->forget('admin_current_tenant_id');
                }
            }
            
            return $next($request);
        }

        // Ð Ð•Ð–Ð˜Ðœ 2: ÐœÐÐ“ÐÐ—Ð˜ÐÐ«
        $domainMap = $this->tenantService->getDomainMap();

        if (array_key_exists($host, $domainMap)) {
            $tenantId = $domainMap[$host];
            try {
                $this->tenantService->switchTenant($tenantId);
            } catch (\Exception $e) {
                abort(500, "Tenant switch failed: " . $e->getMessage());
            }

            return $next($request);
        }

        abort(404, "Site not found for domain: {$host}");
    }
}
</file>

<file path="app/Models/AttributeOption.php">
<?php
// FILE: app/Models/AttributeOption.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class AttributeOption extends Model
{
    protected $fillable = ['type', 'value', 'slug'];
}
</file>

<file path="app/Models/Category.php">
<?php
// FILE: app/Models/Category.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Category extends Model
{
    use HasFactory;

    protected $fillable = ['name', 'slug'];

    public function products()
    {
        return $this->belongsToMany(Product::class);
    }
}
</file>

<file path="app/Models/ClothingLine.php">
<?php
// FILE: app/Models/ClothingLine.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class ClothingLine extends Model
{
    protected $fillable = ['name', 'slug'];

    public function products()
    {
        return $this->hasMany(Product::class);
    }
}
</file>

<file path="app/Models/OrderItem.php">
<?php
// FILE: app/Models/OrderItem.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class OrderItem extends Model
{
    protected $fillable = [
        'order_id', 'product_id', 'product_name', 'sku', 'size', 'quantity', 'price', 'total'
    ];

    public function product()
    {
        return $this->belongsTo(Product::class)->withTrashed(); // Ð”Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€ ÑƒÐ´Ð°Ð»ÐµÐ½, ÑÐ²ÑÐ·ÑŒ Ð½ÑƒÐ¶Ð½Ð°
    }
}
</file>

<file path="app/Models/ProductImage.php">
<?php
// FILE: app/Models/ProductImage.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\Storage;
use Illuminate\Support\Str;

class ProductImage extends Model
{
    protected $fillable = ['product_id', 'path', 'sort_order'];

    // ÐÐºÑÐµÑÑÐ¾Ñ€ Ð´Ð»Ñ URL
    public function getUrlAttribute()
    {
        // Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ð²Ð½ÐµÑˆÐ½ÑÑ ÑÑÑ‹Ð»ÐºÐ° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð° Ð·Ð°Ð³Ð»ÑƒÑˆÐµÐº), Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ ÐºÐ°Ðº ÐµÑÑ‚ÑŒ
        if (Str::startsWith($this->path, ['http://', 'https://'])) {
            return $this->path;
        }

        // Ð˜Ð½Ð°Ñ‡Ðµ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÐ¼ ÑÑÑ‹Ð»ÐºÑƒ Ñ‡ÐµÑ€ÐµÐ· Ð´Ð¸ÑÐº Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
        return Storage::disk('tenant')->url($this->path);
    }
}
</file>

<file path="app/Models/ProductVariant.php">
<?php
// FILE: app/Models/ProductVariant.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class ProductVariant extends Model
{
    protected $fillable = ['product_id', 'size', 'stock'];

    public function product()
    {
        return $this->belongsTo(Product::class);
    }
}
</file>

<file path="app/Models/PromoCode.php">
<?php
// FILE: app/Models/PromoCode.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class PromoCode extends Model
{
    // Ð’Ð°Ð¶Ð½Ð¾: Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð²ÑÐµÐ³Ð´Ð° Ð² public ÑÑ…ÐµÐ¼Ðµ
    protected $table = 'public.promo_codes';

    protected $fillable = [
        'code', 
        'type', 
        'value', 
        'is_active', 
        'starts_at',
        'expires_at',
        'scope_type',
        'scope_data'
    ];

    protected $casts = [
        'is_active' => 'boolean',
        'starts_at' => 'datetime',
        'expires_at' => 'datetime',
        'scope_data' => 'array', // ÐÐ²Ñ‚Ð¾-ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð°Ñ†Ð¸Ñ JSON
    ];

    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ð°Ð»Ð¸Ð´Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
    public function isValid()
    {
        if (!$this->is_active) return false;
        $now = now();
        if ($this->starts_at && $now->lt($this->starts_at)) return false;
        if ($this->expires_at && $now->gt($this->expires_at)) return false;
        
        return true;
    }
}
</file>

<file path="app/Models/TelegramConfig.php">
<?php
// FILE: app/Models/TelegramConfig.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class TelegramConfig extends Model
{
    protected $fillable = [
        'name',
        'bot_token',
        'chat_id',
        'tenant_id',
        'is_active',
    ];

    // Ð¯Ð²Ð½Ð¾ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² ÑÑ…ÐµÐ¼Ðµ public (ÐµÑÐ»Ð¸ Ð²Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ PostgreSQL ÑÑ…ÐµÐ¼Ñ‹)
    // Ð­Ñ‚Ð¾ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð²ÑÐµÐ³Ð´Ð° Ð¾Ð±Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ðº Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼, 
    // Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð¼Ñ‹ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ð»Ð¸ search_path Ð½Ð° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½.
    protected $table = 'public.telegram_configs';
}
</file>

<file path="app/Models/TenantSetting.php">
<?php
// FILE: app/Models/TenantSetting.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class TenantSetting extends Model
{
    protected $fillable = ['key', 'value', 'group'];

    // Ð¥ÐµÐ»Ð¿ÐµÑ€ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
    public static function get(string $key, $default = null)
    {
        return self::where('key', $key)->value('value') ?? $default;
    }

    // Ð¥ÐµÐ»Ð¿ÐµÑ€ Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ
    public static function set(string $key, $value, string $group = 'general')
    {
        return self::updateOrCreate(
            ['key' => $key],
            ['value' => $value, 'group' => $group]
        );
    }
}
</file>

<file path="app/Providers/AppServiceProvider.php">
<?php
// FILE: app/Providers/AppServiceProvider.php

namespace App\Providers;

use App\Services\TenantService;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Register any application services.
     */
    public function register(): void
    {
        // Ð’ÐÐ–ÐÐž: Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÐ¼ TenantService ÐºÐ°Ðº Singleton.
        // Ð­Ñ‚Ð¾ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð² Middleware,
        // Ð±ÑƒÐ´ÑƒÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ðµ.
        $this->app->singleton(TenantService::class, function ($app) {
            return new TenantService();
        });
    }

    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        //
    }
}
</file>

<file path="app/Services/CartService.php">
<?php
// FILE: app/Services/CartService.php

declare(strict_types=1);

namespace App\Services;

use App\Models\Product;
use Illuminate\Support\Facades\Redis;
use Illuminate\Support\Facades\Session;

class CartService
{
    // 2 Ñ‡Ð°ÑÐ° Ð¶Ð¸Ð·Ð½Ð¸ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñ‹
    private const TTL = 7200;

    private function getCartKey(): string
    {
        // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ID ÑÐµÑÑÐ¸Ð¸ ÐºÐ°Ðº Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñ‹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
        $sessionId = Session::getId();
        return "cart:{$sessionId}";
    }

    public function add(int $productId, int $quantity = 1): void
    {
        $product = Product::findOrFail($productId);
        $key = $this->getCartKey();
        
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ
        $cart = $this->get();
        
        if (isset($cart[$productId])) {
            $cart[$productId]['quantity'] += $quantity;
        } else {
            $cart[$productId] = [
                'id' => $product->id,
                'name' => $product->name,
                'price' => $product->price,
                'quantity' => $quantity,
            ];
        }

        Redis::setex($key, self::TTL, json_encode($cart));
    }

    public function get(): array
    {
        $key = $this->getCartKey();
        $data = Redis::get($key);
        return $data ? json_decode($data, true) : [];
    }

    public function clear(): void
    {
        Redis::del($this->getCartKey());
    }

    public function total(): float
    {
        $cart = $this->get();
        $total = 0;
        foreach ($cart as $item) {
            $total += $item['price'] * $item['quantity'];
        }
        return $total;
    }
}
</file>

<file path="app/Services/SearchService.php">
<?php
// FILE: app/Services/SearchService.php

declare(strict_types=1);

namespace App\Services;

use App\Models\Product;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;

class SearchService
{
    protected string $host;
    protected string $port;
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
        $this->host = config('services.elasticsearch.host', 'elasticsearch');
        $this->port = config('services.elasticsearch.port', '9200');
    }

    /**
     * ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð¼Ñ Ð¸Ð½Ð´ÐµÐºÑÐ° Ð´Ð»Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° (Ð½Ð°Ð¿Ñ€. street_style_products)
     */
    protected function getIndexName(): string
    {
        $tenantId = $this->tenantService->getCurrentTenantId();
        if (!$tenantId) {
            throw new \RuntimeException("Cannot determine index name: no tenant active.");
        }
        return "{$tenantId}_products";
    }

    protected function getUrl(string $endpoint): string
    {
        return "http://{$this->host}:{$this->port}/{$endpoint}";
    }

    /**
     * Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑ Ñ Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³Ð¾Ð¼ (ÐµÑÐ»Ð¸ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚)
     */
    public function createIndexIfNotExists(): void
    {
        $index = $this->getIndexName();
        $url = $this->getUrl($index);

        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ (HEAD Ð·Ð°Ð¿Ñ€Ð¾Ñ)
        $exists = Http::head($url)->successful();

        if (!$exists) {
            $response = Http::put($url, [
                'mappings' => [
                    'properties' => [
                        'name' => ['type' => 'text'],
                        'description' => ['type' => 'text'],
                        'category' => ['type' => 'keyword'],
                        'price' => ['type' => 'float'],
                        'sku' => ['type' => 'keyword'],
                        'tenant_id' => ['type' => 'keyword'],
                    ]
                ]
            ]);
            
            Log::info("Created Elasticsearch index: {$index}", ['status' => $response->status()]);
        }
    }

    /**
     * Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð°
     */
    public function indexProduct(Product $product): bool
    {
        $this->createIndexIfNotExists(); // Ð›ÐµÐ½Ð¸Ð²Ð°Ñ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ

        $index = $this->getIndexName();
        $url = $this->getUrl("{$index}/_doc/{$product->id}");

        $response = Http::post($url, [
            'id' => $product->id,
            'name' => $product->name,
            'description' => $product->description,
            'price' => (float) $product->price,
            'category' => $product->category,
            'sku' => $product->sku,
            'created_at' => $product->created_at->toIso8601String(),
        ]);

        return $response->successful();
    }

    /**
     * ÐŸÐ¾Ð¸ÑÐº Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²
     */
    public function search(string $query, int $limit = 20): array
    {
        $index = $this->getIndexName();
        $url = $this->getUrl("{$index}/_search");

        $body = [
            'size' => $limit,
            'query' => [
                'multi_match' => [
                    'query' => $query,
                    'fields' => ['name^3', 'description', 'sku'], // Name Ð¸Ð¼ÐµÐµÑ‚ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ x3
                    'fuzziness' => 'AUTO' // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾Ð¿ÐµÑ‡Ð°Ñ‚Ð¾Ðº
                ]
            ]
        ];

        $response = Http::post($url, $body);

        if (!$response->successful()) {
            Log::error("Elasticsearch search failed", ['body' => $response->body()]);
            return [];
        }

        $hits = $response->json('hits.hits');
        
        // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¼Ð°ÑÑÐ¸Ð² ID, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ð» Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð¸Ð· Ð‘Ð”
        return array_map(fn($hit) => $hit['_id'], $hits);
    }
    
    /**
     * Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑ (Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ ÑÐ±Ñ€Ð¾ÑÐ°)
     */
    public function deleteIndex(): void
    {
        try {
            $index = $this->getIndexName();
            Http::delete($this->getUrl($index));
        } catch (\Exception $e) {
            // Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼, ÐµÑÐ»Ð¸ Ð¸Ð½Ð´ÐµÐºÑÐ° Ð½ÐµÑ‚ Ð¸Ð»Ð¸ Ð¼Ñ‹ Ð²Ð½Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°
        }
    }
}
</file>

<file path="bootstrap/cache/.gitignore">
*
!.gitignore
</file>

<file path="bootstrap/app.php">
<?php
// FILE: bootstrap/app.php

use Illuminate\Foundation\Application;
use Illuminate\Foundation\Configuration\Exceptions;
use Illuminate\Foundation\Configuration\Middleware;
use Illuminate\Http\Request;

return Application::configure(basePath: dirname(__DIR__))
    ->withRouting(
        web: __DIR__.'/../routes/web.php',
        commands: __DIR__.'/../routes/console.php',
        health: '/up',
    )
    ->withMiddleware(function (Middleware $middleware) {
        // 1. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ TenantMiddleware
        // Ð˜Ð¡ÐŸÐžÐ›Ð¬Ð—Ð£Ð•Ðœ PREPEND Ð’ÐœÐ•Ð¡Ð¢Ðž APPEND
        // Ð­Ñ‚Ð¾ Ð²Ð°Ð¶Ð½Ð¾! Middleware Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒÑÑ Ð”Ðž ÑÑ‚Ð°Ñ€Ñ‚Ð° ÑÐµÑÑÐ¸Ð¸ (StartSession),
        // Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ° Redis Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ð»Ð°ÑÑŒ Ðº Ð´Ñ€Ð°Ð¹Ð²ÐµÑ€Ñƒ ÑÐµÑÑÐ¸Ð¹.
        $middleware->web(prepend: [
            \App\Http\Middleware\TenantMiddleware::class,
        ]);

        // 2. Ð•ÑÐ»Ð¸ Ð“ÐžÐ¡Ð¢Ð¬ Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð·Ð°Ð¹Ñ‚Ð¸ Ð² Ð°Ð´Ð¼Ð¸Ð½ÐºÑƒ -> Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚ Ð½Ð° Ð›Ð¾Ð³Ð¸Ð½
        $middleware->redirectGuestsTo(function (Request $request) {
            return route('admin.login');
        });

        // 3. Ð•ÑÐ»Ð¸ ÐÐ’Ð¢ÐžÐ Ð˜Ð—ÐžÐ’ÐÐÐÐ«Ð™ Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð›Ð¾Ð³Ð¸Ð½ -> Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚ Ð² Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´
        $middleware->redirectUsersTo(function (Request $request) {
            return route('admin.dashboard');
        });
    })
    ->withExceptions(function (Exceptions $exceptions) {
        //
    })->create();
</file>

<file path="bootstrap/providers.php">
<?php

return [
    App\Providers\AppServiceProvider::class,
];
</file>

<file path="config/app.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Application Name
    |--------------------------------------------------------------------------
    |
    | This value is the name of your application, which will be used when the
    | framework needs to place the application's name in a notification or
    | other UI elements where an application name needs to be displayed.
    |
    */

    'name' => env('APP_NAME', 'Laravel'),

    /*
    |--------------------------------------------------------------------------
    | Application Environment
    |--------------------------------------------------------------------------
    |
    | This value determines the "environment" your application is currently
    | running in. This may determine how you prefer to configure various
    | services the application utilizes. Set this in your ".env" file.
    |
    */

    'env' => env('APP_ENV', 'production'),

    /*
    |--------------------------------------------------------------------------
    | Application Debug Mode
    |--------------------------------------------------------------------------
    |
    | When your application is in debug mode, detailed error messages with
    | stack traces will be shown on every error that occurs within your
    | application. If disabled, a simple generic error page is shown.
    |
    */

    'debug' => (bool) env('APP_DEBUG', false),

    /*
    |--------------------------------------------------------------------------
    | Application URL
    |--------------------------------------------------------------------------
    |
    | This URL is used by the console to properly generate URLs when using
    | the Artisan command line tool. You should set this to the root of
    | the application so that it's available within Artisan commands.
    |
    */

    'url' => env('APP_URL', 'http://localhost'),

    /*
    |--------------------------------------------------------------------------
    | Application Timezone
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default timezone for your application, which
    | will be used by the PHP date and date-time functions. The timezone
    | is set to "UTC" by default as it is suitable for most use cases.
    |
    */

    'timezone' => 'UTC',

    /*
    |--------------------------------------------------------------------------
    | Application Locale Configuration
    |--------------------------------------------------------------------------
    |
    | The application locale determines the default locale that will be used
    | by Laravel's translation / localization methods. This option can be
    | set to any locale for which you plan to have translation strings.
    |
    */

    'locale' => env('APP_LOCALE', 'en'),

    'fallback_locale' => env('APP_FALLBACK_LOCALE', 'en'),

    'faker_locale' => env('APP_FAKER_LOCALE', 'en_US'),

    /*
    |--------------------------------------------------------------------------
    | Encryption Key
    |--------------------------------------------------------------------------
    |
    | This key is utilized by Laravel's encryption services and should be set
    | to a random, 32 character string to ensure that all encrypted values
    | are secure. You should do this prior to deploying the application.
    |
    */

    'cipher' => 'AES-256-CBC',

    'key' => env('APP_KEY'),

    'previous_keys' => [
        ...array_filter(
            explode(',', (string) env('APP_PREVIOUS_KEYS', ''))
        ),
    ],

    /*
    |--------------------------------------------------------------------------
    | Maintenance Mode Driver
    |--------------------------------------------------------------------------
    |
    | These configuration options determine the driver used to determine and
    | manage Laravel's "maintenance mode" status. The "cache" driver will
    | allow maintenance mode to be controlled across multiple machines.
    |
    | Supported drivers: "file", "cache"
    |
    */

    'maintenance' => [
        'driver' => env('APP_MAINTENANCE_DRIVER', 'file'),
        'store' => env('APP_MAINTENANCE_STORE', 'database'),
    ],

];
</file>

<file path="config/auth.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Authentication Defaults
    |--------------------------------------------------------------------------
    |
    | This option defines the default authentication "guard" and password
    | reset "broker" for your application. You may change these values
    | as required, but they're a perfect start for most applications.
    |
    */

    'defaults' => [
        'guard' => env('AUTH_GUARD', 'web'),
        'passwords' => env('AUTH_PASSWORD_BROKER', 'users'),
    ],

    /*
    |--------------------------------------------------------------------------
    | Authentication Guards
    |--------------------------------------------------------------------------
    |
    | Next, you may define every authentication guard for your application.
    | Of course, a great default configuration has been defined for you
    | which utilizes session storage plus the Eloquent user provider.
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | Supported: "session"
    |
    */

    'guards' => [
        'web' => [
            'driver' => 'session',
            'provider' => 'users',
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | User Providers
    |--------------------------------------------------------------------------
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | If you have multiple user tables or models you may configure multiple
    | providers to represent the model / table. These providers may then
    | be assigned to any extra authentication guards you have defined.
    |
    | Supported: "database", "eloquent"
    |
    */

    'providers' => [
        'users' => [
            'driver' => 'eloquent',
            'model' => env('AUTH_MODEL', App\Models\User::class),
        ],

        // 'users' => [
        //     'driver' => 'database',
        //     'table' => 'users',
        // ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Resetting Passwords
    |--------------------------------------------------------------------------
    |
    | These configuration options specify the behavior of Laravel's password
    | reset functionality, including the table utilized for token storage
    | and the user provider that is invoked to actually retrieve users.
    |
    | The expiry time is the number of minutes that each reset token will be
    | considered valid. This security feature keeps tokens short-lived so
    | they have less time to be guessed. You may change this as needed.
    |
    | The throttle setting is the number of seconds a user must wait before
    | generating more password reset tokens. This prevents the user from
    | quickly generating a very large amount of password reset tokens.
    |
    */

    'passwords' => [
        'users' => [
            'provider' => 'users',
            'table' => env('AUTH_PASSWORD_RESET_TOKEN_TABLE', 'password_reset_tokens'),
            'expire' => 60,
            'throttle' => 60,
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Password Confirmation Timeout
    |--------------------------------------------------------------------------
    |
    | Here you may define the number of seconds before a password confirmation
    | window expires and users are asked to re-enter their password via the
    | confirmation screen. By default, the timeout lasts for three hours.
    |
    */

    'password_timeout' => env('AUTH_PASSWORD_TIMEOUT', 10800),

];
</file>

<file path="config/cache.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Cache Store
    |--------------------------------------------------------------------------
    |
    | This option controls the default cache store that will be used by the
    | framework. This connection is utilized if another isn't explicitly
    | specified when running a cache operation inside the application.
    |
    */

    'default' => env('CACHE_STORE', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Cache Stores
    |--------------------------------------------------------------------------
    |
    | Here you may define all of the cache "stores" for your application as
    | well as their drivers. You may even define multiple stores for the
    | same cache driver to group types of items stored in your caches.
    |
    | Supported drivers: "array", "database", "file", "memcached",
    |                    "redis", "dynamodb", "octane",
    |                    "failover", "null"
    |
    */

    'stores' => [

        'array' => [
            'driver' => 'array',
            'serialize' => false,
        ],

        'database' => [
            'driver' => 'database',
            'connection' => env('DB_CACHE_CONNECTION'),
            'table' => env('DB_CACHE_TABLE', 'cache'),
            'lock_connection' => env('DB_CACHE_LOCK_CONNECTION'),
            'lock_table' => env('DB_CACHE_LOCK_TABLE'),
        ],

        'file' => [
            'driver' => 'file',
            'path' => storage_path('framework/cache/data'),
            'lock_path' => storage_path('framework/cache/data'),
        ],

        'memcached' => [
            'driver' => 'memcached',
            'persistent_id' => env('MEMCACHED_PERSISTENT_ID'),
            'sasl' => [
                env('MEMCACHED_USERNAME'),
                env('MEMCACHED_PASSWORD'),
            ],
            'options' => [
                // Memcached::OPT_CONNECT_TIMEOUT => 2000,
            ],
            'servers' => [
                [
                    'host' => env('MEMCACHED_HOST', '127.0.0.1'),
                    'port' => env('MEMCACHED_PORT', 11211),
                    'weight' => 100,
                ],
            ],
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => env('REDIS_CACHE_CONNECTION', 'cache'),
            'lock_connection' => env('REDIS_CACHE_LOCK_CONNECTION', 'default'),
        ],

        'dynamodb' => [
            'driver' => 'dynamodb',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'table' => env('DYNAMODB_CACHE_TABLE', 'cache'),
            'endpoint' => env('DYNAMODB_ENDPOINT'),
        ],

        'octane' => [
            'driver' => 'octane',
        ],

        'failover' => [
            'driver' => 'failover',
            'stores' => [
                'database',
                'array',
            ],
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Cache Key Prefix
    |--------------------------------------------------------------------------
    |
    | When utilizing the APC, database, memcached, Redis, and DynamoDB cache
    | stores, there might be other applications using the same cache. For
    | that reason, you may prefix every cache key to avoid collisions.
    |
    */

    'prefix' => env('CACHE_PREFIX', Str::slug((string) env('APP_NAME', 'laravel')).'-cache-'),

];
</file>

<file path="config/database.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Database Connection Name
    |--------------------------------------------------------------------------
    |
    | Here you may specify which of the database connections below you wish
    | to use as your default connection for database operations. This is
    | the connection which will be utilized unless another connection
    | is explicitly specified when you execute a query / statement.
    |
    */

    'default' => env('DB_CONNECTION', 'sqlite'),

    /*
    |--------------------------------------------------------------------------
    | Database Connections
    |--------------------------------------------------------------------------
    |
    | Below are all of the database connections defined for your application.
    | An example configuration is provided for each database system which
    | is supported by Laravel. You're free to add / remove connections.
    |
    */

    'connections' => [

        'sqlite' => [
            'driver' => 'sqlite',
            'url' => env('DB_URL'),
            'database' => env('DB_DATABASE', database_path('database.sqlite')),
            'prefix' => '',
            'foreign_key_constraints' => env('DB_FOREIGN_KEYS', true),
            'busy_timeout' => null,
            'journal_mode' => null,
            'synchronous' => null,
            'transaction_mode' => 'DEFERRED',
        ],

        'mysql' => [
            'driver' => 'mysql',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => env('DB_CHARSET', 'utf8mb4'),
            'collation' => env('DB_COLLATION', 'utf8mb4_unicode_ci'),
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                (PHP_VERSION_ID >= 80500 ? \Pdo\Mysql::ATTR_SSL_CA : \PDO::MYSQL_ATTR_SSL_CA) => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'mariadb' => [
            'driver' => 'mariadb',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => env('DB_CHARSET', 'utf8mb4'),
            'collation' => env('DB_COLLATION', 'utf8mb4_unicode_ci'),
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                (PHP_VERSION_ID >= 80500 ? \Pdo\Mysql::ATTR_SSL_CA : \PDO::MYSQL_ATTR_SSL_CA) => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'pgsql' => [
            'driver' => 'pgsql',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '5432'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => env('DB_CHARSET', 'utf8'),
            'prefix' => '',
            'prefix_indexes' => true,
            'search_path' => 'public',
            'sslmode' => 'prefer',
        ],

        'sqlsrv' => [
            'driver' => 'sqlsrv',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', 'localhost'),
            'port' => env('DB_PORT', '1433'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => env('DB_CHARSET', 'utf8'),
            'prefix' => '',
            'prefix_indexes' => true,
            // 'encrypt' => env('DB_ENCRYPT', 'yes'),
            // 'trust_server_certificate' => env('DB_TRUST_SERVER_CERTIFICATE', 'false'),
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Migration Repository Table
    |--------------------------------------------------------------------------
    |
    | This table keeps track of all the migrations that have already run for
    | your application. Using this information, we can determine which of
    | the migrations on disk haven't actually been run on the database.
    |
    */

    'migrations' => [
        'table' => 'migrations',
        'update_date_on_publish' => true,
    ],

    /*
    |--------------------------------------------------------------------------
    | Redis Databases
    |--------------------------------------------------------------------------
    |
    | Redis is an open source, fast, and advanced key-value store that also
    | provides a richer body of commands than a typical key-value system
    | such as Memcached. You may define your connection settings here.
    |
    */

    'redis' => [

        'client' => env('REDIS_CLIENT', 'phpredis'),

        'options' => [
            'cluster' => env('REDIS_CLUSTER', 'redis'),
            'prefix' => env('REDIS_PREFIX', Str::slug((string) env('APP_NAME', 'laravel')).'-database-'),
            'persistent' => env('REDIS_PERSISTENT', false),
        ],

        'default' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_DB', '0'),
            'max_retries' => env('REDIS_MAX_RETRIES', 3),
            'backoff_algorithm' => env('REDIS_BACKOFF_ALGORITHM', 'decorrelated_jitter'),
            'backoff_base' => env('REDIS_BACKOFF_BASE', 100),
            'backoff_cap' => env('REDIS_BACKOFF_CAP', 1000),
        ],

        'cache' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_CACHE_DB', '1'),
            'max_retries' => env('REDIS_MAX_RETRIES', 3),
            'backoff_algorithm' => env('REDIS_BACKOFF_ALGORITHM', 'decorrelated_jitter'),
            'backoff_base' => env('REDIS_BACKOFF_BASE', 100),
            'backoff_cap' => env('REDIS_BACKOFF_CAP', 1000),
        ],

    ],

];
</file>

<file path="config/logging.php">
<?php

use Monolog\Handler\NullHandler;
use Monolog\Handler\StreamHandler;
use Monolog\Handler\SyslogUdpHandler;
use Monolog\Processor\PsrLogMessageProcessor;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Log Channel
    |--------------------------------------------------------------------------
    |
    | This option defines the default log channel that is utilized to write
    | messages to your logs. The value provided here should match one of
    | the channels present in the list of "channels" configured below.
    |
    */

    'default' => env('LOG_CHANNEL', 'stack'),

    /*
    |--------------------------------------------------------------------------
    | Deprecations Log Channel
    |--------------------------------------------------------------------------
    |
    | This option controls the log channel that should be used to log warnings
    | regarding deprecated PHP and library features. This allows you to get
    | your application ready for upcoming major versions of dependencies.
    |
    */

    'deprecations' => [
        'channel' => env('LOG_DEPRECATIONS_CHANNEL', 'null'),
        'trace' => env('LOG_DEPRECATIONS_TRACE', false),
    ],

    /*
    |--------------------------------------------------------------------------
    | Log Channels
    |--------------------------------------------------------------------------
    |
    | Here you may configure the log channels for your application. Laravel
    | utilizes the Monolog PHP logging library, which includes a variety
    | of powerful log handlers and formatters that you're free to use.
    |
    | Available drivers: "single", "daily", "slack", "syslog",
    |                    "errorlog", "monolog", "custom", "stack"
    |
    */

    'channels' => [

        'stack' => [
            'driver' => 'stack',
            'channels' => explode(',', (string) env('LOG_STACK', 'single')),
            'ignore_exceptions' => false,
        ],

        'single' => [
            'driver' => 'single',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'daily' => [
            'driver' => 'daily',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'days' => env('LOG_DAILY_DAYS', 14),
            'replace_placeholders' => true,
        ],

        'slack' => [
            'driver' => 'slack',
            'url' => env('LOG_SLACK_WEBHOOK_URL'),
            'username' => env('LOG_SLACK_USERNAME', 'Laravel Log'),
            'emoji' => env('LOG_SLACK_EMOJI', ':boom:'),
            'level' => env('LOG_LEVEL', 'critical'),
            'replace_placeholders' => true,
        ],

        'papertrail' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => env('LOG_PAPERTRAIL_HANDLER', SyslogUdpHandler::class),
            'handler_with' => [
                'host' => env('PAPERTRAIL_URL'),
                'port' => env('PAPERTRAIL_PORT'),
                'connectionString' => 'tls://'.env('PAPERTRAIL_URL').':'.env('PAPERTRAIL_PORT'),
            ],
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'stderr' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => StreamHandler::class,
            'handler_with' => [
                'stream' => 'php://stderr',
            ],
            'formatter' => env('LOG_STDERR_FORMATTER'),
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'syslog' => [
            'driver' => 'syslog',
            'level' => env('LOG_LEVEL', 'debug'),
            'facility' => env('LOG_SYSLOG_FACILITY', LOG_USER),
            'replace_placeholders' => true,
        ],

        'errorlog' => [
            'driver' => 'errorlog',
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'null' => [
            'driver' => 'monolog',
            'handler' => NullHandler::class,
        ],

        'emergency' => [
            'path' => storage_path('logs/laravel.log'),
        ],

    ],

];
</file>

<file path="config/mail.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Mailer
    |--------------------------------------------------------------------------
    |
    | This option controls the default mailer that is used to send all email
    | messages unless another mailer is explicitly specified when sending
    | the message. All additional mailers can be configured within the
    | "mailers" array. Examples of each type of mailer are provided.
    |
    */

    'default' => env('MAIL_MAILER', 'log'),

    /*
    |--------------------------------------------------------------------------
    | Mailer Configurations
    |--------------------------------------------------------------------------
    |
    | Here you may configure all of the mailers used by your application plus
    | their respective settings. Several examples have been configured for
    | you and you are free to add your own as your application requires.
    |
    | Laravel supports a variety of mail "transport" drivers that can be used
    | when delivering an email. You may specify which one you're using for
    | your mailers below. You may also add additional mailers if needed.
    |
    | Supported: "smtp", "sendmail", "mailgun", "ses", "ses-v2",
    |            "postmark", "resend", "log", "array",
    |            "failover", "roundrobin"
    |
    */

    'mailers' => [

        'smtp' => [
            'transport' => 'smtp',
            'scheme' => env('MAIL_SCHEME'),
            'url' => env('MAIL_URL'),
            'host' => env('MAIL_HOST', '127.0.0.1'),
            'port' => env('MAIL_PORT', 2525),
            'username' => env('MAIL_USERNAME'),
            'password' => env('MAIL_PASSWORD'),
            'timeout' => null,
            'local_domain' => env('MAIL_EHLO_DOMAIN', parse_url((string) env('APP_URL', 'http://localhost'), PHP_URL_HOST)),
        ],

        'ses' => [
            'transport' => 'ses',
        ],

        'postmark' => [
            'transport' => 'postmark',
            // 'message_stream_id' => env('POSTMARK_MESSAGE_STREAM_ID'),
            // 'client' => [
            //     'timeout' => 5,
            // ],
        ],

        'resend' => [
            'transport' => 'resend',
        ],

        'sendmail' => [
            'transport' => 'sendmail',
            'path' => env('MAIL_SENDMAIL_PATH', '/usr/sbin/sendmail -bs -i'),
        ],

        'log' => [
            'transport' => 'log',
            'channel' => env('MAIL_LOG_CHANNEL'),
        ],

        'array' => [
            'transport' => 'array',
        ],

        'failover' => [
            'transport' => 'failover',
            'mailers' => [
                'smtp',
                'log',
            ],
            'retry_after' => 60,
        ],

        'roundrobin' => [
            'transport' => 'roundrobin',
            'mailers' => [
                'ses',
                'postmark',
            ],
            'retry_after' => 60,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Global "From" Address
    |--------------------------------------------------------------------------
    |
    | You may wish for all emails sent by your application to be sent from
    | the same address. Here you may specify a name and address that is
    | used globally for all emails that are sent by your application.
    |
    */

    'from' => [
        'address' => env('MAIL_FROM_ADDRESS', 'hello@example.com'),
        'name' => env('MAIL_FROM_NAME', 'Example'),
    ],

];
</file>

<file path="config/queue.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Queue Connection Name
    |--------------------------------------------------------------------------
    |
    | Laravel's queue supports a variety of backends via a single, unified
    | API, giving you convenient access to each backend using identical
    | syntax for each. The default queue connection is defined below.
    |
    */

    'default' => env('QUEUE_CONNECTION', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Queue Connections
    |--------------------------------------------------------------------------
    |
    | Here you may configure the connection options for every queue backend
    | used by your application. An example configuration is provided for
    | each backend supported by Laravel. You're also free to add more.
    |
    | Drivers: "sync", "database", "beanstalkd", "sqs", "redis",
    |          "deferred", "background", "failover", "null"
    |
    */

    'connections' => [

        'sync' => [
            'driver' => 'sync',
        ],

        'database' => [
            'driver' => 'database',
            'connection' => env('DB_QUEUE_CONNECTION'),
            'table' => env('DB_QUEUE_TABLE', 'jobs'),
            'queue' => env('DB_QUEUE', 'default'),
            'retry_after' => (int) env('DB_QUEUE_RETRY_AFTER', 90),
            'after_commit' => false,
        ],

        'beanstalkd' => [
            'driver' => 'beanstalkd',
            'host' => env('BEANSTALKD_QUEUE_HOST', 'localhost'),
            'queue' => env('BEANSTALKD_QUEUE', 'default'),
            'retry_after' => (int) env('BEANSTALKD_QUEUE_RETRY_AFTER', 90),
            'block_for' => 0,
            'after_commit' => false,
        ],

        'sqs' => [
            'driver' => 'sqs',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'prefix' => env('SQS_PREFIX', 'https://sqs.us-east-1.amazonaws.com/your-account-id'),
            'queue' => env('SQS_QUEUE', 'default'),
            'suffix' => env('SQS_SUFFIX'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'after_commit' => false,
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => env('REDIS_QUEUE_CONNECTION', 'default'),
            'queue' => env('REDIS_QUEUE', 'default'),
            'retry_after' => (int) env('REDIS_QUEUE_RETRY_AFTER', 90),
            'block_for' => null,
            'after_commit' => false,
        ],

        'deferred' => [
            'driver' => 'deferred',
        ],

        'background' => [
            'driver' => 'background',
        ],

        'failover' => [
            'driver' => 'failover',
            'connections' => [
                'database',
                'deferred',
            ],
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Job Batching
    |--------------------------------------------------------------------------
    |
    | The following options configure the database and table that store job
    | batching information. These options can be updated to any database
    | connection and table which has been defined by your application.
    |
    */

    'batching' => [
        'database' => env('DB_CONNECTION', 'sqlite'),
        'table' => 'job_batches',
    ],

    /*
    |--------------------------------------------------------------------------
    | Failed Queue Jobs
    |--------------------------------------------------------------------------
    |
    | These options configure the behavior of failed queue job logging so you
    | can control how and where failed jobs are stored. Laravel ships with
    | support for storing failed jobs in a simple file or in a database.
    |
    | Supported drivers: "database-uuids", "dynamodb", "file", "null"
    |
    */

    'failed' => [
        'driver' => env('QUEUE_FAILED_DRIVER', 'database-uuids'),
        'database' => env('DB_CONNECTION', 'sqlite'),
        'table' => 'failed_jobs',
    ],

];
</file>

<file path="config/services.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Third Party Services
    |--------------------------------------------------------------------------
    |
    | This file is for storing the credentials for third party services such
    | as Mailgun, Postmark, AWS and more. This file provides the de facto
    | location for this type of information, allowing packages to have
    | a conventional file to locate the various service credentials.
    |
    */

    'postmark' => [
        'key' => env('POSTMARK_API_KEY'),
    ],

    'resend' => [
        'key' => env('RESEND_API_KEY'),
    ],

    'ses' => [
        'key' => env('AWS_ACCESS_KEY_ID'),
        'secret' => env('AWS_SECRET_ACCESS_KEY'),
        'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
    ],

    'slack' => [
        'notifications' => [
            'bot_user_oauth_token' => env('SLACK_BOT_USER_OAUTH_TOKEN'),
            'channel' => env('SLACK_BOT_USER_DEFAULT_CHANNEL'),
        ],
    ],

];
</file>

<file path="config/session.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Session Driver
    |--------------------------------------------------------------------------
    |
    | This option determines the default session driver that is utilized for
    | incoming requests. Laravel supports a variety of storage options to
    | persist session data. Database storage is a great default choice.
    |
    | Supported: "file", "cookie", "database", "memcached",
    |            "redis", "dynamodb", "array"
    |
    */

    'driver' => env('SESSION_DRIVER', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Session Lifetime
    |--------------------------------------------------------------------------
    |
    | Here you may specify the number of minutes that you wish the session
    | to be allowed to remain idle before it expires. If you want them
    | to expire immediately when the browser is closed then you may
    | indicate that via the expire_on_close configuration option.
    |
    */

    'lifetime' => (int) env('SESSION_LIFETIME', 120),

    'expire_on_close' => env('SESSION_EXPIRE_ON_CLOSE', false),

    /*
    |--------------------------------------------------------------------------
    | Session Encryption
    |--------------------------------------------------------------------------
    |
    | This option allows you to easily specify that all of your session data
    | should be encrypted before it's stored. All encryption is performed
    | automatically by Laravel and you may use the session like normal.
    |
    */

    'encrypt' => env('SESSION_ENCRYPT', false),

    /*
    |--------------------------------------------------------------------------
    | Session File Location
    |--------------------------------------------------------------------------
    |
    | When utilizing the "file" session driver, the session files are placed
    | on disk. The default storage location is defined here; however, you
    | are free to provide another location where they should be stored.
    |
    */

    'files' => storage_path('framework/sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Connection
    |--------------------------------------------------------------------------
    |
    | When using the "database" or "redis" session drivers, you may specify a
    | connection that should be used to manage these sessions. This should
    | correspond to a connection in your database configuration options.
    |
    */

    'connection' => env('SESSION_CONNECTION'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Table
    |--------------------------------------------------------------------------
    |
    | When using the "database" session driver, you may specify the table to
    | be used to store sessions. Of course, a sensible default is defined
    | for you; however, you're welcome to change this to another table.
    |
    */

    'table' => env('SESSION_TABLE', 'sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Cache Store
    |--------------------------------------------------------------------------
    |
    | When using one of the framework's cache driven session backends, you may
    | define the cache store which should be used to store the session data
    | between requests. This must match one of your defined cache stores.
    |
    | Affects: "dynamodb", "memcached", "redis"
    |
    */

    'store' => env('SESSION_STORE'),

    /*
    |--------------------------------------------------------------------------
    | Session Sweeping Lottery
    |--------------------------------------------------------------------------
    |
    | Some session drivers must manually sweep their storage location to get
    | rid of old sessions from storage. Here are the chances that it will
    | happen on a given request. By default, the odds are 2 out of 100.
    |
    */

    'lottery' => [2, 100],

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Name
    |--------------------------------------------------------------------------
    |
    | Here you may change the name of the session cookie that is created by
    | the framework. Typically, you should not need to change this value
    | since doing so does not grant a meaningful security improvement.
    |
    */

    'cookie' => env(
        'SESSION_COOKIE',
        Str::slug((string) env('APP_NAME', 'laravel')).'-session'
    ),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Path
    |--------------------------------------------------------------------------
    |
    | The session cookie path determines the path for which the cookie will
    | be regarded as available. Typically, this will be the root path of
    | your application, but you're free to change this when necessary.
    |
    */

    'path' => env('SESSION_PATH', '/'),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Domain
    |--------------------------------------------------------------------------
    |
    | This value determines the domain and subdomains the session cookie is
    | available to. By default, the cookie will be available to the root
    | domain without subdomains. Typically, this shouldn't be changed.
    |
    */

    'domain' => env('SESSION_DOMAIN'),

    /*
    |--------------------------------------------------------------------------
    | HTTPS Only Cookies
    |--------------------------------------------------------------------------
    |
    | By setting this option to true, session cookies will only be sent back
    | to the server if the browser has a HTTPS connection. This will keep
    | the cookie from being sent to you when it can't be done securely.
    |
    */

    'secure' => env('SESSION_SECURE_COOKIE'),

    /*
    |--------------------------------------------------------------------------
    | HTTP Access Only
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will prevent JavaScript from accessing the
    | value of the cookie and the cookie will only be accessible through
    | the HTTP protocol. It's unlikely you should disable this option.
    |
    */

    'http_only' => env('SESSION_HTTP_ONLY', true),

    /*
    |--------------------------------------------------------------------------
    | Same-Site Cookies
    |--------------------------------------------------------------------------
    |
    | This option determines how your cookies behave when cross-site requests
    | take place, and can be used to mitigate CSRF attacks. By default, we
    | will set this value to "lax" to permit secure cross-site requests.
    |
    | See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#samesitesamesite-value
    |
    | Supported: "lax", "strict", "none", null
    |
    */

    'same_site' => env('SESSION_SAME_SITE', 'lax'),

    /*
    |--------------------------------------------------------------------------
    | Partitioned Cookies
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will tie the cookie to the top-level site for
    | a cross-site context. Partitioned cookies are accepted by the browser
    | when flagged "secure" and the Same-Site attribute is set to "none".
    |
    */

    'partitioned' => env('SESSION_PARTITIONED_COOKIE', false),

];
</file>

<file path="config/tenants.php">
<?php
// FILE: config/tenants.php

return [
    // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ð¾ÐºÑƒ
    'admin_domain' => env('ADMIN_DOMAIN', 'admin.trishop.local'),

    'tenants' => [
        'street_style' => [
            'id' => 'street_style',
            'domain' => env('DOMAIN_STREET', 'street.trishop.local'),
            'name' => 'Street Style',
        ],
        'designer_hub' => [
            'id' => 'designer_hub',
            'domain' => env('DOMAIN_DESIGNER', 'designer.trishop.local'),
            'name' => 'Designer Hub',
        ],
        'military_gear' => [
            'id' => 'military_gear',
            'domain' => env('DOMAIN_MILITARY', 'military.trishop.local'),
            'name' => 'Military Gear',
        ],
    ],
];
</file>

<file path="database/factories/UserFactory.php">
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\User>
 */
class UserFactory extends Factory
{
    /**
     * The current password being used by the factory.
     */
    protected static ?string $password;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => static::$password ??= Hash::make('password'),
            'remember_token' => Str::random(10),
        ];
    }

    /**
     * Indicate that the model's email address should be unverified.
     */
    public function unverified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}
</file>

<file path="database/migrations/0001_01_01_000000_create_users_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->rememberToken();
            $table->timestamps();
        });

        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });

        Schema::create('sessions', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->foreignId('user_id')->nullable()->index();
            $table->string('ip_address', 45)->nullable();
            $table->text('user_agent')->nullable();
            $table->longText('payload');
            $table->integer('last_activity')->index();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
        Schema::dropIfExists('password_reset_tokens');
        Schema::dropIfExists('sessions');
    }
};
</file>

<file path="database/migrations/0001_01_01_000001_create_cache_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('cache', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->mediumText('value');
            $table->integer('expiration');
        });

        Schema::create('cache_locks', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->string('owner');
            $table->integer('expiration');
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('cache');
        Schema::dropIfExists('cache_locks');
    }
};
</file>

<file path="database/migrations/0001_01_01_000002_create_jobs_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('jobs', function (Blueprint $table) {
            $table->id();
            $table->string('queue')->index();
            $table->longText('payload');
            $table->unsignedTinyInteger('attempts');
            $table->unsignedInteger('reserved_at')->nullable();
            $table->unsignedInteger('available_at');
            $table->unsignedInteger('created_at');
        });

        Schema::create('job_batches', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->string('name');
            $table->integer('total_jobs');
            $table->integer('pending_jobs');
            $table->integer('failed_jobs');
            $table->longText('failed_job_ids');
            $table->mediumText('options')->nullable();
            $table->integer('cancelled_at')->nullable();
            $table->integer('created_at');
            $table->integer('finished_at')->nullable();
        });

        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('jobs');
        Schema::dropIfExists('job_batches');
        Schema::dropIfExists('failed_jobs');
    }
};
</file>

<file path="database/migrations/2024_01_01_000001_create_products_table.php">
<?php
// FILE: database/migrations/2024_01_01_000001_create_products_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('products', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('slug')->unique(); // Ð£Ð½Ð¸ÐºÐ°Ð»ÐµÐ½ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð¹ ÑÑ…ÐµÐ¼Ñ‹
            $table->text('description')->nullable();
            $table->decimal('price', 10, 2);
            $table->string('category'); // ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 'shoes', 'jackets'
            $table->string('sku')->nullable(); // ÐÑ€Ñ‚Ð¸ÐºÑƒÐ»
            $table->integer('stock_quantity')->default(0);
            $table->json('attributes')->nullable(); // Ð Ð°Ð·Ð¼ÐµÑ€, Ñ†Ð²ÐµÑ‚ Ð¸ Ñ‚.Ð´.
            $table->timestamps();
            $table->softDeletes();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('products');
    }
};
</file>

<file path="database/migrations/2024_01_01_000002_create_orders_table.php">
<?php
// FILE: database/migrations/2024_01_01_000002_create_orders_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('orders', function (Blueprint $table) {
            $table->id();
            $table->string('order_number')->unique(); // ST-12345, DH-99999
            $table->decimal('total_amount', 10, 2);
            $table->string('status')->default('new'); // new, paid, shipped
            $table->string('customer_email');
            $table->string('customer_name')->nullable();
            $table->json('items'); // Snapshot Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð½Ð° Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('orders');
    }
};
</file>

<file path="database/migrations/2024_01_01_000003_create_tenant_settings_table.php">
<?php
// FILE: database/migrations/2024_01_01_000003_create_tenant_settings_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('tenant_settings', function (Blueprint $table) {
            $table->id();
            $table->string('key')->unique(); // 'telegram_chat_id', 'novaposhta_api_key'
            $table->text('value')->nullable();
            $table->string('group')->default('general'); // 'notifications', 'delivery'
            $table->timestamps();
        });
        
        // Ð”Ð¾Ð±Ð°Ð²Ð¸Ð¼ Ñ€Ð¾Ð»ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼, ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð½ÐµÑ‚
        if (!Schema::hasColumn('users', 'role')) {
            Schema::table('users', function (Blueprint $table) {
                $table->string('role')->default('manager'); // 'super_admin', 'manager'
            });
        }
    }

    public function down(): void
    {
        Schema::dropIfExists('tenant_settings');
        if (Schema::hasColumn('users', 'role')) {
            Schema::table('users', function (Blueprint $table) {
                $table->dropColumn('role');
            });
        }
    }
};
</file>

<file path="database/migrations/2024_01_01_000004_add_tenant_id_to_users_table.php">
<?php
// FILE: database/migrations/2024_01_01_000004_add_tenant_id_to_users_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾Ð»Ðµ Ð¸ Ð² public ÑÑ…ÐµÐ¼Ñƒ (Ð´Ð»Ñ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»Ð°), Ð¸ Ð² ÑÑ…ÐµÐ¼Ñ‹ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð² (Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²)
        Schema::table('users', function (Blueprint $table) {
            // Ð•ÑÐ»Ð¸ tenant_id NULL â€” ÑÑ‚Ð¾ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ (Ð¡ÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½)
            // Ð•ÑÐ»Ð¸ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ 'military_gear') â€” Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ðº ÑÑ‚Ð¾Ð¼Ñƒ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñƒ
            $table->string('tenant_id')->nullable()->after('email');
        });
    }

    public function down(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->dropColumn('tenant_id');
        });
    }
};
</file>

<file path="database/migrations/2024_01_01_000005_add_image_to_products_table.php">
<?php
// FILE: database/migrations/2024_01_01_000005_add_image_to_products_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // Ð­Ñ‚Ð° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð½Ð°ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒÑÑ Ð½Ð° Ð’Ð¡Ð• ÑÑ…ÐµÐ¼Ñ‹ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð²
        Schema::table('products', function (Blueprint $table) {
            $table->string('image_path')->nullable()->after('description');
        });
    }

    public function down(): void
    {
        Schema::table('products', function (Blueprint $table) {
            $table->dropColumn('image_path');
        });
    }
};
</file>

<file path="database/migrations/2024_01_01_000006_create_categories_table.php">
<?php
// FILE: database/migrations/2024_01_01_000006_create_categories_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // 1. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹
        Schema::create('categories', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('slug')->unique();
            $table->timestamps();
        });

        // 2. ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹: category (string) -> category_id (int)
        // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ, ÑÑ‚Ð°Ñ€ÑƒÑŽ Ð¿Ð¾ÐºÐ° Ð½Ðµ ÑƒÐ´Ð°Ð»ÑÐµÐ¼ (Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð¿Ð¾Ñ‚ÐµÑ€ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ, ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ð¼Ð¸Ð³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ)
        Schema::table('products', function (Blueprint $table) {
            $table->foreignId('category_id')->nullable()->constrained()->nullOnDelete();
        });
    }

    public function down(): void
    {
        Schema::table('products', function (Blueprint $table) {
            $table->dropForeign(['category_id']);
            $table->dropColumn('category_id');
        });
        Schema::dropIfExists('categories');
    }
};
</file>

<file path="database/migrations/2024_01_01_000007_refactor_categories_and_attributes.php">
<?php
// FILE: database/migrations/2024_01_01_000007_refactor_categories_and_attributes.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // 1. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÑÐ²ÑÐ·ÐµÐ¹ Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ <-> ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
        Schema::create('category_product', function (Blueprint $table) {
            $table->id();
            $table->foreignId('product_id')->constrained()->cascadeOnDelete();
            $table->foreignId('category_id')->constrained()->cascadeOnDelete();
        });

        // 2. Ð¡Ð¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸Ðº Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¾Ð² (Ð Ð°Ð·Ð¼ÐµÑ€Ñ‹, Ð¢Ð¸Ð¿Ñ‹, ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹)
        // Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÑƒÑ‚ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒÑÑ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ: "Hoodie", "XL", "Cotton"
        Schema::create('attribute_options', function (Blueprint $table) {
            $table->id();
            $table->string('type'); // 'size', 'product_type', 'material'
            $table->string('value'); // 'XL', 'Hoodie'
            $table->string('slug')->nullable();
            $table->timestamps();
            
            // Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ñ‚Ð¸Ð¿Ð° (Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð´Ð²Ð° Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° XL)
            $table->unique(['type', 'value']);
        });

        // 3. ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… (ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð¸) Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ€Ð¾Ð¹ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸
        // (Ð£Ð¿Ñ€Ð¾Ñ‰ÐµÐ½Ð¾: Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑƒÐ´Ð°Ð»ÑÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ)
        if (Schema::hasColumn('products', 'category_id')) {
            Schema::table('products', function (Blueprint $table) {
                $table->dropForeign(['category_id']);
                $table->dropColumn('category_id');
            });
        }
    }

    public function down(): void
    {
        Schema::dropIfExists('category_product');
        Schema::dropIfExists('attribute_options');
        Schema::table('products', function (Blueprint $table) {
            $table->foreignId('category_id')->nullable()->constrained()->nullOnDelete();
        });
    }
};
</file>

<file path="database/migrations/2024_01_01_000009_clean_products_table_columns.php">
<?php
// FILE: database/migrations/2024_01_01_000009_clean_products_table_columns.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('products', function (Blueprint $table) {
            // Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸, ÐµÑÐ»Ð¸ Ð¾Ð½Ð¸ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‚
            if (Schema::hasColumn('products', 'category')) {
                $table->dropColumn('category');
            }
            if (Schema::hasColumn('products', 'category_id')) {
                // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð´Ñ€Ð¾Ð¿Ð°ÐµÐ¼ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡, ÐµÑÐ»Ð¸ Ð¾Ð½ ÐµÑÑ‚ÑŒ (Ð½Ð° Ð²ÑÑÐºÐ¸Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹ Ð¾Ð±ÐµÑ€Ð½ÐµÐ¼ Ð² try catch Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ)
                // Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ñ‹ Ð² SQLite/Postgres Ñ‡Ð°ÑÑ‚Ð¾ Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ dropColumn, Ð½Ð¾ Ð¿Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°Ð¼ Ð½Ð°Ð´Ð¾ ÐºÐ»ÑŽÑ‡.
                // Ð¢Ð°Ðº ÐºÐ°Ðº Ð¼Ñ‹ Ð½Ðµ Ð·Ð½Ð°ÐµÐ¼ Ñ‚Ð¾Ñ‡Ð½Ð¾Ðµ Ð¸Ð¼Ñ ÐºÐ»ÑŽÑ‡Ð° Ð² ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÑ…ÐµÐ¼Ðµ, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ.
                $table->dropColumn('category_id');
            }
        });
    }

    public function down(): void
    {
        // ÐžÐ±Ñ€Ð°Ñ‚Ð½Ð¾ Ð½Ðµ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð°ÑÑŒ Ð±ÐµÐ·Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð½Ð¾
    }
};
</file>

<file path="database/migrations/2024_01_01_000010_create_product_images_table.php">
<?php
// FILE: database/migrations/2024_01_01_000010_create_product_images_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    public function up(): void
    {
        // 1. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹
        Schema::create('product_images', function (Blueprint $table) {
            $table->id();
            $table->foreignId('product_id')->constrained()->cascadeOnDelete();
            $table->string('path');
            $table->integer('sort_order')->default(0); // 0 = Ð“Ð»Ð°Ð²Ð½Ð°Ñ (Ð¾Ð±Ð»Ð¾Ð¶ÐºÐ°)
            $table->timestamps();
        });

        // 2. ÐŸÐµÑ€ÐµÐ½Ð¾ÑÐ¸Ð¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· ÑÑ‚Ð°Ñ€Ð¾Ð¹ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ (ÐµÑÐ»Ð¸ Ð¾Ð½Ð° ÐµÑÑ‚ÑŒ Ð¸ Ð½Ðµ Ð¿ÑƒÑÑ‚Ð°Ñ)
        // Ð­Ñ‚Ð¾ ÑÑ‹Ñ€Ð¾Ð¹ SQL, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒÑÑ
        if (Schema::hasColumn('products', 'image_path')) {
            $products = DB::table('products')->whereNotNull('image_path')->get();
            foreach ($products as $product) {
                if (!empty($product->image_path)) {
                    DB::table('product_images')->insert([
                        'product_id' => $product->id,
                        'path' => $product->image_path,
                        'sort_order' => 0,
                        'created_at' => now(),
                        'updated_at' => now(),
                    ]);
                }
            }
            
            // 3. Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€ÑƒÑŽ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ
            Schema::table('products', function (Blueprint $table) {
                $table->dropColumn('image_path');
            });
        }
    }

    public function down(): void
    {
        Schema::table('products', function (Blueprint $table) {
            $table->string('image_path')->nullable();
        });
        Schema::dropIfExists('product_images');
    }
};
</file>

<file path="database/migrations/2024_01_01_000011_create_product_variants_table.php">
<?php
// FILE: database/migrations/2024_01_01_000011_create_product_variants_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('product_variants', function (Blueprint $table) {
            $table->id();
            $table->foreignId('product_id')->constrained()->cascadeOnDelete();
            $table->string('size'); // S, M, 42, 43
            $table->integer('stock')->default(0);
            $table->timestamps();
            
            // Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ: Ñƒ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð´Ð²Ð° Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° 'S'
            $table->unique(['product_id', 'size']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('product_variants');
    }
};
</file>

<file path="database/migrations/2024_01_01_000012_create_telegram_configs_table.php">
<?php
// FILE: database/migrations/2024_01_01_000012_create_telegram_configs_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð² ÑÑ…ÐµÐ¼Ðµ public, Ñ‚Ð°Ðº ÐºÐ°Ðº ÑÑ‚Ð¾ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
        // ÐÐ¾ Laravel Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ search_path.
        // ÐœÑ‹ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑÑ Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð· Ð´Ð»Ñ Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð‘Ð”.
        
        Schema::create('telegram_configs', function (Blueprint $table) {
            $table->id();
            $table->string('name'); // ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð°, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ "StreetStyle Bot")
            $table->string('bot_token'); // Ð¢Ð¾ÐºÐµÐ½ Ð¾Ñ‚ BotFather
            $table->string('chat_id'); // ID Ñ‡Ð°Ñ‚Ð° Ð¸Ð»Ð¸ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð´Ð»Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
            $table->string('tenant_id')->nullable()->unique(); // ÐŸÑ€Ð¸Ð²ÑÐ·ÐºÐ° Ðº Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñƒ (null = Ð¾Ð±Ñ‰Ð¸Ð¹ Ð±Ð¾Ñ‚)
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('telegram_configs');
    }
};
</file>

<file path="database/migrations/2024_01_01_000013_create_clothing_lines_table.php">
<?php
// FILE: database/migrations/2024_01_01_000013_create_clothing_lines_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // 1. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð»Ð¸Ð½ÐµÐµÐº
        Schema::create('clothing_lines', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('slug')->unique(); // Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÑ…ÐµÐ¼Ñ‹ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
            $table->timestamps();
        });

        // 2. Ð¡Ð²ÑÐ·ÑŒ Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²
        Schema::table('products', function (Blueprint $table) {
            // nullable - Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð½Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹
            // nullOnDelete - ÐµÑÐ»Ð¸ Ð»Ð¸Ð½ÐµÐ¹ÐºÑƒ ÑƒÐ´Ð°Ð»ÑÑ‚, Ñ‚Ð¾Ð²Ð°Ñ€ Ð¾ÑÑ‚Ð°Ð½ÐµÑ‚ÑÑ (Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ð¾Ð»Ðµ ÑÑ‚Ð°Ð½ÐµÑ‚ null)
            $table->foreignId('clothing_line_id')
                  ->nullable()
                  ->constrained('clothing_lines')
                  ->nullOnDelete();
        });
    }

    public function down(): void
    {
        Schema::table('products', function (Blueprint $table) {
            $table->dropForeign(['clothing_line_id']);
            $table->dropColumn('clothing_line_id');
        });
        Schema::dropIfExists('clothing_lines');
    }
};
</file>

<file path="database/migrations/2024_01_01_000014_add_discounts_and_promocodes.php">
<?php
// FILE: database/migrations/2024_01_01_000014_add_discounts_and_promocodes.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // 1. Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ñ†ÐµÐ½Ñƒ ÑÐ¾ ÑÐºÐ¸Ð´ÐºÐ¾Ð¹ Ð² Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹
        Schema::table('products', function (Blueprint $table) {
            $table->decimal('sale_price', 10, 2)->nullable()->after('price');
        });

        // 2. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð¾Ð²
        Schema::create('promo_codes', function (Blueprint $table) {
            $table->id();
            $table->string('code')->unique(); // ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: SUMMER2025
            $table->enum('type', ['percent', 'fixed']); // Ð¢Ð¸Ð¿ ÑÐºÐ¸Ð´ÐºÐ¸
            $table->decimal('value', 10, 2); // Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ 10% Ð¸Ð»Ð¸ 50$)
            $table->boolean('is_active')->default(true);
            $table->timestamp('expires_at')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::table('products', function (Blueprint $table) {
            $table->dropColumn('sale_price');
        });
        Schema::dropIfExists('promo_codes');
    }
};
</file>

<file path="database/migrations/2024_01_01_000015_update_promo_codes_structure.php">
<?php
// FILE: database/migrations/2024_01_01_000015_update_promo_codes_structure.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // ÐœÑ‹ Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ð¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹
        Schema::dropIfExists('promo_codes');

        Schema::create('promo_codes', function (Blueprint $table) {
            $table->id();
            $table->string('code')->unique(); // ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: VIPCLIENT
            $table->enum('type', ['percent', 'fixed']); // Ð¢Ð¸Ð¿: % Ð¸Ð»Ð¸ $
            $table->decimal('value', 10, 2); // 10.00
            
            // Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
            $table->boolean('is_active')->default(true);
            $table->timestamp('starts_at')->nullable();
            $table->timestamp('expires_at')->nullable();
            
            // Ð›ÐžÐ“Ð˜ÐšÐ ÐŸÐ Ð˜Ð’Ð¯Ð—ÐšÐ˜
            // 'global' = Ð½Ð° Ð²ÑÑ‘ Ð²ÐµÐ·Ð´Ðµ
            // 'tenant' = Ð½Ð° Ð²ÐµÑÑŒ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½
            // 'category' = Ð½Ð° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ (Ð² ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ)
            // 'line' = Ð½Ð° Ð»Ð¸Ð½ÐµÐ¹ÐºÑƒ (Ð² ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ)
            // 'specific' = Ð½Ð° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹
            $table->string('scope_type')->default('global'); 
            
            // JSON Ð¿Ð¾Ð»Ðµ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ID:
            // ÐŸÑ€Ð¸Ð¼ÐµÑ€: { "street_style": [1, 5, 10], "designer_hub": [2] }
            // Ð˜Ð»Ð¸ Ð´Ð»Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹: { "street_style": ["hoodies_slug"], "military": ["boots_slug"] }
            $table->json('scope_data')->nullable();

            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('promo_codes');
    }
};
</file>

<file path="database/migrations/2024_01_01_000016_create_orders_system.php">
<?php
// FILE: database/migrations/2024_01_01_000016_create_orders_system.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // FIX: Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° ÑƒÐ´Ð°Ð»ÑÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹, ÐµÑÐ»Ð¸ Ð¾Ð½Ð¸ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‚.
        // Ð­Ñ‚Ð¾ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‚Ð¸Ñ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ "relation already exists", Ñ‚Ð°Ðº ÐºÐ°Ðº Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð° Ð¿ÐµÑ€ÐµÐ´ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÐµÐ¼.
        // Ð’Ð°Ð¶ÐµÐ½ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº: ÑÐ½Ð°Ñ‡Ð°Ð»Ð° order_items (Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð°Ñ), Ð¿Ð¾Ñ‚Ð¾Ð¼ orders (Ð³Ð»Ð°Ð²Ð½Ð°Ñ).
        Schema::dropIfExists('order_items');
        Schema::dropIfExists('orders');

        // 1. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð·Ð°ÐºÐ°Ð·Ð¾Ð² (Ð¡Ñ€Ð°Ð·Ñƒ ÑÐ¾ Ð²ÑÐµÐ¼Ð¸ Ð½ÑƒÐ¶Ð½Ñ‹Ð¼Ð¸ Ð¿Ð¾Ð»ÑÐ¼Ð¸)
        Schema::create('orders', function (Blueprint $table) {
            $table->id();
            $table->string('order_number')->unique(); // ORD-20250101-XXXX
            
            // ÐšÐ»Ð¸ÐµÐ½Ñ‚
            $table->string('customer_name');
            $table->string('customer_email');
            $table->string('customer_phone'); // Ð¡Ñ€Ð°Ð·Ñƒ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½
            
            // Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ° Ð¸ ÐžÐ¿Ð»Ð°Ñ‚Ð°
            $table->string('shipping_method')->default('nova_poshta');
            $table->text('shipping_address'); // Ð¡Ñ€Ð°Ð·Ñƒ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð°Ð´Ñ€ÐµÑ
            $table->string('payment_method')->default('cod');
            $table->string('payment_status')->default('pending');
            
            // Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹
            $table->decimal('subtotal', 10, 2); 
            $table->decimal('discount_amount', 10, 2)->default(0); 
            $table->decimal('total_amount', 10, 2); 
            $table->string('promo_code')->nullable(); 
            
            // Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
            $table->string('status')->default('new'); // new, processing, shipped, completed, cancelled
            
            $table->timestamps();
        });

        // 2. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð·Ð°ÐºÐ°Ð·Ð°
        Schema::create('order_items', function (Blueprint $table) {
            $table->id();
            $table->foreignId('order_id')->constrained('orders')->onDelete('cascade');
            
            // Ð¡Ð²ÑÐ·ÑŒ Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð¼ (nullable, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐ»Ð°ÑÑŒ Ð¿Ñ€Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€Ð°)
            $table->foreignId('product_id')->nullable()->constrained('products')->nullOnDelete();
            
            // Ð¡Ð½ÑÐ¿ÑˆÐ¾Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…
            $table->string('product_name'); 
            $table->string('sku');
            $table->string('size')->nullable();
            
            $table->integer('quantity');
            $table->decimal('price', 10, 2); 
            $table->decimal('total', 10, 2); 

            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('order_items');
        Schema::dropIfExists('orders');
    }
};
</file>

<file path="database/migrations/2024_01_01_000020_recreate_orders_tables.php">
<?php
// FILE: database/migrations/2024_01_01_000020_recreate_orders_tables.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // 1. Ð–Ð•Ð¡Ð¢ÐšÐžÐ• Ð£Ð”ÐÐ›Ð•ÐÐ˜Ð• Ð¡Ð¢ÐÐ Ð«Ð¥ Ð¢ÐÐ‘Ð›Ð˜Ð¦
        // ÐœÑ‹ ÑƒÐ´Ð°Ð»ÑÐµÐ¼ Ð¸Ñ…, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ Ð½ÑƒÐ»Ñ Ð¿Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ñ‡ÐµÑ€Ñ‚ÐµÐ¶Ñƒ.
        Schema::dropIfExists('order_items');
        Schema::dropIfExists('orders');

        // 2. Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐžÐ™ Ð¢ÐÐ‘Ð›Ð˜Ð¦Ð« ORDERS
        Schema::create('orders', function (Blueprint $table) {
            $table->id();
            $table->string('order_number')->unique();
            
            // ÐšÐ»Ð¸ÐµÐ½Ñ‚
            $table->string('customer_name');
            $table->string('customer_email');
            $table->string('customer_phone');
            
            // Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ° Ð¸ ÐžÐ¿Ð»Ð°Ñ‚Ð°
            $table->string('shipping_method')->default('nova_poshta');
            $table->text('shipping_address');
            $table->string('payment_method')->default('cod');
            $table->string('payment_status')->default('pending');
            
            // Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹
            $table->decimal('subtotal', 10, 2);
            $table->decimal('discount_amount', 10, 2)->default(0);
            $table->decimal('total_amount', 10, 2);
            $table->string('promo_code')->nullable();
            
            // Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
            $table->string('status')->default('new');
            
            $table->timestamps();
            
            // Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ: ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ 'items' Ð·Ð´ÐµÑÑŒ ÐÐ•Ð¢, Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚.
        });

        // 3. Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐžÐ™ Ð¢ÐÐ‘Ð›Ð˜Ð¦Ð« ORDER_ITEMS
        Schema::create('order_items', function (Blueprint $table) {
            $table->id();
            $table->foreignId('order_id')->constrained('orders')->onDelete('cascade');
            $table->foreignId('product_id')->nullable()->constrained('products')->nullOnDelete();
            
            $table->string('product_name');
            $table->string('sku');
            $table->string('size')->nullable();
            $table->integer('quantity');
            $table->decimal('price', 10, 2);
            $table->decimal('total', 10, 2);

            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('order_items');
        Schema::dropIfExists('orders');
    }
};
</file>

<file path="database/migrations/2024_01_01_000021_update_users_and_orders_for_clients.php">
<?php
// FILE: database/migrations/2024_01_01_000021_update_users_and_orders_for_clients.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // 1. ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ users (Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½)
        if (Schema::hasTable('users')) {
            Schema::table('users', function (Blueprint $table) {
                if (!Schema::hasColumn('users', 'phone')) {
                    $table->string('phone')->unique()->nullable();
                }
                // Ð Ð¾Ð»ÑŒ ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ Ð² ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð¹ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¸Ð»Ð¸ ÑÐ¸Ð´ÐµÑ€Ðµ, Ð½Ð¾ Ð½Ð° Ð²ÑÑÐºÐ¸Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹
                if (!Schema::hasColumn('users', 'role')) {
                    $table->string('role')->default('client'); // client, manager, super_admin
                }
            });
        }

        // 2. ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ orders (ÑÐ²ÑÐ·ÑŒ Ñ ÑŽÐ·ÐµÑ€Ð¾Ð¼)
        if (Schema::hasTable('orders')) {
            Schema::table('orders', function (Blueprint $table) {
                if (!Schema::hasColumn('orders', 'user_id')) {
                    $table->foreignId('user_id')->nullable()->constrained('users')->nullOnDelete();
                }
            });
        }
    }

    public function down(): void
    {
        //
    }
};
</file>

<file path="database/migrations/2024_01_01_000022_link_orphaned_orders.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;
use App\Models\User;
use App\Models\Order;

return new class extends Migration
{
    public function up(): void
    {
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð²ÑÐµ Ð·Ð°ÐºÐ°Ð·Ñ‹, Ñƒ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð½ÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¸ Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ
        $orders = Order::whereNull('user_id')->get();

        foreach ($orders as $order) {
            // ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·ÑƒÐµÐ¼ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ Ð·Ð°ÐºÐ°Ð·Ð° (Ð½Ð° Ð²ÑÑÐºÐ¸Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹)
            $phone = $this->normalizePhone($order->customer_phone);

            if ($phone) {
                // Ð˜Ñ‰ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ñ Ñ‚Ð°ÐºÐ¸Ð¼ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¾Ð¼
                // (Ð˜Ñ‰ÐµÐ¼ Ð¸ Ð¿Ð¾ Ð½Ð¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¼Ñƒ, Ð¸ Ð¿Ð¾ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ð²ÐµÑ€Ð½ÑÐºÐ°)
                $user = User::where('phone', $phone)
                            ->orWhere('phone', $order->customer_phone)
                            ->first();

                if ($user) {
                    // Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°Ð¹Ð´ÐµÐ½ - Ð¿Ñ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ Ð·Ð°ÐºÐ°Ð· Ðº Ð½ÐµÐ¼Ñƒ
                    // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ update Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð² DB, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð±Ð¾Ð¹Ñ‚Ð¸ Ð»ÑŽÐ±Ñ‹Ðµ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ Ð¼Ð¾Ð´ÐµÐ»Ð¸
                    DB::table('orders')
                        ->where('id', $order->id)
                        ->update(['user_id' => $user->id]);
                }
            }
        }
    }

    public function down(): void
    {
        // ÐÐµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ
    }

    // Ð¥ÐµÐ»Ð¿ÐµÑ€ Ð½Ð¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ (Ñ‚Ð¾Ñ‚ Ð¶Ðµ, Ñ‡Ñ‚Ð¾ Ð² ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ðµ)
    private function normalizePhone($phone)
    {
        $clean = preg_replace('/[^0-9+]/', '', $phone);
        if (str_starts_with($clean, '0')) return '+38' . $clean;
        if (str_starts_with($clean, '380')) return '+' . $clean;
        return $clean;
    }
};
</file>

<file path="database/migrations/2024_01_01_000023_add_access_key_to_users.php">
<?php

// FILE: database/migrations/2024_01_01_000023_add_access_key_to_users.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        if (Schema::hasTable('users')) {
            Schema::table('users', function (Blueprint $table) {
                // ÐŸÐ¾Ð»Ðµ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð·Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ ÐºÐ»ÑŽÑ‡Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°
                // text, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð·Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° Ð´Ð»Ð¸Ð½Ð½Ð°Ñ
                $table->text('access_key')->nullable();
            });
        }
    }

    public function down(): void
    {
        //
    }
};
</file>

<file path="database/.gitignore">
*.sqlite*
</file>

<file path="docker/php/Dockerfile">
# FILE: docker/php/Dockerfile
FROM php:8.2-fpm

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    libpng-dev \
    libonig-dev \
    libxml2-dev \
    zip \
    unzip \
    libpq-dev \
    libzip-dev

# Clear cache
RUN apt-get clean && rm -rf /var/lib/apt/lists/*

# Install PHP extensions
# pdo_pgsql - for PostgreSQL
# bcmath - for financial calculations
# redis - for Redis connection
RUN docker-php-ext-install pdo_pgsql mbstring exif pcntl bcmath gd zip

# Install Redis extension via PECL
RUN pecl install redis && docker-php-ext-enable redis

# Get latest Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Set working directory
WORKDIR /var/www

# Create system user to run Composer and Artisan Commands
RUN groupadd -g 1000 www
RUN useradd -u 1000 -ms /bin/bash -g www www

# Change current user to www
USER www

# Expose port 9000 and start php-fpm server
EXPOSE 9000
CMD ["php-fpm"]
</file>

<file path="docker/php/local.ini">
[PHP]
post_max_size = 100M
upload_max_filesize = 100M
variables_order = EGPCS
</file>

<file path="public/.htaccess">
<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Handle X-XSRF-Token Header
    RewriteCond %{HTTP:x-xsrf-token} .
    RewriteRule .* - [E=HTTP_X_XSRF_TOKEN:%{HTTP:X-XSRF-Token}]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>
</file>

<file path="public/index.php">
<?php

use Illuminate\Foundation\Application;
use Illuminate\Http\Request;

define('LARAVEL_START', microtime(true));

// Determine if the application is in maintenance mode...
if (file_exists($maintenance = __DIR__.'/../storage/framework/maintenance.php')) {
    require $maintenance;
}

// Register the Composer autoloader...
require __DIR__.'/../vendor/autoload.php';

// Bootstrap Laravel and handle the request...
/** @var Application $app */
$app = require_once __DIR__.'/../bootstrap/app.php';

$app->handleRequest(Request::capture());
</file>

<file path="public/robots.txt">
User-agent: *
Disallow:
</file>

<file path="resources/css/app.css">
@import 'tailwindcss';

@source '../../vendor/laravel/framework/src/Illuminate/Pagination/resources/views/*.blade.php';
@source '../../storage/framework/views/*.php';
@source '../**/*.blade.php';
@source '../**/*.js';

@theme {
    --font-sans: 'Instrument Sans', ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji',
        'Segoe UI Symbol', 'Noto Color Emoji';
}
</file>

<file path="resources/js/app.js">
import './bootstrap';
</file>

<file path="resources/js/bootstrap.js">
import axios from 'axios';
window.axios = axios;

window.axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
</file>

<file path="resources/views/admin/auth/login.blade.php">
<!-- FILE: resources/views/admin/auth/login.blade.php -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-200 h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded shadow-md w-96">
        <h1 class="text-2xl font-bold mb-6 text-center">System Login</h1>
        
        @if ($errors->any())
            <div class="bg-red-100 text-red-700 p-3 rounded mb-4 text-sm">
                {{ $errors->first() }}
            </div>
        @endif

        <form action="{{ route('admin.login') }}" method="POST">
            @csrf
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                <input type="email" name="email" class="w-full border p-2 rounded" required autofocus>
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                <input type="password" name="password" class="w-full border p-2 rounded" required>
            </div>
            <button class="w-full bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-500">
                Login
            </button>
        </form>
        <p class="text-xs text-gray-500 mt-4 text-center">
            Log in with manager@... or admin@...
        </p>
    </div>
</body>
</html>
</file>

<file path="resources/views/admin/categories/index.blade.php">
<!-- FILE: resources/views/admin/categories/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Categories')

@section('content')
    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Categories</h1>
        
        <div class="flex gap-4 items-center">
            <!-- SEARCH Filter -->
            <form method="GET" action="{{ route('admin.categories.index') }}" class="flex">
                @if(auth()->user()->role === 'super_admin')
                    <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}">
                @endif
                <input type="text" name="search" value="{{ request('search') }}" placeholder="Search..." class="border p-2 rounded-l">
                <button class="bg-gray-200 px-3 rounded-r hover:bg-gray-300">ðŸ”</button>
            </form>
        </div>
    </div>

    <!-- CREATE & CONTEXT TOOLBAR -->
    <div class="bg-white p-4 rounded shadow mb-6 border border-gray-200">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Store Selector (Super Admin Only) -->
            @if(auth()->user()->role === 'super_admin')
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Store Context</label>
                    <form method="GET" action="{{ route('admin.categories.index') }}">
                        <select name="tenant_id" class="w-full border p-2 rounded bg-yellow-50 border-yellow-200" onchange="this.form.submit()">
                            @foreach(config('tenants.tenants') as $id => $data)
                                <option value="{{ $id }}" {{ $currentTenantId === $id ? 'selected' : '' }}>
                                    {{ $data['name'] }}
                                </option>
                            @endforeach
                        </select>
                        <!-- Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð¸ÑÐº Ð¿Ñ€Ð¸ ÑÐ¼ÐµÐ½Ðµ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° -->
                        @if(request('search'))
                            <input type="hidden" name="search" value="{{ request('search') }}">
                        @endif
                    </form>
                </div>
            @endif

            <!-- Create Form -->
            <div>
                 <label class="block text-xs font-bold text-gray-500 mb-1">New Category</label>
                 <form action="{{ route('admin.categories.store') }}" method="POST" class="flex gap-2">
                    @csrf
                    @if(auth()->user()->role === 'super_admin')
                        <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}">
                    @endif
                    <input type="text" name="name" placeholder="Category Name" class="w-full border p-2 rounded" required>
                    <button class="bg-blue-600 text-white px-4 rounded font-bold">Add</button>
                </form>
            </div>
        </div>
    </div>

    <!-- LIST -->
    <div class="bg-white rounded shadow p-6">
        <div class="flex flex-wrap gap-3">
            @forelse($categories as $cat)
                <div class="bg-gray-100 border rounded px-3 py-2 flex items-center gap-3 group hover:bg-gray-200 transition">
                    <!-- Simple Edit Form on Double Click logic could go here, sticking to simple display/delete for now as requested -->
                    <span class="font-bold text-gray-700">{{ $cat->name }}</span>
                    <span class="text-xs bg-white px-2 py-0.5 rounded text-gray-500 border">{{ $cat->products_count }} items</span>
                    
                    <form action="{{ route('admin.categories.destroy', ['category' => $cat->id, 'tenant_id' => $currentTenantId]) }}" method="POST">
                        @csrf
                        @method('DELETE')
                        <button class="text-red-300 group-hover:text-red-600 font-bold ml-2" onclick="return confirm('Delete category?')">&times;</button>
                    </form>
                </div>
            @empty
                <p class="text-gray-500 italic">No categories found.</p>
            @endforelse
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/clothing_lines/index.blade.php">
<!-- FILE: resources/views/admin/clothing_lines/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Clothing Lines')

@section('content')
    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Clothing Lines / Collections</h1>
        
        <div class="flex gap-4 items-center">
            <!-- SEARCH Filter -->
            <form method="GET" action="{{ route('admin.clothing-lines.index') }}" class="flex">
                @if(auth()->user()->role === 'super_admin')
                    <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}">
                @endif
                <input type="text" name="search" value="{{ request('search') }}" placeholder="Search..." class="border p-2 rounded-l">
                <button class="bg-gray-200 px-3 rounded-r hover:bg-gray-300">ðŸ”</button>
            </form>
        </div>
    </div>

    <!-- TOOLBAR -->
    <div class="bg-white p-4 rounded shadow mb-6 border border-gray-200">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Store Selector (Super Admin Only) -->
            @if(auth()->user()->role === 'super_admin')
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Store Context</label>
                    <form method="GET" action="{{ route('admin.clothing-lines.index') }}">
                        <select name="tenant_id" class="w-full border p-2 rounded bg-yellow-50 border-yellow-200" onchange="this.form.submit()">
                            @foreach(config('tenants.tenants') as $id => $data)
                                <option value="{{ $id }}" {{ $currentTenantId === $id ? 'selected' : '' }}>
                                    {{ $data['name'] }}
                                </option>
                            @endforeach
                        </select>
                    </form>
                </div>
            @endif

            <!-- Create Form -->
            <div>
                 <label class="block text-xs font-bold text-gray-500 mb-1">New Collection</label>
                 <form action="{{ route('admin.clothing-lines.store') }}" method="POST" class="flex gap-2">
                    @csrf
                    @if(auth()->user()->role === 'super_admin')
                        <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}">
                    @endif
                    <input type="text" name="name" placeholder="Collection Name (e.g. Summer 2025)" class="w-full border p-2 rounded" required>
                    <button class="bg-purple-600 text-white px-4 rounded font-bold">Add</button>
                </form>
            </div>
        </div>
    </div>

    <!-- LIST -->
    <div class="bg-white rounded shadow p-6">
        <div class="flex flex-wrap gap-3">
            @forelse($lines as $line)
                <div class="bg-purple-50 border border-purple-100 rounded px-3 py-2 flex items-center gap-3 group hover:bg-purple-100 transition">
                    <div>
                        <span class="font-bold text-gray-700 block">{{ $line->name }}</span>
                        <span class="text-xs text-gray-400">{{ $line->slug }}</span>
                    </div>
                    <span class="text-xs bg-white px-2 py-0.5 rounded text-gray-500 border">{{ $line->products_count }} items</span>
                    
                    <!-- ISPREVLENIE: Ð£Ð¿Ñ€Ð¾Ñ‰ÐµÐ½Ð½Ð°Ñ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð° Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð´Ð»Ñ Ð¸Ð·Ð±ÐµÐ¶Ð°Ð½Ð¸Ñ ParseError -->
                    <form action="{{ route('admin.clothing-lines.destroy', [$line->id, 'tenant_id' => $currentTenantId]) }}" method="POST">
                        @csrf
                        @method('DELETE')
                        <button class="text-red-300 group-hover:text-red-600 font-bold ml-2" onclick="return confirm('Delete collection?')">&times;</button>
                    </form>
                </div>
            @empty
                <p class="text-gray-500 italic">No collections found.</p>
            @endforelse
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/inventory/index.blade.php">
<!-- FILE: resources/views/admin/inventory/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Inventory Report')

@section('content')
    <style>
        /* Ð¡Ñ‚Ð¸Ð»Ð¸ Ð¢ÐžÐ›Ð¬ÐšÐž Ð´Ð»Ñ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸ */
        @media print {
            /* 1. Ð¡ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð²ÑÐµ Ð»Ð¸ÑˆÐ½ÐµÐµ */
            aside, nav, header, footer, .no-print, button { 
                display: none !important; 
            }

            /* 2. Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ ÑˆÐ¸Ñ€Ð¸Ð½Ñ‹ Ð¸ Ð¾Ñ‚ÑÑ‚ÑƒÐ¿Ñ‹ */
            body, main, .content, .container {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                min-width: 100% !important;
            }

            /* 3. Ð£Ð‘Ð˜Ð ÐÐ•Ðœ Ð¡ÐšÐ ÐžÐ›Ð›Ð« (Ð¡Ð°Ð¼Ð¾Ðµ Ð²Ð°Ð¶Ð½Ð¾Ðµ Ð´Ð»Ñ Ñ€Ð°Ð·Ð±Ð¸ÐµÐ½Ð¸Ñ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹) */
            .overflow-hidden, .overflow-x-auto, .overflow-y-auto {
                overflow: visible !important;
                height: auto !important;
            }

            /* 4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ */
            table {
                width: 100% !important;
                border-collapse: collapse !important;
                font-size: 11px !important; /* Ð§ÑƒÑ‚ÑŒ Ð¼ÐµÐ½ÑŒÑˆÐµ ÑˆÑ€Ð¸Ñ„Ñ‚ */
                table-layout: fixed !important; /* Ð¤Ð¸ÐºÑÐ¸Ñ€ÑƒÐµÐ¼ ÑˆÐ¸Ñ€Ð¸Ð½Ñƒ ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº */
            }

            th, td {
                border: 1px solid #333 !important;
                padding: 4px !important;
                color: #000 !important;
                word-wrap: break-word; /* ÐŸÐµÑ€ÐµÐ½Ð¾Ñ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ñ… ÑÐ»Ð¾Ð² */
            }

            /* 5. ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€ÑÑ‚ÑŒ ÑˆÐ°Ð¿ÐºÑƒ Ð½Ð° ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ */
            thead {
                display: table-header-group !important;
            }

            /* 6. ÐÐµ Ñ€Ð°Ð·Ñ€Ñ‹Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð¿Ð¾ÑÐµÑ€ÐµÐ´Ð¸Ð½Ðµ */
            tr {
                break-inside: avoid !important;
                page-break-inside: avoid !important;
            }

            /* 7. ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¿ÐµÑ‡Ð°Ñ‚Ð¸ */
            .print-only {
                display: block !important;
                margin-bottom: 20px;
            }

            /* Ð¡ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ ÑÑÑ‹Ð»ÐºÐ¸ href Ð¿Ñ€Ð¸ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸ (Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð±Ñ‹Ð»Ð¾ URL Ð¿Ð¾ÑÐ»Ðµ Ñ‚ÐµÐºÑÑ‚Ð°) */
            a { text-decoration: none !important; color: black !important; }
        }

        /* Ð¡ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð±Ð»Ð¾Ðº Ð´Ð»Ñ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸ Ð² Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ */
        .print-only { display: none; }
    </style>

    <!-- Toolbar (Ð¡ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸) -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-6 no-print">
        <div>
            <h1 class="text-2xl font-bold">Inventory & Stock Report</h1>
            <p class="text-sm text-gray-500">Scope: 
                <span class="uppercase font-bold text-blue-600">
                    {{ $currentTenantId ? config("tenants.tenants.$currentTenantId.name") : 'ALL STORES (Global View)' }}
                </span>
            </p>
        </div>
        
        <div class="flex gap-2" x-data="{ showTelegramModal: false }">
            <!-- PRINT -->
            <button onclick="window.print()" class="bg-gray-700 text-white px-3 py-2 rounded font-bold hover:bg-gray-600 shadow flex items-center gap-2 text-sm">
                ðŸ–¨ï¸ Print PDF
            </button>
            
            <!-- EXPORT -->
            <button onclick="document.getElementById('exportFlag').value='export_csv'; document.getElementById('filterForm').submit(); document.getElementById('exportFlag').value='';" 
                    class="bg-green-600 text-white px-3 py-2 rounded font-bold hover:bg-green-500 shadow flex items-center gap-2 text-sm">
                ðŸ“Š Export Excel
            </button>

            <!-- TELEGRAM BUTTON -->
            <button @click="showTelegramModal = true"
                    class="bg-blue-500 text-white px-3 py-2 rounded font-bold hover:bg-blue-400 shadow flex items-center gap-2 text-sm">
                âœˆï¸ Send to Telegram
            </button>

            <!-- TELEGRAM MODAL -->
            <div x-show="showTelegramModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
                <div class="bg-white p-6 rounded shadow-lg w-96" @click.away="showTelegramModal = false">
                    <h3 class="text-lg font-bold mb-4">Send Report to Telegram</h3>
                    <form action="{{ route('admin.inventory.send_telegram') }}" method="POST">
                        @csrf
                        <input type="hidden" name="tenant_id" value="{{ request('tenant_id') }}">
                        <input type="hidden" name="search" value="{{ request('search') }}">
                        <input type="hidden" name="category_id" value="{{ request('category_id') }}">
                        <input type="hidden" name="stock_status" value="{{ request('stock_status') }}">
                        <input type="hidden" name="clothing_line_id" value="{{ request('clothing_line_id') }}">

                        <div class="mb-4">
                            <label class="block text-sm font-bold mb-2">Select Bot / Chat</label>
                            <select name="telegram_config_id" class="w-full border p-2 rounded" required>
                                <option value="" disabled selected>Choose a bot...</option>
                                @foreach($telegramBots as $bot)
                                    <option value="{{ $bot->id }}">
                                        {{ $bot->name }} ({{ $bot->tenant_id ?? 'Global' }})
                                    </option>
                                @endforeach
                            </select>
                        </div>

                        <div class="flex justify-end gap-2">
                            <button type="button" @click="showTelegramModal = false" class="bg-gray-200 px-4 py-2 rounded text-sm font-bold">Cancel</button>
                            <button class="bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold hover:bg-blue-500">Send Report</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- HEADER FOR PRINT ONLY -->
    <div class="print-only">
        <h1 style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">Inventory Report</h1>
        <p style="margin-bottom: 15px;">
            Scope: <strong>{{ $currentTenantId ?? 'ALL STORES' }}</strong> | 
            Date: <strong>{{ date('Y-m-d H:i') }}</strong>
        </p>
    </div>

    <!-- FILTERS (Hidden on print) -->
    <div class="bg-white p-4 rounded shadow mb-6 border border-gray-200 no-print">
        <form method="GET" action="{{ route('admin.inventory.index') }}" id="filterForm" class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
            <input type="hidden" name="action" id="exportFlag" value="">

            @if(auth()->user()->role === 'super_admin')
                <div class="col-span-1">
                    <label class="block text-xs font-bold text-gray-500 mb-1">Store Scope</label>
                    <select name="tenant_id" class="w-full border p-2 rounded bg-yellow-50 border-yellow-200" onchange="this.form.submit()">
                        <option value="">ALL STORES (Global)</option>
                        @foreach(config('tenants.tenants') as $id => $data)
                            <option value="{{ $id }}" {{ $currentTenantId === $id ? 'selected' : '' }}>{{ $data['name'] }}</option>
                        @endforeach
                    </select>
                </div>
            @else
                <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}">
            @endif

            <div class="col-span-1">
                <label class="block text-xs font-bold text-gray-500 mb-1">Stock Status</label>
                <select name="stock_status" class="w-full border p-2 rounded">
                    <option value="">All Statuses</option>
                    <option value="in_stock" {{ request('stock_status') == 'in_stock' ? 'selected' : '' }}>In Stock (5+)</option>
                    <option value="low_stock" {{ request('stock_status') == 'low_stock' ? 'selected' : '' }}>Low Stock (< 5)</option>
                    <option value="out_of_stock" {{ request('stock_status') == 'out_of_stock' ? 'selected' : '' }}>Out of Stock (0)</option>
                </select>
            </div>

            @if($currentTenantId)
                <div class="col-span-1">
                    <label class="block text-xs font-bold text-gray-500 mb-1">Collection</label>
                    <select name="clothing_line_id" class="w-full border p-2 rounded">
                        <option value="">All Collections</option>
                        @foreach($lines as $line)
                            <option value="{{ $line->id }}" {{ request('clothing_line_id') == $line->id ? 'selected' : '' }}>{{ $line->name }}</option>
                        @endforeach
                    </select>
                </div>
            @else
                <div class="col-span-1 flex items-center text-xs text-gray-400 italic">
                    Select store to filter by Collection.
                </div>
            @endif

            <div class="col-span-2">
                <label class="block text-xs font-bold text-gray-500 mb-1">Search</label>
                <input type="text" name="search" value="{{ request('search') }}" placeholder="Product Name or SKU..." class="w-full border p-2 rounded">
            </div>

            <div class="col-span-1 flex gap-2">
                <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-500 font-bold">Filter</button>
                <a href="{{ route('admin.inventory.index', ['tenant_id' => $currentTenantId]) }}" class="bg-gray-200 text-gray-600 p-2 rounded hover:bg-gray-300">Reset</a>
            </div>
        </form>
    </div>

    <!-- TABLE CONTAINER -->
    <!-- Ð’Ð°Ð¶Ð½Ð¾: ÑƒÐ±Ð¸Ñ€Ð°ÐµÐ¼ overflow-hidden Ð¿Ñ€Ð¸ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· CSS Ð²Ñ‹ÑˆÐµ -->
    <div class="bg-white rounded shadow overflow-hidden print:shadow-none print:border-none">
        <table class="w-full text-left border-collapse">
            <thead class="bg-gray-50 border-b print:bg-gray-200">
                <tr>
                    <th class="p-3 text-xs font-bold text-gray-500 uppercase">Product</th>
                    @if(!$currentTenantId)<th class="p-3 text-xs font-bold text-gray-500 uppercase">Store</th>@endif
                    <th class="p-3 text-xs font-bold text-gray-500 uppercase">Price</th>
                    <th class="p-3 text-xs font-bold text-gray-500 uppercase">Stock Breakdown</th>
                    <th class="p-3 text-xs font-bold text-gray-500 uppercase text-center">Total</th>
                    <th class="p-3 text-xs font-bold text-gray-500 uppercase text-right">Value</th>
                </tr>
            </thead>
            <tbody class="text-sm">
                @php $grandTotalValue = 0; $grandTotalItems = 0; @endphp
                @forelse($products as $product)
                    @php 
                        $currentPrice = $product->sale_price ?? $product->price;
                        $totalValue = $product->stock_quantity * $currentPrice;
                        $grandTotalValue += $totalValue;
                        $grandTotalItems += $product->stock_quantity;
                    @endphp
                    <tr class="border-b hover:bg-gray-50 print:border-gray-400">
                        <td class="p-3 align-top">
                            <div class="font-bold text-gray-800">{{ $product->name }}</div>
                            <div class="text-xs text-gray-500 font-mono">{{ $product->sku }}</div>
                        </td>
                        @if(!$currentTenantId)
                            <td class="p-3 text-xs font-bold text-blue-600 align-top">{{ $product->tenant_name ?? '-' }}</td>
                        @endif
                        <td class="p-3 align-top">
                            @if($product->sale_price)
                                <span class="text-red-600 font-bold">${{ $product->sale_price }}</span>
                            @else
                                ${{ $product->price }}
                            @endif
                        </td>
                        <td class="p-3 align-top">
                            @if($product->variants->isNotEmpty())
                                <div class="flex flex-wrap gap-1">
                                    @foreach($product->variants as $v)
                                        <span class="text-[10px] px-1 rounded border whitespace-nowrap {{ $v->stock <= 0 ? 'bg-red-50 border-red-200 text-red-600' : 'bg-gray-50 border-gray-200' }}">
                                            <b>{{ $v->size }}:</b> {{ $v->stock }}
                                        </span>
                                    @endforeach
                                </div>
                            @else
                                <span class="text-gray-400 italic text-xs">One Size</span>
                            @endif
                        </td>
                        <td class="p-3 text-center align-top">
                            @if($product->stock_quantity <= 0)
                                <span class="bg-red-100 text-red-800 px-2 py-0.5 rounded font-bold text-xs">0</span>
                            @elseif($product->stock_quantity < 5)
                                <span class="bg-orange-100 text-orange-800 px-2 py-0.5 rounded font-bold text-xs">{{ $product->stock_quantity }}</span>
                            @else
                                <span class="bg-green-100 text-green-800 px-2 py-0.5 rounded font-bold text-xs">{{ $product->stock_quantity }}</span>
                            @endif
                        </td>
                        <td class="p-3 text-right font-mono align-top">
                            ${{ number_format($totalValue, 2) }}
                        </td>
                    </tr>
                @empty
                    <tr>
                        <td colspan="7" class="p-8 text-center text-gray-400 italic">No inventory data found.</td>
                    </tr>
                @endforelse
            </tbody>
            <tfoot class="bg-gray-100 border-t-2 border-gray-300 print:bg-white print:border-t print:border-black">
                <tr>
                    <td colspan="{{ !$currentTenantId ? 4 : 3 }}" class="p-3 text-right font-bold uppercase">Page Totals:</td>
                    <td class="p-3 text-center font-bold">{{ $grandTotalItems }}</td>
                    <td class="p-3 text-right font-bold">${{ number_format($grandTotalValue, 2) }}</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <!-- Pagination (Hidden on print) -->
    <div class="mt-4 no-print">
        {{ $products->appends(request()->query())->links() }}
    </div>
@endsection
</file>

<file path="resources/views/admin/managers/form.blade.php">
<!-- FILE: resources/views/admin/managers/form.blade.php -->
@extends('layouts.admin')

@php
    $isEdit = isset($manager);
    $title = $isEdit ? 'Edit Manager: ' . $manager->name : 'New Manager';
    $action = $isEdit ? route('admin.managers.update', $manager->id) : route('admin.managers.store');
@endphp

@section('title', $title)

@section('content')
    <div class="max-w-2xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">{{ $title }}</h1>
            <a href="{{ route('admin.managers.index') }}" class="text-gray-500 hover:underline">Back to List</a>
        </div>

        <div class="bg-white p-6 rounded shadow border-t-4 {{ $isEdit ? 'border-blue-600' : 'border-green-600' }}">
            <form action="{{ $action }}" method="POST" class="space-y-6">
                @csrf
                @if($isEdit)
                    @method('PUT')
                @endif
                
                <!-- Name -->
                <div>
                    <label class="block text-sm font-bold mb-1 text-gray-700">Full Name</label>
                    <input type="text" name="name" value="{{ old('name', $manager->name ?? '') }}" class="w-full border p-2 rounded focus:border-blue-500 outline-none transition" required placeholder="John Doe">
                    @error('name') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                </div>

                <!-- Contact Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold mb-1 text-gray-700">Email</label>
                        <input type="email" name="email" value="{{ old('email', $manager->email ?? '') }}" class="w-full border p-2 rounded focus:border-blue-500 outline-none transition" required placeholder="manager@example.com">
                        @error('email') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1 text-gray-700">Phone</label>
                        <input type="text" name="phone" value="{{ old('phone', $manager->phone ?? '') }}" class="w-full border p-2 rounded focus:border-blue-500 outline-none transition" required placeholder="+380...">
                        @error('phone') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                    </div>
                </div>

                <!-- Password -->
                <div class="bg-gray-50 p-4 rounded border border-gray-200">
                    <label class="block text-sm font-bold mb-1 text-gray-700">
                        {{ $isEdit ? 'New Password (Optional)' : 'Password' }}
                    </label>
                    <input type="password" name="password" class="w-full border p-2 rounded focus:border-blue-500 outline-none transition" {{ $isEdit ? '' : 'required' }} placeholder="{{ $isEdit ? 'Leave empty to keep current' : '********' }}">
                    @if($isEdit)
                        <p class="text-xs text-gray-400 mt-1">Only fill this if you want to change the manager's password.</p>
                    @endif
                    @error('password') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                </div>

                <!-- Store Assignment -->
                <div class="bg-yellow-50 p-4 rounded border border-yellow-200">
                    <label class="block text-sm font-bold mb-1 text-yellow-800">Assign to Store</label>
                    <select name="tenant_id" class="w-full border p-2 rounded bg-white focus:border-yellow-500 outline-none" required>
                        <option value="">-- Select Store --</option>
                        @foreach($tenants as $id => $data)
                            <option value="{{ $id }}" {{ (old('tenant_id', $manager->tenant_id ?? '') == $id) ? 'selected' : '' }}>
                                {{ $data['name'] }} ({{ $id }})
                            </option>
                        @endforeach
                    </select>
                    <p class="text-xs text-gray-500 mt-1">
                        <span class="font-bold text-yellow-700">Warning:</span> This manager will ONLY see orders and products of the selected store.
                    </p>
                    @error('tenant_id') <span class="text-red-500 text-xs">{{ $message }}</span> @enderror
                </div>

                <!-- Submit Button -->
                <div class="pt-4 flex items-center justify-end border-t mt-6">
                    <button class="{{ $isEdit ? 'bg-blue-600 hover:bg-blue-700' : 'bg-green-600 hover:bg-green-700' }} text-white px-8 py-3 rounded font-bold transition shadow-lg flex items-center gap-2">
                        @if($isEdit)
                            <span>ðŸ’¾ Update Manager</span>
                        @else
                            <span>âž• Create Manager</span>
                        @endif
                    </button>
                </div>
            </form>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/managers/index.blade.php">
<!-- FILE: resources/views/admin/managers/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Managers')

@section('content')
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Store Managers</h1>
        <a href="{{ route('admin.managers.create') }}" class="bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-500 shadow">
            + Add Manager
        </a>
    </div>

    <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="p-4 text-sm font-bold text-gray-600">Name</th>
                    <th class="p-4 text-sm font-bold text-gray-600">Contact</th>
                    <th class="p-4 text-sm font-bold text-gray-600">Assigned Store</th>
                    <th class="p-4 text-sm font-bold text-gray-600 text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                @forelse($managers as $manager)
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-4 font-bold">{{ $manager->name }}</td>
                        <td class="p-4">
                            <div class="text-sm">{{ $manager->email }}</div>
                            <div class="text-xs text-gray-500">{{ $manager->phone }}</div>
                        </td>
                        <td class="p-4">
                            @php
                                $tenantName = config("tenants.tenants.{$manager->tenant_id}.name", 'Unknown Store');
                            @endphp
                            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-bold uppercase border border-yellow-200">
                                {{ $tenantName }}
                            </span>
                            <div class="text-[10px] text-gray-400 mt-1">{{ $manager->tenant_id }}</div>
                        </td>
                        <td class="p-4 text-right flex justify-end gap-2">
                            <a href="{{ route('admin.managers.edit', $manager->id) }}" class="text-blue-600 hover:text-blue-800 font-bold text-sm">Edit</a>
                            
                            <form action="{{ route('admin.managers.destroy', $manager->id) }}" method="POST" onsubmit="return confirm('Delete this manager?');">
                                @csrf
                                @method('DELETE')
                                <button class="text-red-500 hover:text-red-700 font-bold text-sm ml-2">Delete</button>
                            </form>
                        </td>
                    </tr>
                @empty
                    <tr>
                        <td colspan="4" class="p-8 text-center text-gray-400 italic">No managers found.</td>
                    </tr>
                @endforelse
            </tbody>
        </table>
    </div>
@endsection
</file>

<file path="resources/views/admin/products/select_tenant.blade.php">
<!-- FILE: resources/views/admin/products/select_tenant.blade.php -->
@extends('layouts.admin')
@section('title', 'Select Store')

@section('content')
    <div class="flex flex-col items-center justify-center h-96">
        <div class="bg-white p-8 rounded shadow-md text-center max-w-md">
            <div class="text-6xl mb-4">ðŸª</div>
            <h1 class="text-2xl font-bold mb-2">Select a Store</h1>
            <p class="text-gray-500 mb-6">To manage products, please switch to a specific store context.</p>
            
            <div class="space-y-2">
                @foreach(config('tenants.tenants') as $id => $data)
                    <form action="{{ route('admin.switch_tenant') }}" method="POST">
                        @csrf
                        <input type="hidden" name="tenant_id" value="{{ $id }}">
                        <button class="w-full bg-gray-100 hover:bg-blue-50 text-gray-800 font-semibold py-2 px-4 border border-gray-300 rounded shadow-sm">
                            Manage {{ $data['name'] }}
                        </button>
                    </form>
                @endforeach
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/promocodes/create.blade.php">
<!-- FILE: resources/views/admin/promocodes/create.blade.php -->
@extends('layouts.admin')
@section('title', 'Create Promo Code')

@section('content')
    <div class="mb-6">
        <a href="{{ route('admin.promocodes.index') }}" class="text-gray-500 hover:text-blue-600 font-bold">&larr; Back to List</a>
        <h1 class="text-2xl font-bold mt-2">Create New Promo Code</h1>
    </div>

    <form action="{{ route('admin.promocodes.store') }}" method="POST" class="max-w-5xl" 
          x-data="{ 
              scope: 'global',
              catalog: {{ json_encode($catalogData) }}
          }">
        @csrf

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- LEFT COLUMN: Basic Info -->
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white p-6 rounded shadow border-t-4 border-blue-600">
                    <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">Basic Information</h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-bold mb-1">Code</label>
                        <input type="text" name="code" placeholder="e.g. SUMMER2025" class="w-full border p-2 rounded uppercase font-mono text-lg" required>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-bold mb-1">Type</label>
                            <select name="type" class="w-full border p-2 rounded bg-gray-50">
                                <option value="percent">Percentage (%)</option>
                                <option value="fixed">Fixed Amount ($)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold mb-1">Value</label>
                            <input type="number" name="value" placeholder="10" min="0" step="0.01" class="w-full border p-2 rounded" required>
                        </div>
                    </div>

                    <div class="flex items-center gap-2 mb-4">
                        <input type="checkbox" name="is_active" id="active" value="1" checked class="h-4 w-4">
                        <label for="active" class="text-sm font-bold">Is Active</label>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-bold mb-1">Expires At (Optional)</label>
                        <input type="date" name="expires_at" class="w-full border p-2 rounded">
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: Scope & Selection -->
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white p-6 rounded shadow border-t-4 border-purple-600">
                    <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">Applicability Scope</h3>

                    <!-- Scope Selector -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-6">
                        <label class="cursor-pointer">
                            <input type="radio" name="scope_type" value="global" x-model="scope" class="peer sr-only">
                            <div class="p-3 border rounded text-center peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 hover:bg-gray-50 transition">
                                <div class="font-bold text-sm">Global</div>
                                <div class="text-[10px]">All Stores</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="scope_type" value="line" x-model="scope" class="peer sr-only">
                            <div class="p-3 border rounded text-center peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 hover:bg-gray-50 transition">
                                <div class="font-bold text-sm">Collection</div>
                                <div class="text-[10px]">Specific Line</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="scope_type" value="category" x-model="scope" class="peer sr-only">
                            <div class="p-3 border rounded text-center peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 hover:bg-gray-50 transition">
                                <div class="font-bold text-sm">Category</div>
                                <div class="text-[10px]">Specific Cat.</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="scope_type" value="specific" x-model="scope" class="peer sr-only">
                            <div class="p-3 border rounded text-center peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 hover:bg-gray-50 transition">
                                <div class="font-bold text-sm">Manual</div>
                                <div class="text-[10px]">Pick Products</div>
                            </div>
                        </label>
                    </div>

                    <!-- DYNAMIC CONTENT BASED ON SCOPE -->
                    <div class="bg-gray-50 p-4 rounded border border-gray-200">
                        
                        <!-- GLOBAL -->
                        <div x-show="scope === 'global'">
                            <p class="text-green-600 font-bold flex items-center gap-2">
                                âœ… This code will apply to ALL products in ALL stores.
                            </p>
                        </div>

                        <!-- SPECIFIC PRODUCTS -->
                        <div x-show="scope === 'specific'">
                            <p class="text-sm text-gray-500 mb-4">Select products from each store:</p>
                            <template x-for="(data, tenantId) in catalog" :key="tenantId">
                                <div class="mb-4 bg-white p-3 rounded border">
                                    <h4 class="font-bold text-gray-800 border-b pb-1 mb-2" x-text="data.name"></h4>
                                    <div class="h-40 overflow-y-auto space-y-1">
                                        <template x-for="prod in data.products" :key="prod.id">
                                            <label class="flex items-center gap-2 hover:bg-gray-50 p-1 rounded cursor-pointer">
                                                <input type="checkbox" :name="`scope_data[${tenantId}][]`" :value="prod.id" class="rounded text-blue-600">
                                                <span class="text-sm">
                                                    <span class="font-bold" x-text="prod.sku"></span> - <span x-text="prod.name"></span>
                                                </span>
                                            </label>
                                        </template>
                                        <div x-show="data.products.length === 0" class="text-xs text-gray-400 italic">No products found.</div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- CATEGORIES -->
                        <div x-show="scope === 'category'">
                            <p class="text-sm text-gray-500 mb-4">Select categories for each store:</p>
                            <template x-for="(data, tenantId) in catalog" :key="tenantId">
                                <div class="mb-4 bg-white p-3 rounded border">
                                    <h4 class="font-bold text-gray-800 border-b pb-1 mb-2" x-text="data.name"></h4>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="cat in data.categories" :key="cat.id">
                                            <label class="flex items-center gap-1 bg-gray-100 px-2 py-1 rounded border hover:bg-white cursor-pointer select-none">
                                                <input type="checkbox" :name="`scope_data[${tenantId}][]`" :value="cat.slug" class="rounded text-purple-600">
                                                <span class="text-xs font-bold" x-text="cat.name"></span>
                                            </label>
                                        </template>
                                        <div x-show="data.categories.length === 0" class="text-xs text-gray-400 italic">No categories.</div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- CLOTHING LINES -->
                        <div x-show="scope === 'line'">
                            <p class="text-sm text-gray-500 mb-4">Select collections for each store:</p>
                            <template x-for="(data, tenantId) in catalog" :key="tenantId">
                                <div class="mb-4 bg-white p-3 rounded border">
                                    <h4 class="font-bold text-gray-800 border-b pb-1 mb-2" x-text="data.name"></h4>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="line in data.lines" :key="line.id">
                                            <label class="flex items-center gap-1 bg-gray-100 px-2 py-1 rounded border hover:bg-white cursor-pointer select-none">
                                                <input type="checkbox" :name="`scope_data[${tenantId}][]`" :value="line.slug" class="rounded text-indigo-600">
                                                <span class="text-xs font-bold" x-text="line.name"></span>
                                            </label>
                                        </template>
                                        <div x-show="data.lines.length === 0" class="text-xs text-gray-400 italic">No collections.</div>
                                    </div>
                                </div>
                            </template>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 border-t pt-4 flex justify-end">
            <button class="bg-green-600 text-white font-bold py-3 px-8 rounded shadow hover:bg-green-500 text-lg">
                Create Promo Code
            </button>
        </div>
    </form>
@endsection
</file>

<file path="resources/views/admin/promocodes/index.blade.php">
<!-- FILE: resources/views/admin/promocodes/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Promo Codes')

@section('content')
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Promo Codes Management</h1>
        <a href="{{ route('admin.promocodes.create') }}" class="bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-500 shadow">
            + Create New Code
        </a>
    </div>

    <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="p-4 text-sm font-bold text-gray-600">Code</th>
                    <th class="p-4 text-sm font-bold text-gray-600">Discount</th>
                    <th class="p-4 text-sm font-bold text-gray-600">Scope</th>
                    <th class="p-4 text-sm font-bold text-gray-600">Validity</th>
                    <th class="p-4 text-sm font-bold text-gray-600">Status</th>
                    <th class="p-4 text-sm font-bold text-gray-600 text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                @forelse($promocodes as $code)
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-4">
                            <span class="font-mono font-bold text-lg text-blue-600 bg-blue-50 px-2 py-1 rounded border border-blue-100">
                                {{ $code->code }}
                            </span>
                        </td>
                        <td class="p-4 font-bold">
                            {{ $code->type === 'percent' ? '-' . $code->value . '%' : '-$' . $code->value }}
                        </td>
                        <td class="p-4">
                            @if($code->scope_type === 'global')
                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded font-bold">Global (All Stores)</span>
                            @elseif($code->scope_type === 'specific')
                                <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded font-bold">Specific Products</span>
                            @elseif($code->scope_type === 'category')
                                <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded font-bold">Category</span>
                            @elseif($code->scope_type === 'line')
                                <span class="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded font-bold">Collection</span>
                            @endif
                        </td>
                        <td class="p-4 text-sm text-gray-500">
                            @if($code->expires_at)
                                Allows until {{ $code->expires_at->format('M d, Y') }}
                            @else
                                <span class="text-green-600">Forever</span>
                            @endif
                        </td>
                        <td class="p-4">
                            @if($code->isValid())
                                <span class="text-green-600 font-bold flex items-center gap-1">â— Active</span>
                            @else
                                <span class="text-red-500 font-bold flex items-center gap-1">â—‹ Inactive</span>
                            @endif
                        </td>
                        <td class="p-4 text-right">
                            <form action="{{ route('admin.promocodes.destroy', $code->id) }}" method="POST" onsubmit="return confirm('Delete this promo code?');">
                                @csrf
                                @method('DELETE')
                                <button class="text-red-500 hover:bg-red-50 p-2 rounded font-bold transition">&times; Delete</button>
                            </form>
                        </td>
                    </tr>
                @empty
                    <tr>
                        <td colspan="6" class="p-8 text-center text-gray-400 italic">No promo codes created yet.</td>
                    </tr>
                @endforelse
            </tbody>
        </table>
    </div>
@endsection
</file>

<file path="resources/views/admin/reports/index.blade.php">
<!-- FILE: resources/views/admin/reports/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Financial Reports')

@section('content')
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Financial Performance</h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-gradient-to-r from-green-500 to-green-600 p-6 rounded shadow text-white">
            <div class="text-xs uppercase font-bold opacity-75">Total Revenue</div>
            <div class="text-4xl font-bold mt-2">${{ number_format($grandTotal, 2) }}</div>
        </div>
    </div>

    <div class="bg-white rounded shadow overflow-hidden">
        <table class="min-w-full">
            <thead class="bg-gray-800 text-white">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Store</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Orders</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Avg. Check</th>
                    <th class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider">Revenue</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @foreach($reportData as $row)
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap font-bold text-gray-700">
                            {{ $row['tenant'] }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {{ $row['orders_count'] }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${{ number_format($row['average_check'], 2) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right font-bold text-green-600">
                            ${{ number_format($row['total_revenue'], 2) }}
                        </td>
                    </tr>
                @endforeach
            </tbody>
        </table>
    </div>
@endsection
</file>

<file path="resources/views/admin/users/show.blade.php">
<!-- FILE: resources/views/admin/users/show.blade.php -->
@extends('layouts.admin')
@section('title', 'Customer Profile')

@section('content')
    <div class="mb-6 flex justify-between items-center">
        <a href="{{ route('admin.users.index', ['tenant_id' => request('tenant_id')]) }}" class="text-blue-600 hover:underline font-bold">&larr; Back to List</a>
        <h1 class="text-2xl font-bold">Customer Profile #{{ $user->id }}</h1>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <!-- LEFT: INFO & ACTIONS -->
        <div class="col-span-1 space-y-6">
            <!-- Info Card -->
            <div class="bg-white p-6 rounded shadow border-t-4 border-blue-600">
                <h2 class="font-bold text-lg mb-4 text-gray-700 uppercase tracking-wide">Personal Data</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-gray-500 uppercase">Full Name</label>
                        <div class="font-bold text-lg">{{ $user->name }}</div>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 uppercase">Phone (Login)</label>
                        <div class="font-mono font-bold text-lg bg-gray-100 p-2 rounded">{{ $user->phone }}</div>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 uppercase">Email</label>
                        <div class="text-gray-800">{{ $user->email }}</div>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 uppercase">Registration Date</label>
                        <div class="text-sm">{{ $user->created_at->format('d F Y, H:i') }}</div>
                    </div>
                </div>
            </div>

            <!-- Security Card -->
            <div class="bg-white p-6 rounded shadow border-t-4 border-red-500">
                <h2 class="font-bold text-lg mb-4 text-gray-700 uppercase tracking-wide">Security & Access</h2>
                
                @if(session('success') && str_contains(session('success'), 'New Key'))
                    <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4">
                        <p class="font-bold">Password Reset Successful!</p>
                        <p class="text-sm mb-1">Please give this key to the customer:</p>
                        <div class="text-2xl font-mono font-black bg-white p-2 mt-1 select-all border border-green-300">
                            {{ explode(': ', session('success'))[1] }}
                        </div>
                    </div>
                @endif

                <p class="text-sm text-gray-600 mb-4">
                    If the customer forgot their password, you can generate a new Access Key for them.
                </p>

                <form action="{{ route('admin.users.update', ['user' => $user->id, 'tenant_id' => request('tenant_id')]) }}" method="POST" onsubmit="return confirm('Are you sure? This will overwrite the user\'s current password.');">
                    @csrf
                    @method('PUT')
                    <input type="hidden" name="generate_password" value="1">
                    <button class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded transition flex items-center justify-center gap-2">
                        <span>ðŸ”’ Reset Password / Generate Key</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- RIGHT: ORDERS HISTORY -->
        <div class="col-span-2">
            <div class="bg-white rounded shadow overflow-hidden">
                <div class="px-6 py-4 border-b bg-gray-50 flex justify-between items-center">
                    <h2 class="font-bold text-lg text-gray-700 uppercase tracking-wide">Order History</h2>
                    <span class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs font-bold">{{ $user->orders->count() }} Orders</span>
                </div>

                <table class="w-full text-left">
                    <thead class="bg-gray-50 text-xs text-gray-500 uppercase border-b">
                        <tr>
                            <th class="px-6 py-3">Order #</th>
                            <th class="px-6 py-3">Date</th>
                            <th class="px-6 py-3">Status</th>
                            <th class="px-6 py-3">Total</th>
                            <th class="px-6 py-3 text-right">Action</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        @forelse($user->orders as $order)
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 font-mono font-bold text-blue-600">
                                    {{ $order->order_number }}
                                </td>
                                <td class="px-6 py-4 text-sm">
                                    {{ $order->created_at->format('d M Y') }}
                                </td>
                                <td class="px-6 py-4">
                                    @php
                                        $colors = [
                                            'new' => 'bg-blue-100 text-blue-800',
                                            'processing' => 'bg-yellow-100 text-yellow-800',
                                            'shipped' => 'bg-purple-100 text-purple-800',
                                            'completed' => 'bg-green-100 text-green-800',
                                            'cancelled' => 'bg-red-100 text-red-800',
                                        ];
                                    @endphp
                                    <span class="px-2 py-1 rounded text-xs font-bold uppercase {{ $colors[$order->status] ?? 'bg-gray-100' }}">
                                        {{ $order->status }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 font-bold">
                                    ${{ $order->total_amount }}
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <a href="{{ route('admin.orders.show', ['order' => $order->id, 'tenant_id' => request('tenant_id')]) }}" class="text-gray-500 hover:text-black font-bold text-sm">
                                        View
                                    </a>
                                </td>
                            </tr>
                        @empty
                            <tr>
                                <td colspan="5" class="px-6 py-12 text-center text-gray-400 italic">
                                    No orders found for this customer.
                                </td>
                            </tr>
                        @endforelse
                    </tbody>
                </table>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/client/auth/login.blade.php">
<!-- FILE: resources/views/client/auth/login.blade.php -->
@extends('layouts.app')
@section('title', 'Login')

@section('content')
<div class="min-h-[60vh] flex items-center justify-center p-4">
    <div class="w-full max-w-md theme-card p-8 shadow-2xl relative">
        
        <h1 class="text-3xl font-black uppercase mb-2 text-center theme-skew theme-text">
            Member Login
        </h1>
        <p class="text-center theme-muted mb-8 text-xs uppercase tracking-widest">Secure Access</p>

        <form action="{{ url('/login') }}" method="POST" class="space-y-6">
            @csrf
            
            <div>
                <label class="block text-xs font-bold uppercase theme-muted mb-2">Phone Number</label>
                <div class="relative">
                    <input type="text" name="phone" placeholder="+380..." class="theme-input w-full p-4 font-bold tracking-wider">
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold uppercase theme-muted mb-2">Password</label>
                <div class="relative">
                    <input type="password" name="password" placeholder="********" class="theme-input w-full p-4 font-bold tracking-wider">
                </div>
            </div>

            <button class="theme-btn w-full py-4 text-lg shadow-lg mt-4">
                AUTHENTICATE
            </button>
        </form>

        <div class="mt-8 pt-6 border-t theme-border text-center text-xs theme-muted">
            <p>Don't have an account?</p>
            <p class="mt-1">Simply <a href="{{ route('home') }}" class="theme-link font-bold">place your first order</a>.</p>
        </div>
    </div>
</div>
@endsection
</file>

<file path="resources/views/client/profile/index.blade.php">
<!-- FILE: resources/views/client/profile/index.blade.php -->
@extends('layouts.app')
@section('title', 'Profile')

@section('content')
<div class="max-w-6xl mx-auto py-8">
    
    <!-- Welcome Banner / New Account Alert -->
    @if(session('generated_password'))
        <div class="theme-card p-6 mb-8 border-2" style="border-color: var(--color-primary);">
            <h2 class="text-2xl font-bold uppercase mb-2 theme-text">âš  New Account Details</h2>
            <div class="flex flex-col md:flex-row gap-8 items-start">
                <div class="flex-1">
                    <p class="theme-muted text-sm mb-4">A secure account has been created for your order history.</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-3 bg-gray-900 bg-opacity-10 theme-border border">
                            <span class="block text-[10px] theme-muted uppercase">Login</span>
                            <span class="font-mono font-bold theme-text">{{ $user->phone }}</span>
                        </div>
                        <div class="p-3 bg-gray-900 bg-opacity-10 theme-border border">
                            <span class="block text-[10px] theme-muted uppercase">Password</span>
                            <span class="font-mono font-bold text-xl" style="color: var(--color-primary)">{{ session('generated_password') }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    @endif

    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <!-- Sidebar -->
        <div class="col-span-1 theme-card p-6 h-fit">
            <h2 class="text-lg font-bold uppercase mb-4 theme-muted border-b theme-border pb-2">My Profile</h2>
            <div class="mb-6">
                <p class="font-bold text-lg theme-text">{{ $user->name }}</p>
                <p class="text-sm theme-muted">{{ $user->phone }}</p>
            </div>
            
            <form action="{{ route('client.logout') }}" method="POST" class="mb-6">
                @csrf
                <button class="w-full text-left text-red-500 font-bold hover:opacity-75 uppercase text-xs tracking-widest border border-red-500/30 p-2 rounded">
                    Disconnect
                </button>
            </form>

            <h3 class="text-xs font-bold uppercase mb-3 theme-muted">Update Credentials</h3>
            <form action="{{ route('client.password.update') }}" method="POST" class="space-y-3">
                @csrf
                <input type="password" name="current_password" placeholder="Current Password" class="theme-input w-full p-2 text-xs">
                <input type="password" name="new_password" placeholder="New Password" class="theme-input w-full p-2 text-xs">
                <input type="password" name="new_password_confirmation" placeholder="Confirm" class="theme-input w-full p-2 text-xs">
                <button class="theme-btn w-full py-2 text-xs">Save Changes</button>
            </form>
        </div>

        <!-- Main Content -->
        <div class="col-span-3">
            <h1 class="text-3xl font-black uppercase mb-6 theme-skew theme-text">Order History</h1>
            
            @forelse($orders as $order)
                <div class="theme-card mb-4 p-6 hover:shadow-md transition group relative overflow-hidden">
                    <!-- Status Badge -->
                    <div class="absolute top-4 right-4">
                        <span class="px-3 py-1 text-[10px] uppercase font-bold theme-bg theme-border border shadow-sm theme-text">
                            {{ $order->status }}
                        </span>
                    </div>

                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <div class="flex-1">
                            <div class="text-2xl font-bold font-mono theme-text">#{{ $order->order_number }}</div>
                            <div class="text-xs theme-muted uppercase mt-1">{{ $order->created_at->format('d F Y') }}</div>
                        </div>
                        
                        <div class="text-center px-8 border-l border-r theme-border border-opacity-30">
                            <div class="text-xs theme-muted uppercase">Total</div>
                            <div class="text-xl font-bold font-mono" style="color: var(--color-primary)">${{ $order->total_amount }}</div>
                        </div>

                        <div class="flex-1 text-right">
                             <a href="{{ route('client.orders.show', $order->id) }}" class="theme-btn px-6 py-2 text-xs inline-flex items-center gap-2">
                                <span>Receipt</span> &rarr;
                            </a>
                        </div>
                    </div>
                </div>
            @empty
                <div class="theme-card p-12 text-center border-dashed">
                    <p class="theme-muted italic mb-4">No records found.</p>
                    <a href="{{ route('home') }}" class="theme-link font-bold text-sm uppercase">Go to Catalog</a>
                </div>
            @endforelse
        </div>
    </div>
</div>
@endsection
</file>

<file path="resources/views/client/profile/order.blade.php">
<!-- FILE: resources/views/client/profile/order.blade.php -->
@extends('layouts.app')
@section('title', 'Receipt #' . $order->order_number)

@section('content')
<div class="max-w-3xl mx-auto py-8">

    <!-- ÐŸÐÐÐ•Ð›Ð¬ Ð”Ð•Ð™Ð¡Ð¢Ð’Ð˜Ð™ -->
    <div class="flex justify-between items-center mb-6 no-print">
        <a href="{{ route('client.profile') }}" class="theme-link text-xs font-bold uppercase flex items-center gap-2">
            <span>&larr; Back to History</span>
        </a>
         <button onclick="window.print()" class="theme-btn px-6 py-2 flex items-center gap-2 text-sm font-bold shadow-md cursor-pointer transition hover:opacity-90">
            <span>ðŸ–¨ï¸ Print Receipt</span>
        </button>
    </div>

    <!-- Ð¡ÐÐœ Ð§Ð•Ðš -->
    <div class="theme-card p-8 shadow-2xl relative bg-white theme-text print:shadow-none print:border print:border-gray-300 print:p-0" id="receipt">
        
        <!-- Ð¨Ð°Ð¿ÐºÐ° -->
        <div class="text-center border-b theme-border pb-6 mb-8">
             <h1 class="text-4xl font-black uppercase tracking-tighter theme-skew leading-none mb-2">
                @php
                    $tenantId = app(\App\Services\TenantService::class)->getCurrentTenantId();
                    $tenantName = config("tenants.tenants.{$tenantId}.name", 'TriShop');
                @endphp
                {{ $tenantName }}
            </h1>
            <div class="flex justify-center items-center gap-4 text-[10px] theme-muted uppercase tracking-widest">
                <span>Official Receipt</span>
                <span>&bull;</span>
                <span>{{ $order->created_at->format('d M Y / H:i') }}</span>
            </div>
        </div>

        <!-- Ð‘Ð›ÐžÐš Ð”ÐžÐ¡Ð¢Ð£ÐŸÐ (ÐšÐ Ð•Ð”Ð•ÐÐ¨Ð•Ð›Ð«) - Ð’Ð¡Ð•Ð“Ð”Ð ÐÐšÐ¢Ð£ÐÐ›Ð•Ð -->
        <div class="border-2 border-dashed theme-border p-5 mb-8 bg-gray-50 bg-opacity-5 print:bg-transparent relative group">
            <div class="absolute top-0 left-0 bg-gray-100 theme-text text-[9px] font-bold uppercase px-2 py-1 transform -translate-y-1/2 ml-4 theme-border border">
                Customer Access Credentials
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 items-center">
                <!-- Ð›Ð¾Ð³Ð¸Ð½ -->
                <div>
                    <span class="block text-[10px] theme-muted uppercase mb-1">Login ID</span>
                    <div class="font-mono font-bold text-sm flex items-center gap-2">
                        <span>{{ $order->customer_phone }}</span>
                    </div>
                </div>

                <!-- ÐŸÐ°Ñ€Ð¾Ð»ÑŒ (ÐÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Access Key) -->
                <div>
                    <span class="block text-[10px] theme-muted uppercase mb-1">Current Password</span>
                    <div class="flex items-center gap-2">
                        @if($order->user && $order->user->access_key)
                            <!-- Ð’Ð¡Ð•Ð“Ð”Ð Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° (Ð¾Ð½ Ð¶Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ) -->
                            <span id="pwd-text" class="font-mono font-black text-xl tracking-widest" style="color: var(--color-primary)">
                                {{ $order->user->access_key }}
                            </span>
                            
                            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ -->
                            <button onclick="copyPassword('{{ $order->user->access_key }}')" class="no-print opacity-50 hover:opacity-100 transition" title="Copy Password">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                </svg>
                            </button>
                            <span id="copy-msg" class="text-[9px] text-green-600 font-bold hidden transition">Copied!</span>
                        @else
                            <span class="text-sm italic theme-muted">Not set (Guest)</span>
                        @endif
                    </div>
                </div>
            </div>

            <div class="mt-3 text-[10px] theme-muted border-t theme-border pt-2 flex items-start gap-2 no-print">
                <span class="text-lg leading-none">&uarr;</span>
                <span>You can use these credentials to log in at any time. If you change your password in profile, this receipt will update automatically.</span>
            </div>
        </div>

        <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð·Ð°ÐºÐ°Ð·Ðµ -->
        <div class="grid grid-cols-2 gap-8 mb-8 text-sm">
            <div>
                <h4 class="font-bold uppercase text-[10px] theme-muted mb-2 border-b theme-border inline-block pb-0.5">Bill To</h4>
                <p class="font-bold text-base">{{ $order->customer_name }}</p>
                <p class="text-xs font-mono mt-1">{{ $order->customer_phone }}</p>
                <p class="text-xs mt-1 opacity-80">{{ $order->shipping_address }}</p>
                <div class="mt-2">
                    <span class="text-[9px] font-bold uppercase theme-bg theme-border border px-1 py-0.5">{{ $order->shipping_method }}</span>
                </div>
            </div>
            <div class="text-right">
                <h4 class="font-bold uppercase text-[10px] theme-muted mb-2 border-b theme-border inline-block pb-0.5">Details</h4>
                <p class="font-bold text-xl font-mono">#{{ $order->order_number }}</p>
                <div class="mt-2">
                     <span class="inline-block px-3 py-1 text-[10px] font-bold uppercase border theme-border theme-bg shadow-sm">
                        {{ $order->status }}
                    </span>
                </div>
                <p class="text-[10px] theme-muted mt-2 uppercase">{{ $order->payment_method }}</p>
            </div>
        </div>

        <!-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² -->
        <div class="mb-8">
            <table class="w-full text-left text-sm border-collapse">
                <thead>
                    <tr class="border-b-2 theme-border text-[10px] uppercase theme-muted">
                        <th class="py-2 pl-2">Item Description</th>
                        <th class="py-2 text-center">Qty</th>
                        <th class="py-2 text-right pr-2">Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach($order->items as $item)
                        <tr class="border-b theme-border last:border-0 group hover:bg-gray-50 transition">
                            <td class="py-3 pl-2">
                                <span class="font-bold block">{{ $item->product_name }}</span>
                                <span class="text-[10px] theme-muted font-mono uppercase tracking-wide">{{ $item->sku }} / {{ $item->size }}</span>
                            </td>
                            <td class="py-3 text-center font-mono text-xs">{{ $item->quantity }}</td>
                            <td class="py-3 text-right font-mono font-bold pr-2">${{ $item->total }}</td>
                        </tr>
                    @endforeach
                </tbody>
            </table>
        </div>

        <!-- Ð˜Ñ‚Ð¾Ð³Ð¾ -->
        <div class="flex justify-end pt-4">
            <div class="w-full md:w-1/2 space-y-3">
                <div class="flex justify-between text-xs px-2">
                    <span class="theme-muted uppercase tracking-wider">Subtotal</span>
                    <span class="font-mono">${{ $order->subtotal }}</span>
                </div>
                 @if($order->discount_amount > 0)
                    <div class="flex justify-between text-xs px-2 text-red-500 font-bold">
                        <span class="uppercase tracking-wider">Discount</span>
                        <span class="font-mono">-${{ $order->discount_amount }}</span>
                    </div>
                @endif
                <div class="flex justify-between font-black text-2xl pt-4 border-t-2 theme-border px-2 items-center">
                    <span class="uppercase text-sm tracking-widest">Total Paid</span>
                    <span style="color: var(--color-primary)">${{ $order->total_amount }}</span>
                </div>
            </div>
        </div>

        <div class="mt-16 text-center text-[9px] theme-muted uppercase tracking-[0.2em] border-t theme-border pt-4">
            Thank you for shopping at {{ $tenantName }}
        </div>
    </div>
    
    <div class="h-12 no-print"></div>
</div>

<script>
    function copyPassword(text) {
        navigator.clipboard.writeText(text).then(function() {
            const msg = document.getElementById('copy-msg');
            msg.classList.remove('hidden');
            setTimeout(() => msg.classList.add('hidden'), 2000);
        }, function(err) {
            console.error('Async: Could not copy text: ', err);
        });
    }
</script>

<style>
    @media print {
        .no-print { display: none !important; }
        body { background: white !important; padding: 0 !important; margin: 0 !important; }
        body * { visibility: hidden; }
        #receipt, #receipt * { visibility: visible; }
        #receipt {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            margin: 0;
            padding: 0;
            box-shadow: none !important;
            border: none !important;
            background: white !important;
            color: black !important;
            transform: none !important; 
        }
        #receipt * { color: black !important; border-color: #ddd !important; }
        #receipt h1 { font-size: 24pt !important; }
    }
</style>
@endsection
</file>

<file path="resources/views/shop/home.blade.php">
<!-- FILE: resources/views/shop/home.blade.php -->
@extends('layouts.app')

@php
    $currentTenant = app(\App\Services\TenantService::class)->getCurrentTenantId();
    $titles = [
        'street_style' => 'New Drops',
        'designer_hub' => 'Collections',
        'military_gear' => 'Supply Catalog'
    ];
@endphp

@section('content')
    <!-- Hero Section -->
    <div class="py-16 text-center border-b theme-border mb-12 bg-opacity-50">
        <h1 class="text-6xl font-black uppercase tracking-tighter mb-4 theme-skew theme-text">
            {{ $titles[$currentTenant] ?? 'Welcome' }}
        </h1>
        <p class="theme-muted tracking-widest uppercase text-sm">
            {{ date('Y') }} Official Store
        </p>
    </div>

    <!-- Filters -->
    <div class="flex flex-wrap justify-center gap-4 mb-12">
        <a href="{{ route('home') }}" class="px-6 py-2 border theme-border font-bold uppercase text-sm transition {{ !request('category') ? 'theme-btn shadow-lg' : 'theme-link' }}">
            All Items
        </a>
        @foreach($categories as $cat)
            <a href="{{ route('home', ['category' => $cat->slug]) }}" class="px-6 py-2 border theme-border font-bold uppercase text-sm transition {{ request('category') == $cat->slug ? 'theme-btn shadow-lg' : 'theme-link' }}">
                {{ $cat->name }}
            </a>
        @endforeach
    </div>

    <!-- Product Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
        @foreach($products as $product)
            <div class="group relative block h-full flex flex-col">
                <a href="{{ route('product.show', $product->slug) }}" class="flex-1 flex flex-col">
                    <div class="relative overflow-hidden theme-card aspect-[3/4] mb-4 group-hover:opacity-90 transition">
                        <img src="{{ $product->cover_url }}" class="w-full h-full object-cover transition duration-700 group-hover:scale-105">
                        
                        @if($product->has_discount)
                            <div class="absolute top-2 right-2 theme-btn px-2 py-1 text-xs shadow-md">
                                SALE
                            </div>
                        @endif
                    </div>
                    
                    <div class="text-center mt-auto">
                        <h3 class="text-lg font-bold uppercase truncate theme-text">{{ $product->name }}</h3>
                        <div class="mt-2 pb-2">
                            <span class="theme-muted text-xs block mb-1">{{ $product->clothingLine->name ?? 'General' }}</span>
                            <span class="block font-bold text-lg" style="color: var(--color-primary)">
                                ${{ $product->current_price }}
                            </span>
                        </div>
                    </div>
                </a>
            </div>
        @endforeach
    </div>

    <div class="mt-12">
        {{ $products->links() }}
    </div>
@endsection
</file>

<file path="resources/views/shop/product.blade.php">
<!-- FILE: resources/views/shop/product.blade.php -->
@extends('layouts.app')
@section('title', $product->name)

@section('content')
<div x-data="{ 
    selectedSize: null, 
    showSizeGuide: false,
    hasVariants: {{ $product->variants->count() > 0 ? 'true' : 'false' }}
}">
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 py-8">
        <!-- Image Section -->
        <div class="relative">
            <div class="aspect-[3/4] overflow-hidden theme-card relative group">
                <img src="{{ $product->cover_url }}" class="w-full h-full object-cover transition duration-700 group-hover:scale-105">
                
                @if($product->has_discount)
                    <div class="absolute top-4 right-4 theme-btn px-3 py-1 text-sm shadow-xl z-10">
                        SALE -{{ $product->discount_percentage }}%
                    </div>
                @endif
            </div>
        </div>

        <!-- Info Section -->
        <div class="flex flex-col justify-center">
            <div class="mb-2">
                <span class="theme-muted text-sm uppercase tracking-widest">{{ $product->clothingLine->name ?? 'Collection' }}</span>
                <h1 class="text-4xl md:text-5xl font-black uppercase tracking-tighter theme-skew theme-text mb-2">
                    {{ $product->name }}
                </h1>
                <p class="text-xs font-mono theme-muted">SKU: {{ $product->sku }}</p>
            </div>

            <div class="mb-6 border-b theme-border pb-6">
                <div class="text-3xl font-bold flex items-center gap-4">
                    @if($product->has_discount)
                        <span class="line-through theme-muted text-xl">${{ $product->price }}</span>
                        <span style="color: var(--color-primary)">${{ $product->sale_price }}</span>
                    @else
                        <span style="color: var(--color-primary)">${{ $product->price }}</span>
                    @endif
                </div>
            </div>

            <form action="{{ route('cart.add') }}" method="POST">
                @csrf
                <input type="hidden" name="product_id" value="{{ $product->id }}">
                <input type="hidden" name="size" :value="selectedSize || 'One Size'">

                <!-- Size Selector (Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹) -->
                @if($product->variants->count() > 0)
                    <div class="mb-8">
                        <div class="flex justify-between items-end mb-3">
                            <label class="font-bold text-sm uppercase theme-muted">Select Size</label>
                            
                            <!-- Trigger Size Guide -->
                            <button type="button" @click="showSizeGuide = true" class="text-xs underline hover:no-underline font-bold theme-text uppercase flex items-center gap-1">
                                <span>ðŸ“ Size Guide</span>
                            </button>
                        </div>
                        
                        <div class="flex flex-wrap gap-3">
                            @foreach($product->variants as $variant)
                                <button type="button" 
                                    @click="selectedSize = '{{ $variant->size }}'"
                                    class="h-12 w-12 flex items-center justify-center border-2 font-bold text-sm transition relative overflow-hidden"
                                    :class="selectedSize === '{{ $variant->size }}' 
                                        ? 'theme-bg theme-text border-[var(--color-primary)]' 
                                        : 'bg-transparent theme-border theme-text hover:border-[var(--color-primary)]'"
                                    {{ $variant->stock <= 0 ? 'disabled' : '' }}>
                                    
                                    {{ $variant->size }}

                                    <!-- ÐŸÐµÑ€ÐµÑ‡ÐµÑ€ÐºÐ¸Ð²Ð°Ð½Ð¸Ðµ Ð´Ð»Ñ Out of Stock -->
                                    @if($variant->stock <= 0)
                                        <div class="absolute inset-0 bg-gray-500 bg-opacity-20 cursor-not-allowed"></div>
                                        <div class="absolute inset-0 flex items-center justify-center">
                                            <div class="w-full h-0.5 bg-red-500 rotate-45"></div>
                                        </div>
                                    @endif
                                </button>
                            @endforeach
                        </div>
                        <p class="mt-2 text-red-500 text-xs font-bold h-4" x-show="!selectedSize && hasVariants" x-cloak>
                            * Please select a size
                        </p>
                    </div>
                @endif

                <div class="mb-8">
                    <h3 class="font-bold text-sm uppercase theme-muted mb-2">Description</h3>
                    <div class="theme-text text-sm leading-relaxed opacity-80">
                        {{ $product->description ?? 'No description available for this item.' }}
                    </div>
                </div>

                <button class="theme-btn w-full py-4 text-xl shadow-lg hover:shadow-2xl transition disabled:opacity-50 disabled:cursor-not-allowed"
                        :disabled="hasVariants && !selectedSize">
                    ADD TO CART
                </button>
                
                @if($product->variants->count() > 0)
                    <p class="text-center text-[10px] theme-muted uppercase mt-2 opacity-50">
                        Secure checkout powered by TriShop
                    </p>
                @endif
            </form>
        </div>
    </div>

    <!-- SIZE GUIDE MODAL (Universal) -->
    <div x-show="showSizeGuide" style="display: none;" 
         class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 backdrop-blur-sm p-4"
         x-transition.opacity>
        
        <div class="theme-card max-w-2xl w-full p-8 relative shadow-2xl bg-white theme-text" 
             @click.away="showSizeGuide = false">
            
            <button @click="showSizeGuide = false" class="absolute top-4 right-4 text-2xl font-bold hover:text-red-500">&times;</button>
            
            <h2 class="text-2xl font-black uppercase mb-6 theme-skew text-center">Size Guide</h2>
            
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-center border-collapse">
                    <thead>
                        <tr class="theme-bg theme-text text-white">
                            <th class="p-3 border theme-border">Size</th>
                            <th class="p-3 border theme-border">Chest (cm)</th>
                            <th class="p-3 border theme-border">Waist (cm)</th>
                            <th class="p-3 border theme-border">Hips (cm)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ÐŸÑ€Ð¸Ð¼ÐµÑ€Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ. ÐœÐ¾Ð¶Ð½Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼Ð¸ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼ -->
                        <tr>
                            <td class="p-3 border theme-border font-bold">XS</td>
                            <td class="p-3 border theme-border">82-87</td>
                            <td class="p-3 border theme-border">63-68</td>
                            <td class="p-3 border theme-border">88-93</td>
                        </tr>
                        <tr>
                            <td class="p-3 border theme-border font-bold">S</td>
                            <td class="p-3 border theme-border">88-93</td>
                            <td class="p-3 border theme-border">69-74</td>
                            <td class="p-3 border theme-border">94-99</td>
                        </tr>
                        <tr>
                            <td class="p-3 border theme-border font-bold">M</td>
                            <td class="p-3 border theme-border">94-99</td>
                            <td class="p-3 border theme-border">75-80</td>
                            <td class="p-3 border theme-border">100-105</td>
                        </tr>
                        <tr>
                            <td class="p-3 border theme-border font-bold">L</td>
                            <td class="p-3 border theme-border">100-105</td>
                            <td class="p-3 border theme-border">81-86</td>
                            <td class="p-3 border theme-border">106-111</td>
                        </tr>
                        <tr>
                            <td class="p-3 border theme-border font-bold">XL</td>
                            <td class="p-3 border theme-border">106-111</td>
                            <td class="p-3 border theme-border">87-92</td>
                            <td class="p-3 border theme-border">112-117</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="mt-6 text-xs theme-muted text-center">
                * Measurements are in centimeters. Use as a general guide.
            </div>

            <div class="mt-6 text-center">
                <button @click="showSizeGuide = false" class="theme-btn px-6 py-2 text-sm">Close Guide</button>
            </div>
        </div>
    </div>

</div>
@endsection
</file>

<file path="resources/views/welcome.blade.php">
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>{{ config('app.name', 'Laravel') }}</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=instrument-sans:400,500,600" rel="stylesheet" />

        <!-- Styles / Scripts -->
        @if (file_exists(public_path('build/manifest.json')) || file_exists(public_path('hot')))
            @vite(['resources/css/app.css', 'resources/js/app.js'])
        @else
            <style>
                /*! tailwindcss v4.0.7 | MIT License | https://tailwindcss.com */@layer theme{:root,:host{--font-sans:'Instrument Sans',ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-serif:ui-serif,Georgia,Cambria,"Times New Roman",Times,serif;--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-50:oklch(.971 .013 17.38);--color-red-100:oklch(.936 .032 17.717);--color-red-200:oklch(.885 .062 18.334);--color-red-300:oklch(.808 .114 19.571);--color-red-400:oklch(.704 .191 22.216);--color-red-500:oklch(.637 .237 25.331);--color-red-600:oklch(.577 .245 27.325);--color-red-700:oklch(.505 .213 27.518);--color-red-800:oklch(.444 .177 26.899);--color-red-900:oklch(.396 .141 25.723);--color-red-950:oklch(.258 .092 26.042);--color-orange-50:oklch(.98 .016 73.684);--color-orange-100:oklch(.954 .038 75.164);--color-orange-200:oklch(.901 .076 70.697);--color-orange-300:oklch(.837 .128 66.29);--color-orange-400:oklch(.75 .183 55.934);--color-orange-500:oklch(.705 .213 47.604);--color-orange-600:oklch(.646 .222 41.116);--color-orange-700:oklch(.553 .195 38.402);--color-orange-800:oklch(.47 .157 37.304);--color-orange-900:oklch(.408 .123 38.172);--color-orange-950:oklch(.266 .079 36.259);--color-amber-50:oklch(.987 .022 95.277);--color-amber-100:oklch(.962 .059 95.617);--color-amber-200:oklch(.924 .12 95.746);--color-amber-300:oklch(.879 .169 91.605);--color-amber-400:oklch(.828 .189 84.429);--color-amber-500:oklch(.769 .188 70.08);--color-amber-600:oklch(.666 .179 58.318);--color-amber-700:oklch(.555 .163 48.998);--color-amber-800:oklch(.473 .137 46.201);--color-amber-900:oklch(.414 .112 45.904);--color-amber-950:oklch(.279 .077 45.635);--color-yellow-50:oklch(.987 .026 102.212);--color-yellow-100:oklch(.973 .071 103.193);--color-yellow-200:oklch(.945 .129 101.54);--color-yellow-300:oklch(.905 .182 98.111);--color-yellow-400:oklch(.852 .199 91.936);--color-yellow-500:oklch(.795 .184 86.047);--color-yellow-600:oklch(.681 .162 75.834);--color-yellow-700:oklch(.554 .135 66.442);--color-yellow-800:oklch(.476 .114 61.907);--color-yellow-900:oklch(.421 .095 57.708);--color-yellow-950:oklch(.286 .066 53.813);--color-lime-50:oklch(.986 .031 120.757);--color-lime-100:oklch(.967 .067 122.328);--color-lime-200:oklch(.938 .127 124.321);--color-lime-300:oklch(.897 .196 126.665);--color-lime-400:oklch(.841 .238 128.85);--color-lime-500:oklch(.768 .233 130.85);--color-lime-600:oklch(.648 .2 131.684);--color-lime-700:oklch(.532 .157 131.589);--color-lime-800:oklch(.453 .124 130.933);--color-lime-900:oklch(.405 .101 131.063);--color-lime-950:oklch(.274 .072 132.109);--color-green-50:oklch(.982 .018 155.826);--color-green-100:oklch(.962 .044 156.743);--color-green-200:oklch(.925 .084 155.995);--color-green-300:oklch(.871 .15 154.449);--color-green-400:oklch(.792 .209 151.711);--color-green-500:oklch(.723 .219 149.579);--color-green-600:oklch(.627 .194 149.214);--color-green-700:oklch(.527 .154 150.069);--color-green-800:oklch(.448 .119 151.328);--color-green-900:oklch(.393 .095 152.535);--color-green-950:oklch(.266 .065 152.934);--color-emerald-50:oklch(.979 .021 166.113);--color-emerald-100:oklch(.95 .052 163.051);--color-emerald-200:oklch(.905 .093 164.15);--color-emerald-300:oklch(.845 .143 164.978);--color-emerald-400:oklch(.765 .177 163.223);--color-emerald-500:oklch(.696 .17 162.48);--color-emerald-600:oklch(.596 .145 163.225);--color-emerald-700:oklch(.508 .118 165.612);--color-emerald-800:oklch(.432 .095 166.913);--color-emerald-900:oklch(.378 .077 168.94);--color-emerald-950:oklch(.262 .051 172.552);--color-teal-50:oklch(.984 .014 180.72);--color-teal-100:oklch(.953 .051 180.801);--color-teal-200:oklch(.91 .096 180.426);--color-teal-300:oklch(.855 .138 181.071);--color-teal-400:oklch(.777 .152 181.912);--color-teal-500:oklch(.704 .14 182.503);--color-teal-600:oklch(.6 .118 184.704);--color-teal-700:oklch(.511 .096 186.391);--color-teal-800:oklch(.437 .078 188.216);--color-teal-900:oklch(.386 .063 188.416);--color-teal-950:oklch(.277 .046 192.524);--color-cyan-50:oklch(.984 .019 200.873);--color-cyan-100:oklch(.956 .045 203.388);--color-cyan-200:oklch(.917 .08 205.041);--color-cyan-300:oklch(.865 .127 207.078);--color-cyan-400:oklch(.789 .154 211.53);--color-cyan-500:oklch(.715 .143 215.221);--color-cyan-600:oklch(.609 .126 221.723);--color-cyan-700:oklch(.52 .105 223.128);--color-cyan-800:oklch(.45 .085 224.283);--color-cyan-900:oklch(.398 .07 227.392);--color-cyan-950:oklch(.302 .056 229.695);--color-sky-50:oklch(.977 .013 236.62);--color-sky-100:oklch(.951 .026 236.824);--color-sky-200:oklch(.901 .058 230.902);--color-sky-300:oklch(.828 .111 230.318);--color-sky-400:oklch(.746 .16 232.661);--color-sky-500:oklch(.685 .169 237.323);--color-sky-600:oklch(.588 .158 241.966);--color-sky-700:oklch(.5 .134 242.749);--color-sky-800:oklch(.443 .11 240.79);--color-sky-900:oklch(.391 .09 240.876);--color-sky-950:oklch(.293 .066 243.157);--color-blue-50:oklch(.97 .014 254.604);--color-blue-100:oklch(.932 .032 255.585);--color-blue-200:oklch(.882 .059 254.128);--color-blue-300:oklch(.809 .105 251.813);--color-blue-400:oklch(.707 .165 254.624);--color-blue-500:oklch(.623 .214 259.815);--color-blue-600:oklch(.546 .245 262.881);--color-blue-700:oklch(.488 .243 264.376);--color-blue-800:oklch(.424 .199 265.638);--color-blue-900:oklch(.379 .146 265.522);--color-blue-950:oklch(.282 .091 267.935);--color-indigo-50:oklch(.962 .018 272.314);--color-indigo-100:oklch(.93 .034 272.788);--color-indigo-200:oklch(.87 .065 274.039);--color-indigo-300:oklch(.785 .115 274.713);--color-indigo-400:oklch(.673 .182 276.935);--color-indigo-500:oklch(.585 .233 277.117);--color-indigo-600:oklch(.511 .262 276.966);--color-indigo-700:oklch(.457 .24 277.023);--color-indigo-800:oklch(.398 .195 277.366);--color-indigo-900:oklch(.359 .144 278.697);--color-indigo-950:oklch(.257 .09 281.288);--color-violet-50:oklch(.969 .016 293.756);--color-violet-100:oklch(.943 .029 294.588);--color-violet-200:oklch(.894 .057 293.283);--color-violet-300:oklch(.811 .111 293.571);--color-violet-400:oklch(.702 .183 293.541);--color-violet-500:oklch(.606 .25 292.717);--color-violet-600:oklch(.541 .281 293.009);--color-violet-700:oklch(.491 .27 292.581);--color-violet-800:oklch(.432 .232 292.759);--color-violet-900:oklch(.38 .189 293.745);--color-violet-950:oklch(.283 .141 291.089);--color-purple-50:oklch(.977 .014 308.299);--color-purple-100:oklch(.946 .033 307.174);--color-purple-200:oklch(.902 .063 306.703);--color-purple-300:oklch(.827 .119 306.383);--color-purple-400:oklch(.714 .203 305.504);--color-purple-500:oklch(.627 .265 303.9);--color-purple-600:oklch(.558 .288 302.321);--color-purple-700:oklch(.496 .265 301.924);--color-purple-800:oklch(.438 .218 303.724);--color-purple-900:oklch(.381 .176 304.987);--color-purple-950:oklch(.291 .149 302.717);--color-fuchsia-50:oklch(.977 .017 320.058);--color-fuchsia-100:oklch(.952 .037 318.852);--color-fuchsia-200:oklch(.903 .076 319.62);--color-fuchsia-300:oklch(.833 .145 321.434);--color-fuchsia-400:oklch(.74 .238 322.16);--color-fuchsia-500:oklch(.667 .295 322.15);--color-fuchsia-600:oklch(.591 .293 322.896);--color-fuchsia-700:oklch(.518 .253 323.949);--color-fuchsia-800:oklch(.452 .211 324.591);--color-fuchsia-900:oklch(.401 .17 325.612);--color-fuchsia-950:oklch(.293 .136 325.661);--color-pink-50:oklch(.971 .014 343.198);--color-pink-100:oklch(.948 .028 342.258);--color-pink-200:oklch(.899 .061 343.231);--color-pink-300:oklch(.823 .12 346.018);--color-pink-400:oklch(.718 .202 349.761);--color-pink-500:oklch(.656 .241 354.308);--color-pink-600:oklch(.592 .249 .584);--color-pink-700:oklch(.525 .223 3.958);--color-pink-800:oklch(.459 .187 3.815);--color-pink-900:oklch(.408 .153 2.432);--color-pink-950:oklch(.284 .109 3.907);--color-rose-50:oklch(.969 .015 12.422);--color-rose-100:oklch(.941 .03 12.58);--color-rose-200:oklch(.892 .058 10.001);--color-rose-300:oklch(.81 .117 11.638);--color-rose-400:oklch(.712 .194 13.428);--color-rose-500:oklch(.645 .246 16.439);--color-rose-600:oklch(.586 .253 17.585);--color-rose-700:oklch(.514 .222 16.935);--color-rose-800:oklch(.455 .188 13.697);--color-rose-900:oklch(.41 .159 10.272);--color-rose-950:oklch(.271 .105 12.094);--color-slate-50:oklch(.984 .003 247.858);--color-slate-100:oklch(.968 .007 247.896);--color-slate-200:oklch(.929 .013 255.508);--color-slate-300:oklch(.869 .022 252.894);--color-slate-400:oklch(.704 .04 256.788);--color-slate-500:oklch(.554 .046 257.417);--color-slate-600:oklch(.446 .043 257.281);--color-slate-700:oklch(.372 .044 257.287);--color-slate-800:oklch(.279 .041 260.031);--color-slate-900:oklch(.208 .042 265.755);--color-slate-950:oklch(.129 .042 264.695);--color-gray-50:oklch(.985 .002 247.839);--color-gray-100:oklch(.967 .003 264.542);--color-gray-200:oklch(.928 .006 264.531);--color-gray-300:oklch(.872 .01 258.338);--color-gray-400:oklch(.707 .022 261.325);--color-gray-500:oklch(.551 .027 264.364);--color-gray-600:oklch(.446 .03 256.802);--color-gray-700:oklch(.373 .034 259.733);--color-gray-800:oklch(.278 .033 256.848);--color-gray-900:oklch(.21 .034 264.665);--color-gray-950:oklch(.13 .028 261.692);--color-zinc-50:oklch(.985 0 0);--color-zinc-100:oklch(.967 .001 286.375);--color-zinc-200:oklch(.92 .004 286.32);--color-zinc-300:oklch(.871 .006 286.286);--color-zinc-400:oklch(.705 .015 286.067);--color-zinc-500:oklch(.552 .016 285.938);--color-zinc-600:oklch(.442 .017 285.786);--color-zinc-700:oklch(.37 .013 285.805);--color-zinc-800:oklch(.274 .006 286.033);--color-zinc-900:oklch(.21 .006 285.885);--color-zinc-950:oklch(.141 .005 285.823);--color-neutral-50:oklch(.985 0 0);--color-neutral-100:oklch(.97 0 0);--color-neutral-200:oklch(.922 0 0);--color-neutral-300:oklch(.87 0 0);--color-neutral-400:oklch(.708 0 0);--color-neutral-500:oklch(.556 0 0);--color-neutral-600:oklch(.439 0 0);--color-neutral-700:oklch(.371 0 0);--color-neutral-800:oklch(.269 0 0);--color-neutral-900:oklch(.205 0 0);--color-neutral-950:oklch(.145 0 0);--color-stone-50:oklch(.985 .001 106.423);--color-stone-100:oklch(.97 .001 106.424);--color-stone-200:oklch(.923 .003 48.717);--color-stone-300:oklch(.869 .005 56.366);--color-stone-400:oklch(.709 .01 56.259);--color-stone-500:oklch(.553 .013 58.071);--color-stone-600:oklch(.444 .011 73.639);--color-stone-700:oklch(.374 .01 67.558);--color-stone-800:oklch(.268 .007 34.298);--color-stone-900:oklch(.216 .006 56.043);--color-stone-950:oklch(.147 .004 49.25);--color-black:#000;--color-white:#fff;--spacing:.25rem;--breakpoint-sm:40rem;--breakpoint-md:48rem;--breakpoint-lg:64rem;--breakpoint-xl:80rem;--breakpoint-2xl:96rem;--container-3xs:16rem;--container-2xs:18rem;--container-xs:20rem;--container-sm:24rem;--container-md:28rem;--container-lg:32rem;--container-xl:36rem;--container-2xl:42rem;--container-3xl:48rem;--container-4xl:56rem;--container-5xl:64rem;--container-6xl:72rem;--container-7xl:80rem;--text-xs:.75rem;--text-xs--line-height:calc(1/.75);--text-sm:.875rem;--text-sm--line-height:calc(1.25/.875);--text-base:1rem;--text-base--line-height: 1.5 ;--text-lg:1.125rem;--text-lg--line-height:calc(1.75/1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75/1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2/1.5);--text-3xl:1.875rem;--text-3xl--line-height: 1.2 ;--text-4xl:2.25rem;--text-4xl--line-height:calc(2.5/2.25);--text-5xl:3rem;--text-5xl--line-height:1;--text-6xl:3.75rem;--text-6xl--line-height:1;--text-7xl:4.5rem;--text-7xl--line-height:1;--text-8xl:6rem;--text-8xl--line-height:1;--text-9xl:8rem;--text-9xl--line-height:1;--font-weight-thin:100;--font-weight-extralight:200;--font-weight-light:300;--font-weight-normal:400;--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--font-weight-extrabold:800;--font-weight-black:900;--tracking-tighter:-.05em;--tracking-tight:-.025em;--tracking-normal:0em;--tracking-wide:.025em;--tracking-wider:.05em;--tracking-widest:.1em;--leading-tight:1.25;--leading-snug:1.375;--leading-normal:1.5;--leading-relaxed:1.625;--leading-loose:2;--radius-xs:.125rem;--radius-sm:.25rem;--radius-md:.375rem;--radius-lg:.5rem;--radius-xl:.75rem;--radius-2xl:1rem;--radius-3xl:1.5rem;--radius-4xl:2rem;--shadow-2xs:0 1px #0000000d;--shadow-xs:0 1px 2px 0 #0000000d;--shadow-sm:0 1px 3px 0 #0000001a,0 1px 2px -1px #0000001a;--shadow-md:0 4px 6px -1px #0000001a,0 2px 4px -2px #0000001a;--shadow-lg:0 10px 15px -3px #0000001a,0 4px 6px -4px #0000001a;--shadow-xl:0 20px 25px -5px #0000001a,0 8px 10px -6px #0000001a;--shadow-2xl:0 25px 50px -12px #00000040;--inset-shadow-2xs:inset 0 1px #0000000d;--inset-shadow-xs:inset 0 1px 1px #0000000d;--inset-shadow-sm:inset 0 2px 4px #0000000d;--drop-shadow-xs:0 1px 1px #0000000d;--drop-shadow-sm:0 1px 2px #00000026;--drop-shadow-md:0 3px 3px #0000001f;--drop-shadow-lg:0 4px 4px #00000026;--drop-shadow-xl:0 9px 7px #0000001a;--drop-shadow-2xl:0 25px 25px #00000026;--ease-in:cubic-bezier(.4,0,1,1);--ease-out:cubic-bezier(0,0,.2,1);--ease-in-out:cubic-bezier(.4,0,.2,1);--animate-spin:spin 1s linear infinite;--animate-ping:ping 1s cubic-bezier(0,0,.2,1)infinite;--animate-pulse:pulse 2s cubic-bezier(.4,0,.6,1)infinite;--animate-bounce:bounce 1s infinite;--blur-xs:4px;--blur-sm:8px;--blur-md:12px;--blur-lg:16px;--blur-xl:24px;--blur-2xl:40px;--blur-3xl:64px;--perspective-dramatic:100px;--perspective-near:300px;--perspective-normal:500px;--perspective-midrange:800px;--perspective-distant:1200px;--aspect-video:16/9;--default-transition-duration:.15s;--default-transition-timing-function:cubic-bezier(.4,0,.2,1);--default-font-family:var(--font-sans);--default-font-feature-settings:var(--font-sans--font-feature-settings);--default-font-variation-settings:var(--font-sans--font-variation-settings);--default-mono-font-family:var(--font-mono);--default-mono-font-feature-settings:var(--font-mono--font-feature-settings);--default-mono-font-variation-settings:var(--font-mono--font-variation-settings)}}@layer base{*,:after,:before,::backdrop{box-sizing:border-box;border:0 solid;margin:0;padding:0}::file-selector-button{box-sizing:border-box;border:0 solid;margin:0;padding:0}html,:host{-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;line-height:1.5;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}body{line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{vertical-align:middle;display:block}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1;color:color-mix(in oklab,currentColor 50%,transparent)}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit{padding-block:0}::-webkit-datetime-edit-year-field{padding-block:0}::-webkit-datetime-edit-month-field{padding-block:0}::-webkit-datetime-edit-day-field{padding-block:0}::-webkit-datetime-edit-hour-field{padding-block:0}::-webkit-datetime-edit-minute-field{padding-block:0}::-webkit-datetime-edit-second-field{padding-block:0}::-webkit-datetime-edit-millisecond-field{padding-block:0}::-webkit-datetime-edit-meridiem-field{padding-block:0}:-moz-ui-invalid{box-shadow:none}button,input:where([type=button],[type=reset],[type=submit]){-webkit-appearance:button;-moz-appearance:button;appearance:button}::file-selector-button{-webkit-appearance:button;-moz-appearance:button;appearance:button}::-webkit-inner-spin-button{height:auto}::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden=until-found])){display:none!important}}@layer components;@layer utilities{.absolute{position:absolute}.relative{position:relative}.static{position:static}.inset-0{inset:calc(var(--spacing)*0)}.-mt-\[4\.9rem\]{margin-top:-4.9rem}.-mb-px{margin-bottom:-1px}.mb-1{margin-bottom:calc(var(--spacing)*1)}.mb-2{margin-bottom:calc(var(--spacing)*2)}.mb-4{margin-bottom:calc(var(--spacing)*4)}.mb-6{margin-bottom:calc(var(--spacing)*6)}.-ml-8{margin-left:calc(var(--spacing)*-8)}.flex{display:flex}.hidden{display:none}.inline-block{display:inline-block}.inline-flex{display:inline-flex}.table{display:table}.aspect-\[335\/376\]{aspect-ratio:335/376}.h-1{height:calc(var(--spacing)*1)}.h-1\.5{height:calc(var(--spacing)*1.5)}.h-2{height:calc(var(--spacing)*2)}.h-2\.5{height:calc(var(--spacing)*2.5)}.h-3{height:calc(var(--spacing)*3)}.h-3\.5{height:calc(var(--spacing)*3.5)}.h-14{height:calc(var(--spacing)*14)}.h-14\.5{height:calc(var(--spacing)*14.5)}.min-h-screen{min-height:100vh}.w-1{width:calc(var(--spacing)*1)}.w-1\.5{width:calc(var(--spacing)*1.5)}.w-2{width:calc(var(--spacing)*2)}.w-2\.5{width:calc(var(--spacing)*2.5)}.w-3{width:calc(var(--spacing)*3)}.w-3\.5{width:calc(var(--spacing)*3.5)}.w-\[448px\]{width:448px}.w-full{width:100%}.max-w-\[335px\]{max-width:335px}.max-w-none{max-width:none}.flex-1{flex:1}.shrink-0{flex-shrink:0}.translate-y-0{--tw-translate-y:calc(var(--spacing)*0);translate:var(--tw-translate-x)var(--tw-translate-y)}.transform{transform:var(--tw-rotate-x)var(--tw-rotate-y)var(--tw-rotate-z)var(--tw-skew-x)var(--tw-skew-y)}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.items-center{align-items:center}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.gap-3{gap:calc(var(--spacing)*3)}.gap-4{gap:calc(var(--spacing)*4)}:where(.space-x-1>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing)*1)*var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing)*1)*calc(1 - var(--tw-space-x-reverse)))}.overflow-hidden{overflow:hidden}.rounded-full{border-radius:3.40282e38px}.rounded-sm{border-radius:var(--radius-sm)}.rounded-t-lg{border-top-left-radius:var(--radius-lg);border-top-right-radius:var(--radius-lg)}.rounded-br-lg{border-bottom-right-radius:var(--radius-lg)}.rounded-bl-lg{border-bottom-left-radius:var(--radius-lg)}.border{border-style:var(--tw-border-style);border-width:1px}.border-\[\#19140035\]{border-color:#19140035}.border-\[\#e3e3e0\]{border-color:#e3e3e0}.border-black{border-color:var(--color-black)}.border-transparent{border-color:#0000}.bg-\[\#1b1b18\]{background-color:#1b1b18}.bg-\[\#FDFDFC\]{background-color:#fdfdfc}.bg-\[\#dbdbd7\]{background-color:#dbdbd7}.bg-\[\#fff2f2\]{background-color:#fff2f2}.bg-white{background-color:var(--color-white)}.p-6{padding:calc(var(--spacing)*6)}.px-5{padding-inline:calc(var(--spacing)*5)}.py-1{padding-block:calc(var(--spacing)*1)}.py-1\.5{padding-block:calc(var(--spacing)*1.5)}.py-2{padding-block:calc(var(--spacing)*2)}.pb-12{padding-bottom:calc(var(--spacing)*12)}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-\[13px\]{font-size:13px}.leading-\[20px\]{--tw-leading:20px;line-height:20px}.leading-normal{--tw-leading:var(--leading-normal);line-height:var(--leading-normal)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.text-\[\#1b1b18\]{color:#1b1b18}.text-\[\#706f6c\]{color:#706f6c}.text-\[\#F53003\],.text-\[\#f53003\]{color:#f53003}.text-white{color:var(--color-white)}.underline{text-decoration-line:underline}.underline-offset-4{text-underline-offset:4px}.opacity-100{opacity:1}.shadow-\[0px_0px_1px_0px_rgba\(0\,0\,0\,0\.03\)\,0px_1px_2px_0px_rgba\(0\,0\,0\,0\.06\)\]{--tw-shadow:0px 0px 1px 0px var(--tw-shadow-color,#00000008),0px 1px 2px 0px var(--tw-shadow-color,#0000000f);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-\[inset_0px_0px_0px_1px_rgba\(26\,26\,0\,0\.16\)\]{--tw-shadow:inset 0px 0px 0px 1px var(--tw-shadow-color,#1a1a0029);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.\!filter{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)!important}.filter{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.delay-300{transition-delay:.3s}.duration-750{--tw-duration:.75s;transition-duration:.75s}.not-has-\[nav\]\:hidden:not(:has(:is(nav))){display:none}.before\:absolute:before{content:var(--tw-content);position:absolute}.before\:top-0:before{content:var(--tw-content);top:calc(var(--spacing)*0)}.before\:top-1\/2:before{content:var(--tw-content);top:50%}.before\:bottom-0:before{content:var(--tw-content);bottom:calc(var(--spacing)*0)}.before\:bottom-1\/2:before{content:var(--tw-content);bottom:50%}.before\:left-\[0\.4rem\]:before{content:var(--tw-content);left:.4rem}.before\:border-l:before{content:var(--tw-content);border-left-style:var(--tw-border-style);border-left-width:1px}.before\:border-\[\#e3e3e0\]:before{content:var(--tw-content);border-color:#e3e3e0}@media (hover:hover){.hover\:border-\[\#1915014a\]:hover{border-color:#1915014a}.hover\:border-\[\#19140035\]:hover{border-color:#19140035}.hover\:border-black:hover{border-color:var(--color-black)}.hover\:bg-black:hover{background-color:var(--color-black)}}@media (width>=64rem){.lg\:-mt-\[6\.6rem\]{margin-top:-6.6rem}.lg\:mb-0{margin-bottom:calc(var(--spacing)*0)}.lg\:mb-6{margin-bottom:calc(var(--spacing)*6)}.lg\:-ml-px{margin-left:-1px}.lg\:ml-0{margin-left:calc(var(--spacing)*0)}.lg\:block{display:block}.lg\:aspect-auto{aspect-ratio:auto}.lg\:w-\[438px\]{width:438px}.lg\:max-w-4xl{max-width:var(--container-4xl)}.lg\:grow{flex-grow:1}.lg\:flex-row{flex-direction:row}.lg\:justify-center{justify-content:center}.lg\:rounded-t-none{border-top-left-radius:0;border-top-right-radius:0}.lg\:rounded-tl-lg{border-top-left-radius:var(--radius-lg)}.lg\:rounded-r-lg{border-top-right-radius:var(--radius-lg);border-bottom-right-radius:var(--radius-lg)}.lg\:rounded-br-none{border-bottom-right-radius:0}.lg\:p-8{padding:calc(var(--spacing)*8)}.lg\:p-20{padding:calc(var(--spacing)*20)}}@media (prefers-color-scheme:dark){.dark\:block{display:block}.dark\:hidden{display:none}.dark\:border-\[\#3E3E3A\]{border-color:#3e3e3a}.dark\:border-\[\#eeeeec\]{border-color:#eeeeec}.dark\:bg-\[\#0a0a0a\]{background-color:#0a0a0a}.dark\:bg-\[\#1D0002\]{background-color:#1d0002}.dark\:bg-\[\#3E3E3A\]{background-color:#3e3e3a}.dark\:bg-\[\#161615\]{background-color:#161615}.dark\:bg-\[\#eeeeec\]{background-color:#eeeeec}.dark\:text-\[\#1C1C1A\]{color:#1c1c1a}.dark\:text-\[\#A1A09A\]{color:#a1a09a}.dark\:text-\[\#EDEDEC\]{color:#ededec}.dark\:text-\[\#F61500\]{color:#f61500}.dark\:text-\[\#FF4433\]{color:#f43}.dark\:shadow-\[inset_0px_0px_0px_1px_\#fffaed2d\]{--tw-shadow:inset 0px 0px 0px 1px var(--tw-shadow-color,#fffaed2d);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.dark\:before\:border-\[\#3E3E3A\]:before{content:var(--tw-content);border-color:#3e3e3a}@media (hover:hover){.dark\:hover\:border-\[\#3E3E3A\]:hover{border-color:#3e3e3a}.dark\:hover\:border-\[\#62605b\]:hover{border-color:#62605b}.dark\:hover\:border-white:hover{border-color:var(--color-white)}.dark\:hover\:bg-white:hover{background-color:var(--color-white)}}}@starting-style{.starting\:translate-y-4{--tw-translate-y:calc(var(--spacing)*4);translate:var(--tw-translate-x)var(--tw-translate-y)}}@starting-style{.starting\:translate-y-6{--tw-translate-y:calc(var(--spacing)*6);translate:var(--tw-translate-x)var(--tw-translate-y)}}@starting-style{.starting\:opacity-0{opacity:0}}}@keyframes spin{to{transform:rotate(360deg)}}@keyframes ping{75%,to{opacity:0;transform:scale(2)}}@keyframes pulse{50%{opacity:.5}}@keyframes bounce{0%,to{animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}@property --tw-rotate-x{syntax:"*";inherits:false;initial-value:rotateX(0)}@property --tw-rotate-y{syntax:"*";inherits:false;initial-value:rotateY(0)}@property --tw-rotate-z{syntax:"*";inherits:false;initial-value:rotateZ(0)}@property --tw-skew-x{syntax:"*";inherits:false;initial-value:skewX(0)}@property --tw-skew-y{syntax:"*";inherits:false;initial-value:skewY(0)}@property --tw-space-x-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-content{syntax:"*";inherits:false;initial-value:""}
            </style>
        @endif
    </head>
    <body class="bg-[#FDFDFC] dark:bg-[#0a0a0a] text-[#1b1b18] flex p-6 lg:p-8 items-center lg:justify-center min-h-screen flex-col">
        <header class="w-full lg:max-w-4xl max-w-[335px] text-sm mb-6 not-has-[nav]:hidden">
            @if (Route::has('login'))
                <nav class="flex items-center justify-end gap-4">
                    @auth
                        <a
                            href="{{ url('/dashboard') }}"
                            class="inline-block px-5 py-1.5 dark:text-[#EDEDEC] border-[#19140035] hover:border-[#1915014a] border text-[#1b1b18] dark:border-[#3E3E3A] dark:hover:border-[#62605b] rounded-sm text-sm leading-normal"
                        >
                            Dashboard
                        </a>
                    @else
                        <a
                            href="{{ route('login') }}"
                            class="inline-block px-5 py-1.5 dark:text-[#EDEDEC] text-[#1b1b18] border border-transparent hover:border-[#19140035] dark:hover:border-[#3E3E3A] rounded-sm text-sm leading-normal"
                        >
                            Log in
                        </a>

                        @if (Route::has('register'))
                            <a
                                href="{{ route('register') }}"
                                class="inline-block px-5 py-1.5 dark:text-[#EDEDEC] border-[#19140035] hover:border-[#1915014a] border text-[#1b1b18] dark:border-[#3E3E3A] dark:hover:border-[#62605b] rounded-sm text-sm leading-normal">
                                Register
                            </a>
                        @endif
                    @endauth
                </nav>
            @endif
        </header>
        <div class="flex items-center justify-center w-full transition-opacity opacity-100 duration-750 lg:grow starting:opacity-0">
            <main class="flex max-w-[335px] w-full flex-col-reverse lg:max-w-4xl lg:flex-row">
                <div class="text-[13px] leading-[20px] flex-1 p-6 pb-12 lg:p-20 bg-white dark:bg-[#161615] dark:text-[#EDEDEC] shadow-[inset_0px_0px_0px_1px_rgba(26,26,0,0.16)] dark:shadow-[inset_0px_0px_0px_1px_#fffaed2d] rounded-bl-lg rounded-br-lg lg:rounded-tl-lg lg:rounded-br-none">
                    <h1 class="mb-1 font-medium">Let's get started</h1>
                    <p class="mb-2 text-[#706f6c] dark:text-[#A1A09A]">Laravel has an incredibly rich ecosystem. <br>We suggest starting with the following.</p>
                    <ul class="flex flex-col mb-4 lg:mb-6">
                        <li class="flex items-center gap-4 py-2 relative before:border-l before:border-[#e3e3e0] dark:before:border-[#3E3E3A] before:top-1/2 before:bottom-0 before:left-[0.4rem] before:absolute">
                            <span class="relative py-1 bg-white dark:bg-[#161615]">
                                <span class="flex items-center justify-center rounded-full bg-[#FDFDFC] dark:bg-[#161615] shadow-[0px_0px_1px_0px_rgba(0,0,0,0.03),0px_1px_2px_0px_rgba(0,0,0,0.06)] w-3.5 h-3.5 border dark:border-[#3E3E3A] border-[#e3e3e0]">
                                    <span class="rounded-full bg-[#dbdbd7] dark:bg-[#3E3E3A] w-1.5 h-1.5"></span>
                                </span>
                            </span>
                            <span>
                                Read the
                                <a href="https://laravel.com/docs" target="_blank" class="inline-flex items-center space-x-1 font-medium underline underline-offset-4 text-[#f53003] dark:text-[#FF4433] ml-1">
                                    <span>Documentation</span>
                                    <svg
                                        width="10"
                                        height="11"
                                        viewBox="0 0 10 11"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="w-2.5 h-2.5"
                                    >
                                        <path
                                            d="M7.70833 6.95834V2.79167H3.54167M2.5 8L7.5 3.00001"
                                            stroke="currentColor"
                                            stroke-linecap="square"
                                        />
                                    </svg>
                                </a>
                            </span>
                        </li>
                        <li class="flex items-center gap-4 py-2 relative before:border-l before:border-[#e3e3e0] dark:before:border-[#3E3E3A] before:bottom-1/2 before:top-0 before:left-[0.4rem] before:absolute">
                            <span class="relative py-1 bg-white dark:bg-[#161615]">
                                <span class="flex items-center justify-center rounded-full bg-[#FDFDFC] dark:bg-[#161615] shadow-[0px_0px_1px_0px_rgba(0,0,0,0.03),0px_1px_2px_0px_rgba(0,0,0,0.06)] w-3.5 h-3.5 border dark:border-[#3E3E3A] border-[#e3e3e0]">
                                    <span class="rounded-full bg-[#dbdbd7] dark:bg-[#3E3E3A] w-1.5 h-1.5"></span>
                                </span>
                            </span>
                            <span>
                                Watch video tutorials at
                                <a href="https://laracasts.com" target="_blank" class="inline-flex items-center space-x-1 font-medium underline underline-offset-4 text-[#f53003] dark:text-[#FF4433] ml-1">
                                    <span>Laracasts</span>
                                    <svg
                                        width="10"
                                        height="11"
                                        viewBox="0 0 10 11"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="w-2.5 h-2.5"
                                    >
                                        <path
                                            d="M7.70833 6.95834V2.79167H3.54167M2.5 8L7.5 3.00001"
                                            stroke="currentColor"
                                            stroke-linecap="square"
                                        />
                                    </svg>
                                </a>
                            </span>
                        </li>
                    </ul>
                    <ul class="flex gap-3 text-sm leading-normal">
                        <li>
                            <a href="https://cloud.laravel.com" target="_blank" class="inline-block dark:bg-[#eeeeec] dark:border-[#eeeeec] dark:text-[#1C1C1A] dark:hover:bg-white dark:hover:border-white hover:bg-black hover:border-black px-5 py-1.5 bg-[#1b1b18] rounded-sm border border-black text-white text-sm leading-normal">
                                Deploy now
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="bg-[#fff2f2] dark:bg-[#1D0002] relative lg:-ml-px -mb-px lg:mb-0 rounded-t-lg lg:rounded-t-none lg:rounded-r-lg aspect-[335/376] lg:aspect-auto w-full lg:w-[438px] shrink-0 overflow-hidden">
                    {{-- Laravel Logo --}}
                    <svg class="w-full text-[#F53003] dark:text-[#F61500] transition-all translate-y-0 opacity-100 max-w-none duration-750 starting:opacity-0 starting:translate-y-6" viewBox="0 0 438 104" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.2036 -3H0V102.197H49.5189V86.7187H17.2036V-3Z" fill="currentColor" />
                        <path d="M110.256 41.6337C108.061 38.1275 104.945 35.3731 100.905 33.3681C96.8667 31.3647 92.8016 30.3618 88.7131 30.3618C83.4247 30.3618 78.5885 31.3389 74.201 33.2923C69.8111 35.2456 66.0474 37.928 62.9059 41.3333C59.7643 44.7401 57.3198 48.6726 55.5754 53.1293C53.8287 57.589 52.9572 62.274 52.9572 67.1813C52.9572 72.1925 53.8287 76.8995 55.5754 81.3069C57.3191 85.7173 59.7636 89.6241 62.9059 93.0293C66.0474 96.4361 69.8119 99.1155 74.201 101.069C78.5885 103.022 83.4247 103.999 88.7131 103.999C92.8016 103.999 96.8667 102.997 100.905 100.994C104.945 98.9911 108.061 96.2359 110.256 92.7282V102.195H126.563V32.1642H110.256V41.6337ZM108.76 75.7472C107.762 78.4531 106.366 80.8078 104.572 82.8112C102.776 84.8161 100.606 86.4183 98.0637 87.6206C95.5202 88.823 92.7004 89.4238 89.6103 89.4238C86.5178 89.4238 83.7252 88.823 81.2324 87.6206C78.7388 86.4183 76.5949 84.8161 74.7998 82.8112C73.004 80.8078 71.6319 78.4531 70.6856 75.7472C69.7356 73.0421 69.2644 70.1868 69.2644 67.1821C69.2644 64.1758 69.7356 61.3205 70.6856 58.6154C71.6319 55.9102 73.004 53.5571 74.7998 51.5522C76.5949 49.5495 78.738 47.9451 81.2324 46.7427C83.7252 45.5404 86.5178 44.9396 89.6103 44.9396C92.7012 44.9396 95.5202 45.5404 98.0637 46.7427C100.606 47.9451 102.776 49.5487 104.572 51.5522C106.367 53.5571 107.762 55.9102 108.76 58.6154C109.756 61.3205 110.256 64.1758 110.256 67.1821C110.256 70.1868 109.756 73.0421 108.76 75.7472Z" fill="currentColor" />
                        <path d="M242.805 41.6337C240.611 38.1275 237.494 35.3731 233.455 33.3681C229.416 31.3647 225.351 30.3618 221.262 30.3618C215.974 30.3618 211.138 31.3389 206.75 33.2923C202.36 35.2456 198.597 37.928 195.455 41.3333C192.314 44.7401 189.869 48.6726 188.125 53.1293C186.378 57.589 185.507 62.274 185.507 67.1813C185.507 72.1925 186.378 76.8995 188.125 81.3069C189.868 85.7173 192.313 89.6241 195.455 93.0293C198.597 96.4361 202.361 99.1155 206.75 101.069C211.138 103.022 215.974 103.999 221.262 103.999C225.351 103.999 229.416 102.997 233.455 100.994C237.494 98.9911 240.611 96.2359 242.805 92.7282V102.195H259.112V32.1642H242.805V41.6337ZM241.31 75.7472C240.312 78.4531 238.916 80.8078 237.122 82.8112C235.326 84.8161 233.156 86.4183 230.614 87.6206C228.07 88.823 225.251 89.4238 222.16 89.4238C219.068 89.4238 216.275 88.823 213.782 87.6206C211.289 86.4183 209.145 84.8161 207.35 82.8112C205.554 80.8078 204.182 78.4531 203.236 75.7472C202.286 73.0421 201.814 70.1868 201.814 67.1821C201.814 64.1758 202.286 61.3205 203.236 58.6154C204.182 55.9102 205.554 53.5571 207.35 51.5522C209.145 49.5495 211.288 47.9451 213.782 46.7427C216.275 45.5404 219.068 44.9396 222.16 44.9396C225.251 44.9396 228.07 45.5404 230.614 46.7427C233.156 47.9451 235.326 49.5487 237.122 51.5522C238.917 53.5571 240.312 55.9102 241.31 58.6154C242.306 61.3205 242.806 64.1758 242.806 67.1821C242.805 70.1868 242.305 73.0421 241.31 75.7472Z" fill="currentColor" />
                        <path d="M438 -3H421.694V102.197H438V-3Z" fill="currentColor" />
                        <path d="M139.43 102.197H155.735V48.2834H183.712V32.1665H139.43V102.197Z" fill="currentColor" />
                        <path d="M324.49 32.1665L303.995 85.794L283.498 32.1665H266.983L293.748 102.197H314.242L341.006 32.1665H324.49Z" fill="currentColor" />
                        <path d="M376.571 30.3656C356.603 30.3656 340.797 46.8497 340.797 67.1828C340.797 89.6597 356.094 104 378.661 104C391.29 104 399.354 99.1488 409.206 88.5848L398.189 80.0226C398.183 80.031 389.874 90.9895 377.468 90.9895C363.048 90.9895 356.977 79.3111 356.977 73.269H411.075C413.917 50.1328 398.775 30.3656 376.571 30.3656ZM357.02 61.0967C357.145 59.7487 359.023 43.3761 376.442 43.3761C393.861 43.3761 395.978 59.7464 396.099 61.0967H357.02Z" fill="currentColor" />
                    </svg>

                    {{-- Light Mode 12 SVG --}}
                    <svg class="w-[448px] max-w-none relative -mt-[4.9rem] -ml-8 lg:ml-0 lg:-mt-[6.6rem] dark:hidden" viewBox="0 0 440 376" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M188.263 355.73L188.595 355.73C195.441 348.845 205.766 339.761 219.569 328.477C232.93 317.193 242.978 308.205 249.714 301.511C256.34 294.626 260.867 287.358 263.296 279.708C265.725 272.058 264.565 264.121 259.816 255.896C254.516 246.716 247.062 239.352 237.454 233.805C227.957 228.067 217.908 225.198 207.307 225.198C196.927 225.197 190.136 227.97 186.934 233.516C183.621 238.872 184.726 246.331 190.247 255.894L125.647 255.891C116.371 239.825 112.395 225.481 113.72 212.858C115.265 200.235 121.559 190.481 132.602 183.596C143.754 176.52 158.607 172.982 177.159 172.983C196.594 172.984 215.863 176.523 234.968 183.6C253.961 190.486 271.299 200.241 286.98 212.864C302.661 225.488 315.14 239.833 324.416 255.899C333.03 270.817 336.841 283.918 335.847 295.203C335.075 306.487 331.376 316.336 324.75 324.751C318.346 333.167 308.408 343.494 294.936 355.734L377.094 355.737L405.917 405.656L217.087 405.649L188.263 355.73Z" fill="black" />
                            <path d="M9.11884 226.339L-13.7396 226.338L-42.7286 176.132L43.0733 176.135L175.595 405.649L112.651 405.647L9.11884 226.339Z" fill="black" />
                            <path d="M188.263 355.73L188.595 355.73C195.441 348.845 205.766 339.761 219.569 328.477C232.93 317.193 242.978 308.205 249.714 301.511C256.34 294.626 260.867 287.358 263.296 279.708C265.725 272.058 264.565 264.121 259.816 255.896C254.516 246.716 247.062 239.352 237.454 233.805C227.957 228.067 217.908 225.198 207.307 225.198C196.927 225.197 190.136 227.97 186.934 233.516C183.621 238.872 184.726 246.331 190.247 255.894L125.647 255.891C116.371 239.825 112.395 225.481 113.72 212.858C115.265 200.235 121.559 190.481 132.602 183.596C143.754 176.52 158.607 172.982 177.159 172.983C196.594 172.984 215.863 176.523 234.968 183.6C253.961 190.486 271.299 200.241 286.98 212.864C302.661 225.488 315.14 239.833 324.416 255.899C333.03 270.817 336.841 283.918 335.847 295.203C335.075 306.487 331.376 316.336 324.75 324.751C318.346 333.167 308.408 343.494 294.936 355.734L377.094 355.737L405.917 405.656L217.087 405.649L188.263 355.73Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M9.11884 226.339L-13.7396 226.338L-42.7286 176.132L43.0733 176.135L175.595 405.649L112.651 405.647L9.11884 226.339Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M204.592 327.449L204.923 327.449C211.769 320.564 222.094 311.479 235.897 300.196C249.258 288.912 259.306 279.923 266.042 273.23C272.668 266.345 277.195 259.077 279.624 251.427C282.053 243.777 280.893 235.839 276.145 227.615C270.844 218.435 263.39 211.071 253.782 205.524C244.285 199.786 234.236 196.917 223.635 196.916C213.255 196.916 206.464 199.689 203.262 205.235C199.949 210.59 201.054 218.049 206.575 227.612L141.975 227.61C132.699 211.544 128.723 197.2 130.048 184.577C131.593 171.954 137.887 162.2 148.93 155.315C160.083 148.239 174.935 144.701 193.487 144.702C212.922 144.703 232.192 148.242 251.296 155.319C270.289 162.205 287.627 171.96 303.308 184.583C318.989 197.207 331.468 211.552 340.745 227.618C349.358 242.536 353.169 255.637 352.175 266.921C351.403 278.205 347.704 288.055 341.078 296.47C334.674 304.885 324.736 315.213 311.264 327.453L393.422 327.456L422.246 377.375L233.415 377.368L204.592 327.449Z" fill="#F8B803" />
                            <path d="M25.447 198.058L2.58852 198.057L-26.4005 147.851L59.4015 147.854L191.923 377.368L128.979 377.365L25.447 198.058Z" fill="#F8B803" />
                            <path d="M204.592 327.449L204.923 327.449C211.769 320.564 222.094 311.479 235.897 300.196C249.258 288.912 259.306 279.923 266.042 273.23C272.668 266.345 277.195 259.077 279.624 251.427C282.053 243.777 280.893 235.839 276.145 227.615C270.844 218.435 263.39 211.071 253.782 205.524C244.285 199.786 234.236 196.917 223.635 196.916C213.255 196.916 206.464 199.689 203.262 205.235C199.949 210.59 201.054 218.049 206.575 227.612L141.975 227.61C132.699 211.544 128.723 197.2 130.048 184.577C131.593 171.954 137.887 162.2 148.93 155.315C160.083 148.239 174.935 144.701 193.487 144.702C212.922 144.703 232.192 148.242 251.296 155.319C270.289 162.205 287.627 171.96 303.308 184.583C318.989 197.207 331.468 211.552 340.745 227.618C349.358 242.536 353.169 255.637 352.175 266.921C351.403 278.205 347.704 288.055 341.078 296.47C334.674 304.885 324.736 315.213 311.264 327.453L393.422 327.456L422.246 377.375L233.415 377.368L204.592 327.449Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M25.447 198.058L2.58852 198.057L-26.4005 147.851L59.4015 147.854L191.923 377.368L128.979 377.365L25.447 198.058Z" stroke="#1B1B18" stroke-width="1" />
                        </g>
                        <g style="mix-blend-mode: hard-light" class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.725 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" fill="#F0ACB8" />
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" fill="#F0ACB8" />
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.725 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" stroke="#1B1B18" stroke-width="1" />
                        </g>
                        <g style="mix-blend-mode: plus-darker" class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M230.951 281.792L231.282 281.793C238.128 274.907 248.453 265.823 262.256 254.539C275.617 243.256 285.666 234.267 292.402 227.573C299.027 220.688 303.554 213.421 305.983 205.771C308.412 198.12 307.253 190.183 302.504 181.959C297.203 172.778 289.749 165.415 280.142 159.868C270.645 154.13 260.596 151.26 249.995 151.26C239.615 151.26 232.823 154.033 229.621 159.579C226.309 164.934 227.413 172.393 232.935 181.956L168.335 181.954C159.058 165.888 155.082 151.543 156.407 138.92C157.953 126.298 164.247 116.544 175.289 109.659C186.442 102.583 201.294 99.045 219.846 99.0457C239.281 99.0464 258.551 102.585 277.655 109.663C296.649 116.549 313.986 126.303 329.667 138.927C345.349 151.551 357.827 165.895 367.104 181.961C375.718 196.88 379.528 209.981 378.535 221.265C377.762 232.549 374.063 242.399 367.438 250.814C361.033 259.229 351.095 269.557 337.624 281.796L419.782 281.8L448.605 331.719L259.774 331.712L230.951 281.792Z" fill="#F3BEC7" />
                            <path d="M51.8063 152.402L28.9479 152.401L-0.0411453 102.195L85.7608 102.198L218.282 331.711L155.339 331.709L51.8063 152.402Z" fill="#F3BEC7" />
                            <path d="M230.951 281.792L231.282 281.793C238.128 274.907 248.453 265.823 262.256 254.539C275.617 243.256 285.666 234.267 292.402 227.573C299.027 220.688 303.554 213.421 305.983 205.771C308.412 198.12 307.253 190.183 302.504 181.959C297.203 172.778 289.749 165.415 280.142 159.868C270.645 154.13 260.596 151.26 249.995 151.26C239.615 151.26 232.823 154.033 229.621 159.579C226.309 164.934 227.413 172.393 232.935 181.956L168.335 181.954C159.058 165.888 155.082 151.543 156.407 138.92C157.953 126.298 164.247 116.544 175.289 109.659C186.442 102.583 201.294 99.045 219.846 99.0457C239.281 99.0464 258.551 102.585 277.655 109.663C296.649 116.549 313.986 126.303 329.667 138.927C345.349 151.551 357.827 165.895 367.104 181.961C375.718 196.88 379.528 209.981 378.535 221.265C377.762 232.549 374.063 242.399 367.438 250.814C361.033 259.229 351.095 269.557 337.624 281.796L419.782 281.8L448.605 331.719L259.774 331.712L230.951 281.792Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M51.8063 152.402L28.9479 152.401L-0.0411453 102.195L85.7608 102.198L218.282 331.711L155.339 331.709L51.8063 152.402Z" stroke="#1B1B18" stroke-width="1" />
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M188.467 355.363L188.798 355.363C195.644 348.478 205.969 339.393 219.772 328.11C233.133 316.826 243.181 307.837 249.917 301.144C253.696 297.217 256.792 293.166 259.205 288.991C261.024 285.845 262.455 282.628 263.499 279.341C265.928 271.691 264.768 263.753 260.02 255.529C254.719 246.349 247.265 238.985 237.657 233.438C228.16 227.7 218.111 224.831 207.51 224.83C197.13 224.83 190.339 227.603 187.137 233.149C183.824 238.504 184.929 245.963 190.45 255.527L125.851 255.524C116.574 239.458 112.598 225.114 113.923 212.491C114.615 206.836 116.261 201.756 118.859 197.253C122.061 191.704 126.709 187.03 132.805 183.229C143.958 176.153 158.81 172.615 177.362 172.616C196.797 172.617 216.067 176.156 235.171 183.233C254.164 190.119 271.502 199.874 287.183 212.497C302.864 225.121 315.343 239.466 324.62 255.532C333.233 270.45 337.044 283.551 336.05 294.835C335.46 303.459 333.16 311.245 329.151 318.194C327.915 320.337 326.515 322.4 324.953 324.384C318.549 332.799 308.611 343.127 295.139 355.367L377.297 355.37L406.121 405.289L217.29 405.282L188.467 355.363Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M9.32197 225.972L-13.5365 225.971L-42.5255 175.765L43.2765 175.768L175.798 405.282L112.854 405.279L9.32197 225.972Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M345.247 111.915C329.566 99.2919 312.229 89.5371 293.235 82.6512L235.167 183.228C254.161 190.114 271.498 199.869 287.179 212.492L345.247 111.915Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M382.686 154.964C373.41 138.898 360.931 124.553 345.25 111.93L287.182 212.506C302.863 225.13 315.342 239.475 324.618 255.541L382.686 154.964Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M293.243 82.6472C274.139 75.57 254.869 72.031 235.434 72.0303L177.366 172.607C196.801 172.608 216.071 176.147 235.175 183.224L293.243 82.6472Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M394.118 194.257C395.112 182.973 391.301 169.872 382.688 154.953L324.619 255.53C333.233 270.448 337.044 283.55 336.05 294.834L394.118 194.257Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M235.432 72.0311C216.88 72.0304 202.027 75.5681 190.875 82.6442L132.806 183.221C143.959 176.145 158.812 172.607 177.363 172.608L235.432 72.0311Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M265.59 124.25C276.191 124.251 286.24 127.12 295.737 132.858L237.669 233.435C228.172 227.697 218.123 224.828 207.522 224.827L265.59 124.25Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M295.719 132.859C305.326 138.406 312.78 145.77 318.081 154.95L260.013 255.527C254.712 246.347 247.258 238.983 237.651 233.436L295.719 132.859Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M387.218 217.608C391.227 210.66 393.527 202.874 394.117 194.25L336.049 294.827C335.459 303.451 333.159 311.237 329.15 318.185L387.218 217.608Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M245.211 132.577C248.413 127.03 255.204 124.257 265.584 124.258L207.516 224.835C197.136 224.834 190.345 227.607 187.143 233.154L245.211 132.577Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M318.094 154.945C322.842 163.17 324.002 171.107 321.573 178.757L263.505 279.334C265.934 271.684 264.774 263.746 260.026 255.522L318.094 154.945Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M176.925 96.6737C180.127 91.1249 184.776 86.4503 190.871 82.6499L132.803 183.227C126.708 187.027 122.059 191.702 118.857 197.25L176.925 96.6737Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M387.226 217.606C385.989 219.749 384.59 221.813 383.028 223.797L324.96 324.373C326.522 322.39 327.921 320.326 329.157 318.183L387.226 217.606Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M317.269 188.408C319.087 185.262 320.519 182.045 321.562 178.758L263.494 279.335C262.451 282.622 261.019 285.839 259.201 288.985L317.269 188.408Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M245.208 132.573C241.895 137.928 243 145.387 248.522 154.95L190.454 255.527C184.932 245.964 183.827 238.505 187.14 233.15L245.208 132.573Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M176.93 96.6719C174.331 101.175 172.686 106.255 171.993 111.91L113.925 212.487C114.618 206.831 116.263 201.752 118.862 197.249L176.93 96.6719Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M317.266 188.413C314.853 192.589 311.757 196.64 307.978 200.566L249.91 301.143C253.689 297.216 256.785 293.166 259.198 288.99L317.266 188.413Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M464.198 304.708L435.375 254.789L377.307 355.366L406.13 405.285L464.198 304.708Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M353.209 254.787C366.68 242.548 376.618 232.22 383.023 223.805L324.955 324.382C318.55 332.797 308.612 343.124 295.141 355.364L353.209 254.787Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M435.37 254.787L353.212 254.784L295.144 355.361L377.302 355.364L435.37 254.787Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M183.921 154.947L248.521 154.95L190.453 255.527L125.853 255.524L183.921 154.947Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M171.992 111.914C170.668 124.537 174.643 138.881 183.92 154.947L125.852 255.524C116.575 239.458 112.599 225.114 113.924 212.491L171.992 111.914Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M307.987 200.562C301.251 207.256 291.203 216.244 277.842 227.528L219.774 328.105C233.135 316.821 243.183 307.832 249.919 301.139L307.987 200.562Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M15.5469 75.1797L44.5359 125.386L-13.5321 225.963L-42.5212 175.756L15.5469 75.1797Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M277.836 227.536C264.033 238.82 253.708 247.904 246.862 254.789L188.794 355.366C195.64 348.481 205.965 339.397 219.768 328.113L277.836 227.536Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M275.358 304.706L464.189 304.713L406.12 405.29L217.29 405.283L275.358 304.706Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M44.5279 125.39L67.3864 125.39L9.31834 225.967L-13.5401 225.966L44.5279 125.39Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M101.341 75.1911L233.863 304.705L175.795 405.282L43.2733 175.768L101.341 75.1911ZM15.5431 75.19L-42.525 175.767L43.277 175.77L101.345 75.1932L15.5431 75.19Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M246.866 254.784L246.534 254.784L188.466 355.361L188.798 355.361L246.866 254.784Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M246.539 254.781L275.362 304.701L217.294 405.277L188.471 355.358L246.539 254.781Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M67.3906 125.391L170.923 304.698L112.855 405.275L9.32257 225.967L67.3906 125.391Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M170.921 304.699L233.865 304.701L175.797 405.278L112.853 405.276L170.921 304.699Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                        </g>
                        <g style="mix-blend-mode: hard-light" class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M246.544 254.79L246.875 254.79C253.722 247.905 264.046 238.82 277.849 227.537C291.21 216.253 301.259 207.264 307.995 200.57C314.62 193.685 319.147 186.418 321.577 178.768C324.006 171.117 322.846 163.18 318.097 154.956C312.796 145.775 305.342 138.412 295.735 132.865C286.238 127.127 276.189 124.258 265.588 124.257C255.208 124.257 248.416 127.03 245.214 132.576C241.902 137.931 243.006 145.39 248.528 154.953L183.928 154.951C174.652 138.885 170.676 124.541 172 111.918C173.546 99.2946 179.84 89.5408 190.882 82.6559C202.035 75.5798 216.887 72.0421 235.439 72.0428C254.874 72.0435 274.144 75.5825 293.248 82.6598C312.242 89.5457 329.579 99.3005 345.261 111.924C360.942 124.548 373.421 138.892 382.697 154.958C391.311 169.877 395.121 182.978 394.128 194.262C393.355 205.546 389.656 215.396 383.031 223.811C376.627 232.226 366.688 242.554 353.217 254.794L435.375 254.797L464.198 304.716L275.367 304.709L246.544 254.79Z" fill="#F0ACB8" />
                            <path d="M246.544 254.79L246.875 254.79C253.722 247.905 264.046 238.82 277.849 227.537C291.21 216.253 301.259 207.264 307.995 200.57C314.62 193.685 319.147 186.418 321.577 178.768C324.006 171.117 322.846 163.18 318.097 154.956C312.796 145.775 305.342 138.412 295.735 132.865C286.238 127.127 276.189 124.258 265.588 124.257C255.208 124.257 248.416 127.03 245.214 132.576C241.902 137.931 243.006 145.39 248.528 154.953L183.928 154.951C174.652 138.885 170.676 124.541 172 111.918C173.546 99.2946 179.84 89.5408 190.882 82.6559C202.035 75.5798 216.887 72.0421 235.439 72.0428C254.874 72.0435 274.144 75.5825 293.248 82.6598C312.242 89.5457 329.579 99.3005 345.261 111.924C360.942 124.548 373.421 138.892 382.697 154.958C391.311 169.877 395.121 182.978 394.128 194.262C393.355 205.546 389.656 215.396 383.031 223.811C376.627 232.226 366.688 242.554 353.217 254.794L435.375 254.797L464.198 304.716L275.367 304.709L246.544 254.79Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="round" />
                        </g>
                        <g style="mix-blend-mode: hard-light" class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M67.41 125.402L44.5515 125.401L15.5625 75.1953L101.364 75.1985L233.886 304.712L170.942 304.71L67.41 125.402Z" fill="#F0ACB8" />
                            <path d="M67.41 125.402L44.5515 125.401L15.5625 75.1953L101.364 75.1985L233.886 304.712L170.942 304.71L67.41 125.402Z" stroke="#1B1B18" stroke-width="1" />
                        </g>
                    </svg>

                    {{-- Dark Mode 12 SVG --}}
                    <svg class="w-[448px] max-w-none relative -mt-[4.9rem] -ml-8 lg:ml-0 lg:-mt-[6.6rem] hidden dark:block" viewBox="0 0 440 376" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M188.263 355.73L188.595 355.73C195.441 348.845 205.766 339.761 219.569 328.477C232.93 317.193 242.978 308.205 249.714 301.511C256.34 294.626 260.867 287.358 263.296 279.708C265.725 272.058 264.565 264.121 259.816 255.896C254.516 246.716 247.062 239.352 237.454 233.805C227.957 228.067 217.908 225.198 207.307 225.198C196.927 225.197 190.136 227.97 186.934 233.516C183.621 238.872 184.726 246.331 190.247 255.894L125.647 255.891C116.371 239.825 112.395 225.481 113.72 212.858C115.265 200.235 121.559 190.481 132.602 183.596C143.754 176.52 158.607 172.982 177.159 172.983C196.594 172.984 215.863 176.523 234.968 183.6C253.961 190.486 271.299 200.241 286.98 212.864C302.661 225.488 315.14 239.833 324.416 255.899C333.03 270.817 336.841 283.918 335.847 295.203C335.075 306.487 331.376 316.336 324.75 324.751C318.346 333.167 308.408 343.494 294.936 355.734L377.094 355.737L405.917 405.656L217.087 405.649L188.263 355.73Z" fill="black"/>
                            <path d="M9.11884 226.339L-13.7396 226.338L-42.7286 176.132L43.0733 176.135L175.595 405.649L112.651 405.647L9.11884 226.339Z" fill="black"/>
                            <path d="M188.263 355.73L188.595 355.73C195.441 348.845 205.766 339.761 219.569 328.477C232.93 317.193 242.978 308.205 249.714 301.511C256.34 294.626 260.867 287.358 263.296 279.708C265.725 272.058 264.565 264.121 259.816 255.896C254.516 246.716 247.062 239.352 237.454 233.805C227.957 228.067 217.908 225.198 207.307 225.198C196.927 225.197 190.136 227.97 186.934 233.516C183.621 238.872 184.726 246.331 190.247 255.894L125.647 255.891C116.371 239.825 112.395 225.481 113.72 212.858C115.265 200.235 121.559 190.481 132.602 183.596C143.754 176.52 158.607 172.982 177.159 172.983C196.594 172.984 215.863 176.523 234.968 183.6C253.961 190.486 271.299 200.241 286.98 212.864C302.661 225.488 315.14 239.833 324.416 255.899C333.03 270.817 336.841 283.918 335.847 295.203C335.075 306.487 331.376 316.336 324.75 324.751C318.346 333.167 308.408 343.494 294.936 355.734L377.094 355.737L405.917 405.656L217.087 405.649L188.263 355.73Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M9.11884 226.339L-13.7396 226.338L-42.7286 176.132L43.0733 176.135L175.595 405.649L112.651 405.647L9.11884 226.339Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M204.592 327.449L204.923 327.449C211.769 320.564 222.094 311.479 235.897 300.196C249.258 288.912 259.306 279.923 266.042 273.23C272.668 266.345 277.195 259.077 279.624 251.427C282.053 243.777 280.893 235.839 276.145 227.615C270.844 218.435 263.39 211.071 253.782 205.524C244.285 199.786 234.236 196.917 223.635 196.916C213.255 196.916 206.464 199.689 203.262 205.235C199.949 210.59 201.054 218.049 206.575 227.612L141.975 227.61C132.699 211.544 128.723 197.2 130.048 184.577C131.593 171.954 137.887 162.2 148.93 155.315C160.083 148.239 174.935 144.701 193.487 144.702C212.922 144.703 232.192 148.242 251.296 155.319C270.289 162.205 287.627 171.96 303.308 184.583C318.989 197.207 331.468 211.552 340.745 227.618C349.358 242.536 353.169 255.637 352.175 266.921C351.403 278.205 347.704 288.055 341.078 296.47C334.674 304.885 324.736 315.213 311.264 327.453L393.422 327.456L422.246 377.375L233.415 377.368L204.592 327.449Z" fill="#391800"/>
                            <path d="M25.447 198.058L2.58852 198.057L-26.4005 147.851L59.4015 147.854L191.923 377.368L128.979 377.365L25.447 198.058Z" fill="#391800"/>
                            <path d="M204.592 327.449L204.923 327.449C211.769 320.564 222.094 311.479 235.897 300.196C249.258 288.912 259.306 279.923 266.042 273.23C272.668 266.345 277.195 259.077 279.624 251.427C282.053 243.777 280.893 235.839 276.145 227.615C270.844 218.435 263.39 211.071 253.782 205.524C244.285 199.786 234.236 196.917 223.635 196.916C213.255 196.916 206.464 199.689 203.262 205.235C199.949 210.59 201.054 218.049 206.575 227.612L141.975 227.61C132.699 211.544 128.723 197.2 130.048 184.577C131.593 171.954 137.887 162.2 148.93 155.315C160.083 148.239 174.935 144.701 193.487 144.702C212.922 144.703 232.192 148.242 251.296 155.319C270.289 162.205 287.627 171.96 303.308 184.583C318.989 197.207 331.468 211.552 340.745 227.618C349.358 242.536 353.169 255.637 352.175 266.921C351.403 278.205 347.704 288.055 341.078 296.47C334.674 304.885 324.736 315.213 311.264 327.453L393.422 327.456L422.246 377.375L233.415 377.368L204.592 327.449Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M25.447 198.058L2.58852 198.057L-26.4005 147.851L59.4015 147.854L191.923 377.368L128.979 377.365L25.447 198.058Z" stroke="#FF750F" stroke-width="1"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4" style="mix-blend-mode:hard-light">
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.725 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" fill="#733000"/>
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" fill="#733000"/>
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.725 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" stroke="#FF750F" stroke-width="1"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.726 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" stroke="#FF750F" stroke-width="1"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M188.467 355.363L188.798 355.363C195.644 348.478 205.969 339.393 219.772 328.11C233.133 316.826 243.181 307.837 249.917 301.144C253.696 297.217 256.792 293.166 259.205 288.991C261.024 285.845 262.455 282.628 263.499 279.341C265.928 271.691 264.768 263.753 260.02 255.529C254.719 246.349 247.265 238.985 237.657 233.438C228.16 227.7 218.111 224.831 207.51 224.83C197.13 224.83 190.339 227.603 187.137 233.149C183.824 238.504 184.929 245.963 190.45 255.527L125.851 255.524C116.574 239.458 112.598 225.114 113.923 212.491C114.615 206.836 116.261 201.756 118.859 197.253C122.061 191.704 126.709 187.03 132.805 183.229C143.958 176.153 158.81 172.615 177.362 172.616C196.797 172.617 216.067 176.156 235.171 183.233C254.164 190.119 271.502 199.874 287.183 212.497C302.864 225.121 315.343 239.466 324.62 255.532C333.233 270.45 337.044 283.551 336.05 294.835C335.46 303.459 333.16 311.245 329.151 318.194C327.915 320.337 326.515 322.4 324.953 324.384C318.549 332.799 308.611 343.127 295.139 355.367L377.297 355.37L406.121 405.289L217.29 405.282L188.467 355.363Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M9.32197 225.972L-13.5365 225.971L-42.5255 175.765L43.2765 175.768L175.798 405.282L112.854 405.279L9.32197 225.972Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M345.247 111.915C329.566 99.2919 312.229 89.5371 293.235 82.6512L235.167 183.228C254.161 190.114 271.498 199.869 287.179 212.492L345.247 111.915Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M382.686 154.964C373.41 138.898 360.931 124.553 345.25 111.93L287.182 212.506C302.863 225.13 315.342 239.475 324.618 255.541L382.686 154.964Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M293.243 82.6472C274.139 75.57 254.869 72.031 235.434 72.0303L177.366 172.607C196.801 172.608 216.071 176.147 235.175 183.224L293.243 82.6472Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M394.118 194.257C395.112 182.973 391.301 169.872 382.688 154.953L324.619 255.53C333.233 270.448 337.044 283.55 336.05 294.834L394.118 194.257Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M235.432 72.0311C216.88 72.0304 202.027 75.5681 190.875 82.6442L132.806 183.221C143.959 176.145 158.812 172.607 177.363 172.608L235.432 72.0311Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M265.59 124.25C276.191 124.251 286.24 127.12 295.737 132.858L237.669 233.435C228.172 227.697 218.123 224.828 207.522 224.827L265.59 124.25Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M295.719 132.859C305.326 138.406 312.78 145.77 318.081 154.95L260.013 255.527C254.712 246.347 247.258 238.983 237.651 233.436L295.719 132.859Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M387.218 217.608C391.227 210.66 393.527 202.874 394.117 194.25L336.049 294.827C335.459 303.451 333.159 311.237 329.15 318.185L387.218 217.608Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M245.211 132.577C248.413 127.03 255.204 124.257 265.584 124.258L207.516 224.835C197.136 224.834 190.345 227.607 187.143 233.154L245.211 132.577Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M318.094 154.945C322.842 163.17 324.002 171.107 321.573 178.757L263.505 279.334C265.934 271.684 264.774 263.746 260.026 255.522L318.094 154.945Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M176.925 96.6737C180.127 91.1249 184.776 86.4503 190.871 82.6499L132.803 183.227C126.708 187.027 122.059 191.702 118.857 197.25L176.925 96.6737Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M387.226 217.606C385.989 219.749 384.59 221.813 383.028 223.797L324.96 324.373C326.522 322.39 327.921 320.326 329.157 318.183L387.226 217.606Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M317.269 188.408C319.087 185.262 320.519 182.045 321.562 178.758L263.494 279.335C262.451 282.622 261.019 285.839 259.201 288.985L317.269 188.408Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M245.208 132.573C241.895 137.928 243 145.387 248.522 154.95L190.454 255.527C184.932 245.964 183.827 238.505 187.14 233.15L245.208 132.573Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M176.93 96.6719C174.331 101.175 172.686 106.255 171.993 111.91L113.925 212.487C114.618 206.831 116.263 201.752 118.862 197.249L176.93 96.6719Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M317.266 188.413C314.853 192.589 311.757 196.64 307.978 200.566L249.91 301.143C253.689 297.216 256.785 293.166 259.198 288.99L317.266 188.413Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M464.198 304.708L435.375 254.789L377.307 355.366L406.13 405.285L464.198 304.708Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M353.209 254.787C366.68 242.548 376.618 232.22 383.023 223.805L324.955 324.382C318.55 332.797 308.612 343.124 295.141 355.364L353.209 254.787Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M435.37 254.787L353.212 254.784L295.144 355.361L377.302 355.364L435.37 254.787Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M183.921 154.947L248.521 154.95L190.453 255.527L125.853 255.524L183.921 154.947Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M171.992 111.914C170.668 124.537 174.643 138.881 183.92 154.947L125.852 255.524C116.575 239.458 112.599 225.114 113.924 212.491L171.992 111.914Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M307.987 200.562C301.251 207.256 291.203 216.244 277.842 227.528L219.774 328.105C233.135 316.821 243.183 307.832 249.919 301.139L307.987 200.562Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M15.5469 75.1797L44.5359 125.386L-13.5321 225.963L-42.5212 175.756L15.5469 75.1797Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M277.836 227.536C264.033 238.82 253.708 247.904 246.862 254.789L188.794 355.366C195.64 348.481 205.965 339.397 219.768 328.113L277.836 227.536Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M275.358 304.706L464.189 304.713L406.12 405.29L217.29 405.283L275.358 304.706Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M44.5279 125.39L67.3864 125.39L9.31834 225.967L-13.5401 225.966L44.5279 125.39Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M101.341 75.1911L233.863 304.705L175.795 405.282L43.2733 175.768L101.341 75.1911ZM15.5431 75.19L-42.525 175.767L43.277 175.77L101.345 75.1932L15.5431 75.19Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M246.866 254.784L246.534 254.784L188.466 355.361L188.798 355.361L246.866 254.784Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M246.539 254.781L275.362 304.701L217.294 405.277L188.471 355.358L246.539 254.781Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M67.3906 125.391L170.923 304.698L112.855 405.275L9.32257 225.967L67.3906 125.391Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M170.921 304.699L233.865 304.701L175.797 405.278L112.853 405.276L170.921 304.699Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4" style="mix-blend-mode:hard-light">
                            <path d="M246.544 254.79L246.875 254.79C253.722 247.905 264.046 238.82 277.849 227.537C291.21 216.253 301.259 207.264 307.995 200.57C314.62 193.685 319.147 186.418 321.577 178.768C324.006 171.117 322.846 163.18 318.097 154.956C312.796 145.775 305.342 138.412 295.735 132.865C286.238 127.127 276.189 124.258 265.588 124.257C255.208 124.257 248.416 127.03 245.214 132.576C241.902 137.931 243.006 145.39 248.528 154.953L183.928 154.951C174.652 138.885 170.676 124.541 172 111.918C173.546 99.2946 179.84 89.5408 190.882 82.6559C202.035 75.5798 216.887 72.0421 235.439 72.0428C254.874 72.0435 274.144 75.5825 293.248 82.6598C312.242 89.5457 329.579 99.3005 345.261 111.924C360.942 124.548 373.421 138.892 382.697 154.958C391.311 169.877 395.121 182.978 394.128 194.262C393.355 205.546 389.656 215.396 383.031 223.811C376.627 232.226 366.688 242.554 353.217 254.794L435.375 254.797L464.198 304.716L275.367 304.709L246.544 254.79Z" fill="#4B0600"/>
                            <path d="M246.544 254.79L246.875 254.79C253.722 247.905 264.046 238.82 277.849 227.537C291.21 216.253 301.259 207.264 307.995 200.57C314.62 193.685 319.147 186.418 321.577 178.768C324.006 171.117 322.846 163.18 318.097 154.956C312.796 145.775 305.342 138.412 295.735 132.865C286.238 127.127 276.189 124.258 265.588 124.257C255.208 124.257 248.416 127.03 245.214 132.576C241.902 137.931 243.006 145.39 248.528 154.953L183.928 154.951C174.652 138.885 170.676 124.541 172 111.918C173.546 99.2946 179.84 89.5408 190.882 82.6559C202.035 75.5798 216.887 72.0421 235.439 72.0428C254.874 72.0435 274.144 75.5825 293.248 82.6598C312.242 89.5457 329.579 99.3005 345.261 111.924C360.942 124.548 373.421 138.892 382.697 154.958C391.311 169.877 395.121 182.978 394.128 194.262C393.355 205.546 389.656 215.396 383.031 223.811C376.627 232.226 366.688 242.554 353.217 254.794L435.375 254.797L464.198 304.716L275.367 304.709L246.544 254.79Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="round"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4" style="mix-blend-mode:hard-light">
                            <path d="M67.41 125.402L44.5515 125.401L15.5625 75.1953L101.364 75.1985L233.886 304.712L170.942 304.71L67.41 125.402Z" fill="#4B0600"/>
                            <path d="M67.41 125.402L44.5515 125.401L15.5625 75.1953L101.364 75.1985L233.886 304.712L170.942 304.71L67.41 125.402Z" stroke="#FF750F" stroke-width="1"/>
                        </g>
                    </svg>
                    <div class="absolute inset-0 rounded-t-lg lg:rounded-t-none lg:rounded-r-lg shadow-[inset_0px_0px_0px_1px_rgba(26,26,0,0.16)] dark:shadow-[inset_0px_0px_0px_1px_#fffaed2d]"></div>
                </div>
            </main>
        </div>

        @if (Route::has('login'))
            <div class="h-14.5 hidden lg:block"></div>
        @endif
    </body>
</html>
</file>

<file path="routes/api.php">
<?php
// FILE: routes/api.php

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\Api\ProductController;

/*
|--------------------------------------------------------------------------
| API Routes
|--------------------------------------------------------------------------
*/

Route::middleware('auth:sanctum')->get('/user', function (Request $request) {
    return $request->user();
});

// ÐŸÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð° (Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹ TenantMiddleware Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾ Ð² bootstrap/app.php)
Route::prefix('products')->group(function () {
    Route::get('/', [ProductController::class, 'index']);
    Route::get('/search', [ProductController::class, 'search']);
    Route::get('/{id}', [ProductController::class, 'show']);
});
</file>

<file path="routes/console.php">
<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');
</file>

<file path="storage/tenants/designer_hub/cache/.gitignore">
*
!.gitignore
</file>

<file path="storage/tenants/designer_hub/logs/.gitignore">
*
!.gitignore
</file>

<file path="storage/tenants/designer_hub/media/.gitignore">
*
!.gitignore
</file>

<file path="storage/tenants/military_gear/cache/.gitignore">
*
!.gitignore
</file>

<file path="storage/tenants/military_gear/logs/.gitignore">
*
!.gitignore
</file>

<file path="storage/tenants/military_gear/media/.gitignore">
*
!.gitignore
</file>

<file path="storage/tenants/street_style/cache/.gitignore">
*
!.gitignore
</file>

<file path="storage/tenants/street_style/logs/.gitignore">
*
!.gitignore
</file>

<file path="storage/tenants/street_style/media/.gitignore">
*
!.gitignore
</file>

<file path="tests/Feature/ExampleTest.php">
<?php

namespace Tests\Feature;

// use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     */
    public function test_the_application_returns_a_successful_response(): void
    {
        $response = $this->get('/');

        $response->assertStatus(200);
    }
}
</file>

<file path="tests/Unit/ExampleTest.php">
<?php

namespace Tests\Unit;

use PHPUnit\Framework\TestCase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     */
    public function test_that_true_is_true(): void
    {
        $this->assertTrue(true);
    }
}
</file>

<file path="tests/TestCase.php">
<?php

namespace Tests;

use Illuminate\Foundation\Testing\TestCase as BaseTestCase;

abstract class TestCase extends BaseTestCase
{
    //
}
</file>

<file path=".editorconfig">
root = true

[*]
charset = utf-8
end_of_line = lf
indent_size = 4
indent_style = space
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false

[*.{yml,yaml}]
indent_size = 2

[compose.yaml]
indent_size = 4
</file>

<file path=".env.example">
APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

APP_MAINTENANCE_DRIVER=file
# APP_MAINTENANCE_STORE=database

# PHP_CLI_SERVER_WORKERS=4

BCRYPT_ROUNDS=12

LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=sqlite
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=laravel
# DB_USERNAME=root
# DB_PASSWORD=

SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local
QUEUE_CONNECTION=database

CACHE_STORE=database
# CACHE_PREFIX=

MEMCACHED_HOST=127.0.0.1

REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=log
MAIL_SCHEME=null
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

VITE_APP_NAME="${APP_NAME}"
</file>

<file path=".gitattributes">
* text=auto eol=lf

*.blade.php diff=html
*.css diff=css
*.html diff=html
*.md diff=markdown
*.php diff=php

/.github export-ignore
CHANGELOG.md export-ignore
.styleci.yml export-ignore
</file>

<file path="artisan">
#!/usr/bin/env php
<?php

use Illuminate\Foundation\Application;
use Symfony\Component\Console\Input\ArgvInput;

define('LARAVEL_START', microtime(true));

// Register the Composer autoloader...
require __DIR__.'/vendor/autoload.php';

// Bootstrap Laravel and handle the command...
/** @var Application $app */
$app = require_once __DIR__.'/bootstrap/app.php';

$status = $app->handleCommand(new ArgvInput);

exit($status);
</file>

<file path="composer.json">
{
    "$schema": "https://getcomposer.org/schema.json",
    "name": "laravel/laravel",
    "type": "project",
    "description": "The skeleton application for the Laravel framework.",
    "keywords": [
        "laravel",
        "framework"
    ],
    "license": "MIT",
    "require": {
        "php": "^8.2",
        "laravel/framework": "^12.0",
        "laravel/tinker": "^2.10.1"
    },
    "require-dev": {
        "fakerphp/faker": "^1.23",
        "laravel/pail": "^1.2.2",
        "laravel/pint": "^1.24",
        "laravel/sail": "^1.41",
        "mockery/mockery": "^1.6",
        "nunomaduro/collision": "^8.6",
        "phpunit/phpunit": "^11.5.3"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Database\\Factories\\": "database/factories/",
            "Database\\Seeders\\": "database/seeders/"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "Tests\\": "tests/"
        }
    },
    "scripts": {
        "setup": [
            "composer install",
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\"",
            "@php artisan key:generate",
            "@php artisan migrate --force",
            "npm install",
            "npm run build"
        ],
        "dev": [
            "Composer\\Config::disableProcessTimeout",
            "npx concurrently -c \"#93c5fd,#c4b5fd,#fb7185,#fdba74\" \"php artisan serve\" \"php artisan queue:listen --tries=1\" \"php artisan pail --timeout=0\" \"npm run dev\" --names=server,queue,logs,vite --kill-others"
        ],
        "test": [
            "@php artisan config:clear --ansi",
            "@php artisan test"
        ],
        "post-autoload-dump": [
            "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",
            "@php artisan package:discover --ansi"
        ],
        "post-update-cmd": [
            "@php artisan vendor:publish --tag=laravel-assets --ansi --force"
        ],
        "post-root-package-install": [
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\""
        ],
        "post-create-project-cmd": [
            "@php artisan key:generate --ansi",
            "@php -r \"file_exists('database/database.sqlite') || touch('database/database.sqlite');\"",
            "@php artisan migrate --graceful --ansi"
        ],
        "pre-package-uninstall": [
            "Illuminate\\Foundation\\ComposerScripts::prePackageUninstall"
        ]
    },
    "extra": {
        "laravel": {
            "dont-discover": []
        }
    },
    "config": {
        "optimize-autoloader": true,
        "preferred-install": "dist",
        "sort-packages": true,
        "allow-plugins": {
            "pestphp/pest-plugin": true,
            "php-http/discovery": true
        }
    },
    "minimum-stability": "stable",
    "prefer-stable": true
}
</file>

<file path="full_reset.sh">
#!/bin/bash
# FILE: full_reset.sh

echo "âš ï¸  WARNING: This will DESTROY all data in databases and storage!"
echo "âš ï¸  Make sure you have configured /etc/hosts as per MANUAL.md"
read -p "Press [Enter] to continue or Ctrl+C to abort..."

# 1. ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ°
echo "ðŸ›‘ Stopping containers and removing volumes..."
docker compose down -v
# Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ñ„Ð°Ð¹Ð»Ñ‹ ÑÐµÑÑÐ¸Ð¹ Ð¸ ÐºÑÑˆÐ°, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¼Ð¾Ð³Ð»Ð¸ Ð±Ñ‹Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ñ Ð¿Ñ€Ð°Ð²Ð°Ð¼Ð¸ root
sudo rm -rf storage/framework/sessions/*
sudo rm -rf storage/framework/views/*
sudo rm -rf storage/framework/cache/*
sudo rm -rf storage/tenants
sudo rm -rf public/tenants

# 2. ÐŸÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ° Ð¸ Ð·Ð°Ð¿ÑƒÑÐº
echo "ðŸ—  Building and starting containers..."
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° max_map_count Ð´Ð»Ñ Elastic (Ñ‡Ð°ÑÑ‚Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°)
if [ "$(sysctl -n vm.max_map_count)" -lt 262144 ]; then
    echo "âŒ vm.max_map_count is too low for Elasticsearch."
    echo "ðŸ‘‰ Run: sudo sysctl -w vm.max_map_count=262144"
    exit 1
fi

docker compose up -d --build

echo "â³ Waiting for Database to initialize (15 seconds)..."
sleep 15

# 3. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
echo "ðŸ“¦ Installing Composer dependencies..."
docker compose exec app composer install

# 4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
echo "ðŸ”‘ Generating Application Key..."
docker compose exec app php artisan key:generate

echo "ðŸ”— Linking Storage..."
# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ Ð»Ð¸Ð½Ðº public/storage
docker compose exec app php artisan storage:link
# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð»Ð¸Ð½ÐºÐ¸ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð² public/tenants/{id}
docker compose exec app php artisan tenants:link

# 5. ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÐºÑÑˆÐ° (Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³Ð¾Ð² Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð²)
echo "ðŸ§¹ Clearing caches..."
docker compose exec app php artisan optimize:clear

# 6. ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð¸ ÐŸÐ¾ÑÐµÐ² (Ð¡ÐÐœÐžÐ• Ð’ÐÐ–ÐÐžÐ•)
echo "ðŸŒ± Migrating and Seeding (Public + Tenants)..."
# Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ: Ð·Ð´ÐµÑÑŒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð½Ð°ÑˆÐ° Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ
# ÑÐ½Ð°Ñ‡Ð°Ð»Ð° ÑÐµÐµÑ‚ Public (ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ ÐÐ´Ð¼Ð¸Ð½Ð°), Ð° Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñ‹.
docker compose exec app php artisan tenants:migrate --fresh --seed

echo "âœ… DONE! System is ready."
echo "ðŸ‘‰ Admin Panel: http://admin.trishop.local"
</file>

<file path="package.json">
{
    "$schema": "https://www.schemastore.org/package.json",
    "private": true,
    "type": "module",
    "scripts": {
        "build": "vite build",
        "dev": "vite"
    },
    "devDependencies": {
        "@tailwindcss/vite": "^4.0.0",
        "axios": "^1.11.0",
        "concurrently": "^9.0.1",
        "laravel-vite-plugin": "^2.0.0",
        "tailwindcss": "^4.0.0",
        "vite": "^7.0.7"
    }
}
</file>

<file path="phpunit.xml">
<?xml version="1.0" encoding="UTF-8"?>
<phpunit xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="vendor/phpunit/phpunit/phpunit.xsd"
         bootstrap="vendor/autoload.php"
         colors="true"
>
    <testsuites>
        <testsuite name="Unit">
            <directory>tests/Unit</directory>
        </testsuite>
        <testsuite name="Feature">
            <directory>tests/Feature</directory>
        </testsuite>
    </testsuites>
    <source>
        <include>
            <directory>app</directory>
        </include>
    </source>
    <php>
        <env name="APP_ENV" value="testing"/>
        <env name="APP_MAINTENANCE_DRIVER" value="file"/>
        <env name="BCRYPT_ROUNDS" value="4"/>
        <env name="BROADCAST_CONNECTION" value="null"/>
        <env name="CACHE_STORE" value="array"/>
        <env name="DB_DATABASE" value="testing"/>
        <env name="MAIL_MAILER" value="array"/>
        <env name="QUEUE_CONNECTION" value="sync"/>
        <env name="SESSION_DRIVER" value="array"/>
        <env name="PULSE_ENABLED" value="false"/>
        <env name="TELESCOPE_ENABLED" value="false"/>
        <env name="NIGHTWATCH_ENABLED" value="false"/>
    </php>
</phpunit>
</file>

<file path="setup_structure.sh">
#!/bin/bash
# FILE: setup_structure.sh

echo "Starting directory structure setup for Multi-Tenant E-commerce..."

# Define tenants
TENANTS=("street_style" "designer_hub" "military_gear")
SUBFOLDERS=("media" "logs" "cache")

# Base storage path
STORAGE_PATH="storage/tenants"

# Create directories
for tenant in "${TENANTS[@]}"; do
    for folder in "${SUBFOLDERS[@]}"; do
        FULL_PATH="$STORAGE_PATH/$tenant/$folder"
        if [ ! -d "$FULL_PATH" ]; then
            mkdir -p "$FULL_PATH"
            echo "Created: $FULL_PATH"
        else
            echo "Exists: $FULL_PATH"
        fi
        
        # Create .gitignore to keep folder structure but ignore content (except .gitignore)
        touch "$FULL_PATH/.gitignore"
        echo "*" > "$FULL_PATH/.gitignore"
        echo "!.gitignore" >> "$FULL_PATH/.gitignore"
    done
done

# Set permissions
# We assume the script is run by the user who owns the files on host.
# Inside Docker, 'www' user (uid 1000) needs access.
# Usually chmod 775 or 777 is needed for storage in dev environments to avoid permission denied.

echo "Setting permissions..."
chmod -R 777 storage/
chmod -R 777 bootstrap/cache/

echo "Structure setup complete."
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite';
import laravel from 'laravel-vite-plugin';
import tailwindcss from '@tailwindcss/vite';

export default defineConfig({
    plugins: [
        laravel({
            input: ['resources/css/app.css', 'resources/js/app.js'],
            refresh: true,
        }),
        tailwindcss(),
    ],
    server: {
        watch: {
            ignored: ['**/storage/framework/views/**'],
        },
    },
});
</file>

<file path="app/Http/Controllers/Admin/AttributeController.php">
<?php
// FILE: app/Http/Controllers/Admin/AttributeController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\AttributeOption;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Str;

class AttributeController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function resolveContext(Request $request)
    {
        if (auth()->user()->role !== 'super_admin') {
            return $this->tenantService->getCurrentTenantId();
        }
        // Ð”ÐµÑ„Ð¾Ð»Ñ‚ Ð´Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½Ð°
        $tenantId = $request->tenant_id ?? array_key_first(config('tenants.tenants'));
        if ($tenantId) $this->tenantService->switchTenant($tenantId);
        return $tenantId;
    }

    public function index(Request $request)
    {
        $currentTenantId = $this->resolveContext($request);
        
        $query = AttributeOption::query();
        if ($request->filled('search')) {
            $query->where('value', 'ilike', "%{$request->search}%");
        }

        $attributes = $query->get()->groupBy('type');
        
        return view('admin.attributes.index', compact('attributes', 'currentTenantId'));
    }

    public function store(Request $request)
    {
        $this->resolveContext($request);
        
        $validated = $request->validate([
            'type' => 'required|string|in:size,product_type,material',
            'value' => 'required|string|max:255',
        ]);

        AttributeOption::firstOrCreate(
            ['type' => $validated['type'], 'value' => $validated['value']],
            ['slug' => Str::slug($validated['value'])]
        );

        return back()->with('success', 'Attribute added.');
    }

    // Ð’ÐÐ–ÐÐž: ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ $id, Ð¸ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¶Ð´Ð°Ñ‚ÑŒ {id}
    public function destroy(Request $request, $id)
    {
        $this->resolveContext($request);
        AttributeOption::destroy($id);
        return back()->with('success', 'Attribute deleted.');
    }
}
</file>

<file path="app/Http/Controllers/Admin/DashboardController.php">
<?php
// FILE: app/Http/Controllers/Admin/DashboardController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Order;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Collection;

class DashboardController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    public function index(Request $request)
    {
        $user = auth()->user();
        $isSuperAdmin = $user->role === 'super_admin';
        
        $currentTenantId = null;

        if ($isSuperAdmin) {
            if ($request->has('tenant_id')) {
                $currentTenantId = $request->tenant_id;
            } elseif (session()->has('admin_current_tenant_id')) {
                $currentTenantId = session('admin_current_tenant_id');
            }
            if ($currentTenantId === 'root') $currentTenantId = null;
        } else {
            $currentTenantId = $this->tenantService->getCurrentTenantId();
        }

        $stats = [
            'total_orders' => 0,
            'total_revenue' => 0,
            'recent_orders' => new Collection(),
            'tenant_name' => $currentTenantId ? config("tenants.tenants.$currentTenantId.name") : 'All Shops (Global Overview)'
        ];

        if ($currentTenantId) {
            // --- Ð Ð•Ð–Ð˜Ðœ ÐžÐ”ÐÐžÐ“Ðž ÐœÐÐ“ÐÐ—Ð˜ÐÐ ---
            $this->tenantService->switchTenant($currentTenantId);
            
            $stats['total_orders'] = Order::count();
            $stats['total_revenue'] = Order::sum('total_amount');
            
            $recent = Order::latest()->take(5)->get();
            $storeName = config("tenants.tenants.$currentTenantId.name");
            $recent->each(fn($o) => $o->store_name = $storeName);
            
            $stats['recent_orders'] = $recent;

        } elseif ($isSuperAdmin) {
            // --- Ð“Ð›ÐžÐ‘ÐÐ›Ð¬ÐÐ«Ð™ Ð Ð•Ð–Ð˜Ðœ ---
            $allOrders = []; // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¼Ð°ÑÑÐ¸Ð², Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð° ID

            foreach (config('tenants.tenants') as $id => $config) {
                try {
                    $this->tenantService->switchTenant($id);
                    
                    $stats['total_orders'] += Order::count();
                    $stats['total_revenue'] += Order::sum('total_amount');
                    
                    // Ð‘ÐµÑ€ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 5 Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
                    $orders = Order::latest()->take(5)->get();
                    
                    foreach ($orders as $order) {
                        $order->store_name = $config['name'];
                        $order->tenant_id = $id;
                        $allOrders[] = $order; // ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð² Ð¼Ð°ÑÑÐ¸Ð²
                    }
                } catch (\Exception $e) {
                    continue;
                }
            }
            
            // ÐŸÑ€ÐµÐ²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð² ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ, ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ Ð¸ Ð±ÐµÑ€ÐµÐ¼ Ñ‚Ð¾Ð¿-5
            $stats['recent_orders'] = collect($allOrders)->sortByDesc('created_at')->take(5);
        }

        return view('admin.dashboard', compact('stats', 'currentTenantId'));
    }
}
</file>

<file path="app/Http/Controllers/Admin/OrderController.php">
<?php
// FILE: app/Http/Controllers/Admin/OrderController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Order;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Collection;
use Illuminate\Pagination\LengthAwarePaginator;

class OrderController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function resolveContext(Request $request)
    {
        if (auth()->user()->role === 'super_admin') {
            $tenantId = $request->get('tenant_id');
            // Ð•ÑÐ»Ð¸ tenant_id Ð¿ÐµÑ€ÐµÐ´Ð°Ð½ ÐºÐ°Ðº Ð¿ÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° (Ð¸Ð· Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð° "All Shops"), ÑÑ‡Ð¸Ñ‚Ð°ÐµÐ¼ ÑÑ‚Ð¾ null
            return $tenantId ?: null;
        }
        return $this->tenantService->getCurrentTenantId();
    }

    public function index(Request $request)
    {
        $currentTenantId = $this->resolveContext($request);
        $isSuperAdmin = auth()->user()->role === 'super_admin';
        $orders = new Collection();

        if ($isSuperAdmin && !$currentTenantId) {
            // --- Ð“Ð›ÐžÐ‘ÐÐ›Ð¬ÐÐ«Ð™ Ð Ð•Ð–Ð˜Ðœ: Ð¡ÐžÐ‘Ð˜Ð ÐÐ•Ðœ Ð¡Ðž Ð’Ð¡Ð•Ð¥ ÐœÐÐ“ÐÐ—Ð˜ÐÐžÐ’ ---
            foreach (config('tenants.tenants') as $id => $config) {
                try {
                    $this->tenantService->switchTenant($id);
                    $query = Order::query();

                    if ($request->filled('search')) {
                        $query->where(function($q) use ($request) {
                            $q->where('order_number', 'like', "%{$request->search}%")
                              ->orWhere('customer_phone', 'like', "%{$request->search}%");
                        });
                    }

                    if ($request->filled('status')) {
                        $query->where('status', $request->status);
                    }

                    // Ð‘ÐµÑ€ÐµÐ¼ Ð¿Ð¾ 20 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
                    $storeOrders = $query->latest()->take(20)->get();
                    
                    // ÐŸÐ¾Ð¼ÐµÑ‡Ð°ÐµÐ¼, Ð¾Ñ‚ÐºÑƒÐ´Ð° Ð·Ð°ÐºÐ°Ð·
                    $storeOrders->each(function($o) use ($config, $id) {
                        $o->tenant_name = $config['name'];
                        $o->tenant_id = $id; 
                    });
                    
                    $orders = $orders->merge($storeOrders);
                } catch (\Exception $e) { continue; }
            }

            // Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ð±Ñ‰Ð¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ
            $orders = $orders->sortByDesc('created_at');

            // Ð ÑƒÑ‡Ð½Ð°Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸
            $page = $request->get('page', 1);
            $perPage = 20;
            $orders = new LengthAwarePaginator(
                $orders->forPage($page, $perPage),
                $orders->count(),
                $perPage,
                $page,
                ['path' => $request->url(), 'query' => $request->query()]
            );

        } else {
            // --- ÐžÐ‘Ð«Ð§ÐÐ«Ð™ Ð Ð•Ð–Ð˜Ðœ (ÐžÐ”Ð˜Ð ÐœÐÐ“ÐÐ—Ð˜Ð) ---
            if ($currentTenantId) {
                $this->tenantService->switchTenant($currentTenantId);
            }
            
            $query = Order::query();

            if ($request->filled('search')) {
                $query->where(function($q) use ($request) {
                    $q->where('order_number', 'like', "%{$request->search}%")
                      ->orWhere('customer_phone', 'like', "%{$request->search}%");
                });
            }

            if ($request->filled('status')) {
                $query->where('status', $request->status);
            }

            $orders = $query->latest()->paginate(20);
        }

        return view('admin.orders.index', compact('orders', 'currentTenantId'));
    }

    public function show(Request $request, $id)
    {
        // Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð·Ð°ÐºÐ°Ð·Ð° Ð½Ð°Ð¼ ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž Ð½ÑƒÐ¶Ð½Ð¾ Ð·Ð½Ð°Ñ‚ÑŒ, Ð² ÐºÐ°ÐºÐ¾Ð¹ Ð¾Ð½ Ð±Ð°Ð·Ðµ.
        // Ð•ÑÐ»Ð¸ tenant_id Ð¿Ñ€Ð¸ÑˆÐµÐ» Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ (Ð¸Ð· Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹), Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐµÐ³Ð¾.
        $tenantId = $request->get('tenant_id') ?? $this->resolveContext($request);
        
        if (!$tenantId && auth()->user()->role === 'super_admin') {
            // Ð•ÑÐ»Ð¸ ÑÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½ Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð· Ð±ÐµÐ· ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°, ÑÑ‚Ð¾ Ð¾ÑˆÐ¸Ð±ÐºÐ°,
            // Ð½Ð¾ Ð¼Ñ‹ Ð¼Ð¾Ð¶ÐµÐ¼ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°Ð¹Ñ‚Ð¸ Ð·Ð°ÐºÐ°Ð· Ð¿ÐµÑ€ÐµÐ±Ð¾Ñ€Ð¾Ð¼ (Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾, Ð½Ð¾ Ð½Ð°Ð´ÐµÐ¶Ð½Ð¾)
            foreach (config('tenants.tenants') as $tid => $tconfig) {
                $this->tenantService->switchTenant($tid);
                $order = Order::with('items')->find($id);
                if ($order) {
                    $tenantId = $tid;
                    break;
                }
            }
        } else {
             $this->tenantService->switchTenant($tenantId);
        }

        $order = Order::with('items')->findOrFail($id);
        
        return view('admin.orders.show', compact('order'));
    }

    public function update(Request $request, $id)
    {
        // ÐÐ½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾ show, Ð½Ð°Ð¼ Ð½ÑƒÐ¶ÐµÐ½ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚
        $tenantId = $request->get('tenant_id') ?? $this->resolveContext($request);
        $this->tenantService->switchTenant($tenantId);

        $order = Order::findOrFail($id);

        $validated = $request->validate([
            'status' => 'required|in:new,processing,shipped,completed,cancelled'
        ]);

        $order->update(['status' => $validated['status']]);

        return back()->with('success', "Order status updated to {$validated['status']}.");
    }
}
</file>

<file path="app/Http/Controllers/Admin/SettingsController.php">
<?php
// FILE: app/Http/Controllers/Admin/SettingsController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Models\TelegramConfig; // Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ñ‚ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼Ð°

class SettingsController extends Controller
{
    private function checkSuperAdmin()
    {
        if (auth()->user()->role !== 'super_admin') {
            abort(403, 'Access denied.');
        }
    }

    public function index()
    {
        $this->checkSuperAdmin();

        // Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Telegram Ð²ÐºÐ»Ð°Ð´ÐºÐ¸
        $telegramConfigs = TelegramConfig::all();
        $tenants = config('tenants.tenants');

        return view('admin.settings.index', compact('telegramConfigs', 'tenants'));
    }

    // ÐœÐµÑ‚Ð¾Ð´ Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÐžÐ‘Ð©Ð˜Ð¥ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº (Ð·Ð°Ð³Ð»ÑƒÑˆÐºÐ° Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°)
    public function update(Request $request)
    {
        $this->checkSuperAdmin();
        // Ð—Ð´ÐµÑÑŒ Ð»Ð¾Ð³Ð¸ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ ÑÐ°Ð¹Ñ‚Ð°, Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð° Ð¸ Ñ‚.Ð´.
        // ...
        return back()->with('success', 'General settings updated.');
    }
}
</file>

<file path="app/Http/Controllers/Client/AuthController.php">
<?php
// FILE: app/Http/Controllers/Client/AuthController.php

namespace App\Http\Controllers\Client;

use App\Http\Controllers\Controller;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use App\Models\User;

class AuthController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function resolveTenant()
    {
        $host = request()->getHost();
        $map = $this->tenantService->getDomainMap();
        $tenantId = $map[$host] ?? 'default';
        $this->tenantService->switchTenant($tenantId);
        return $tenantId;
    }

    public function showLogin()
    {
        $tenantId = $this->resolveTenant();
        // Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° Ð¸Ð»Ð¸ Ð¾Ð±Ñ‰Ð¸Ð¹
        $view = "tenants.{$tenantId}.auth.login";
        if (!view()->exists($view)) {
            $view = 'client.auth.login'; // Ð¤Ð¾Ð»Ð±ÑÐº Ð½Ð° Ð¾Ð±Ñ‰Ð¸Ð¹
        }
        
        return view($view);
    }

    public function login(Request $request)
    {
        $this->resolveTenant();

        $credentials = $request->validate([
            'phone' => 'required|string',
            'password' => 'required|string',
        ]);

        // 1. Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð°Ñ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð²Ñ…Ð¾Ð´Ð° (ÐŸÐ°Ñ€Ð¾Ð»ÑŒ)
        if (Auth::attempt(['phone' => $credentials['phone'], 'password' => $credentials['password']])) {
            $request->session()->regenerate();
            return redirect()->route('client.profile');
        }

        // 2. ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð²Ñ…Ð¾Ð´Ð° Ñ‡ÐµÑ€ÐµÐ· Access Key (Ð ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ð¹ Ð²Ñ…Ð¾Ð´)
        $user = User::where('phone', $credentials['phone'])->first();
        
        if ($user && $user->access_key) {
            // Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÐ¼ Ð²Ð²ÐµÐ´ÐµÐ½Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ñ Ñ€Ð°ÑÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ ÐºÐ»ÑŽÑ‡Ð¾Ð¼
            if ($credentials['password'] === $user->access_key) {
                Auth::login($user);
                $request->session()->regenerate();
                return redirect()->route('client.profile')->with('success', 'Logged in via Access Key');
            }
        }

        return back()->withErrors([
            'phone' => 'The provided credentials do not match our records.',
        ]);
    }

    public function logout(Request $request)
    {
        Auth::logout();
        $request->session()->invalidate();
        $request->session()->regenerateToken();
        return redirect()->route('home');
    }

    public function updatePassword(Request $request)
    {
        $this->resolveTenant();

        $request->validate([
            'current_password' => 'required',
            'new_password' => 'required|min:6|confirmed',
        ]);

        $user = Auth::user();

        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ (Ð¸Ð»Ð¸ access_key)
        $isPasswordCorrect = Hash::check($request->current_password, $user->password);
        $isAccessKeyCorrect = ($user->access_key && $request->current_password === $user->access_key);

        if (!$isPasswordCorrect && !$isAccessKeyCorrect) {
            return back()->withErrors(['current_password' => 'Current password is incorrect']);
        }

        /** @var \App\Models\User $user */
        $user->update([
            'password' => Hash::make($request->new_password),
            // Ð’ÐÐ–ÐÐž: ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Access Key Ñ‚Ð¾Ð¶Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð° Ñ‡ÐµÐºÐµ Ð²ÑÐµÐ³Ð´Ð° Ð±Ñ‹Ð» ÐÐšÐ¢Ð£ÐÐ›Ð¬ÐÐ«Ð™ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ
            // Laravel Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°ÑˆÐ¸Ñ„Ñ€ÑƒÐµÑ‚ ÑÑ‚Ð¾ Ð¿Ð¾Ð»Ðµ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ $casts Ð² Ð¼Ð¾Ð´ÐµÐ»Ð¸
            'access_key' => $request->new_password 
        ]);

        return back()->with('success', 'Password updated successfully! Your receipt credentials are also updated.');
    }
}
</file>

<file path="app/Services/TelegramService.php">
<?php
// FILE: app/Services/TelegramService.php

namespace App\Services;

use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;
use App\Models\TelegramConfig;
use App\Services\TenantService;

class TelegramService
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    /**
     * ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ð±Ð¾Ñ‚Ð° Ð´Ð»Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°.
     */
    private function getConfig()
    {
        $tenantId = $this->tenantService->getCurrentTenantId();

        // 1. ÐŸÑ‹Ñ‚Ð°ÐµÐ¼ÑÑ Ð½Ð°Ð¹Ñ‚Ð¸ Ð±Ð¾Ñ‚Ð°, Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½Ð½Ð¾Ð³Ð¾ Ðº ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼Ñƒ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñƒ
        $config = TelegramConfig::where('tenant_id', $tenantId)
                                ->where('is_active', true)
                                ->first();

        // 2. Ð•ÑÐ»Ð¸ Ð½Ðµ Ð½Ð°ÑˆÐ»Ð¸, Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐºÐ°Ñ‚ÑŒ "Ð¾Ð±Ñ‰ÐµÐ³Ð¾" Ð±Ð¾Ñ‚Ð° (Ð³Ð´Ðµ tenant_id is null), 
        // Ð½Ð¾ Ð´Ð»Ñ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ð»ÑƒÑ‡ÑˆÐµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñƒ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° Ð±Ñ‹Ð» ÑÐ²Ð¾Ð¹. 
        // Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ñ„Ð¾Ð»Ð»Ð±ÐµÐº Ð½Ð° Ð¾Ð±Ñ‰ÐµÐ³Ð¾, Ñ€Ð°ÑÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ:
        /*
        if (!$config) {
            $config = TelegramConfig::whereNull('tenant_id')->where('is_active', true)->first();
        }
        */

        return $config;
    }

    public function sendStockAlert(string $productName, string $size, string $tenantName)
    {
        $config = $this->getConfig();

        if (!$config) {
            Log::warning("[Telegram] No active configuration found for tenant: {$tenantName}");
            return;
        }

        $message = "âš ï¸ *STOCK ALERT* âš ï¸\n\n" .
                   "Store: *{$tenantName}*\n" .
                   "Product: {$productName}\n" .
                   "Size: {$size}\n" .
                   "Status: *OUT OF STOCK* âŒ\n\n" .
                   "Please restock immediately.";

        $this->sendMessage($config, $message);
    }

    public function sendOrderNotification(string $orderNumber, float $amount, string $tenantName)
    {
        $config = $this->getConfig();

        if (!$config) {
            return;
        }

        $message = "ðŸ’° *NEW ORDER* ðŸ’°\n\n" .
                   "Store: *{$tenantName}*\n" .
                   "Order: `{$orderNumber}`\n" .
                   "Amount: *$" . number_format($amount, 2) . "*\n" .
                   "Status: *Pending*\n";

        $this->sendMessage($config, $message);
    }

    private function sendMessage($config, $text)
    {
        try {
            Http::post("https://api.telegram.org/bot{$config->bot_token}/sendMessage", [
                'chat_id' => $config->chat_id,
                'text' => $text,
                'parse_mode' => 'Markdown',
            ]);
        } catch (\Exception $e) {
            Log::error("Telegram send failed: " . $e->getMessage());
        }
    }
}
</file>

<file path="app/Services/TenantService.php">
<?php
// FILE: app/Services/TenantService.php

namespace App\Services;

use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Config;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\Storage; // Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚

class TenantService
{
    // Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð¾ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ID, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐµÐ³Ð¾ Ð²Ð¸Ð´ÐµÐ» config
    protected static ?string $currentTenantId = null;

    public function switchTenant(string $tenantId): void
    {
        $config = config("tenants.tenants.{$tenantId}");

        if (!$config) {
            throw new \Exception("Tenant {$tenantId} not found in config.");
        }

        // 1. Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð² ÑÑ‚Ð°Ñ‚Ð¸ÐºÑƒ (Ð´Ð»Ñ config/filesystems.php)
        self::$currentTenantId = $tenantId;

        // 2. ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ñ Ð‘Ð” (search_path)
        DB::statement("SET search_path TO \"{$tenantId}\""); // Ð£Ð±Ñ€Ð°Ð»Ð¸ public Ð¸Ð· Ð¿ÑƒÑ‚Ð¸ Ð´Ð»Ñ ÑÑ‚Ñ€Ð¾Ð³Ð¾Ð¹ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸
        
        // 3. [Ð’ÐÐ–ÐÐž] Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÐºÐ¾Ð½Ñ„Ð¸Ð³ Ð´Ð¸ÑÐºÐ°
        // Ð­Ñ‚Ð¾ Ð·Ð°ÑÑ‚Ð°Ð²Ð¸Ñ‚ Storage::disk('tenant') ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½ÑƒÑŽ Ð¿Ð°Ð¿ÐºÑƒ
        Config::set('filesystems.disks.tenant.root', storage_path("tenants/{$tenantId}"));
        Config::set('filesystems.disks.tenant.url', "/tenants/{$tenantId}");

        // 4. [Ð’ÐÐ–ÐÐž] Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¸Ð½ÑÑ‚Ð°Ð½Ñ Ð´Ð¸ÑÐºÐ°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Laravel Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð» ÐµÐ³Ð¾ Ñ Ð½Ð¾Ð²Ñ‹Ð¼ ÐºÐ¾Ð½Ñ„Ð¸Ð³Ð¾Ð¼
        Storage::forgetDisk('tenant');
    }

    public function getCurrentTenantId(): ?string
    {
        return self::$currentTenantId;
    }
    
    // ÐœÐµÑ‚Ð¾Ð´ Ð´Ð»Ñ Ð²Ñ‹Ð·Ð¾Ð²Ð° Ð¸Ð· ÐºÐ¾Ð½Ñ„Ð¸Ð³-Ñ„Ð°Ð¹Ð»Ð¾Ð²
    public static function getStaticCurrentTenantId(): ?string
    {
        return self::$currentTenantId;
    }

    public function getDomainMap(): array
    {
        $tenants = config('tenants.tenants');
        $map = [];
        foreach ($tenants as $id => $data) {
            $map[$data['domain']] = $id;
        }
        return $map;
    }
}
</file>

<file path="config/filesystems.php">
<?php
// FILE: config/filesystems.php

return [

    'default' => env('FILESYSTEM_DISK', 'local'),

    'disks' => [

        'local' => [
            'driver' => 'local',
            'root' => storage_path('app'),
            'throw' => false,
        ],

        'public' => [
            'driver' => 'local',
            'root' => storage_path('app/public'),
            'url' => env('APP_URL').'/storage',
            'visibility' => 'public',
            'throw' => false,
        ],

        // ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ Ð”Ð›Ð¯ ÐœÐÐ“ÐÐ—Ð˜ÐÐžÐ’
        'tenant' => [
            'driver' => 'local',
            // Ð¤Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿ÑƒÑ‚ÑŒ: storage/tenants/{tenant_id}
            'root' => storage_path('tenants/' . (\App\Services\TenantService::getStaticCurrentTenantId() ?? 'default')),
            // URL: /tenants/{tenant_id}/... (Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð½Ð° Ð»ÑŽÐ±Ð¾Ð¼ Ð´Ð¾Ð¼ÐµÐ½Ðµ)
            'url' => '/tenants/' . (\App\Services\TenantService::getStaticCurrentTenantId() ?? 'default'),
            'visibility' => 'public',
            'throw' => false,
        ],

        's3' => [
            'driver' => 's3',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION'),
            'bucket' => env('AWS_BUCKET'),
            'url' => env('AWS_URL'),
            'endpoint' => env('AWS_ENDPOINT'),
            'use_path_style_endpoint' => env('AWS_USE_PATH_STYLE_ENDPOINT', false),
            'throw' => false,
        ],

    ],

    'links' => [
        public_path('storage') => storage_path('app/public'),
    ],

];
</file>

<file path="docker/nginx/conf.d/app.conf">
# FILE: docker/nginx/conf.d/app.conf
server {
    listen 80;
    index index.php index.html;
    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
    root /var/www/public;

    # Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð¾ 100ÐœÐ‘
    client_max_body_size 100M;

    server_name localhost street.trishop.local designer.trishop.local military.trishop.local admin.trishop.local;

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass app:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    location / {
        try_files $uri $uri/ /index.php?$query_string;
        gzip_static on;
    }
}
</file>

<file path="resources/views/admin/attributes/index.blade.php">
<!-- FILE: resources/views/admin/attributes/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Attributes')

@section('content')
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Attributes (Tags & Sizes)</h1>
        
        <!-- Search Filter -->
        <form method="GET" action="{{ route('admin.attributes.index') }}" class="flex">
            @if(auth()->user()->role === 'super_admin')
                <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}">
            @endif
            <input type="text" name="search" value="{{ request('search') }}" placeholder="Search value..." class="border p-2 rounded-l">
            <button class="bg-gray-200 px-3 rounded-r hover:bg-gray-300">ðŸ”</button>
        </form>
    </div>

    @if(auth()->user()->role === 'super_admin')
        <div class="bg-white p-4 rounded shadow mb-6 border border-gray-200">
            <label class="block text-xs font-bold text-gray-500 mb-1">Store Context</label>
            <form method="GET" action="{{ route('admin.attributes.index') }}">
                <select name="tenant_id" class="w-full border p-2 rounded bg-yellow-50 border-yellow-200" onchange="this.form.submit()">
                    @foreach(config('tenants.tenants') as $id => $data)
                        <option value="{{ $id }}" {{ $currentTenantId === $id ? 'selected' : '' }}>
                            {{ $data['name'] }}
                        </option>
                    @endforeach
                </select>
            </form>
        </div>
    @endif

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- SIZES -->
        <div class="bg-white rounded shadow p-6 border-t-4 border-green-500">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">ðŸ“ Sizes</h2>
            
            <form action="{{ route('admin.attributes.store') }}" method="POST" class="flex gap-2 mb-4">
                @csrf
                @if(auth()->user()->role === 'super_admin')
                    <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}">
                @endif
                <input type="hidden" name="type" value="size">
                <input type="text" name="value" placeholder="New Size (e.g. 3XL)" class="border p-2 rounded flex-1" required>
                <button class="bg-green-600 text-white px-4 rounded font-bold">+</button>
            </form>

            <div class="flex flex-wrap gap-2">
                @foreach($attributes['size'] ?? [] as $option)
                    <div class="bg-gray-100 px-3 py-1 rounded flex items-center gap-2 border">
                        <span class="font-mono font-bold">{{ $option->value }}</span>
                        <!-- Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐ«Ð™ ROUTE -->
                        <form action="{{ route('admin.attributes.destroy', ['id' => $option->id, 'tenant_id' => $currentTenantId]) }}" method="POST">
                            @csrf 
                            @method('DELETE')
                            <button class="text-red-400 hover:text-red-600 font-bold">&times;</button>
                        </form>
                    </div>
                @endforeach
            </div>
        </div>

        <!-- TYPES -->
        <div class="bg-white rounded shadow p-6 border-t-4 border-blue-500">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">ðŸ‘• Product Types</h2>
            
            <form action="{{ route('admin.attributes.store') }}" method="POST" class="flex gap-2 mb-4">
                @csrf
                @if(auth()->user()->role === 'super_admin')
                    <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}">
                @endif
                <input type="hidden" name="type" value="product_type">
                <input type="text" name="value" placeholder="New Type (e.g. Jacket)" class="border p-2 rounded flex-1" required>
                <button class="bg-blue-600 text-white px-4 rounded font-bold">+</button>
            </form>

            <div class="flex flex-wrap gap-2">
                @foreach($attributes['product_type'] ?? [] as $option)
                    <div class="bg-blue-50 px-3 py-1 rounded flex items-center gap-2 border border-blue-100">
                        <span>{{ $option->value }}</span>
                        <!-- Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐ«Ð™ ROUTE -->
                        <form action="{{ route('admin.attributes.destroy', ['id' => $option->id, 'tenant_id' => $currentTenantId]) }}" method="POST">
                            @csrf @method('DELETE')
                            <button class="text-red-400 hover:text-red-600 font-bold">&times;</button>
                        </form>
                    </div>
                @endforeach
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/orders/index.blade.php">
<!-- FILE: resources/views/admin/orders/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Orders')

@section('content')
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Orders Management</h1>
    </div>

    <!-- FILTERS -->
    <div class="bg-white p-4 rounded shadow mb-6 border border-gray-200">
        <form method="GET" action="{{ route('admin.orders.index') }}" class="flex gap-4 items-end">
            @if(auth()->user()->role === 'super_admin')
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Store Context</label>
                    <select name="tenant_id" class="border p-2 rounded bg-yellow-50 font-bold text-gray-800" onchange="this.form.submit()">
                        <!-- Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: Ð§ÐµÑ‚ÐºÐ¾Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð´Ð»Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð° -->
                        <option value="" {{ empty($currentTenantId) ? 'selected' : '' }}>ðŸŒŽ All Shops</option>
                        
                        @foreach(config('tenants.tenants') as $id => $data)
                            <option value="{{ $id }}" {{ $currentTenantId == $id ? 'selected' : '' }}>
                                ðŸª {{ $data['name'] }}
                            </option>
                        @endforeach
                    </select>
                </div>
            @endif

            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">Search</label>
                <input type="text" name="search" value="{{ request('search') }}" placeholder="Order # or Phone" class="border p-2 rounded">
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">Status</label>
                <select name="status" class="border p-2 rounded">
                    <option value="">All Statuses</option>
                    <option value="new" {{ request('status') == 'new' ? 'selected' : '' }}>New</option>
                    <option value="processing" {{ request('status') == 'processing' ? 'selected' : '' }}>Processing</option>
                    <option value="shipped" {{ request('status') == 'shipped' ? 'selected' : '' }}>Shipped</option>
                    <option value="completed" {{ request('status') == 'completed' ? 'selected' : '' }}>Completed</option>
                    <option value="cancelled" {{ request('status') == 'cancelled' ? 'selected' : '' }}>Cancelled</option>
                </select>
            </div>

            <button class="bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-500">Filter</button>
        </form>
    </div>

    <!-- LIST -->
    <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="p-4 font-bold text-gray-600">Order #</th>
                    <!-- ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ Store Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ -->
                    @if(auth()->user()->role === 'super_admin' && !$currentTenantId)
                        <th class="p-4 font-bold text-gray-600">Store</th>
                    @endif
                    <th class="p-4 font-bold text-gray-600">Customer</th>
                    <th class="p-4 font-bold text-gray-600">Total</th>
                    <th class="p-4 font-bold text-gray-600">Status</th>
                    <th class="p-4 font-bold text-gray-600">Date</th>
                    <th class="p-4 text-right">Action</th>
                </tr>
            </thead>
            <tbody>
                @forelse($orders as $order)
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-4 font-mono font-bold">{{ $order->order_number }}</td>
                        
                        @if(auth()->user()->role === 'super_admin' && !$currentTenantId)
                            <td class="p-4 text-sm text-blue-600 font-bold">
                                {{ $order->tenant_name ?? 'Unknown' }}
                            </td>
                        @endif

                        <td class="p-4">
                            <div class="font-bold">{{ $order->customer_name }}</div>
                            <div class="text-xs text-gray-500">{{ $order->customer_phone }}</div>
                        </td>
                        <td class="p-4 font-bold">${{ $order->total_amount }}</td>
                        <td class="p-4">
                            @php
                                $colors = [
                                    'new' => 'bg-blue-100 text-blue-800',
                                    'processing' => 'bg-yellow-100 text-yellow-800',
                                    'shipped' => 'bg-purple-100 text-purple-800',
                                    'completed' => 'bg-green-100 text-green-800',
                                    'cancelled' => 'bg-red-100 text-red-800',
                                ];
                            @endphp
                            <span class="px-2 py-1 rounded text-xs font-bold uppercase {{ $colors[$order->status] ?? 'bg-gray-100' }}">
                                {{ $order->status }}
                            </span>
                        </td>
                        <td class="p-4 text-sm text-gray-500">{{ $order->created_at->format('M d, H:i') }}</td>
                        <td class="p-4 text-right">
                            <a href="{{ route('admin.orders.show', ['order' => $order->id, 'tenant_id' => $order->tenant_id ?? request('tenant_id')]) }}" class="bg-gray-800 text-white px-3 py-1 rounded text-sm font-bold hover:bg-gray-700">View</a>
                        </td>
                    </tr>
                @empty
                    <tr><td colspan="{{ (auth()->user()->role === 'super_admin' && !$currentTenantId) ? 7 : 6 }}" class="p-8 text-center text-gray-400">No orders found.</td></tr>
                @endforelse
            </tbody>
        </table>
        <div class="p-4">{{ $orders->withQueryString()->links() }}</div>
    </div>
@endsection
</file>

<file path="resources/views/admin/orders/show.blade.php">
<!-- FILE: resources/views/admin/orders/show.blade.php -->
@extends('layouts.admin')
@section('title', 'Order ' . $order->order_number)

@section('content')
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold flex items-center gap-2">
            <a href="{{ route('admin.orders.index', ['tenant_id' => request('tenant_id')]) }}" class="text-gray-400 hover:text-gray-600">&larr;</a>
            Order #{{ $order->order_number }}
        </h1>
        <div class="text-sm text-gray-500">
            Placed on {{ $order->created_at->format('F d, Y H:i') }}
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- LEFT: Items -->
        <div class="lg:col-span-2 space-y-6">
            <div class="bg-white rounded shadow overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="p-4 text-xs font-bold uppercase text-gray-500">Product</th>
                            <th class="p-4 text-xs font-bold uppercase text-gray-500 text-right">Price</th>
                            <th class="p-4 text-xs font-bold uppercase text-gray-500 text-center">Qty</th>
                            <th class="p-4 text-xs font-bold uppercase text-gray-500 text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($order->items as $item)
                            <tr class="border-b last:border-0">
                                <td class="p-4">
                                    <div class="font-bold">{{ $item->product_name }}</div>
                                    <div class="text-xs text-gray-500">SKU: {{ $item->sku }} | Size: {{ $item->size ?? 'N/A' }}</div>
                                </td>
                                <td class="p-4 text-right">${{ $item->price }}</td>
                                <td class="p-4 text-center">{{ $item->quantity }}</td>
                                <td class="p-4 text-right font-bold">${{ $item->total }}</td>
                            </tr>
                        @endforeach
                    </tbody>
                    <tfoot class="bg-gray-50">
                        <tr>
                            <td colspan="3" class="p-4 text-right font-bold">Subtotal:</td>
                            <td class="p-4 text-right">${{ $order->subtotal }}</td>
                        </tr>
                        @if($order->discount_amount > 0)
                            <tr>
                                <td colspan="3" class="p-4 text-right font-bold text-green-600">Discount ({{ $order->promo_code }}):</td>
                                <td class="p-4 text-right text-green-600">-${{ $order->discount_amount }}</td>
                            </tr>
                        @endif
                        <tr class="text-lg">
                            <td colspan="3" class="p-4 text-right font-bold">Total:</td>
                            <td class="p-4 text-right font-bold">${{ $order->total_amount }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- RIGHT: Info & Actions -->
        <div class="lg:col-span-1 space-y-6">
            <!-- Status Manager -->
            <div class="bg-white p-6 rounded shadow border-l-4 border-blue-600">
                <h3 class="font-bold text-gray-700 mb-4">Update Status</h3>
                <form action="{{ route('admin.orders.update', $order->id) }}" method="POST">
                    @csrf
                    @method('PUT')
                    @if(request('tenant_id')) <input type="hidden" name="tenant_id" value="{{ request('tenant_id') }}"> @endif
                    
                    <select name="status" class="w-full border p-2 rounded mb-4 bg-gray-50">
                        @foreach(['new', 'processing', 'shipped', 'completed', 'cancelled'] as $st)
                            <option value="{{ $st }}" {{ $order->status === $st ? 'selected' : '' }}>
                                {{ ucfirst($st) }}
                            </option>
                        @endforeach
                    </select>
                    <button class="w-full bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-500">Update Status</button>
                </form>
            </div>

            <!-- Customer Info -->
            <div class="bg-white p-6 rounded shadow">
                <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">Customer Details</h3>
                <div class="space-y-3 text-sm">
                    <div>
                        <span class="text-gray-500 block text-xs">Name</span>
                        <span class="font-bold">{{ $order->customer_name }}</span>
                    </div>
                    <div>
                        <span class="text-gray-500 block text-xs">Phone</span>
                        <a href="tel:{{ $order->customer_phone }}" class="text-blue-600">{{ $order->customer_phone }}</a>
                    </div>
                    <div>
                        <span class="text-gray-500 block text-xs">Email</span>
                        <a href="mailto:{{ $order->customer_email }}" class="text-blue-600">{{ $order->customer_email }}</a>
                    </div>
                </div>
            </div>

            <!-- Shipping Info -->
            <div class="bg-white p-6 rounded shadow">
                <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">Shipping & Payment</h3>
                <div class="space-y-3 text-sm">
                    <div>
                        <span class="text-gray-500 block text-xs">Method</span>
                        <span class="font-bold uppercase">{{ str_replace('_', ' ', $order->shipping_method) }}</span>
                    </div>
                    <div>
                        <span class="text-gray-500 block text-xs">Address</span>
                        <div class="bg-gray-50 p-2 rounded border">{{ $order->shipping_address }}</div>
                    </div>
                    <div>
                        <span class="text-gray-500 block text-xs">Payment</span>
                        <span class="font-bold uppercase badge bg-yellow-100 text-yellow-800 px-2 rounded">
                            {{ $order->payment_method }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/settings/index.blade.php">
<!-- FILE: resources/views/admin/settings/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Platform Settings')

@section('content')
    <div x-data="{ activeTab: 'general' }">
        
        <!-- Header & Tabs -->
        <div class="mb-6 border-b border-gray-200">
            <h1 class="text-2xl font-bold mb-4">Platform Settings</h1>
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button @click="activeTab = 'general'" 
                        :class="activeTab === 'general' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition">
                    General Settings
                </button>
                <button @click="activeTab = 'telegram'" 
                        :class="activeTab === 'telegram' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition flex items-center gap-2">
                    <span class="text-xl">âœˆï¸</span> Telegram Bots
                </button>
            </nav>
        </div>

        <!-- TAB 1: GENERAL SETTINGS -->
        <div x-show="activeTab === 'general'" x-transition:enter.duration.300ms>
            <div class="bg-white p-6 rounded shadow max-w-2xl">
                <h2 class="text-lg font-bold mb-4 text-gray-700">Global Configuration</h2>
                <form action="{{ route('admin.settings.update') }}" method="POST">
                    @csrf
                    <div class="mb-4">
                        <label class="block text-sm font-bold mb-2">Platform Name</label>
                        <input type="text" name="platform_name" value="TriShop Platform" class="w-full border p-2 rounded">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-bold mb-2">Admin Email</label>
                        <input type="email" name="admin_email" value="admin@trishop.com" class="w-full border p-2 rounded">
                    </div>
                    <div class="p-4 bg-yellow-50 text-yellow-800 text-sm rounded border border-yellow-200 mb-4">
                        This section is for global platform settings. Store-specific settings are managed within each store context.
                    </div>
                    <button class="bg-gray-800 text-white px-6 py-2 rounded font-bold hover:bg-gray-700">Save General Settings</button>
                </form>
            </div>
        </div>

        <!-- TAB 2: TELEGRAM SETTINGS -->
        <div x-show="activeTab === 'telegram'" x-transition:enter.duration.300ms style="display: none;">
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- LEFT COL: CONFIG LIST -->
                <div class="lg:col-span-2 space-y-6">
                    
                    <!-- ADD NEW FORM -->
                    <div class="bg-white p-6 rounded shadow border-t-4 border-blue-600">
                        <h2 class="text-lg font-bold mb-4">Add New Bot</h2>
                        <form action="{{ route('admin.settings.telegram.store') }}" method="POST">
                            @csrf
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-bold mb-1">Friendly Name</label>
                                    <input type="text" name="name" placeholder="e.g. StreetStyle Notifications" class="w-full border p-2 rounded" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-1">Assign to Store</label>
                                    <select name="tenant_id" class="w-full border p-2 rounded bg-gray-50">
                                        <option value="">-- General / Unassigned --</option>
                                        @foreach($tenants as $id => $data)
                                            <option value="{{ $id }}">{{ $data['name'] }} ({{ $id }})</option>
                                        @endforeach
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-bold mb-1">Bot Token</label>
                                    <input type="text" name="bot_token" placeholder="123456:ABC..." class="w-full border p-2 rounded font-mono text-sm" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-1">Chat ID</label>
                                    <input type="text" name="chat_id" placeholder="-100..." class="w-full border p-2 rounded font-mono text-sm" required>
                                </div>
                            </div>

                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <input type="checkbox" name="is_active" id="is_active_new" value="1" checked class="h-4 w-4">
                                    <label for="is_active_new" class="text-sm font-bold">Active</label>
                                </div>
                                <button class="bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-500">Save Configuration</button>
                            </div>
                        </form>
                    </div>

                    <!-- EXISTING CONFIGS -->
                    <h3 class="text-lg font-bold text-gray-700">Active Configurations</h3>
                    @forelse($telegramConfigs as $config)
                        <div class="bg-white rounded shadow overflow-hidden border {{ $config->is_active ? 'border-gray-200' : 'border-red-200 bg-red-50' }}">
                            <form action="{{ route('admin.settings.telegram.update', $config->id) }}" method="POST">
                                @csrf
                                @method('PUT')
                                
                                <div class="p-4 flex flex-col md:flex-row gap-4 items-start md:items-center bg-gray-50 border-b">
                                    <div class="flex-1">
                                        <input type="text" name="name" value="{{ $config->name }}" class="font-bold text-lg bg-transparent border-b border-dashed border-gray-400 focus:border-blue-500 outline-none w-full">
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="bg-green-600 text-white px-3 py-1 rounded text-sm font-bold hover:bg-green-500">Update</button>
                                    </div>
                                </div>

                                <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 mb-1">Assigned Store</label>
                                        <select name="tenant_id" class="w-full border p-2 rounded text-sm">
                                            <option value="">-- General --</option>
                                            @foreach($tenants as $id => $data)
                                                <option value="{{ $id }}" {{ $config->tenant_id === $id ? 'selected' : '' }}>
                                                    {{ $data['name'] }}
                                                </option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2 pt-6">
                                        <input type="checkbox" name="is_active" id="active_{{ $config->id }}" value="1" {{ $config->is_active ? 'checked' : '' }}>
                                        <label for="active_{{ $config->id }}" class="text-sm">Is Active</label>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 mb-1">Bot Token</label>
                                        <input type="text" name="bot_token" value="{{ $config->bot_token }}" class="w-full border p-2 rounded font-mono text-xs">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 mb-1">Chat ID</label>
                                        <input type="text" name="chat_id" value="{{ $config->chat_id }}" class="w-full border p-2 rounded font-mono text-xs">
                                    </div>
                                </div>
                            </form>
                            <div class="p-2 bg-gray-100 border-t text-right">
                                <form action="{{ route('admin.settings.telegram.destroy', $config->id) }}" method="POST" onsubmit="return confirm('Delete this configuration?');">
                                    @csrf @method('DELETE')
                                    <button class="text-red-500 text-xs font-bold hover:underline">Delete</button>
                                </form>
                            </div>
                        </div>
                    @empty
                        <p class="text-center text-gray-500 italic py-4 bg-white rounded shadow">No Telegram bots configured yet.</p>
                    @endforelse
                </div>

                <!-- RIGHT COL: MANUAL SENDER -->
                <div class="lg:col-span-1">
                    <div class="bg-white p-6 rounded shadow border-t-4 border-indigo-500 sticky top-4">
                        <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                            <span>ðŸ“¢</span> Manual Message
                        </h2>
                        <p class="text-xs text-gray-500 mb-4">Select a bot and send a custom message directly to the configured Chat ID.</p>
                        
                        <form action="{{ route('admin.settings.telegram.sendMessage') }}" method="POST">
                            @csrf
                            
                            <div class="mb-4">
                                <label class="block text-sm font-bold mb-1">Select Bot</label>
                                <select name="config_id" class="w-full border p-2 rounded bg-indigo-50" required>
                                    @if($telegramConfigs->isEmpty())
                                        <option value="" disabled selected>No active bots</option>
                                    @else
                                        @foreach($telegramConfigs as $config)
                                            <option value="{{ $config->id }}">{{ $config->name }}</option>
                                        @endforeach
                                    @endif
                                </select>
                            </div>

                            <div class="mb-4">
                                <label class="block text-sm font-bold mb-1">Message</label>
                                <textarea name="message" rows="4" class="w-full border p-2 rounded" placeholder="Type your message here... (Markdown supported)" required></textarea>
                            </div>

                            <button class="w-full bg-indigo-600 text-white px-4 py-3 rounded font-bold hover:bg-indigo-500 flex justify-center items-center gap-2 shadow-lg">
                                <span>ðŸš€</span> Send Message
                            </button>
                        </form>
                    </div>
                </div>

            </div>
        </div>

    </div>
@endsection
</file>

<file path="resources/views/admin/users/create.blade.php">
<!-- FILE: resources/views/admin/users/create.blade.php -->
@extends('layouts.admin')
@section('title', 'Create User')

@section('content')
    <h1 class="text-2xl font-bold mb-6">Create New User</h1>
    
    <div class="bg-white rounded shadow p-6 max-w-md">
        <form action="{{ route('admin.users.store') }}" method="POST" x-data="{ role: 'manager' }">
            @csrf
            
            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">Name</label>
                <input type="text" name="name" class="w-full border p-2 rounded" required value="{{ old('name') }}">
            </div>

            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">Email</label>
                <input type="email" name="email" class="w-full border p-2 rounded" required value="{{ old('email') }}">
            </div>

            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">Password</label>
                <input type="password" name="password" class="w-full border p-2 rounded" required>
            </div>

            <div class="mb-4 bg-gray-50 p-4 rounded border">
                <label class="block text-sm font-bold mb-2">System Role</label>
                <select name="role" x-model="role" class="w-full border p-2 rounded bg-white">
                    <option value="manager">Manager (Store Specific)</option>
                    <option value="super_admin">Super Admin (Global Access)</option>
                </select>
                
                <p class="text-xs text-gray-500 mt-2" x-show="role === 'super_admin'">
                    âš ï¸ Super Admin has full access to all stores and settings.
                </p>
            </div>

            <!-- ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð²Ñ‹Ð±Ð¾Ñ€ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° Ð¢ÐžÐ›Ð¬ÐšÐž ÐµÑÐ»Ð¸ Ñ€Ð¾Ð»ÑŒ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ -->
            <div class="mb-6" x-show="role === 'manager'" x-transition>
                <label class="block text-sm font-bold mb-2 text-blue-800">Assign to Store</label>
                <select name="tenant_id" class="w-full border-2 border-blue-200 p-2 rounded bg-blue-50">
                    <option value="" disabled selected>-- Select a Store --</option>
                    @foreach($tenants as $id => $data)
                        <option value="{{ $id }}">{{ $data['name'] }} ({{ $data['domain'] }})</option>
                    @endforeach
                </select>
                <p class="text-xs text-blue-600 mt-1">
                    This user will only manage products and orders for the selected store.
                </p>
            </div>

            <div class="flex justify-between items-center mt-6">
                <a href="{{ route('admin.users.index') }}" class="text-gray-500 py-2 hover:underline">Cancel</a>
                <button class="bg-blue-600 text-white font-bold py-2 px-6 rounded hover:bg-blue-500 shadow">
                    Create User
                </button>
            </div>
        </form>
    </div>
@endsection
</file>

<file path="resources/views/admin/users/edit.blade.php">
<!-- FILE: resources/views/admin/users/edit.blade.php -->
@extends('layouts.admin')
@section('title', 'Edit User')

@section('content')
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Edit User: {{ $user->name }}</h1>
        @if($user->id !== auth()->id())
            <form action="{{ route('admin.users.destroy', $user->id) }}" method="POST" onsubmit="return confirm('Are you sure? This action cannot be undone.');">
                @csrf
                @method('DELETE')
                <button class="text-red-600 hover:text-red-800 hover:underline text-sm font-bold">Delete User</button>
            </form>
        @endif
    </div>
    
    <div class="bg-white rounded shadow p-6 max-w-md">
        <form action="{{ route('admin.users.update', $user->id) }}" method="POST" x-data="{ role: '{{ $user->role }}' }">
            @csrf
            @method('PUT')
            
            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">Name</label>
                <input type="text" name="name" value="{{ $user->name }}" class="w-full border p-2 rounded" required>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">Email</label>
                <input type="email" name="email" value="{{ $user->email }}" class="w-full border p-2 rounded" required>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">Password <span class="text-gray-400 font-normal">(Leave blank to keep current)</span></label>
                <input type="password" name="password" class="w-full border p-2 rounded" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>

            <div class="mb-4 bg-gray-50 p-4 rounded border">
                <label class="block text-sm font-bold mb-2">System Role</label>
                <select name="role" x-model="role" class="w-full border p-2 rounded bg-white">
                    <option value="manager">Manager</option>
                    <option value="super_admin">Super Admin</option>
                </select>
            </div>

            <!-- Ð’Ñ‹Ð±Ð¾Ñ€ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° -->
            <div class="mb-6" x-show="role === 'manager'" x-transition>
                <label class="block text-sm font-bold mb-2 text-blue-800">Assigned Store</label>
                <select name="tenant_id" class="w-full border-2 border-blue-200 p-2 rounded bg-blue-50">
                    <option value="" disabled>-- Select a Store --</option>
                    @foreach($tenants as $id => $data)
                        <option value="{{ $id }}" {{ $user->tenant_id === $id ? 'selected' : '' }}>
                            {{ $data['name'] }}
                        </option>
                    @endforeach
                </select>
                @if($user->tenant_id && !array_key_exists($user->tenant_id, $tenants))
                    <p class="text-xs text-red-500 mt-1">Warning: Current store ID '{{ $user->tenant_id }}' not found in config.</p>
                @endif
            </div>

            <div class="flex justify-between items-center mt-6">
                <a href="{{ route('admin.users.index') }}" class="text-gray-500 py-2 hover:underline">Cancel</a>
                <button class="bg-blue-600 text-white font-bold py-2 px-6 rounded hover:bg-blue-500 shadow">
                    Update User
                </button>
            </div>
        </form>
    </div>
@endsection
</file>

<file path="resources/views/admin/dashboard.blade.php">
<!-- FILE: resources/views/admin/dashboard.blade.php -->
@extends('layouts.admin')
@section('title', 'Dashboard')

@section('content')
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Dashboard</h1>
        <p class="text-gray-500">Overview for: <span class="font-bold text-blue-600">{{ $stats['tenant_name'] }}</span></p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-white p-6 rounded shadow border-l-4 border-blue-500">
            <div class="text-gray-500 text-sm font-bold uppercase mb-1">Total Orders</div>
            <div class="text-3xl font-bold">{{ number_format($stats['total_orders']) }}</div>
        </div>
        <div class="bg-white p-6 rounded shadow border-l-4 border-green-500">
            <div class="text-gray-500 text-sm font-bold uppercase mb-1">Total Revenue</div>
            <div class="text-3xl font-bold">${{ number_format($stats['total_revenue'], 2) }}</div>
        </div>
    </div>

    <!-- Recent Orders -->
    <div class="bg-white rounded shadow overflow-hidden">
        <div class="px-6 py-4 border-b bg-gray-50 flex justify-between items-center">
            <h3 class="font-bold text-gray-700">Recent Orders</h3>
            <a href="{{ route('admin.orders.index') }}" class="text-sm text-blue-600 hover:underline">View All</a>
        </div>
        <table class="w-full text-left">
            <thead>
                <tr class="text-xs text-gray-500 uppercase border-b">
                    <th class="px-6 py-3">Order #</th>
                    @if(!$currentTenantId)<th class="px-6 py-3">Store</th>@endif
                    <th class="px-6 py-3">Customer</th>
                    <th class="px-6 py-3">Total</th>
                    <th class="px-6 py-3">Status</th>
                    <th class="px-6 py-3 text-right">Action</th>
                </tr>
            </thead>
            <tbody class="text-sm">
                @forelse($stats['recent_orders'] as $order)
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-mono font-bold">{{ $order->order_number }}</td>
                        @if(!$currentTenantId)
                            <td class="px-6 py-4 text-blue-600 font-bold text-xs">{{ $order->store_name ?? '-' }}</td>
                        @endif
                        <td class="px-6 py-4">{{ $order->customer_name }}</td>
                        <td class="px-6 py-4 font-bold">${{ $order->total_amount }}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 rounded text-[10px] font-bold uppercase bg-gray-100 text-gray-600">
                                {{ $order->status }}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right">
                             <a href="{{ route('admin.orders.show', ['order' => $order->id, 'tenant_id' => $order->tenant_id ?? request('tenant_id')]) }}" class="text-blue-600 hover:underline font-bold">View</a>
                        </td>
                    </tr>
                @empty
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-400 italic">No orders yet.</td>
                    </tr>
                @endforelse
            </tbody>
        </table>
    </div>
@endsection
</file>

<file path="resources/views/cart/index.blade.php">
<!-- FILE: resources/views/cart/index.blade.php -->
@extends('layouts.app')
@section('title', 'Cart')

@section('content')
    <h1 class="text-3xl font-bold uppercase mb-8 theme-skew theme-text text-center md:text-left">Your Selection</h1>

    @if(empty($cartItems))
        <div class="theme-card p-12 text-center border-dashed">
            <p class="theme-muted text-xl mb-6">Your cart is currently empty.</p>
            <a href="{{ route('home') }}" class="theme-btn px-8 py-3 inline-block">Start Shopping</a>
        </div>
    @else
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Items List -->
            <div class="lg:col-span-2 space-y-4">
                @foreach($cartItems as $item)
                    <div class="theme-card p-4 flex gap-4 items-start relative overflow-hidden group">
                        <div class="w-24 h-32 flex-shrink-0 bg-gray-100 theme-border border">
                            <img src="{{ $item['product']->cover_url }}" class="w-full h-full object-cover">
                        </div>
                        
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-bold text-lg theme-text">{{ $item['product']->name }}</h3>
                                <div class="font-bold text-lg theme-text">${{ number_format($item['total'], 2) }}</div>
                            </div>
                            
                            <p class="theme-muted text-sm mt-1">Size: {{ $item['size'] }}</p>
                            <p class="theme-muted text-sm font-mono mt-1">${{ $item['price'] }} x {{ $item['quantity'] }}</p>
                            
                            <form action="{{ route('cart.remove', $item['row_id']) }}" method="POST" class="mt-4">
                                @csrf
                                <button class="text-xs font-bold uppercase text-red-500 hover:text-red-700 transition flex items-center gap-1">
                                    <span>&times; Remove</span>
                                </button>
                            </form>
                        </div>
                    </div>
                @endforeach
            </div>

            <!-- Checkout Panel -->
            <div class="lg:col-span-1">
                <div class="theme-card p-6 sticky top-4 shadow-lg">
                    <h2 class="text-xl font-bold mb-4 border-b theme-border pb-2 uppercase theme-text">Order Summary</h2>
                    
                    <div class="space-y-2 mb-4 text-sm">
                        <div class="flex justify-between theme-text">
                            <span>Subtotal</span>
                            <span class="font-mono">${{ number_format($subtotal, 2) }}</span>
                        </div>
                        @if($discount > 0)
                            <div class="flex justify-between" style="color: var(--color-primary)">
                                <span>Discount</span>
                                <span class="font-mono">-${{ number_format($discount, 2) }}</span>
                            </div>
                        @endif
                    </div>

                    <div class="flex justify-between mb-6 text-xl font-bold border-t theme-border pt-4 theme-text">
                        <span>Total</span>
                        <span class="font-mono" style="color: var(--color-primary)">${{ number_format($total, 2) }}</span>
                    </div>

                    <!-- Promo -->
                    <form action="{{ route('cart.promo') }}" method="POST" class="mb-6 flex gap-2">
                        @csrf
                        <input type="text" name="code" placeholder="PROMO CODE" class="theme-input p-2 w-full uppercase text-sm font-bold">
                        <button class="theme-btn px-4 text-sm">Apply</button>
                    </form>

                    <!-- Checkout Inputs -->
                    <form action="{{ route('checkout') }}" method="POST" class="space-y-4">
                        @csrf
                        
                        @foreach(['customer_name' => 'Full Name', 'customer_phone' => 'Phone (+380...)', 'customer_email' => 'Email'] as $name => $label)
                        <div>
                            <label class="block text-[10px] font-bold uppercase mb-1 theme-muted">{{ $label }}</label>
                            <input type="text" name="{{ $name }}" class="theme-input w-full p-3 font-bold text-sm" required>
                        </div>
                        @endforeach

                        <div>
                            <label class="block text-[10px] font-bold uppercase mb-1 theme-muted">Shipping Method</label>
                            <select name="shipping_method" class="theme-input w-full p-3 bg-transparent font-bold text-sm">
                                <option value="nova_poshta" class="text-black">Nova Poshta</option>
                                <option value="courier" class="text-black">Courier Delivery</option>
                                <option value="pickup" class="text-black">Store Pickup</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-[10px] font-bold uppercase mb-1 theme-muted">Address / Branch</label>
                            <textarea name="shipping_address" rows="2" class="theme-input w-full p-3 font-bold text-sm" required></textarea>
                        </div>

                        <button class="theme-btn w-full py-4 text-lg mt-4 shadow-xl hover:shadow-2xl transition-shadow">
                            CONFIRM ORDER
                        </button>
                    </form>
                </div>
            </div>
        </div>
    @endif
@endsection
</file>

<file path=".gitignore">
# FILE: .gitignore

# --- Laravel Framework & Composer ---
/vendor
/node_modules
/public/hot
/public/storage
/storage/*.key
.env
.env.backup
.env.production
.phpunit.result.cache
Homestead.json
Homestead.yaml
auth.json
npm-debug.log
yarn-error.log
/.fleet
/.idea
/.vscode

# --- Laravel Storage (Logs, Cache, Sessions) ---
# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¿Ð°Ð¿Ð¾Ðº (Ñ‡ÐµÑ€ÐµÐ· .gitignore Ð²Ð½ÑƒÑ‚Ñ€Ð¸), Ð½Ð¾ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ
/storage/app/public/*
!/storage/app/public/.gitignore

/storage/framework/cache/data/*
!/storage/framework/cache/data/.gitignore

/storage/framework/sessions/*
!/storage/framework/sessions/.gitignore

/storage/framework/testing/*
!/storage/framework/testing/.gitignore

/storage/framework/views/*
!/storage/framework/views/.gitignore

/storage/logs/*
!/storage/logs/.gitignore

# --- Vite / Frontend Build ---
/public/build

# --- Multi-Tenancy Specifics ---
# Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ ÑÐ¸Ð¼Ð»Ð¸Ð½ÐºÐ¸, ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ tenants:link
/public/tenants

# Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÐ´Ð¸Ð°Ñ„Ð°Ð¹Ð»Ñ‹ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð², Ð¸Ñ… Ð»Ð¾Ð³Ð¸ Ð¸ ÐºÑÑˆ,
# Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ°Ð¼Ñƒ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¿Ð°Ð¿Ð¾Ðº (Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ .gitignore Ð²Ð½ÑƒÑ‚Ñ€Ð¸ setup_structure.sh)
/storage/tenants/*/media/*
!/storage/tenants/*/media/.gitignore

/storage/tenants/*/logs/*
!/storage/tenants/*/logs/.gitignore

/storage/tenants/*/cache/*
!/storage/tenants/*/cache/.gitignore

# --- Docker & System ---
.DS_Store
Thumbs.db
docker-compose.override.yml

# Ð•ÑÐ»Ð¸ Ð²Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ð»Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð¼Ð¿Ñ‹ Ð‘Ð”
*.sql
*.sql.gz

# --- Editor Specific ---
.phpintel/
.vscode/
.idea/
*.sublime-project
*.sublime-workspace
</file>

<file path="docker-compose.yml">
# FILE: docker-compose.yml
services:
  app:
    build:
      context: .
      dockerfile: docker/php/Dockerfile
    container_name: trishop_app
    restart: unless-stopped
    working_dir: /var/www
    volumes:
      - ./:/var/www
      - ./docker/php/local.ini:/usr/local/etc/php/conf.d/local.ini
    networks:
      - trishop_network
    depends_on:
      - db
      - redis
      - elasticsearch

  web:
    image: nginx:alpine
    container_name: trishop_web
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - ./:/var/www
      - ./docker/nginx/conf.d:/etc/nginx/conf.d
    networks:
      - trishop_network
    depends_on:
      - app

  db:
    image: postgres:15
    container_name: trishop_db
    restart: unless-stopped
    environment:
      POSTGRES_DB: ${DB_DATABASE}
      POSTGRES_USER: ${DB_USERNAME}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    ports:
      - "${DB_PORT}:5432"
    volumes:
      - dbdata:/var/lib/postgresql/data
    networks:
      - trishop_network

  redis:
    image: redis:7-alpine
    container_name: trishop_redis
    restart: unless-stopped
    ports:
      - "${REDIS_PORT}:6379"
    volumes:
      - redisdata:/data
    networks:
      - trishop_network

  elasticsearch:
    image: elasticsearch:8.11.1
    container_name: trishop_elastic
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ports:
      - "${ELASTIC_PORT}:9200"
    volumes:
      - esdata:/usr/share/elasticsearch/data
    networks:
      - trishop_network

networks:
  trishop_network:
    driver: bridge

volumes:
  dbdata:
  redisdata:
  esdata:
</file>

<file path="README.md">
<p align="center"><a href="https://laravel.com" target="_blank"><img src="https://raw.githubusercontent.com/laravel/art/master/logo-lockup/5%20SVG/2%20CMYK/1%20Full%20Color/laravel-logolockup-cmyk-red.svg" width="400" alt="Laravel Logo"></a></p>

<p align="center">
<a href="https://github.com/laravel/framework/actions"><img src="https://github.com/laravel/framework/workflows/tests/badge.svg" alt="Build Status"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/dt/laravel/framework" alt="Total Downloads"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/v/laravel/framework" alt="Latest Stable Version"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/l/laravel/framework" alt="License"></a>
</p>

## About Laravel

Laravel is a web application framework with expressive, elegant syntax. We believe development must be an enjoyable and creative experience to be truly fulfilling. Laravel takes the pain out of development by easing common tasks used in many web projects, such as:

- [Simple, fast routing engine](https://laravel.com/docs/routing).
- [Powerful dependency injection container](https://laravel.com/docs/container).
- Multiple back-ends for [session](https://laravel.com/docs/session) and [cache](https://laravel.com/docs/cache) storage.
- Expressive, intuitive [database ORM](https://laravel.com/docs/eloquent).
- Database agnostic [schema migrations](https://laravel.com/docs/migrations).
- [Robust background job processing](https://laravel.com/docs/queues).
- [Real-time event broadcasting](https://laravel.com/docs/broadcasting).

Laravel is accessible, powerful, and provides tools required for large, robust applications.

## Learning Laravel

Laravel has the most extensive and thorough [documentation](https://laravel.com/docs) and video tutorial library of all modern web application frameworks, making it a breeze to get started with the framework. You can also check out [Laravel Learn](https://laravel.com/learn), where you will be guided through building a modern Laravel application.

If you don't feel like reading, [Laracasts](https://laracasts.com) can help. Laracasts contains thousands of video tutorials on a range of topics including Laravel, modern PHP, unit testing, and JavaScript. Boost your skills by digging into our comprehensive video library.

## Laravel Sponsors

We would like to extend our thanks to the following sponsors for funding Laravel development. If you are interested in becoming a sponsor, please visit the [Laravel Partners program](https://partners.laravel.com).

### Premium Partners

- **[Vehikl](https://vehikl.com)**
- **[Tighten Co.](https://tighten.co)**
- **[Kirschbaum Development Group](https://kirschbaumdevelopment.com)**
- **[64 Robots](https://64robots.com)**
- **[Curotec](https://www.curotec.com/services/technologies/laravel)**
- **[DevSquad](https://devsquad.com/hire-laravel-developers)**
- **[Redberry](https://redberry.international/laravel-development)**
- **[Active Logic](https://activelogic.com)**

## Contributing

Thank you for considering contributing to the Laravel framework! The contribution guide can be found in the [Laravel documentation](https://laravel.com/docs/contributions).

## Code of Conduct

In order to ensure that the Laravel community is welcoming to all, please review and abide by the [Code of Conduct](https://laravel.com/docs/contributions#code-of-conduct).

## Security Vulnerabilities

If you discover a security vulnerability within Laravel, please send an e-mail to Taylor Otwell via [taylor@laravel.com](mailto:taylor@laravel.com). All security vulnerabilities will be promptly addressed.

## License

The Laravel framework is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).
</file>

<file path="refresh.sh">
#!/bin/bash
# FILE: refresh.sh

# ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð»ÑŽÐ±Ð¾Ð¹ Ð¾ÑˆÐ¸Ð±ÐºÐµ
set -e

echo "ðŸ”„ Starting heavy refresh..."

# 1. Ð¡Ð±Ñ€Ð¾Ñ ÐºÑÑˆÐµÐ¹ Laravel
echo "ðŸ§¹ Clearing caches..."
docker compose exec app php artisan optimize:clear
docker compose exec app php artisan view:clear
docker compose exec app php artisan route:clear
docker compose exec app php artisan config:clear

# 2. ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð‘Ð” Ð¸ Ð¡Ð¸Ð´Ð¸Ð½Ð³
echo "ðŸŒ± Migrating and Seeding (Public + Tenants)..."
# Ð’ÐÐ–ÐÐž: --fresh ÑÐ½Ð¾ÑÐ¸Ñ‚ Ð²ÑÐµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð² Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
docker compose exec app php artisan tenants:migrate --fresh --seed

# 3. ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸Ð¼Ð»Ð¸Ð½ÐºÐ¾Ð²
echo "ðŸ”— Linking storage..."
docker compose exec app php artisan tenants:link --force

echo "âœ… Refresh complete! Admin: http://admin.trishop.local"
</file>

<file path="app/Http/Controllers/Admin/CategoryController.php">
<?php
// FILE: app/Http/Controllers/Admin/CategoryController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Str;

class CategoryController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function resolveContext(Request $request)
    {
        if (auth()->user()->role !== 'super_admin') {
            return $this->tenantService->getCurrentTenantId();
        }
        $tenantId = $request->tenant_id ?? array_key_first(config('tenants.tenants'));
        if ($tenantId) {
            $this->tenantService->switchTenant($tenantId);
        }
        return $tenantId;
    }

    public function index(Request $request)
    {
        $currentTenantId = $this->resolveContext($request);
        $query = Category::withCount('products');
        if ($request->filled('search')) {
            $query->where('name', 'ilike', "%{$request->search}%");
        }
        $categories = $query->orderBy('name')->get();
        return view('admin.categories.index', compact('categories', 'currentTenantId'));
    }

    public function store(Request $request)
    {
        $this->resolveContext($request);
        
        $validated = $request->validate(['name' => 'required|string|max:255']);

        // Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÑÐ»Ð°Ð³Ñƒ
        $slug = Str::slug($validated['name']);
        
        Category::firstOrCreate(
            ['slug' => $slug],
            ['name' => $validated['name']]
        );

        return back()->with('success', 'Category created/found.');
    }

    public function update(Request $request, $id)
    {
        $this->resolveContext($request);
        $category = Category::findOrFail($id);
        
        $validated = $request->validate(['name' => 'required|string|max:255']);
        // ÐŸÑ€Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¼ÐµÐ½ÑÐµÐ¼ Ð¸Ð¼Ñ Ð¸ ÑÐ»Ð°Ð³, Ñ‚ÑƒÑ‚ firstOrCreate Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½, Ð½Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ unique exception
        try {
            $category->update([
                'name' => $validated['name'],
                'slug' => Str::slug($validated['name'])
            ]);
        } catch (\Exception $e) {
            return back()->with('error', 'Category with this name already exists.');
        }
        
        return back()->with('success', 'Category updated.');
    }

    public function destroy(Request $request, $id)
    {
        $this->resolveContext($request);
        Category::destroy($id);
        return back()->with('success', 'Category deleted.');
    }
}
</file>

<file path="app/Http/Controllers/CartController.php">
<?php

namespace App\Http\Controllers;

use App\Models\Product;
use App\Models\Order;
use App\Models\OrderItem;
use App\Models\PromoCode;
use App\Models\TelegramConfig;
use App\Models\User;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;

class CartController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    // --- HELPER: ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð° ---
    // ÐŸÑ€Ð¸Ð²Ð¾Ð´Ð¸Ñ‚ Ð½Ð¾Ð¼ÐµÑ€Ð° (097..., 38097...) Ðº ÐµÐ´Ð¸Ð½Ð¾Ð¼Ñƒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñƒ +380...
    private function normalizePhone($phone)
    {
        // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²ÑÐµ Ð»Ð¸ÑˆÐ½Ð¸Ðµ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹
        $clean = preg_replace('/[^0-9+]/', '', $phone);
        
        // Ð•ÑÐ»Ð¸ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ 0 (097...), Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ +38
        if (str_starts_with($clean, '0')) {
            return '+38' . $clean;
        }
        
        // Ð•ÑÐ»Ð¸ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ 380 (Ð±ÐµÐ· Ð¿Ð»ÑŽÑÐ°), Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð»ÑŽÑ
        if (str_starts_with($clean, '380')) {
            return '+' . $clean;
        }

        return $clean;
    }

    // --- HELPER: Ð˜Ð·Ð¾Ð»ÑÑ†Ð¸Ñ Ð¡ÐµÑÑÐ¸Ð¸ ---
    private function getCartKey()
    {
        return 'cart_' . $this->tenantService->getCurrentTenantId();
    }

    private function getPromoKey()
    {
        return 'promo_code_' . $this->tenantService->getCurrentTenantId();
    }

    // --- HELPER: Ð˜Ð·Ð¾Ð»ÑÑ†Ð¸Ñ Ð‘Ð” ---
    // ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÑÑ…ÐµÐ¼Ñƒ Ð‘Ð” Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ð´Ð¾Ð¼ÐµÐ½Ð°
    private function resolveTenant()
    {
        $host = request()->getHost();
        $map = $this->tenantService->getDomainMap();
        $tenantId = $map[$host] ?? 'default';
        $this->tenantService->switchTenant($tenantId);
        return $tenantId;
    }

    // --- ÐŸÐ ÐžÐ¡ÐœÐžÐ¢Ð  ÐšÐžÐ Ð—Ð˜ÐÐ« ---
    public function index()
    {
        $tenantId = $this->resolveTenant();
        $cartKey = $this->getCartKey();
        $promoKey = $this->getPromoKey();
        
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
        $cart = session()->get($cartKey, []);
        $promoCode = session()->get($promoKey, null);
        
        $cartItems = [];
        $subtotal = 0;
        $discount = 0;

        foreach ($cart as $key => $item) {
            // Ð˜Ñ‰ÐµÐ¼ Ñ‚Ð¾Ð²Ð°Ñ€ Ð² Ð‘Ð” Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
            $product = Product::find($item['product_id']);
            
            // Ð•ÑÐ»Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€ ÑƒÐ´Ð°Ð»ÐµÐ½ - ÑƒÐ±Ð¸Ñ€Ð°ÐµÐ¼ Ð¸Ð· ÑÐµÑÑÐ¸Ð¸
            if (!$product) {
                unset($cart[$key]);
                continue;
            }
            
            $price = $product->current_price;
            $lineTotal = $price * $item['quantity'];
            $subtotal += $lineTotal;

            $cartItems[] = [
                'product' => $product,
                'size' => $item['size'],
                'quantity' => $item['quantity'],
                'price' => $price,
                'total' => $lineTotal,
                'row_id' => $key
            ];
        }
        
        // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÐµÑÑÐ¸ÑŽ (ÐµÑÐ»Ð¸ ÑƒÐ´Ð°Ð»ÑÐ»Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹)
        session()->put($cartKey, $cart);

        // Ð›Ð¾Ð³Ð¸ÐºÐ° Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð°
        if ($promoCode) {
            $promo = PromoCode::where('code', $promoCode)->first();
            
            if ($promo && $promo->isValid()) {
                $scopeData = $promo->scope_data ?? [];
                
                // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¸ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð° Ðº Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñƒ
                if ($promo->scope_type === 'global' || isset($scopeData[$tenantId])) {
                    if ($promo->type === 'fixed') {
                        $discount = $promo->value;
                    } else {
                        $discount = ($subtotal * $promo->value) / 100;
                    }
                } else {
                    session()->forget($promoKey);
                }
            } else {
                session()->forget($promoKey);
            }
        }

        $total = max(0, $subtotal - $discount);

        // Ð˜Ñ‰ÐµÐ¼ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñ‹, ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ â€” Ð±ÐµÑ€ÐµÐ¼ Ð¾Ð±Ñ‰Ð¸Ð¹
        $view = "tenants.{$tenantId}.cart";
        if (!view()->exists($view)) {
            $view = 'cart.index';
        }

        return view($view, compact('cartItems', 'subtotal', 'discount', 'total', 'promoCode'));
    }

    // --- Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐ˜Ð• Ð¢ÐžÐ’ÐÐ Ð ---
    public function addToCart(Request $request)
    {
        $this->resolveTenant();
        
        $product = Product::findOrFail($request->product_id);
        
        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÐµÑÑ‚ÑŒ Ð»Ð¸ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð² Ñƒ Ñ‚Ð¾Ð²Ð°Ñ€Ð°
        $hasVariants = $product->variants()->count() > 0;

        $request->validate([
            'product_id' => 'required|exists:products,id',
            // Ð•ÑÐ»Ð¸ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ ÐµÑÑ‚ÑŒ, Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½
            'size' => $hasVariants ? 'required|string' : 'nullable|string',
        ]);

        $size = $request->size ?? 'One Size';
        
        // Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð°
        if ($hasVariants) {
            $variant = $product->variants()->where('size', $size)->first();
            if (!$variant) {
                return back()->with('error', 'Selected size is invalid.');
            }
            if ($variant->stock <= 0) {
                return back()->with('error', 'Selected size is out of stock.');
            }
        } else {
             if ($product->stock_quantity <= 0) {
                 return back()->with('error', 'Product is out of stock.');
             }
        }
        
        $rowId = $product->id . '_' . $size;
        $cartKey = $this->getCartKey();

        $cart = session()->get($cartKey, []);

        if (isset($cart[$rowId])) {
            $cart[$rowId]['quantity']++;
        } else {
            $cart[$rowId] = [
                'product_id' => $product->id,
                'size' => $size,
                'quantity' => 1
            ];
        }

        session()->put($cartKey, $cart);

        return redirect()->route('cart.index')->with('success', 'Product added to cart!');
    }

    // --- Ð£Ð”ÐÐ›Ð•ÐÐ˜Ð• Ð˜Ð— ÐšÐžÐ Ð—Ð˜ÐÐ« ---
    public function removeFromCart($rowId)
    {
        $this->resolveTenant();
        $cartKey = $this->getCartKey();
        
        $cart = session()->get($cartKey, []);
        if (isset($cart[$rowId])) {
            unset($cart[$rowId]);
            session()->put($cartKey, $cart);
        }
        return back()->with('success', 'Item removed.');
    }

    // --- ÐŸÐ ÐžÐœÐžÐšÐžÐ” ---
    public function applyPromo(Request $request)
    {
        $this->resolveTenant();
        
        $request->validate(['code' => 'required|string']);
        $code = Str::upper($request->code);

        $promo = PromoCode::where('code', $code)->first();

        if (!$promo || !$promo->isValid()) {
            return back()->with('error', 'Invalid or expired promo code.');
        }

        session()->put($this->getPromoKey(), $code);

        return back()->with('success', 'Promo code applied!');
    }

    // --- ÐžÐ¤ÐžÐ ÐœÐ›Ð•ÐÐ˜Ð• Ð—ÐÐšÐÐ—Ð (CHECKOUT) ---
    public function checkout(Request $request)
    {
        $this->resolveTenant();
        
        // 1. Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ
        $validated = $request->validate([
            'customer_name' => 'required|string|max:255',
            'customer_email' => 'required|email',
            // Regex Ð´Ð»Ñ ÑƒÐºÑ€Ð°Ð¸Ð½ÑÐºÐ¸Ñ… Ð½Ð¾Ð¼ÐµÑ€Ð¾Ð² (+380... Ð¸Ð»Ð¸ 0...)
            'customer_phone' => ['required', 'string', 'regex:/^(\+380|0)[0-9]{9}$/'],
            'shipping_method' => 'required|in:nova_poshta,courier,pickup',
            'shipping_address' => 'required|string|min:5',
        ], [
            'customer_phone.regex' => 'Please enter a valid Ukrainian phone number (e.g., 0971234567 or +380...)'
        ]);

        // ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·ÑƒÐµÐ¼ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ Ð¿ÐµÑ€ÐµÐ´ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð¼/ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼
        $normalizedPhone = $this->normalizePhone($validated['customer_phone']);

        $cartKey = $this->getCartKey();
        $promoKey = $this->getPromoKey();
        $cart = session()->get($cartKey, []);

        if (empty($cart)) {
            return back()->with('error', 'Your cart is empty.');
        }

        // 2. Ð Ð°ÑÑ‡ÐµÑ‚ Ð¸ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð¾ÐºÐ¾Ð²
        $subtotal = 0;
        $orderItemsData = [];
        
        foreach ($cart as $item) {
            $product = Product::find($item['product_id']);
            if (!$product) continue;

            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð¾ÐºÐ°
            $variant = $product->variants()->where('size', $item['size'])->first();
            
            if ($variant && $variant->stock < $item['quantity']) {
                return back()->with('error', "Sorry, size {$item['size']} for {$product->name} is out of stock.");
            }
            if (!$variant && $product->stock_quantity < $item['quantity']) {
                return back()->with('error', "Sorry, {$product->name} is out of stock.");
            }

            $price = $product->current_price;
            $lineTotal = $price * $item['quantity'];
            $subtotal += $lineTotal;

            $orderItemsData[] = [
                'product' => $product,
                'size' => $item['size'],
                'quantity' => $item['quantity'],
                'price' => $price,
                'total' => $lineTotal,
            ];
        }

        $discount = 0;
        $promoCode = session()->get($promoKey);
        
        if ($promoCode) {
            $promo = PromoCode::where('code', $promoCode)->first();
            if ($promo && $promo->isValid()) {
                 $discount = ($promo->type === 'fixed') ? $promo->value : ($subtotal * $promo->value / 100);
            }
        }
        $total = max(0, $subtotal - $discount);

        // 3. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð° (Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ñ)
        try {
            $generatedPassword = null;
            $user = null;

            DB::transaction(function () use ($validated, $normalizedPhone, $subtotal, $discount, $total, $promoCode, $orderItemsData, &$generatedPassword, &$user) {
                
                // Ð) ÐŸÐ¾Ð¸ÑÐº Ð¸Ð»Ð¸ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ð¾ Ð½Ð¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¼Ñƒ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ
                $user = User::where('phone', $normalizedPhone)->first();

                if (!$user) {
                    $generatedPassword = Str::random(8); // Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ
                    $user = User::create([
                        'name' => $validated['customer_name'],
                        'email' => $validated['customer_email'],
                        'phone' => $normalizedPhone,
                        'password' => Hash::make($generatedPassword),
                        'role' => 'client',
                    ]);
                }

                // Ð‘) Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð° Ñ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¾Ð¹ (user_id)
                $order = Order::create([
                    'order_number' => 'ORD-' . date('Ymd') . '-' . strtoupper(Str::random(5)),
                    'user_id' => $user->id,
                    'customer_name' => $validated['customer_name'],
                    'customer_email' => $validated['customer_email'],
                    'customer_phone' => $normalizedPhone,
                    'shipping_method' => $validated['shipping_method'],
                    'shipping_address' => $validated['shipping_address'],
                    'subtotal' => $subtotal,
                    'discount_amount' => $discount,
                    'total_amount' => $total,
                    'promo_code' => $promoCode,
                    'status' => 'new',
                    'payment_method' => 'cod',
                ]);

                // Ð’) Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ð¸ ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÑÑ‚Ð¾ÐºÐ°
                foreach ($orderItemsData as $data) {
                    OrderItem::create([
                        'order_id' => $order->id,
                        'product_id' => $data['product']->id,
                        'product_name' => $data['product']->name,
                        'sku' => $data['product']->sku,
                        'size' => $data['size'],
                        'quantity' => $data['quantity'],
                        'price' => $data['price'],
                        'total' => $data['total'],
                    ]);

                    $variant = $data['product']->variants()->where('size', $data['size'])->first();
                    if ($variant) {
                        $variant->decrement('stock', $data['quantity']);
                    }
                    $data['product']->decrement('stock_quantity', $data['quantity']);
                }

                // Ð“) Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð² Telegram
                $this->sendTelegramNotification($order);
                
                // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ID Ð·Ð°ÐºÐ°Ð·Ð° (Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð½Ð°Ð´Ð¾Ð±Ð¸Ñ‚ÑŒÑÑ)
                session()->flash('last_order_id', $order->id);
            });

            // 4. ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñ‹ Ð­Ð¢ÐžÐ“Ðž Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
            session()->forget([$cartKey, $promoKey]);

            // 5. Ð›Ð¾Ð³Ð¸ÐºÐ° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸
            
            // Ð•ÑÐ»Ð¸ Ð¼Ñ‹ ÐÐ´Ð¼Ð¸Ð½ Ð¸Ð»Ð¸ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ â€” ÐÐ• Ð»Ð¾Ð³Ð¸Ð½Ð¸Ð¼ÑÑ ÐºÐ°Ðº ÐºÐ»Ð¸ÐµÐ½Ñ‚, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð¿Ð¾Ñ‚ÐµÑ€ÑÑ‚ÑŒ Ð°Ð´Ð¼Ð¸Ð½ÐºÑƒ
            if (Auth::check() && in_array(Auth::user()->role, ['super_admin', 'manager'])) {
                return redirect()->route('home')->with('success', "Order placed successfully. Admin session preserved. Order linked to User ID: {$user->id}");
            }

            // Ð•ÑÐ»Ð¸ Ð¼Ñ‹ Ð³Ð¾ÑÑ‚ÑŒ â€” Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·ÑƒÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
            Auth::login($user);

            // ÐŸÐµÑ€ÐµÐ´Ð°ÐµÐ¼ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð²Ð¾ flash, ÐµÑÐ»Ð¸ Ð¾Ð½ Ð±Ñ‹Ð» ÑÐ¾Ð·Ð´Ð°Ð½
            if ($generatedPassword) {
                session()->flash('generated_password', $generatedPassword);
                session()->flash('new_account_created', true);
            }

            // 6. Ð ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚ Ð² ÐºÐ°Ð±Ð¸Ð½ÐµÑ‚
            return redirect()->route('client.profile')->with('success', 'Order placed successfully! Welcome to your profile.');

        } catch (\Exception $e) {
            Log::error("Checkout Error: " . $e->getMessage());
            return back()->with('error', 'Checkout failed: ' . $e->getMessage());
        }
    }

    // --- TELEGRAM ---
    private function sendTelegramNotification($order)
    {
        $tenantId = $this->tenantService->getCurrentTenantId();
        
        $config = TelegramConfig::where('tenant_id', $tenantId)->where('is_active', true)->first();
        if (!$config) {
            $config = TelegramConfig::whereNull('tenant_id')->where('is_active', true)->first();
        }

        if ($config) {
            $itemsList = "";
            foreach ($order->items as $item) {
                $itemsList .= "- {$item->product_name} ({$item->size}) x{$item->quantity}\n";
            }

            $message = "ðŸ†• *New Order #{$order->order_number}*\n" .
                       "Store: " . strtoupper($tenantId) . "\n" .
                       "Customer: {$order->customer_name}\n" .
                       "Phone: {$order->customer_phone}\n" .
                       "Total: *$" . $order->total_amount . "*\n" .
                       "----------------\n" .
                       $itemsList . 
                       "\nDelivery: {$order->shipping_method}\n" .
                       "Address: {$order->shipping_address}";

            try {
                Http::post("https://api.telegram.org/bot{$config->bot_token}/sendMessage", [
                    'chat_id' => $config->chat_id,
                    'text' => $message,
                    'parse_mode' => 'Markdown',
                ]);
            } catch (\Exception $e) {
                Log::error("Telegram Send Error: " . $e->getMessage());
            }
        }
    }
}
</file>

<file path="app/Models/Order.php">
<?php
// FILE: app/Models/Order.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Order extends Model
{
    use HasFactory;

    protected $fillable = [
        'order_number',
        'user_id',          // <--- Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð·Ð°ÐºÐ°Ð· Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ
        'customer_name',
        'customer_email',
        'customer_phone',
        'shipping_method',
        'shipping_address',
        'subtotal',
        'discount_amount',
        'total_amount',
        'promo_code',
        'status',
        'payment_method',
        'payment_status'
    ];

    // Ð¡Ð²ÑÐ·ÑŒ Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð°Ð¼Ð¸
    public function items()
    {
        return $this->hasMany(OrderItem::class);
    }
    
    // Ð¡Ð²ÑÐ·ÑŒ Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ (ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼)
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    // Ð¥ÐµÐ»Ð¿ÐµÑ€ Ð´Ð»Ñ Ñ†Ð²ÐµÑ‚Ð¾Ð² ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð² Ð°Ð´Ð¼Ð¸Ð½ÐºÐµ
    public function getStatusColorAttribute()
    {
        return match($this->status) {
            'new' => 'blue',
            'processing' => 'yellow',
            'shipped' => 'purple',
            'completed' => 'green',
            'cancelled' => 'red',
            default => 'gray',
        };
    }
}
</file>

<file path="app/Models/User.php">
<?php
// FILE: app/Models/User.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
    use HasFactory, Notifiable;

    protected $fillable = [
        'name',
        'email',
        'password',
        'phone',      
        'role',       
        'tenant_id',
        'access_key', // <--- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾
    ];

    protected $hidden = [
        'password',
        'remember_token',
        'access_key', // Ð¡ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð¿Ñ€Ð¸ ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð°Ñ†Ð¸Ð¸ Ð² Ð¼Ð°ÑÑÐ¸Ð² (Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ)
    ];

    protected $casts = [
        'email_verified_at' => 'datetime',
        'password' => 'hashed',
        'access_key' => 'encrypted', // <--- ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð§Ð•Ð¡ÐšÐžÐ• Ð¨Ð˜Ð¤Ð ÐžÐ’ÐÐÐ˜Ð•/Ð”Ð•Ð¨Ð˜Ð¤Ð ÐžÐ’ÐšÐ
    ];

    public function orders()
    {
        return $this->hasMany(Order::class)->latest();
    }
}
</file>

<file path="app/Services/ProductService.php">
<?php
// FILE: app/Services/ProductService.php

namespace App\Services;

use App\Models\Product;
use App\Models\ProductImage;
use App\Models\ProductVariant;
use Illuminate\Support\Facades\Storage;

class ProductService
{
    public function create(array $data)
    {
        // Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ (Ñ€Ð°Ð·Ð¼ÐµÑ€Ñ‹ Ñ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾Ð¼)
        $variantsData = $data['variants'] ?? [];
        $images = $data['images'] ?? [];
        
        unset($data['images'], $data['variants']);

        // Ð•ÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½Ñ‹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹, ÑÑ‡Ð¸Ñ‚Ð°ÐµÐ¼ Ð¾Ð±Ñ‰Ð¸Ð¹ ÑÑ‚Ð¾Ðº
        if (!empty($variantsData)) {
            $data['stock_quantity'] = array_sum(array_column($variantsData, 'stock'));
        }

        $product = Product::create($data);

        // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹
        if (!empty($variantsData)) {
            foreach ($variantsData as $variant) {
                if (!empty($variant['size'])) {
                    ProductVariant::create([
                        'product_id' => $product->id,
                        'size' => $variant['size'],
                        'stock' => (int)$variant['stock']
                    ]);
                }
            }
        }

        // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ
        if (!empty($images)) {
            foreach ($images as $index => $file) {
                $path = $file->store('media', 'tenant');
                ProductImage::create([
                    'product_id' => $product->id,
                    'path' => $path,
                    'sort_order' => $index
                ]);
            }
        }

        return $product;
    }

    public function update(Product $product, array $data)
    {
        // 1. ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð²
        // Ð¡Ð°Ð¼Ñ‹Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±: ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð¸ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ðµ (Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ñ‹ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸)
        // Ð’ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ Ð»ÑƒÑ‡ÑˆÐµ Ð´ÐµÐ»Ð°Ñ‚ÑŒ updateOrCreate Ð¿Ð¾ ID
        if (isset($data['variants'])) {
            $product->variants()->delete(); // Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ
            $totalStock = 0;
            
            foreach ($data['variants'] as $variant) {
                if (!empty($variant['size'])) {
                    ProductVariant::create([
                        'product_id' => $product->id,
                        'size' => $variant['size'],
                        'stock' => (int)$variant['stock']
                    ]);
                    $totalStock += (int)$variant['stock'];
                }
            }
            $data['stock_quantity'] = $totalStock; // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð¾Ð±Ñ‰Ð¸Ð¹ ÑÑ‚Ð¾Ðº
            
            // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ JSON Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¾Ð² Ñ‚Ð¾Ð¶Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð¸ÑÐº Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»
            // Ð‘ÐµÑ€ÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð¼ÐµÐ½Ð° Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð²
            $sizeNames = array_map(fn($v) => $v['size'], $data['variants']);
            $currentAttributes = $product->attributes;
            $currentAttributes['size'] = $sizeNames;
            $data['attributes'] = $currentAttributes;
        }

        // 2. Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ (Ð›Ð¾Ð³Ð¸ÐºÐ° Ð¸Ð· Ð¿Ñ€Ð¾ÑˆÐ»Ð¾Ð³Ð¾ ÑˆÐ°Ð³Ð°)
        if (!empty($data['new_images'])) {
            $maxOrder = $product->images()->max('sort_order') ?? -1;
            foreach ($data['new_images'] as $file) {
                $path = $file->store('media', 'tenant');
                ProductImage::create([
                    'product_id' => $product->id,
                    'path' => $path,
                    'sort_order' => ++$maxOrder
                ]);
            }
        }

        if (!empty($data['deleted_images'])) {
            $imagesToDelete = ProductImage::whereIn('id', $data['deleted_images'])
                                          ->where('product_id', $product->id)->get();
            foreach ($imagesToDelete as $img) {
                Storage::disk('tenant')->delete($img->path);
                $img->delete();
            }
        }

        if (!empty($data['sorted_images'])) {
            $orderMap = array_flip($data['sorted_images']);
            foreach ($product->images()->get() as $img) {
                if (isset($orderMap[$img->id])) {
                    $img->update(['sort_order' => $orderMap[$img->id]]);
                }
            }
        }

        unset($data['new_images'], $data['deleted_images'], $data['sorted_images'], $data['variants']);
        
        $product->update($data);
        return $product;
    }

    public function delete(Product $product)
    {
        foreach ($product->images as $img) {
            Storage::disk('tenant')->delete($img->path);
        }
        $product->images()->delete();
        $product->variants()->delete(); // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹
        $product->delete();
    }
}
</file>

<file path="resources/views/admin/products/index.blade.php">
<!-- FILE: resources/views/admin/products/index.blade.php -->
        @extends('layouts.admin')
        @section('title', 'Products')

        @section('content')
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h1 class="text-2xl font-bold">Products Inventory</h1>
                
                <div class="flex gap-4 items-center">
                    <a href="{{ route('admin.products.create', ['tenant_id' => $currentTenantId]) }}" class="bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-500 shadow">
                        + Add Product
                    </a>
                </div>
            </div>

            <!-- Toolbar: Filter -->
                <div class="bg-white p-4 rounded shadow mb-6 border border-gray-200">
        <form method="GET" action="{{ route('admin.products.index') }}" class="grid grid-cols-1 md:grid-cols-5 gap-4">
            
            <!-- 1. STORE FILTER (Super Admin Only) -->
            @if(auth()->user()->role === 'super_admin')
                <div class="col-span-1">
                    <label class="block text-xs font-bold text-gray-500 mb-1">Store Context</label>
                    <select name="tenant_id" class="w-full border p-2 rounded bg-yellow-50 border-yellow-200" onchange="this.form.submit()">
                        <option value="">ALL STORES (Overview)</option>
                        @foreach(config('tenants.tenants') as $id => $data)
                            <option value="{{ $id }}" {{ $currentTenantId === $id ? 'selected' : '' }}>
                                {{ $data['name'] }}
                            </option>
                        @endforeach
                    </select>
                </div>
            @endif

            <!-- 2. SEARCH -->
            <div class="{{ auth()->user()->role === 'super_admin' ? 'col-span-1' : 'col-span-2' }}">
                <label class="block text-xs font-bold text-gray-500 mb-1">Search</label>
                <input type="text" name="search" value="{{ request('search') }}" placeholder="Name or SKU..." class="w-full border p-2 rounded">
            </div>

            <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½ (Ñ‚Ð°Ðº ÐºÐ°Ðº ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ñƒ Ð²ÑÐµÑ… Ñ€Ð°Ð·Ð½Ñ‹Ðµ) -->
            @if($currentTenantId)
                <!-- 3. CATEGORY -->
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Category</label>
                    <select name="category_id" class="w-full border p-2 rounded" onchange="this.form.submit()">
                        <option value="">All Categories</option>
                        @foreach($categories as $cat)
                            <option value="{{ $cat->id }}" {{ request('category_id') == $cat->id ? 'selected' : '' }}>{{ $cat->name }}</option>
                        @endforeach
                    </select>
                </div>

                <!-- 4. ATTRIBUTES -->
                <div class="flex gap-2">
                    <div class="w-1/2">
                        <label class="block text-xs font-bold text-gray-500 mb-1">Type</label>
                        <select name="type" class="w-full border p-2 rounded" onchange="this.form.submit()">
                            <option value="">Any</option>
                            @foreach($types as $t)
                                <option value="{{ $t->value }}" {{ request('type') == $t->value ? 'selected' : '' }}>{{ $t->value }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="w-1/2">
                        <label class="block text-xs font-bold text-gray-500 mb-1">Size</label>
                        <select name="size" class="w-full border p-2 rounded" onchange="this.form.submit()">
                            <option value="">Any</option>
                            @foreach($sizes as $s)
                                <option value="{{ $s->value }}" {{ request('size') == $s->value ? 'selected' : '' }}>{{ $s->value }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
            @else
                <div class="col-span-2 flex items-center text-xs text-gray-400 italic">
                    Select a specific store to filter by Category/Attributes.
                </div>
            @endif

            <!-- 5. SUBMIT -->
            <div class="flex items-end">
                <button class="w-full bg-gray-800 text-white p-2 rounded hover:bg-gray-700 font-bold">Filter</button>
            </div>
        </form>
    </div>

            <!-- Product List -->
            <div class="bg-white rounded shadow overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="p-4 text-sm font-bold text-gray-600">Product</th>
                            <th class="p-4 text-sm font-bold text-gray-600">Price & Offers</th>
                            <th class="p-4 text-sm font-bold text-gray-600">Stock</th>
                            <th class="p-4 text-sm font-bold text-gray-600">Category</th>
                            @if(auth()->user()->role === 'super_admin' && !$currentTenantId)
                                <th class="p-4 text-sm font-bold text-gray-600">Store</th>
                            @endif
                            <th class="p-4 text-sm font-bold text-gray-600 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @forelse($products as $product)
                            <tr class="border-b hover:bg-gray-50 group">
                                <td class="p-4">
                                    <div class="flex items-center gap-3">
                                        <div class="relative">
                                            <img src="{{ $product->cover_url }}" class="h-12 w-12 rounded object-cover border bg-gray-100">
                                            <!-- PROMO BADGE (Ð•ÑÐ»Ð¸ ÑƒÑ‡Ð°ÑÑ‚Ð²ÑƒÐµÑ‚ Ð² Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ðµ) -->
                                            @if($product->applicable_promos->isNotEmpty())
                                                <div class="absolute -top-2 -right-2 bg-purple-600 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full shadow border border-white" title="Active Promo Code">
                                                    PROMO
                                                </div>
                                            @endif
                                        </div>
                                        <div>
                                            <div class="font-bold text-gray-800">{{ $product->name }}</div>
                                            <div class="text-xs text-gray-500 font-mono">{{ $product->sku }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="p-4">
                                    @if($product->has_discount)
                                        <div class="flex flex-col">
                                            <span class="text-red-600 font-bold">${{ $product->sale_price }}</span>
                                            <span class="text-xs text-gray-400 line-through">${{ $product->price }}</span>
                                        </div>
                                    @else
                                        <span class="font-bold">${{ $product->price }}</span>
                                    @endif

                                    <!-- Text info about Promo -->
                                    @foreach($product->applicable_promos as $promo)
                                        <div class="text-[10px] text-purple-600 font-bold mt-1 bg-purple-50 px-1 rounded inline-block">
                                            code: {{ $promo->code }}
                                        </div>
                                    @endforeach
                                </td>
                                <td class="p-4">
                                    @if($product->stock_quantity > 0)
                                        <span class="text-green-600 font-bold">{{ $product->stock_quantity }}</span>
                                        <span class="text-xs text-gray-400">in stock</span>
                                    @else
                                        <span class="text-red-500 font-bold">Out of Stock</span>
                                    @endif
                                </td>
                                <td class="p-4">
                                    <div class="flex flex-wrap gap-1">
                                        @foreach($product->categories as $cat)
                                            <span class="text-xs bg-gray-100 px-2 py-1 rounded">{{ $cat->name }}</span>
                                        @endforeach
                                    </div>
                                    @if($product->clothingLine)
                                        <div class="mt-1 text-xs text-blue-500 font-bold">
                                            Line: {{ $product->clothingLine->name }}
                                        </div>
                                    @endif
                                </td>
                                @if(auth()->user()->role === 'super_admin' && !$currentTenantId)
                                    <td class="p-4 text-xs text-gray-500">{{ $product->tenant_name }}</td>
                                @endif
                                <td class="p-4 text-right">
                                    <div class="flex justify-end gap-2">
                                        <a href="{{ $product->preview_url }}" target="_blank" class="text-gray-400 hover:text-blue-600 p-1" title="Preview">
                                            ðŸ‘ï¸
                                        </a>
                                        <a href="{{ route('admin.products.edit', [$product->id, 'tenant_id' => $product->tenant_id ?? $currentTenantId]) }}" class="text-blue-600 hover:text-blue-800 p-1 font-bold">Edit</a>
                                        <form action="{{ route('admin.products.destroy', [$product->id, 'tenant_id' => $product->tenant_id ?? $currentTenantId]) }}" method="POST" onsubmit="return confirm('Delete this product?');" class="inline">
                                            @csrf
                                            @method('DELETE')
                                            <button class="text-red-500 hover:text-red-700 p-1 font-bold">&times;</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        @empty
                            <tr>
                                <td colspan="6" class="p-8 text-center text-gray-400 italic">No products found.</td>
                            </tr>
                        @endforelse
                    </tbody>
                </table>
                <!-- ÐŸÐ°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ ÑÑ‚Ð¾ Ð½Ðµ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ñ ALL -->
                @if($products instanceof \Illuminate\Pagination\LengthAwarePaginator)
                    <div class="p-4 border-t">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
        @endsection
</file>

<file path="resources/views/admin/users/index.blade.php">
<!-- FILE: resources/views/admin/users/index.blade.php -->
@extends('layouts.admin')
@section('title', 'Customers')

@section('content')
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">Customer Management</h1>
    </div>

    <!-- FILTERS -->
    <div class="bg-white p-4 rounded shadow mb-6 border border-gray-200">
        <form method="GET" action="{{ route('admin.users.index') }}" class="flex gap-4 items-end">
            
            {{-- Ð’Ñ‹Ð±Ð¾Ñ€ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° (Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð¡ÑƒÐ¿ÐµÑ€-ÐÐ´Ð¼Ð¸Ð½Ð°) --}}
            @if(auth()->user()->role === 'super_admin')
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Store Context</label>
                    <select name="tenant_id" class="border p-2 rounded bg-yellow-50 font-bold text-gray-800" onchange="this.form.submit()">
                        @foreach(config('tenants.tenants') as $id => $data)
                            <option value="{{ $id }}" {{ $currentTenantId == $id ? 'selected' : '' }}>
                                ðŸª {{ $data['name'] }}
                            </option>
                        @endforeach
                    </select>
                </div>
            @endif

            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 mb-1">Search Customer</label>
                <input type="text" name="search" value="{{ request('search') }}" placeholder="Name, Email or Phone (+380...)" class="border p-2 rounded w-full">
            </div>

            <button class="bg-blue-600 text-white px-6 py-2 rounded font-bold hover:bg-blue-500">
                Find
            </button>
        </form>
    </div>

    <!-- TABLE -->
    <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="p-4 font-bold text-gray-600">ID</th>
                    <th class="p-4 font-bold text-gray-600">Name</th>
                    <th class="p-4 font-bold text-gray-600">Contact Info</th>
                    <th class="p-4 font-bold text-gray-600">Registered</th>
                    <th class="p-4 font-bold text-gray-600 text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                @forelse($users as $user)
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-4 text-gray-500">#{{ $user->id }}</td>
                        <td class="p-4 font-bold">
                            {{ $user->name }}
                        </td>
                        <td class="p-4">
                            <div class="font-mono text-sm">{{ $user->phone }}</div>
                            <div class="text-xs text-gray-500">{{ $user->email }}</div>
                        </td>
                        <td class="p-4 text-sm text-gray-500">
                            {{ $user->created_at->format('d M Y') }}
                        </td>
                        <td class="p-4 text-right">
                            <a href="{{ route('admin.users.show', ['user' => $user->id, 'tenant_id' => $currentTenantId]) }}" 
                               class="bg-gray-800 text-white px-3 py-1 rounded text-sm font-bold hover:bg-gray-700">
                                Profile & Orders
                            </a>
                        </td>
                    </tr>
                @empty
                    <tr>
                        <td colspan="5" class="p-8 text-center text-gray-400">No customers found in this store.</td>
                    </tr>
                @endforelse
            </tbody>
        </table>
        <div class="p-4">{{ $users->withQueryString()->links() }}</div>
    </div>
@endsection
</file>

<file path="resources/views/layouts/app.blade.php">
<!-- FILE: resources/views/layouts/app.blade.php -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@yield('title') - @yield('brand_name', 'TriShop')</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    {{-- ÐžÐŸÐ Ð•Ð”Ð•Ð›Ð•ÐÐ˜Ð• Ð¢Ð•ÐœÐ« --}}
    @php
        $tenantId = app(\App\Services\TenantService::class)->getCurrentTenantId();
        
        // ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
        $theme = [
            'font' => 'sans-serif',
            'bg-body' => '#f3f4f6',
            'text-main' => '#1f2937',
            'text-muted' => '#9ca3af',
            'color-primary' => '#3b82f6', // Ð¡Ð¸Ð½Ð¸Ð¹
            'color-primary-text' => '#ffffff',
            'color-border' => '#e5e7eb',
            'radius' => '0.5rem',
        ];

        // 1. STREET STYLE (ÐÐ³Ñ€ÐµÑÑÐ¸Ð²Ð½Ñ‹Ð¹, Ð¢ÐµÐ¼Ð½Ñ‹Ð¹, Ð–ÐµÐ»Ñ‚Ñ‹Ð¹)
        if ($tenantId === 'street_style') {
            $theme = [
                'font' => 'ui-sans-serif, system-ui, sans-serif',
                'bg-body' => '#000000',
                'text-main' => '#ffffff',
                'text-muted' => '#9ca3af',
                'color-primary' => '#facc15', // Ð–ÐµÐ»Ñ‚Ñ‹Ð¹
                'color-primary-text' => '#000000',
                'color-border' => '#374151',
                'radius' => '0px', // ÐžÑÑ‚Ñ€Ñ‹Ðµ ÑƒÐ³Ð»Ñ‹
                'transform' => 'skewX(-10deg)', // ÐÐ°ÐºÐ»Ð¾Ð½ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
            ];
        }
        
        // 2. DESIGNER HUB (ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»Ð¸Ð·Ð¼, Ð¡Ð²ÐµÑ‚Ð»Ñ‹Ð¹, Ð§ÐµÑ€Ð½Ð¾-Ð±ÐµÐ»Ñ‹Ð¹)
        if ($tenantId === 'designer_hub') {
            $theme = [
                'font' => 'ui-serif, Georgia, serif',
                'bg-body' => '#ffffff',
                'text-main' => '#111827',
                'text-muted' => '#6b7280',
                'color-primary' => '#000000', // Ð§ÐµÑ€Ð½Ñ‹Ð¹
                'color-primary-text' => '#ffffff',
                'color-border' => '#e5e7eb',
                'radius' => '0px',
                'transform' => 'none',
            ];
        }

        // 3. MILITARY GEAR (Ð¢Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹, Ð¢ÐµÐ¼Ð½Ð¾-ÑÐµÑ€Ñ‹Ð¹, ÐžÑ€Ð°Ð½Ð¶ÐµÐ²Ñ‹Ð¹)
        if ($tenantId === 'military_gear') {
            $theme = [
                'font' => 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace',
                'bg-body' => '#1c1917', // Stone 900
                'text-main' => '#e7e5e4', // Stone 200
                'text-muted' => '#78716c',
                'color-primary' => '#ea580c', // Orange 600
                'color-primary-text' => '#ffffff',
                'color-border' => '#44403c',
                'radius' => '2px',
                'transform' => 'none',
            ];
        }
    @endphp

    <style>
        :root {
            --font-main: {!! $theme['font'] !!};
            --bg-body: {!! $theme['bg-body'] !!};
            --text-main: {!! $theme['text-main'] !!};
            --text-muted: {!! $theme['text-muted'] !!};
            --color-primary: {!! $theme['color-primary'] !!};
            --color-primary-text: {!! $theme['color-primary-text'] !!};
            --color-border: {!! $theme['color-border'] !!};
            --radius: {!! $theme['radius'] !!};
            --transform-style: {!! $theme['transform'] ?? 'none' !!};
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-body);
            color: var(--text-main);
        }

        /* Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð² Tailwind */
        .theme-bg { background-color: var(--bg-body); }
        .theme-text { color: var(--text-main); }
        .theme-muted { color: var(--text-muted); }
        
        .theme-btn {
            background-color: var(--color-primary);
            color: var(--color-primary-text);
            border-radius: var(--radius);
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.3s;
        }
        .theme-btn:hover { opacity: 0.9; transform: scale(1.02); }

        .theme-border { border-color: var(--color-border); }
        .theme-card {
            border: 1px solid var(--color-border);
            background-color: rgba(255, 255, 255, 0.05); /* Ð›ÐµÐ³ÐºÐ°Ñ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ */
            border-radius: var(--radius);
        }
        
        .theme-input {
            background-color: transparent;
            border: 1px solid var(--color-border);
            color: var(--text-main);
            border-radius: var(--radius);
        }
        .theme-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }
        
        .theme-link {
            color: var(--text-main);
            text-decoration: none;
            border-bottom: 1px solid transparent;
        }
        .theme-link:hover {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .theme-skew {
            transform: var(--transform-style);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- Navbar -->
    <nav class="border-b theme-border py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="{{ route('home') }}" class="text-2xl font-bold tracking-widest uppercase">
                @yield('brand_name', 'TriShop')
            </a>
            <div class="flex gap-6 text-sm font-bold uppercase tracking-wider">
                <a href="{{ route('home') }}" class="theme-link">Shop</a>
                @auth
                    <a href="{{ route('client.profile') }}" class="theme-link">Cabinet</a>
                @else
                    <a href="{{ route('client.login') }}" class="theme-link">Login</a>
                @endauth
                <a href="{{ route('cart.index') }}" class="theme-link flex items-center gap-1">
                    Cart
                    @php
                        $tId = app(\App\Services\TenantService::class)->getCurrentTenantId();
                        $count = count(session("cart_{$tId}", []));
                    @endphp
                    @if($count > 0)
                        <span style="background-color: var(--color-primary); color: var(--color-primary-text);" class="text-[10px] rounded-full w-5 h-5 flex items-center justify-center">
                            {{ $count }}
                        </span>
                    @endif
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto mt-8 px-4">
        {{-- Flash Messages --}}
        @if(session('success'))
            <div class="p-4 mb-6 border theme-border" style="color: #22c55e;">
                {{ session('success') }}
            </div>
        @endif
        @if(session('error'))
            <div class="p-4 mb-6 border theme-border" style="color: #ef4444;">
                Error: {{ session('error') }}
            </div>
        @endif

        @yield('content')
    </main>

    <!-- Footer -->
    <footer class="mt-12 py-8 border-t theme-border text-center text-sm theme-muted">
        &copy; {{ date('Y') }} @yield('brand_name'). All rights reserved.
    </footer>
</body>
</html>
</file>

<file path="database/seeders/DatabaseSeeder.php">
<?php
// FILE: database/seeders/DatabaseSeeder.php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;
use App\Models\Product;
use App\Models\Category;
use App\Models\ClothingLine;
use App\Models\AttributeOption;
use App\Services\TenantService;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class DatabaseSeeder extends Seeder
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    public function run(): void
    {
        // 1. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (Ð² public ÑÑ…ÐµÐ¼Ðµ)
        // Ð”Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ñ‹ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ ÑŽÐ·ÐµÑ€Ð° Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð·, Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ
        if (!User::where('email', 'admin@trishop.com')->exists()) {
            User::create([
                'name' => 'Super Admin',
                'email' => 'admin@trishop.com',
                'password' => bcrypt('password'),
                'role' => 'super_admin',
            ]);
        }

        if (!User::where('email', 'manager@street.com')->exists()) {
            User::create([
                'name' => 'Street Manager',
                'email' => 'manager@street.com',
                'password' => bcrypt('password'),
                'role' => 'manager',
                'tenant_id' => 'street_style',
            ]);
        }

        // 2. ÐÐ°Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñ‹
        $this->seedStreetStyle();
        $this->seedDesignerHub();
        $this->seedMilitaryGear();
    }

    // --- STREET STYLE ---
    private function seedStreetStyle()
    {
        $this->tenantService->switchTenant('street_style');
        if (Product::count() > 0) return; // ÐÐµ Ð´ÑƒÐ±Ð»Ð¸Ñ€ÑƒÐµÐ¼, ÐµÑÐ»Ð¸ ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ

        $this->createLine('Urban Summer 2025');
        
        $products = [
            [
                'name' => 'Oversized Graffiti Hoodie',
                'sku' => 'ST-001', 'price' => 89.99, 'sale_price' => 69.99,
                'category' => 'Hoodies', 'type' => 'Hoodie', 'line' => 'Urban Summer 2025',
                'sizes' => ['M', 'L', 'XL'],
                'desc' => 'Cotton hoodie with graffiti print.'
            ],
            [
                'name' => 'Cargo Joggers Black',
                'sku' => 'ST-002', 'price' => 59.99, 'sale_price' => null,
                'category' => 'Pants', 'type' => 'Pants', 'line' => 'Urban Summer 2025',
                'sizes' => ['30', '32', '34'],
                'desc' => 'Tactical cargo pants with many pockets.'
            ],
            [
                'name' => 'Neon Bucket Hat',
                'sku' => 'ST-003', 'price' => 25.00, 'sale_price' => null,
                'category' => 'Accessories', 'type' => 'Hat', 'line' => null,
                'sizes' => ['One Size'],
                'desc' => 'Bright neon hat for parties.'
            ]
        ];

        foreach ($products as $p) $this->createProduct($p);
    }

    // --- DESIGNER HUB ---
    private function seedDesignerHub()
    {
        $this->tenantService->switchTenant('designer_hub');
        if (Product::count() > 0) return;

        $this->createLine('Milano Evening Collection');

        $products = [
            [
                'name' => 'Silk Evening Gown Red',
                'sku' => 'DH-501', 'price' => 450.00, 'sale_price' => 399.00,
                'category' => 'Dresses', 'type' => 'Dress', 'line' => 'Milano Evening Collection',
                'sizes' => ['XS', 'S', 'M'],
                'desc' => '100% Italian Silk. Handcrafted in Milan.'
            ],
            [
                'name' => 'Slim Fit Tuxedo',
                'sku' => 'DH-502', 'price' => 899.00, 'sale_price' => null,
                'category' => 'Suits', 'type' => 'Suit', 'line' => 'Milano Evening Collection',
                'sizes' => ['48', '50', '52'],
                'desc' => 'Classic black tuxedo for formal events.'
            ],
            [
                'name' => 'Diamond Studded Clutch',
                'sku' => 'DH-503', 'price' => 1200.00, 'sale_price' => null,
                'category' => 'Bags', 'type' => 'Bag', 'line' => null,
                'sizes' => ['One Size'],
                'desc' => 'Limited edition clutch with Swarovski crystals.'
            ]
        ];

        foreach ($products as $p) $this->createProduct($p);
    }

    // --- MILITARY GEAR ---
    private function seedMilitaryGear()
    {
        $this->tenantService->switchTenant('military_gear');
        if (Product::count() > 0) return;

        $this->createLine('Tactical Ops');

        $products = [
            [
                'name' => 'Combat Boots Desert',
                'sku' => 'MG-901', 'price' => 149.99, 'sale_price' => 129.99,
                'category' => 'Footwear', 'type' => 'Boots', 'line' => 'Tactical Ops',
                'sizes' => ['42', '43', '44', '45'],
                'desc' => 'Durable combat boots for rough terrain.'
            ],
            [
                'name' => 'Camouflage Tactical Vest',
                'sku' => 'MG-902', 'price' => 85.00, 'sale_price' => null,
                'category' => 'Vests', 'type' => 'Vest', 'line' => 'Tactical Ops',
                'sizes' => ['M', 'L', 'XL'],
                'desc' => 'Lightweight vest with MOLLE system.'
            ],
            [
                'name' => 'Survival Multi-Tool',
                'sku' => 'MG-903', 'price' => 45.00, 'sale_price' => null,
                'category' => 'Equipment', 'type' => 'Tool', 'line' => null,
                'sizes' => ['One Size'],
                'desc' => '15-in-1 tool for survival situations.'
            ]
        ];

        foreach ($products as $p) $this->createProduct($p);
    }

    // --- HELPERS ---

    private function createLine($name)
    {
        if (!$name) return null;
        return ClothingLine::firstOrCreate(['slug' => Str::slug($name)], ['name' => $name]);
    }

    private function createProduct($data)
    {
        // ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ
        $cat = Category::firstOrCreate(
            ['slug' => Str::slug($data['category'])],
            ['name' => $data['category']]
        );

        // Ð›Ð¸Ð½ÐµÐ¹ÐºÐ°
        $lineId = null;
        if ($data['line']) {
            $line = ClothingLine::where('name', $data['line'])->first();
            $lineId = $line ? $line->id : null;
        }

        // ÐÑ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹ (Ñ‚Ð¸Ð¿ Ð¸ Ñ€Ð°Ð·Ð¼ÐµÑ€)
        AttributeOption::firstOrCreate(['type' => 'product_type', 'slug' => Str::slug($data['type'])], ['value' => $data['type']]);
        foreach ($data['sizes'] as $size) {
            AttributeOption::firstOrCreate(['type' => 'size', 'slug' => Str::slug($size)], ['value' => $size]);
        }

        // ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚
        $product = Product::create([
            'name' => $data['name'],
            'slug' => Str::slug($data['name']),
            'sku' => $data['sku'],
            'price' => $data['price'],
            'sale_price' => $data['sale_price'],
            'stock_quantity' => 100,
            'description' => $data['desc'],
            'clothing_line_id' => $lineId,
            'attributes' => [
                'type' => $data['type'],
                'size' => $data['sizes']
            ]
        ]);

        // Ð¡Ð²ÑÐ·Ð¸
        $product->categories()->attach($cat->id);
        
        // Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹
        foreach ($data['sizes'] as $size) {
            $product->variants()->create([
                'size' => $size,
                'stock' => 20 // Ð”Ð°ÐµÐ¼ Ð¿Ð¾ 20 ÑˆÑ‚ÑƒÐº ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð°
            ]);
        }

        // ÐšÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ° (Ð·Ð°Ð³Ð»ÑƒÑˆÐºÐ°)
        $text = urlencode($data['name']);
        $product->images()->create([
            'path' => "https://placehold.co/600x600/e2e8f0/1e293b?text={$text}",
            'sort_order' => 0
        ]);
    }
}
</file>

<file path="app/Http/Controllers/Admin/UserController.php">
<?php
// FILE: app/Http/Controllers/Admin/UserController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\User;
use App\Models\Order;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

class UserController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    // Ð’ÑÐ¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ Ð´Ð»Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° (ÐºÐ°Ðº Ð² OrderController)
    private function resolveContext(Request $request)
    {
        if (auth()->user()->role === 'super_admin') {
            $tenantId = $request->get('tenant_id');
            // Ð•ÑÐ»Ð¸ tenant_id Ð¿ÐµÑ€ÐµÐ´Ð°Ð½, Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ. Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ â€” Ð¾ÑÑ‚Ð°ÐµÐ¼ÑÑ Ð² Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¼ Ð¸Ð»Ð¸ Ð´ÐµÑ„Ð¾Ð»Ñ‚Ð½Ð¾Ð¼.
            if ($tenantId) {
                $this->tenantService->switchTenant($tenantId);
                return $tenantId;
            }
        }
        return $this->tenantService->getCurrentTenantId();
    }

    // 1. Ð¡ÐŸÐ˜Ð¡ÐžÐš ÐšÐ›Ð˜Ð•ÐÐ¢ÐžÐ’
    public function index(Request $request)
    {
        $currentTenantId = $this->resolveContext($request);
        $isSuperAdmin = auth()->user()->role === 'super_admin';

        // Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ
        $query = User::where('role', 'client')->latest();

        if ($request->filled('search')) {
            $search = $request->search;
            $query->where(function($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                  ->orWhere('email', 'like', "%{$search}%")
                  ->orWhere('phone', 'like', "%{$search}%");
            });
        }

        $users = $query->paginate(20);

        return view('admin.users.index', compact('users', 'currentTenantId'));
    }

    // 2. ÐŸÐ ÐžÐ¤Ð˜Ð›Ð¬ ÐšÐ›Ð˜Ð•ÐÐ¢Ð (Ð¡ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÐµÐ¹ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²)
    public function show(Request $request, $id)
    {
        $this->resolveContext($request);

        $user = User::with(['orders' => function($q) {
            $q->latest();
        }])->findOrFail($id);

        return view('admin.users.show', compact('user'));
    }

    // 3. Ð¡ÐœÐ•ÐÐ ÐŸÐÐ ÐžÐ›Ð¯ (ÐÐ´Ð¼Ð¸Ð½Ð¾Ð¼)
    public function update(Request $request, $id)
    {
        $this->resolveContext($request);
        $user = User::findOrFail($id);

        // Ð•ÑÐ»Ð¸ Ð°Ð´Ð¼Ð¸Ð½ Ð½Ð°Ð¶Ð°Ð» "Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"
        if ($request->has('generate_password')) {
            $newPassword = Str::random(8); // ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ 8-Ð·Ð½Ð°Ñ‡Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ
            
            $user->update([
                'password' => Hash::make($newPassword),
                'access_key' => $newPassword // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð¸ ÐºÐ»ÑŽÑ‡ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»
            ]);

            return back()->with('success', "Password reset successfully. New Key: {$newPassword}");
        }

        return back();
    }
}
</file>

<file path="app/Http/Controllers/ShopController.php">
<?php
// FILE: app/Http/Controllers/ShopController.php

namespace App\Http\Controllers;

use App\Models\Product;
use App\Models\Category;
use App\Services\TenantService;
use Illuminate\Http\Request;

class ShopController extends Controller
{
    protected TenantService $tenantService;

    public function __construct(TenantService $tenantService)
    {
        $this->tenantService = $tenantService;
    }

    private function resolveTenant()
    {
        $host = request()->getHost();
        $map = $this->tenantService->getDomainMap();
        $tenantId = $map[$host] ?? 'default';
        $this->tenantService->switchTenant($tenantId);
        return $tenantId;
    }

    public function index()
    {
        $tenantId = $this->resolveTenant();

        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹ Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
        $products = Product::with('clothingLine')
            ->where('stock_quantity', '>', 0)
            ->latest()
            ->paginate(12);
            
        $categories = Category::all();

        // Ð›ÐžÐ“Ð˜ÐšÐ Ð’Ð«Ð‘ÐžÐ Ð Ð¨ÐÐ‘Ð›ÐžÐÐ
        // 1. Ð˜Ñ‰ÐµÐ¼ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½: resources/views/tenants/{id}/home.blade.php
        $view = "tenants.{$tenantId}.home";
        
        // 2. Ð•ÑÐ»Ð¸ ÐµÐ³Ð¾ Ð½ÐµÑ‚ (Ð¼Ñ‹ Ð¸Ñ… ÑƒÐ´Ð°Ð»Ð¸Ð»Ð¸ Ð´Ð»Ñ ÑƒÐ½Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸), Ð±ÐµÑ€ÐµÐ¼ ÐžÐ‘Ð©Ð˜Ð™: resources/views/shop/home.blade.php
        if (!view()->exists($view)) {
            $view = 'shop.home'; // Ð‘Ð«Ð›Ðž: shop.fallback_home (ÐžÐ¨Ð˜Ð‘ÐšÐ) -> Ð¡Ð¢ÐÐ›Ðž: shop.home
        }

        return view($view, compact('products', 'categories'));
    }

    public function show($slug)
    {
        $tenantId = $this->resolveTenant();

        $product = Product::where('slug', $slug)
            ->with(['variants', 'clothingLine', 'images'])
            ->firstOrFail();

        // Ð›ÐžÐ“Ð˜ÐšÐ Ð’Ð«Ð‘ÐžÐ Ð Ð¨ÐÐ‘Ð›ÐžÐÐ Ð¢ÐžÐ’ÐÐ Ð
        $view = "tenants.{$tenantId}.product";
        
        if (!view()->exists($view)) {
            $view = 'shop.product'; // Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° Ñ‚Ð¾Ð²Ð°Ñ€Ð°
        }

        return view($view, compact('product'));
    }
}
</file>

<file path="resources/views/admin/products/form.blade.php">
<!-- FILE: resources/views/admin/products/form.blade.php -->
@extends('layouts.admin')
@section('title', $title)

@section('content')
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">{{ $title }}</h1>
        @if($previewUrl)
            <a href="{{ $previewUrl }}" target="_blank" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-500 flex items-center gap-2 font-bold shadow">
                <span>ðŸ‘ï¸</span> Preview on Site
            </a>
        @endif
    </div>

    <div class="max-w-6xl mx-auto bg-white rounded shadow p-6" 
         x-data="{
            variants: {{ json_encode($product->variants->map(fn($v) => ['size' => $v->size, 'stock' => $v->stock])->values()->all()) }},
            manualStock: {{ $product->stock_quantity ?? 0 }},
            get hasVariants() { return this.variants.length > 0; },
            get calculatedStock() { return this.variants.reduce((sum, v) => sum + (parseInt(v.stock) || 0), 0); },
            get currentStock() { return this.hasVariants ? this.calculatedStock : this.manualStock; },
            addVariant() { this.variants.push({size: '', stock: 0}); },
            removeVariant(index) { this.variants.splice(index, 1); }
         }">
        
        <form action="{{ $action }}" method="POST" enctype="multipart/form-data" id="productForm">
            @csrf
            @if($method !== 'POST') @method($method) @endif
            @if(isset($currentTenantId)) <input type="hidden" name="tenant_id" value="{{ $currentTenantId }}"> @endif

            <!-- Ð’Ð«Ð‘ÐžÐ  ÐœÐÐ“ÐÐ—Ð˜ÐÐ -->
            @if(auth()->user()->role === 'super_admin' && !$product->exists)
                <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded">
                    <label class="block text-sm font-bold mb-2 text-yellow-800">Target Store</label>
                    <select name="target_tenant" class="w-full border p-2 rounded bg-white">
                        @foreach(config('tenants.tenants') as $id => $data)
                            <option value="{{ $id }}" {{ $currentTenantId == $id ? 'selected' : '' }}>{{ $data['name'] }}</option>
                        @endforeach
                    </select>
                </div>
            @endif

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Ð›Ð•Ð’ÐÐ¯ ÐšÐžÐ›ÐžÐÐšÐ -->
                <div class="lg:col-span-2 space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold mb-2">Name</label>
                            <input type="text" name="name" value="{{ old('name', $product->name) }}" class="w-full border p-2 rounded" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold mb-2">SKU</label>
                            <input type="text" name="sku" value="{{ old('sku', $product->sku) }}" class="w-full border p-2 rounded" required>
                        </div>
                    </div>
                    
                    <!-- PRICES & STOCK -->
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-bold mb-2">Regular Price ($)</label>
                            <input type="number" step="0.01" name="price" value="{{ old('price', $product->price) }}" class="w-full border p-2 rounded" required>
                        </div>
                        
                        <!-- SALE PRICE FIELD -->
                        <div>
                            <label class="block text-sm font-bold mb-2 text-red-600">Sale Price ($)</label>
                            <input type="number" step="0.01" name="sale_price" value="{{ old('sale_price', $product->sale_price) }}" class="w-full border p-2 rounded border-red-200 focus:border-red-500" placeholder="Optional">
                            <p class="text-[10px] text-gray-400 mt-1">Must be lower than Regular Price.</p>
                        </div>

                        <div>
                            <label class="block text-sm font-bold mb-2">Total Stock</label>
                            <input type="number" name="stock_quantity" :value="currentStock" @input="if(!hasVariants) manualStock = $event.target.value" :readonly="hasVariants" :class="hasVariants ? 'bg-gray-100 cursor-not-allowed text-gray-500' : 'bg-white'" class="w-full border p-2 rounded transition" required>
                        </div>
                    </div>

                    <!-- CLASSIFICATION -->
                    <div class="space-y-4 bg-gray-50 p-4 rounded border">
                        <h3 class="font-bold text-gray-700 border-b pb-2 mb-2">Classification & Inventory</h3>
                        
                        <!-- CATEGORIES -->
                        <div x-data="{ selected: {{ json_encode($product->categories ? $product->categories->map(fn($c) => ['id' => $c->id, 'name' => $c->name])->values() : []) }}, options: {{ $categories->map(fn($c) => ['id' => $c->id, 'name' => $c->name])->values() }}, newCat: '' }">
                             <label class="block text-sm font-bold mb-2">Categories</label>
                             <div class="flex flex-wrap gap-2 mb-2 p-2 border rounded bg-white min-h-[42px]">
                                <template x-for="(cat, index) in selected" :key="index">
                                    <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded flex items-center">
                                        <span x-text="cat.name"></span>
                                        <input type="hidden" name="categories[]" :value="cat.id || cat.name">
                                        <button type="button" @click="selected.splice(index, 1)" class="ml-1 text-blue-600 font-bold hover:text-red-500">&times;</button>
                                    </span>
                                </template>
                                <input type="text" x-model="newCat" @keydown.enter.prevent="if(newCat.trim()) { selected.push({name: newCat.trim()}); newCat = ''; }" @blur="if(newCat.trim()) { selected.push({name: newCat.trim()}); newCat = ''; }" placeholder="Add category..." class="outline-none flex-1 text-sm bg-transparent min-w-[100px]">
                             </div>
                             <div class="flex flex-wrap gap-1 max-h-24 overflow-y-auto">
                                <template x-for="opt in options">
                                    <button type="button" x-show="!selected.some(s => s.id === opt.id)" @click="selected.push(opt)" class="bg-gray-200 hover:bg-gray-300 text-xs px-2 py-1 rounded" x-text="opt.name"></button>
                                </template>
                             </div>
                        </div>

                        <!-- CLOTHING LINE -->
                        <div x-data="{ options: {{ $lines->pluck('name') }} }">
                            <label class="block text-sm font-bold mb-2">Clothing Line / Collection <span class="font-normal text-gray-400">(Optional)</span></label>
                            <input type="text" name="clothing_line" value="{{ old('clothing_line', optional($product->clothingLine)->name) }}" list="lineList" class="w-full border p-2 rounded" placeholder="e.g. Summer 2025">
                            <datalist id="lineList">
                                <template x-for="opt in options"><option :value="opt"></option></template>
                            </datalist>
                        </div>

                        <!-- TYPE -->
                        <div x-data="{ options: {{ $types->pluck('value') }} }">
                            <label class="block text-sm font-bold mb-2">Product Type</label>
                            <input type="text" name="attributes_type" value="{{ old('attributes_type', $product->attributes['type'] ?? '') }}" list="typeList" class="w-full border p-2 rounded" required>
                            <datalist id="typeList"><template x-for="opt in options"><option :value="opt"></option></template></datalist>
                        </div>

                        <!-- VARIANTS -->
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <label class="block text-sm font-bold">Size Variants</label>
                                <button type="button" @click="addVariant()" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 font-bold">+ Add Size</button>
                            </div>
                            <template x-if="hasVariants">
                                <div class="space-y-2">
                                    <template x-for="(variant, index) in variants" :key="index">
                                        <div class="flex gap-2 items-center bg-white p-2 rounded border shadow-sm">
                                            <div class="w-1/2">
                                                <select :name="`variants[${index}][size]`" x-model="variant.size" class="w-full border p-1 rounded text-sm bg-gray-50 uppercase font-mono" required>
                                                    <option value="" disabled>Select Size</option>
                                                    @foreach($sizes as $sizeOption)
                                                        <option value="{{ $sizeOption->value }}">{{ $sizeOption->value }}</option>
                                                    @endforeach
                                                </select>
                                            </div>
                                            <div class="w-1/3 relative">
                                                <input type="number" :name="`variants[${index}][stock]`" x-model="variant.stock" @input="calculateTotal()" placeholder="0" class="w-full border p-1 rounded text-sm pl-8 font-bold" min="0" required>
                                                <span class="absolute left-2 top-1.5 text-gray-400 text-xs">Qty:</span>
                                            </div>
                                            <button type="button" @click="removeVariant(index)" class="text-red-400 hover:text-red-600 font-bold px-2">&times;</button>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            <template x-if="!hasVariants">
                                <div class="text-sm text-gray-400 italic p-3 border border-dashed rounded text-center bg-gray-50">
                                    No size variants added. Stock is managed globally.
                                </div>
                            </template>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold mb-2">Description</label>
                        <textarea name="description" class="w-full border p-2 rounded h-32">{{ old('description', $product->description) }}</textarea>
                    </div>
                </div>

                <!-- ÐŸÐ ÐÐ’ÐÐ¯ ÐšÐžÐ›ÐžÐÐšÐ (Images) -->
                <div class="lg:col-span-1">
                    <div class="bg-gray-50 p-4 rounded border sticky top-4">
                        <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">ðŸ“¸ Images <span class="text-xs font-normal text-gray-500">(Drag to reorder)</span></h3>
                        <input type="hidden" name="sorted_images_ids" id="sortedImagesIds">
                        <div id="existingImageList" class="space-y-2 mb-4 min-h-[20px]">
                            @foreach($product->images as $index => $img)
                                <div class="relative group bg-white p-2 rounded border flex items-center gap-3 cursor-move shadow-sm hover:shadow-md transition" data-id="{{ $img->id }}">
                                    <div class="text-gray-400 cursor-move px-1">â˜°</div>
                                    <img src="{{ $img->url }}" class="h-12 w-12 object-cover rounded border bg-gray-200">
                                    <div class="flex-1 text-xs">
                                        <div class="font-bold">Image #{{ $img->id }}</div>
                                        <div class="text-gray-400 order-badge">{{ $index === 0 ? 'Cover' : ($index + 1) }}</div>
                                    </div>
                                    <label class="cursor-pointer text-red-500 hover:bg-red-50 p-1 rounded">
                                        <input type="checkbox" name="deleted_images[]" value="{{ $img->id }}" class="hidden delete-checkbox" onchange="toggleDelete(this)">
                                        <span class="text-lg font-bold">&times;</span>
                                    </label>
                                </div>
                            @endforeach
                        </div>
                        <div id="newImagePreview" class="space-y-2 mb-4 border-t pt-4 border-dashed border-gray-300 hidden">
                            <p class="text-xs font-bold text-blue-600 uppercase">Ready to upload:</p>
                        </div>
                        <div class="mt-4">
                            <label class="block w-full cursor-pointer bg-blue-50 border-2 border-dashed border-blue-200 rounded p-4 text-center hover:bg-blue-100 transition">
                                <span class="text-sm font-bold text-blue-600">Click to Select Images</span>
                                <input type="file" name="{{ $product->exists ? 'new_images[]' : 'images[]' }}" multiple accept="image/*" class="hidden" onchange="handleFileSelect(event)">
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center pt-6 border-t mt-6">
                <a href="{{ route('admin.products.index', ['tenant_id' => $currentTenantId]) }}" class="text-gray-500 hover:underline">Cancel</a>
                <button class="bg-blue-600 text-white font-bold py-3 px-8 rounded hover:bg-blue-500 shadow-lg" onclick="updateOrder()">
                    {{ $product->exists ? 'Update Product' : 'Create Product' }}
                </button>
            </div>
        </form>
    </div>

    <script>
        // ... (ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹ Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ Ñ‚Ðµ Ð¶Ðµ)
        const existingList = document.getElementById('existingImageList');
        if (existingList) {
            Sortable.create(existingList, {
                animation: 150,
                onEnd: function () { updateOrder(); }
            });
        }
        function updateOrder() {
            if (!existingList) return;
            const items = Array.from(existingList.querySelectorAll('[data-id]'));
            const ids = items.map(item => item.getAttribute('data-id'));
            document.getElementById('sortedImagesIds').value = ids.join(',');
            items.forEach((item, index) => {
                const badge = item.querySelector('.order-badge');
                if (badge) badge.innerText = index === 0 ? 'Cover' : (index + 1);
            });
        }
        function toggleDelete(checkbox) {
            const row = checkbox.closest('.group');
            row.style.opacity = checkbox.checked ? '0.4' : '1';
            row.style.backgroundColor = checkbox.checked ? '#fee2e2' : 'white';
        }
        function handleFileSelect(event) {
            const container = document.getElementById('newImagePreview');
            container.innerHTML = '<p class="text-xs font-bold text-blue-600 uppercase">Ready to upload:</p>';
            container.classList.remove('hidden');
            Array.from(event.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'bg-blue-50 p-2 rounded border border-blue-100 flex items-center gap-3';
                    div.innerHTML = `<img src="${e.target.result}" class="h-10 w-10 object-cover rounded border bg-white"><div class="text-xs text-blue-900 truncate flex-1">${file.name}</div><div class="text-xs text-gray-500 font-mono">${(file.size/1024).toFixed(0)}KB</div>`;
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }
        updateOrder();
    </script>
@endsection
</file>

<file path="app/Models/Product.php">
<?php
// FILE: app/Models/Product.php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;
use App\Models\PromoCode;
use App\Services\TenantService;

class Product extends Model
{
    use HasFactory, SoftDeletes;

    protected $fillable = [
        'name', 'slug', 'description', 'price', 'sale_price',
        'sku', 'stock_quantity', 'attributes', 'clothing_line_id',
    ];

    protected $casts = [
        'attributes' => 'array',
        'price' => 'decimal:2',
        'sale_price' => 'decimal:2',
    ];

    public function categories()
    {
        return $this->belongsToMany(Category::class);
    }

    public function images()
    {
        return $this->hasMany(ProductImage::class)->orderBy('sort_order', 'asc');
    }

    public function variants()
    {
        return $this->hasMany(ProductVariant::class);
    }
    
    public function clothingLine()
    {
        return $this->belongsTo(ClothingLine::class);
    }

    // Ð¡ÐºÐ¸Ð´ÐºÐ¸
    public function getHasDiscountAttribute()
    {
        return $this->sale_price && $this->sale_price < $this->price;
    }

    public function getDiscountPercentageAttribute()
    {
        if (!$this->has_discount) return 0;
        return round((($this->price - $this->sale_price) / $this->price) * 100);
    }

    public function getCurrentPriceAttribute()
    {
        return $this->has_discount ? $this->sale_price : $this->price;
    }

    public function getCoverUrlAttribute()
    {
        $cover = $this->images->first();
        if ($cover) return $cover->url;
        $text = urlencode($this->sku ?? 'Product');
        return "https://placehold.co/600x600/e2e8f0/1e293b?text={$text}";
    }
    
    public function getImageUrlAttribute()
    {
        return $this->cover_url;
    }

    /**
     * Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÑÐ¿Ð¸ÑÐ¾Ðº Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð¾Ð², Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ð¼Ñ‹Ñ… Ðº ÑÑ‚Ð¾Ð¼Ñƒ Ñ‚Ð¾Ð²Ð°Ñ€Ñƒ.
     * Ð’ÐÐ˜ÐœÐÐÐ˜Ð•: Ð­Ñ‚Ð¾ Ð½Ðµ ÑÐ°Ð¼Ñ‹Ð¹ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ Ð´Ð»Ñ ÑÐ¿Ð¸ÑÐºÐ¾Ð² Ð¸Ð· 1000 Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²,
     * Ð½Ð¾ Ð´Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½ÐºÐ¸ Ð¸ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ñ‚Ð¾Ð²Ð°Ñ€Ð° Ð¿Ð¾Ð´Ð¾Ð¹Ð´ÐµÑ‚.
     */
    public function getApplicablePromosAttribute()
    {
        $tenantId = TenantService::getStaticCurrentTenantId();
        
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð²ÑÐµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹
        $promos = PromoCode::where('is_active', true)
            ->where(function($q) {
                $q->whereNull('expires_at')->orWhere('expires_at', '>', now());
            })
            ->get();

        $applicable = [];

        foreach ($promos as $promo) {
            $scope = $promo->scope_type;
            $data = $promo->scope_data ?? [];

            // Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° (Ð¸ Ð½Ðµ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹), Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÐ¼
            if ($scope !== 'global' && !isset($data[$tenantId])) {
                continue;
            }

            $match = false;

            if ($scope === 'global') {
                $match = true;
            } elseif ($scope === 'specific') {
                // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ID Ñ‚Ð¾Ð²Ð°Ñ€Ð°
                if (in_array($this->id, $data[$tenantId] ?? [])) {
                    $match = true;
                }
            } elseif ($scope === 'category') {
                // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
                $productCatSlugs = $this->categories->pluck('slug')->toArray();
                $promoCatSlugs = $data[$tenantId] ?? [];
                if (!empty(array_intersect($productCatSlugs, $promoCatSlugs))) {
                    $match = true;
                }
            } elseif ($scope === 'line') {
                // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð»Ð¸Ð½ÐµÐ¹ÐºÑƒ
                if ($this->clothingLine && in_array($this->clothingLine->slug, $data[$tenantId] ?? [])) {
                    $match = true;
                }
            }

            if ($match) {
                $applicable[] = $promo;
            }
        }

        return collect($applicable);
    }
}
</file>

<file path="resources/views/layouts/admin.blade.php">
<!-- FILE: resources/views/layouts/admin.blade.php -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - @yield('title')</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-gray-800 text-white flex flex-col flex-shrink-0">
            <div class="p-6 text-2xl font-bold bg-gray-900 border-b border-gray-700">
                Admin Panel
                <div class="text-xs font-normal text-gray-400 mt-1">
                    {{ request()->session()->get('is_super_admin') ? 'Super Admin' : 'Manager' }}
                </div>
                <div class="text-xs font-normal text-yellow-400 mt-1 uppercase">
                    {{ app(\App\Services\TenantService::class)->getCurrentTenantId() ?? 'Global' }}
                </div>
            </div>
            
            <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
                <!-- Dashboard -->
                <a href="{{ route('admin.dashboard') }}" 
                   class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.dashboard') ? 'bg-gray-700 text-yellow-400' : '' }}">
                   Dashboard
                </a>

                <!-- Orders -->
                <a href="{{ route('admin.orders.index') }}" 
                   class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.orders*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                   Orders
                </a>

                <a href="{{ route('admin.messages.index') }}" 
                    class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.messages*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                    Messages
                </a>

                <!-- Products -->
                <a href="{{ route('admin.products.index') }}" 
                   class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.products*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                   Products
                </a>

                <a href="{{ route('admin.inventory.index') }}" 
                    class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.inventory*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                    Inventory Report
                </a>

                <!-- Classification Group -->
                <div class="pt-4 pb-1 text-xs font-bold text-gray-500 uppercase tracking-wider">
                    Catalog Management
                </div>

                <a href="{{ route('admin.categories.index') }}" 
                   class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.categories*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                   Categories
                </a>

                <!-- Ð’ÐžÐ¢ Ð—Ð”Ð•Ð¡Ð¬ Ð‘Ð«Ð›Ð ÐžÐ¨Ð˜Ð‘ÐšÐ. Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾: Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ -->
                <a href="{{ route('admin.clothing-lines.index') }}" 
                   class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.clothing-lines*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                   Collections
                </a>

                <a href="{{ route('admin.attributes.index') }}" 
                   class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.attributes*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                   Attributes (Sizes)
                </a>
                @if(auth()->user()->role === 'super_admin')
                    <a href="{{ route('admin.promocodes.index') }}" 
                    class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.promocodes*') ? 'bg-blue-600 text-white' : '' }}">
                    Promo Codes
                    </a>
                @endif

                <!-- Users -->
                <div class="pt-4 pb-1 text-xs font-bold text-gray-500 uppercase tracking-wider">
                    System
                </div>

                @if(auth()->user()->role === 'super_admin')
                    <!-- ÐÐžÐ’ÐÐ¯ Ð¡Ð¡Ð«Ð›ÐšÐ ÐÐ ÐœÐ•ÐÐ•Ð”Ð–Ð•Ð ÐžÐ’ -->
                    <a href="{{ route('admin.managers.index') }}" class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.managers*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                        Managers
                    </a>
                @endif

                <a href="{{ route('admin.users.index') }}" 
                   class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.users*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                   Users
                </a>

                @if(auth()->user()->role === 'super_admin')
                    <a href="{{ route('admin.settings.index') }}" 
                       class="block px-4 py-2 hover:bg-gray-700 rounded {{ request()->routeIs('admin.settings*') ? 'bg-gray-700 text-yellow-400' : '' }}">
                       Settings & Telegram
                    </a>
                @endif
            </nav>

            <div class="p-4 border-t border-gray-700 bg-gray-900">
                <form action="{{ route('admin.logout') }}" method="POST">
                    @csrf
                    <button class="w-full text-left px-4 py-2 text-red-400 hover:text-white hover:bg-red-900 rounded transition flex items-center gap-2">
                        <span>ðŸšª</span> Logout
                    </button>
                </form>
            </div>
        </aside>

        <!-- Content -->
        <main class="flex-1 overflow-y-auto p-8 bg-gray-100">
            <!-- Global Flash Messages -->
            @if(session('success'))
                <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded shadow-sm flex justify-between items-center">
                    <div>{{ session('success') }}</div>
                    <button onclick="this.parentElement.remove()" class="text-green-900 font-bold">&times;</button>
                </div>
            @endif
            
            @if(session('error'))
                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded shadow-sm flex justify-between items-center">
                    <div>{{ session('error') }}</div>
                    <button onclick="this.parentElement.remove()" class="text-red-900 font-bold">&times;</button>
                </div>
            @endif

            @if ($errors->any())
                <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded shadow-sm">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">There were errors with your submission</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <ul class="list-disc pl-5 space-y-1">
                                    @foreach ($errors->all() as $error)
                                        <li>{{ $error }}</li>
                                    @endforeach
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            @endif

            @yield('content')
        </main>
    </div>
</body>
</html>
</file>

<file path="app/Http/Controllers/Admin/ProductController.php">
<?php
// FILE: app/Http/Controllers/Admin/ProductController.php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use App\Models\Product;
use App\Models\ProductImage;
use App\Models\ProductVariant;
use App\Models\AttributeOption;
use App\Models\ClothingLine;
use App\Services\ProductService;
use App\Services\TenantService;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage;
use Illuminate\Support\Str;
use Illuminate\Support\Collection;
use Illuminate\Support\Facades\DB; // Ð’Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹

class ProductController extends Controller
{
    protected TenantService $tenantService;
    protected ProductService $productService;

    public function __construct(TenantService $tenantService, ProductService $productService)
    {
        $this->tenantService = $tenantService;
        $this->productService = $productService;
    }

    // --- CONTEXT HELPERS (ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°) ---

    private function resolveContext(Request $request)
    {
        $user = auth()->user();
        
        // Ð•ÑÐ»Ð¸ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€ - Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÐ³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½
        if ($user->role !== 'super_admin') {
            return $this->tenantService->getCurrentTenantId();
        }

        // Ð•ÑÐ»Ð¸ ÑÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½ Ð¿ÐµÑ€ÐµÐ´Ð°Ð» ID Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
        $tenantId = $request->get('tenant_id');
        if ($tenantId) {
            $this->tenantService->switchTenant($tenantId);
            return $tenantId;
        }

        // Ð•ÑÐ»Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ ÑƒÐ¶Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½
        $current = $this->tenantService->getCurrentTenantId();
        if ($current) return $current;

        return null;
    }

    // --- ACTIONS (ÐœÐµÑ‚Ð¾Ð´Ñ‹ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹) ---

    public function index(Request $request)
    {
        $isSuperAdmin = auth()->user()->role === 'super_admin';
        $selectedTenant = $request->get('tenant_id');
        
        // Ð ÐµÐ¶Ð¸Ð¼ "ALL STORES" (Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ ÑÑƒÐ¿ÐµÑ€-Ð°Ð´Ð¼Ð¸Ð½Ð° Ð±ÐµÐ· Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°)
        if ($isSuperAdmin && empty($selectedTenant)) {
            $products = $this->getAllTenantsProducts($request);
            // ÐŸÑƒÑÑ‚Ñ‹Ðµ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸ Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²
            $categories = new Collection(); 
            $sizes = new Collection(); 
            $types = new Collection();
            $lines = new Collection();
            $currentTenantId = null;
            return view('admin.products.index', compact('products', 'categories', 'sizes', 'types', 'lines', 'currentTenantId'));
        }

        // Ð ÐµÐ¶Ð¸Ð¼ "SINGLE STORE"
        $currentTenantId = $this->resolveContext($request);
        
        // Ð¤Ð¾Ð»Ð»Ð±ÐµÐº Ð´Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½Ð°: ÐµÑÐ»Ð¸ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½ Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½, Ð±ÐµÑ€ÐµÐ¼ Ð¿ÐµÑ€Ð²Ñ‹Ð¹
        if (!$currentTenantId && $isSuperAdmin) {
             $first = array_key_first(config('tenants.tenants'));
             $this->tenantService->switchTenant($first);
             $currentTenantId = $first;
        }

        // Ð—Ð°Ð¿Ñ€Ð¾Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² Ñ Ð¶Ð°Ð´Ð½Ð¾Ð¹ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹ ÑÐ²ÑÐ·ÐµÐ¹
        $query = Product::with(['categories', 'images', 'variants', 'clothingLine']);

        // --- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ ---
        if ($request->filled('search')) {
            $query->where(fn($q) => $q->where('name', 'ilike', "%{$request->search}%")->orWhere('sku', 'ilike', "%{$request->search}%"));
        }
        if ($request->filled('category_id')) {
            $query->whereHas('categories', fn($q) => $q->where('categories.id', $request->category_id));
        }
        if ($request->filled('clothing_line_id')) {
            $query->where('clothing_line_id', $request->clothing_line_id);
        }
        if ($request->filled('size')) {
            $query->whereRaw("attributes->'size' ? ?", [$request->size]);
        }
        if ($request->filled('type')) {
            $query->whereRaw("attributes->>'type' = ?", [$request->type]);
        }

        $products = $query->latest()->paginate(20)->withQueryString();
        
        // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ URL Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð°
        $tenantDomain = config('tenants.tenants.' . $currentTenantId . '.domain');
        foreach ($products as $product) {
            $product->preview_url = "http://{$tenantDomain}/products/{$product->slug}?preview=true";
            $product->tenant_name = config("tenants.tenants.{$currentTenantId}.name");
            $product->tenant_id = $currentTenantId;
        }

        // Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð²Ñ‹Ð¿Ð°Ð´Ð°ÑŽÑ‰Ð¸Ñ… ÑÐ¿Ð¸ÑÐºÐ¾Ð² Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²
        $categories = Category::orderBy('name')->get();
        $lines = ClothingLine::orderBy('name')->get(); 
        $sizes = AttributeOption::where('type', 'size')->orderBy('value')->get();
        $types = AttributeOption::where('type', 'product_type')->orderBy('value')->get();

        return view('admin.products.index', compact('products', 'categories', 'sizes', 'types', 'lines', 'currentTenantId'));
    }

    // Ð¤Ð¾Ñ€Ð¼Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ/Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
    public function form(Request $request, $id = null)
    {
        $currentTenantId = $this->resolveContext($request);
        if (!$currentTenantId && auth()->user()->role === 'super_admin') {
             $first = array_key_first(config('tenants.tenants'));
             $this->tenantService->switchTenant($first);
             $currentTenantId = $first;
        }

        if ($id) {
            $product = Product::with(['categories', 'images', 'variants', 'clothingLine'])->findOrFail($id);
            $action = route('admin.products.update', $product->id);
            $method = 'PUT';
            $title = "Edit: " . $product->name;
            $tenantDomain = config('tenants.tenants.' . $currentTenantId . '.domain');
            $previewUrl = "http://{$tenantDomain}/products/{$product->slug}?preview=true";
        } else {
            $product = new Product();
            $action = route('admin.products.store');
            $method = 'POST';
            $title = "Add New Product";
            $previewUrl = null;
        }

        $categories = Category::all();
        $lines = ClothingLine::all(); 
        $sizes = AttributeOption::where('type', 'size')->get();
        $types = AttributeOption::where('type', 'product_type')->get();

        return view('admin.products.form', compact(
            'product', 'action', 'method', 'title', 'categories', 'lines', 'sizes', 'types', 'currentTenantId', 'previewUrl'
        ));
    }

    public function create(Request $request) { return $this->form($request); }
    public function edit(Request $request, $id) { return $this->form($request, $id); }

    // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€Ð°
    public function store(Request $request)
    {
        // ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½, ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾
        if (auth()->user()->role === 'super_admin' && $request->has('target_tenant')) {
            $this->tenantService->switchTenant($request->target_tenant);
        } else {
            $this->resolveContext($request);
        }

        $validated = $this->validateProduct($request);

        // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ: Ð²ÑÑ‘ Ð¸Ð»Ð¸ Ð½Ð¸Ñ‡ÐµÐ³Ð¾
        DB::transaction(function () use ($request, $validated) {
            
            // 1. Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼ Ð¾Ð±Ñ‰Ð¸Ð¹ ÑÑ‚Ð¾Ðº Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð²
            $variantsInput = $request->input('variants', []);
            $totalStock = 0;
            $sizeList = [];
            
            foreach ($variantsInput as $v) {
                if (!empty($v['size'])) {
                    $totalStock += (int)($v['stock'] ?? 0);
                    $sizeList[] = $v['size'];
                }
            }

            // 2. ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¸Ð»Ð¸ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð›Ð¸Ð½ÐµÐ¹ÐºÑƒ ÐžÐ´ÐµÐ¶Ð´Ñ‹
            $lineId = $this->resolveClothingLineId($request->clothing_line);

            // 3. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚ (Ð’ÐºÐ»ÑŽÑ‡Ð°Ñ sale_price)
            $product = $this->productService->create([
                'name' => $validated['name'],
                'slug' => Str::slug($validated['name']) . '-' . Str::random(4),
                'price' => $validated['price'],
                'sale_price' => $validated['sale_price'] ?? null, // Ð¡ÐºÐ¸Ð´ÐºÐ°
                'sku' => $validated['sku'],
                'stock_quantity' => $totalStock, // Ð’Ñ‹Ñ‡Ð¸ÑÐ»ÐµÐ½Ð½Ñ‹Ð¹ ÑÑ‚Ð¾Ðº
                'description' => $request->input('description'),
                'clothing_line_id' => $lineId,
                'attributes' => [
                    'type' => $request->attributes_type,
                    'size' => $sizeList,
                ]
            ]);

            // 4. Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ ÑÐ²ÑÐ·Ð¸
            $this->syncAttributesData($request->attributes_type, $sizeList);
            $this->syncCategories($product, $request->categories);
            $this->syncImages($request, $product);
            $this->syncVariants($product, $variantsInput);
        });

        return redirect()->route('admin.products.index', ['tenant_id' => $this->tenantService->getCurrentTenantId()])
                         ->with('success', 'Product created successfully.');
    }

    // ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð°
    public function update(Request $request, $id)
    {
        $this->resolveContext($request);
        $product = Product::findOrFail($id);
        
        $validated = $this->validateProduct($request, $id);
        
        DB::transaction(function () use ($request, $product, $validated) {
            
            // 1. ÐŸÐµÑ€ÐµÑÑ‡ÐµÑ‚ ÑÑ‚Ð¾ÐºÐ°
            $variantsInput = $request->input('variants', []);
            $totalStock = 0;
            $sizeList = [];
            
            foreach ($variantsInput as $v) {
                if (!empty($v['size'])) {
                    $totalStock += (int)($v['stock'] ?? 0);
                    $sizeList[] = $v['size'];
                }
            }

            // 2. Ð›Ð¸Ð½ÐµÐ¹ÐºÐ°
            $lineId = $this->resolveClothingLineId($request->clothing_line);

            // 3. ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÐµÐ¹ (Ð’ÐºÐ»ÑŽÑ‡Ð°Ñ sale_price)
            $product->update([
                'name' => $validated['name'],
                'price' => $validated['price'],
                'sale_price' => $validated['sale_price'] ?? null, // Ð¡ÐºÐ¸Ð´ÐºÐ°
                'sku' => $validated['sku'],
                'stock_quantity' => $totalStock,
                'description' => $request->input('description'),
                'clothing_line_id' => $lineId,
                'attributes' => [
                    'type' => $request->attributes_type,
                    'size' => $sizeList,
                ]
            ]);

            // 4. Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ²ÑÐ·ÐµÐ¹
            $this->syncAttributesData($request->attributes_type, $sizeList);
            $this->syncCategories($product, $request->categories);
            $this->syncImagesUpdate($request, $product);
            $this->syncVariants($product, $variantsInput);
        });

        return redirect()->route('admin.products.index', ['tenant_id' => $this->tenantService->getCurrentTenantId()])
                         ->with('success', 'Product updated successfully.');
    }

    public function destroy(Request $request, $id)
    {
        $this->resolveContext($request);
        $product = Product::findOrFail($id);
        $this->productService->delete($product);
        return back()->with('success', 'Product deleted.');
    }

    // --- PRIVATE HELPERS (ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹) ---

    private function validateProduct(Request $request, $id = null)
    {
        return $request->validate([
            'name' => 'required|string|max:255',
            'price' => 'required|numeric|min:0',
            // Ð¡ÐºÐ¸Ð´ÐºÐ° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¼ÐµÐ½ÑŒÑˆÐµ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð¹ Ñ†ÐµÐ½Ñ‹
            'sale_price' => 'nullable|numeric|min:0|lt:price', 
            'sku' => 'required|string|max:50',
            'categories' => 'required|array',
            'attributes_type' => 'required|string',
            'clothing_line' => 'nullable|string|max:255',
            
            'variants.*.size' => 'required|string',
            'variants.*.stock' => 'required|integer|min:0',
            
            'images.*' => 'image|max:10240',
            'new_images.*' => 'image|max:10240',
        ]);
    }

    private function resolveClothingLineId(?string $name): ?int
    {
        if (empty($name)) return null;
        $slug = Str::slug($name);
        $line = ClothingLine::firstOrCreate(['slug' => $slug], ['name' => $name]);
        return $line->id;
    }

    private function syncAttributesData($type, $sizes)
    {
        $typeSlug = Str::slug($type);
        AttributeOption::firstOrCreate(['type' => 'product_type', 'slug' => $typeSlug], ['value' => $type]);
        foreach ($sizes as $sizeName) {
            $sizeSlug = Str::slug($sizeName);
            AttributeOption::firstOrCreate(['type' => 'size', 'slug' => $sizeSlug], ['value' => $sizeName]);
        }
    }

    private function syncCategories(Product $product, array $categoriesInput)
    {
        $categoryIds = [];
        foreach ($categoriesInput as $input) {
            if (is_numeric($input)) {
                $categoryIds[] = $input;
            } else {
                $slug = Str::slug($input);
                $newCat = Category::firstOrCreate(['slug' => $slug], ['name' => $input]);
                $categoryIds[] = $newCat->id;
            }
        }
        $product->categories()->sync($categoryIds);
    }

    private function syncImages(Request $request, Product $product)
    {
        if ($request->hasFile('images')) {
            foreach ($request->file('images') as $index => $file) {
                $path = $file->store('media', 'tenant');
                ProductImage::create(['product_id' => $product->id, 'path' => $path, 'sort_order' => $index]);
            }
        }
    }

    private function syncImagesUpdate(Request $request, Product $product)
    {
        // Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ñ‹Ñ…
        if ($request->hasFile('new_images')) {
            $maxOrder = $product->images()->max('sort_order') ?? -1;
            foreach ($request->file('new_images') as $file) {
                $path = $file->store('media', 'tenant');
                ProductImage::create(['product_id' => $product->id, 'path' => $path, 'sort_order' => ++$maxOrder]);
            }
        }
        // Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ñ…
        if ($request->filled('deleted_images')) {
            $images = ProductImage::whereIn('id', $request->input('deleted_images'))->where('product_id', $product->id)->get();
            foreach ($images as $img) {
                Storage::disk('tenant')->delete($img->path);
                $img->delete();
            }
        }
        // Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°
        if ($request->filled('sorted_images_ids')) {
            $sortedIds = explode(',', $request->input('sorted_images_ids'));
            foreach ($sortedIds as $index => $imgId) {
                ProductImage::where('id', $imgId)->where('product_id', $product->id)->update(['sort_order' => $index]);
            }
        }
    }

    private function syncVariants(Product $product, array $variantsInput)
    {
        // Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð¸ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ðµ
        $product->variants()->delete();
        foreach ($variantsInput as $v) {
            if (!empty($v['size'])) {
                ProductVariant::create([
                    'product_id' => $product->id, 
                    'size' => $v['size'], 
                    'stock' => (int)($v['stock'] ?? 0)
                ]);
            }
        }
    }
    
    // ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² ÑÐ¾ Ð²ÑÐµÑ… Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð¾Ð² (Ð´Ð»Ñ Super Admin)
    private function getAllTenantsProducts(Request $request) {
        $allProducts = new Collection();
        foreach (config('tenants.tenants') as $id => $config) {
            try {
                $this->tenantService->switchTenant($id);
                // Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð²Ð¼ÐµÑÑ‚Ðµ Ñ clothingLine
                $query = Product::with(['categories', 'images', 'variants', 'clothingLine'])->latest()->take(5);
                
                if ($request->filled('search')) {
                    $s = $request->search;
                    $query->where(fn($q) => $q->where('name', 'ilike', "%$s%")->orWhere('sku', 'ilike', "%$s%"));
                }
                $products = $query->get();
                $products->each(function($p) use ($config, $id) {
                    $p->tenant_name = $config['name'];
                    $p->tenant_id = $id;
                    $p->preview_url = "http://{$config['domain']}/products/{$p->slug}?preview=true";
                });
                $allProducts = $allProducts->merge($products);
            } catch (\Exception $e) { continue; }
        }
        return $allProducts;
    }
}
</file>

<file path="routes/web.php">
<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\ShopController;
use App\Http\Controllers\Admin\AuthController;
use App\Http\Controllers\Admin\DashboardController;
use App\Http\Controllers\Admin\OrderController;
use App\Http\Controllers\Admin\SettingsController;
use App\Http\Controllers\Admin\UserController;
use App\Http\Controllers\Admin\ReportController;
use App\Http\Controllers\Admin\ProductController;
use App\Http\Controllers\Admin\CategoryController;
use App\Http\Controllers\Admin\AttributeController;
use App\Http\Controllers\Admin\TelegramSettingsController;
use App\Http\Controllers\Admin\ClothingLineController;
use App\Http\Controllers\Admin\PromoCodeController;
use App\Http\Controllers\Admin\InventoryController;
use App\Http\Controllers\Admin\ManagerController; 
use App\Http\Controllers\Admin\ContactMessageController; // NEW
use App\Http\Middleware\AdminTenantMiddleware;
use App\Http\Middleware\SuperAdminMiddleware; 
use App\Http\Controllers\CartController;
use App\Http\Controllers\Client\AuthController as ClientAuthController;
use App\Http\Controllers\Client\ProfileController;
use App\Http\Controllers\Client\ContactController; // NEW

// --- ÐÐ”ÐœÐ˜Ð ÐŸÐÐÐ•Ð›Ð¬ ---
Route::domain(config('tenants.admin_domain'))->group(function () {
    Route::get('/', function () { return redirect()->route('admin.dashboard'); });
    Route::middleware('guest')->prefix('admin')->group(function () {
        Route::get('/login', [AuthController::class, 'showLoginForm'])->name('admin.login');
        Route::post('/login', [AuthController::class, 'login']);
    });

    Route::middleware(['auth', AdminTenantMiddleware::class])->prefix('admin')->name('admin.')->group(function () {
        Route::post('/logout', [AuthController::class, 'logout'])->name('logout');
        Route::get('/', [DashboardController::class, 'index'])->name('dashboard');
        
        Route::post('/switch-tenant', function (\Illuminate\Http\Request $request) {
            if (auth()->user()->role !== 'super_admin') abort(403);
            if ($request->tenant_id === 'root') session()->forget('admin_current_tenant_id');
            else session()->put('admin_current_tenant_id', $request->tenant_id);
            return back();
        })->name('switch_tenant');

        Route::resource('users', UserController::class)->only(['index', 'show', 'update']);
        
        Route::resource('managers', ManagerController::class)
            ->middleware(SuperAdminMiddleware::class);

        Route::resource('orders', OrderController::class)->only(['index', 'show', 'update']);
        Route::post('/orders/{id}/notify', [OrderController::class, 'sendNotification'])->name('orders.notify');
        
        // --- Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð¯ (ÐÐžÐ’ÐžÐ•) ---
        Route::resource('messages', ContactMessageController::class)->only(['index', 'show', 'destroy']);
        // -------------------------

        Route::resource('products', ProductController::class);
        Route::resource('categories', CategoryController::class);
        Route::get('/attributes', [AttributeController::class, 'index'])->name('attributes.index');
        Route::post('/attributes', [AttributeController::class, 'store'])->name('attributes.store');
        Route::delete('/attributes/{id}', [AttributeController::class, 'destroy'])->name('attributes.destroy');
        Route::resource('clothing-lines', ClothingLineController::class);
        Route::resource('promocodes', PromoCodeController::class)->only(['index', 'create', 'store', 'destroy']);
        
        Route::prefix('settings/telegram')->name('settings.telegram.')->group(function () {
            Route::get('/', [TelegramSettingsController::class, 'index'])->name('index');
            Route::post('/', [TelegramSettingsController::class, 'store'])->name('store');
            Route::put('/{id}', [TelegramSettingsController::class, 'update'])->name('update');
            Route::delete('/{id}', [TelegramSettingsController::class, 'destroy'])->name('destroy');
            Route::get('/{id}/test', [TelegramSettingsController::class, 'test'])->name('test');
            Route::post('/send-message', [TelegramSettingsController::class, 'sendMessage'])->name('sendMessage');
        });

        Route::get('/reports', [ReportController::class, 'index'])->name('reports.index');
        Route::get('/settings', [SettingsController::class, 'index'])->name('settings.index');
        Route::post('/settings', [SettingsController::class, 'update'])->name('settings.update');
        Route::get('/inventory', [InventoryController::class, 'index'])->name('inventory.index');
        Route::post('/inventory/send-telegram', [InventoryController::class, 'sendToTelegram'])->name('inventory.send_telegram');
    });
});

// --- ÐœÐÐ“ÐÐ—Ð˜ÐÐ« (ÐšÐ›Ð˜Ð•ÐÐ¢Ð¡ÐšÐÐ¯ Ð§ÐÐ¡Ð¢Ð¬) ---
Route::group([], function () {
    
    // Auth
    Route::get('/login', [ClientAuthController::class, 'showLogin'])->name('client.login');
    Route::post('/login', [ClientAuthController::class, 'login']);
    Route::post('/logout', [ClientAuthController::class, 'logout'])->name('client.logout');

    // Cart
    Route::get('/cart', [CartController::class, 'index'])->name('cart.index');
    Route::post('/cart/add', [CartController::class, 'addToCart'])->name('cart.add');
    Route::post('/cart/remove/{rowId}', [CartController::class, 'removeFromCart'])->name('cart.remove');
    Route::post('/cart/promo', [CartController::class, 'applyPromo'])->name('cart.promo');
    Route::post('/checkout', [CartController::class, 'checkout'])->name('checkout');

    // Profile
    Route::middleware('auth')->group(function () {
        Route::get('/user-profile', [ProfileController::class, 'index'])->name('client.profile');
        Route::get('/user-profile/orders/{id}', [ProfileController::class, 'showOrder'])->name('client.orders.show');
        Route::post('/user-profile/password', [ClientAuthController::class, 'updatePassword'])->name('client.password.update');
    });

    // --- ÐšÐžÐÐ¢ÐÐšÐ¢Ð« (ÐÐžÐ’ÐžÐ•) ---
    Route::get('/contact', [ContactController::class, 'index'])->name('contact.index');
    Route::post('/contact', [ContactController::class, 'store'])->name('contact.store');
    // -------------------------

    // Main & Products
    Route::get('/', [ShopController::class, 'index'])->name('home');
    Route::get('/products/{slug}', [ShopController::class, 'show'])->name('product.show');
});
</file>

</files>
